"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6338],{98747:function(e,t,n){n.d(t,{gb:function(){return _},ot:function(){return y.Z},_h:function(){return N.Z}});var r=n(15009),s=n.n(r),a=n(99289),o=n.n(a),c=n(5574),u=n.n(c),l=n(64119),i=n(37476),d=n(98097),p=n(59530),f=n(45360),h=n(27484),x=n.n(h),v=n(38823),g=n.n(v),b=n(70178),S=n.n(b),m=n(62435),k=n(86074);x().extend(S()),x().extend(g());var j=m.forwardRef((function(e,t){var n=f.ZP.useMessage(),r=u()(n,2),a=r[0],c=r[1],h=(0,p.useSelector)((function(e){return e.global.contractKit})),v=(0,m.useState)(),g=u()(v,2),b=g[0],S=g[1],j=(0,m.useState)(),_=u()(j,2),y=_[0],N=_[1],w=(0,m.useRef)(),D=(0,m.useState)(!1),O=u()(D,2),F=O[0],I=O[1],C=(0,m.useState)(!0),R=u()(C,2),P=R[0],Z=R[1],E=(0,m.useCallback)(function(){var e=o()(s()().mark((function e(t,n){var r,o,c;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.load("dfsweb3desoc");case 3:return r=e.sent,o=r.table("profiles"),e.next=7,o.all({scope:"dfsweb3desoc",from:n.voter.toString(),to:n.voter.toString()});case 7:c=e.sent,S(c[0]),Z(!1),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),(0,l.Tv)(e.t0,a);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}(),[a]),A=(0,m.useCallback)((function(e){E(h,e),N(e),I(!0)}),[h]);(0,m.useImperativeHandle)(t,(function(){return{handleOpen:A}}));var M=(0,m.useCallback)(o()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)}))),[]),z=(0,m.useCallback)((function(e){return e?"DFSNode.Online - 广州"===e?"DFSOnline-广州@":"DFSNode.Online - 杭州"===e?"DFSOnline-杭州@":"DFSNode.Online - 香港"===e?"DFSOnline-香港@":"DFSNode.Online - 张家口"===e?"DFSOnline-张家口@":"DFSNode.Online - 呼和浩特"===e?"DFSOnline-呼和浩特@":"DFS-美国弗吉尼亚-Node"===e?"DFS-美国弗吉尼亚@":"DFS-北京节点（持续在线）"===e?"DFS-北京节点@":"DFS-广州（持续在线）"===e?"DFS-广州@":e+"@":""}),[]),J=(0,m.useMemo)((function(){return[{title:"sex",dataIndex:"sex",key:"sex",render:function(e,t){return Object.keys(t).length?(0,k.jsx)("span",{children:t.sex.toNumber()}):(0,k.jsx)("span",{children:"null"})}},{title:"cover",dataIndex:"cover",key:"cover",render:function(e,t){return Object.keys(t).length?(0,k.jsx)("span",{children:t.cover}):(0,k.jsx)("span",{children:"null"})}},{title:"desc",dataIndex:"desc",key:"desc",render:function(e,t){return Object.keys(t).length?(0,k.jsx)("span",{children:t.desc}):(0,k.jsx)("span",{children:"null"})}},{title:"avatar",dataIndex:"avatar",key:"avatar",render:function(e,t){return Object.keys(t).length?(0,k.jsx)("span",{children:t.avatar}):(0,k.jsx)("span",{children:"null"})}},{title:"join",dataIndex:"join",key:"join",render:function(e,t){return Object.keys(t).length?(0,k.jsx)("span",{children:x().utc(t.join.toString()).local().format()}):(0,k.jsx)("span",{children:"null"})}},{title:"update",dataIndex:"update",key:"update",render:function(e,t){return Object.keys(t).length?(0,k.jsx)("span",{children:x().utc(t.update.toString()).local().format()}):(0,k.jsx)("span",{children:"null"})}}]}),[]);return(0,k.jsxs)(i.Y,{formRef:w,title:"",open:F,onFinish:M,onOpenChange:function(e){I(e)},layout:"horizontal",width:"350px",submitter:!1,children:[(0,k.jsx)(d.vY,{title:(0,k.jsx)("div",{className:"flex items-center",children:(0,k.jsx)("div",{className:"",children:z(null==b?void 0:b.nick)+(null==y?void 0:y.voter.toString())})}),loading:P,column:1,dataSource:b,columns:J}),c]})})),_=(0,m.memo)(j),y=n(95260),N=n(98531)},98239:function(e,t,n){n.r(t),n.d(t,{default:function(){return N}});var r=n(15009),s=n.n(r),a=n(52677),o=n.n(a),c=n(99289),u=n.n(c),l=n(5574),i=n.n(l),d=n(98747),p=n(9004),f=n(19601),h=n(64119),x=n(11774),v=n(92340),g=n(59530),b=n(45360),S=n(71230),m=n(15746),k=n(62435),j=n(86074),_=0,y=0,N=function(){var e=b.ZP.useMessage(),t=i()(e,2),n=t[0],r=t[1],a=(0,k.useState)(!1),c=i()(a,2),l=c[0],N=c[1],w=(0,g.useDispatch)(),D=(0,g.useSelector)((function(e){return e.global.session})),O=(0,g.useSelector)((function(e){return e.global.contractKit})),F=(0,g.useSelector)((function(e){return e.vote.producerDataSource1})),I=(0,g.useSelector)((function(e){return e.vote.producerDataSource2})),C=(0,k.useState)(""),R=i()(C,2),P=R[0],Z=R[1],E=(0,k.useRef)(),A=(0,k.useCallback)(function(){var e=u()(s()().mark((function e(t,r){var a,c,u,l,i,d,h,x,v,g,b,S,m,k,j,_,y;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.load("eosio");case 3:return a=e.sent,e.next=6,r.load("dfsbpsvoters");case 6:return c=e.sent,u=c.table("bpstatus"),l=a.table("producers"),i=c.table("bpinfos"),e.next=12,u.all();case 12:return d=e.sent,e.next=15,l.all();case 15:return h=e.sent,e.next=18,i.all();case 18:return x=e.sent,e.next=21,t.client.v1.chain.get_currency_stats("eosio.token","DFS");case 21:return v=e.sent,e.next=24,t.client.v1.chain.get_currency_balance("eosio.token","dfsbpsvoters","DFS");case 24:return g=e.sent,e.next=27,t.client.v1.chain.get_producer_schedule();case 27:b=e.sent,S=b.active.producers,m=d.reduce((function(e,t){return e+t.current_status.toNumber()}),0),k={totalNodes:d.length,totalProducers:S.length,totalNodesOnline:m,rewardMinVotes:v.DFS.supply.value/1e4,bpRewardPoolBal:g[0].value},w(p.N.setNodeInfo(k)),(j=h.sort((function(e,t){return t.total_votes.value-e.total_votes.value}))).forEach((function(e,t){j[t].rank=t+1})),S.forEach((function(e,t){var n=j.find((function(t){return t.owner.toString()===e.producer_name.toString()}));S[t].is_active=n.is_active,S[t].last_claim_time=n.last_claim_time,S[t].producer_authority=n.producer_authority,S[t].producer_key=n.producer_key,S[t].total_votes=n.total_votes,S[t].url=n.url,S[t].rank=n.rank;var r=x.find((function(t){return t.bp.toString()===e.producer_name.toString()}));r?(S[t].intro=r.intro,S[t].location=r.location,S[t].logo=r.logo,S[t].nick=r.nick,S[t].p2purl=r.p2purl,S[t].rpcurl=r.rpcurl):(S[t].intro="",S[t].location="",S[t].logo="https://dfs.land/assets/icons/48x48.png",S[t].nick="",S[t].p2purl="NA",S[t].rpcurl="NA");var s=d.find((function(t){return t.bp.toString()===e.producer_name.toString()}));S[t].bp=s.bp,S[t].current_status=s.current_status,S[t].p2pstatus=s.p2pstatus,S[t].rpcstatus=s.rpcstatus,S[t].total_reward=s.total_reward})),S.forEach((function(e,t){S[t].key=t,"1"===S[t].current_status.toString()&&e.total_votes.value/1e8>=k.rewardMinVotes?S[t].is_reward="1":S[t].is_reward="0"})),_=[],y=[],S.forEach((function(e,t){t<15?_.push(e):y.push(e)})),w(f.N.setProducerDataSource1(_)),w(f.N.setProducerDataSource2(y)),N(!1),e.next=48;break;case 44:e.prev=44,e.t0=e.catch(0),N(!1),e.t0 instanceof Error?(console.log(e.t0.message),n.error(e.t0.message)):e.t0.response?(console.log(e.t0.response),n.error(JSON.stringify(e.t0.response.data))):e.t0.request?(console.log("no response"),n.error("No response")):(console.log(e.t0),"object"===o()(e.t0)?n.error(JSON.stringify(e.t0)):n.error(e.t0));case 48:case"end":return e.stop()}}),e,null,[[0,44]])})));return function(t,n){return e.apply(this,arguments)}}(),[]),M=(0,k.useCallback)(function(){var e=u()(s()().mark((function e(t){var n,r,a,o;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=8;break}return e.next=3,(0,h.zI)(t.client.v1.chain.get_info());case 3:n=e.sent,r=i()(n,2),a=r[0],(o=r[1])?Z(o.head_block_producer.toString()):(Z(""),console.log(a));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);(0,k.useEffect)((function(){D&&O?(F.length&&I.length?N(!1):N(!0),A(D,O),M(D)):N(!0)}),[D,O,A,M]),(0,k.useEffect)((function(){return D&&(_=setInterval((function(){M(D)}),6e3)),function(){clearInterval(_)}}),[D,M]),(0,k.useEffect)((function(){return D&&O&&(y=setInterval((function(){A(D,O)}),12e4)),function(){clearInterval(y)}}),[D,O,A]);var z=(0,k.useMemo)((function(){return[{title:"Pruducer",dataIndex:"bp",key:"bp",fixed:!0,render:function(e,t){return P===t.bp.toString()?(0,j.jsx)("span",{className:"text-blue-500 hover:cursor-pointer",children:t.key+1+". "+t.bp.toString()}):(0,j.jsx)("span",{className:"hover:cursor-pointer",children:t.key+1+". "+t.bp.toString()})}},{title:"RPC",dataIndex:"rpcstatus",key:"rpcstatus",align:"center",render:function(e,t){return(0,j.jsx)("div",{children:"online"===t.rpcstatus?(0,j.jsx)("div",{children:1}):(0,j.jsx)("div",{className:"text-red-600 font-semibold",children:0})})}},{title:"P2P",dataIndex:"rpcstatus",key:"rpcstatus",align:"center",render:function(e,t){return(0,j.jsx)("div",{children:"online"===t.p2pstatus?(0,j.jsx)("div",{children:1}):(0,j.jsx)("div",{className:"text-red-600 font-semibold",children:0})})}},{title:"Reward",dataIndex:"current_status",key:"current_status",align:"center",render:function(e,t){return(0,j.jsx)("div",{children:"1"===t.current_status.toString()?(0,j.jsx)("div",{children:1}):(0,j.jsx)("div",{className:"text-red-600 font-semibold",children:0})})}}]}),[P]);return(0,j.jsxs)(x._z,{className:"producer",ghost:!0,children:[(0,j.jsxs)(S.Z,{gutter:10,className:"w-full",children:[(0,j.jsx)(m.Z,{lg:{span:"12"},md:{span:"12"},sm:{span:"24"},xs:{span:"24"},children:(0,j.jsx)(v.Z,{className:"mb-3",scroll:{x:!0},size:"small",columns:z,dataSource:F,defaultData:[],search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,loading:l,rowClassName:function(e){return e.bp.toString()===P?"bg-blue-200":""},onRow:function(e){return{onClick:function(){E.current.handleOpen(e)}}}})}),(0,j.jsx)(m.Z,{lg:{span:"12"},md:{span:"12"},sm:{span:"24"},xs:{span:"24"},children:(0,j.jsx)(v.Z,{className:"mb-3",scroll:{x:!0},size:"small",columns:z,dataSource:I,defaultData:[],search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,loading:l,rowClassName:function(e){return e.bp.toString()===P?"bg-blue-200":""},onRow:function(e){return{onClick:function(){E.current.handleOpen(e)}}}})})]}),(0,j.jsx)(d.ot,{ref:E}),r]})}}}]);