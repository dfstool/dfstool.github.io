(self.webpackChunk=self.webpackChunk||[]).push([[2674],{91604:function(e,t,r){"use strict";r.d(t,{Z:function(){return h}});var n=r(1413),a=r(87462),o=r(62435),s={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},i=r(84089),c=function(e,t){return o.createElement(i.Z,(0,a.Z)({},e,{ref:t,icon:s}))};var u=o.forwardRef(c),l=r(28459),f=r(2058),d=r(9105),p=r(90789),m=r(86074),g=o.forwardRef((function(e,t){var r=e.fieldProps,a=e.title,s=void 0===a?"单击或拖动文件到此区域进行上传":a,i=e.icon,c=void 0===i?(0,m.jsx)(u,{}):i,p=e.description,g=void 0===p?"支持单次或批量上传":p,h=e.action,x=e.accept,b=e.onChange,v=e.value,w=e.children,k=e.max,y=e.proFieldProps,S=(0,o.useContext)(l.ZP.ConfigContext),j=(0,o.useContext)(d.A),C=(null==y?void 0:y.mode)||j.mode||"edit",N=S.getPrefixCls("upload"),F=(void 0===k||!v||(null==v?void 0:v.length)<k)&&"read"!==C&&!0!==(null==y?void 0:y.readonly);return(0,m.jsxs)(f.Z.Dragger,(0,n.Z)((0,n.Z)({ref:t,name:"files",action:h,accept:x,fileList:v},r),{},{onChange:function(e){null==b||b(e),null!=r&&r.onChange&&(null==r||r.onChange(e))},style:(0,n.Z)((0,n.Z)({},null==r?void 0:r.style),{},{display:F?void 0:"none"}),children:[(0,m.jsx)("p",{className:"".concat(N,"-drag-icon"),children:c}),(0,m.jsx)("p",{className:"".concat(N,"-text"),children:s}),(0,m.jsx)("p",{className:"".concat(N,"-hint"),children:g}),w?(0,m.jsx)("div",{className:"".concat(N,"-extra"),style:{padding:16},children:w}):null]}))})),h=(0,p.G)(g,{getValueFromEvent:function(e){return e.fileList}})},218:function(e,t,r){"use strict";r.d(t,{s:function(){return d}});var n=r(5574),a=r.n(n),o=r(37476),s=r(90672),i=r(59530),c=r(45360),u=r(62435),l=r(86074),f=u.forwardRef((function(e,t){var r=c.ZP.useMessage(),n=a()(r,2),f=n[0],d=n[1],p=(0,u.useRef)(),m=(0,u.useState)(!1),g=a()(m,2),h=g[0],x=g[1],b=(0,u.useState)(""),v=a()(b,2),w=v[0],k=v[1],y=(0,u.useState)(""),S=a()(y,2),j=S[0],C=S[1],N=(0,i.useIntl)(),F=N.formatMessage({id:"msig.intlPreviewFail"}),M=N.formatMessage({id:"msig.intlClose"}),P=(0,u.useCallback)((function(e){var t=new FileReader;t.readAsText(e.originFileObj),t.onload=function(){try{var r,n=JSON.parse(t.result);if(n)null===(r=p.current)||void 0===r||r.setFieldValue("content",JSON.stringify(n,null,2)),k(JSON.stringify(n,null,2)),C(e.name),x(!0);else f.error("".concat(F))}catch(e){f.error("".concat(F))}}}),[]);return(0,u.useImperativeHandle)(t,(function(){return{handleOpen:P}})),(0,l.jsxs)(o.Y,{formRef:p,title:(0,l.jsx)("div",{className:"mt-3",children:j}),open:h,onOpenChange:function(e){x(e)},layout:"vertical",width:"700px",modalProps:{style:{top:25}},submitter:{searchConfig:{resetText:M},render:function(e,t){return[t[0]]}},children:[(0,l.jsx)(s.Z,{name:"content",fieldProps:{autoSize:{minRows:5},allowClear:!1,autoFocus:!1,onChange:void 0,value:w,size:"large"}}),d]})})),d=(0,u.memo)(f)},21024:function(e,t,r){"use strict";r.r(t);var n=r(64599),a=r.n(n),o=r(15009),s=r.n(o),i=r(19632),c=r.n(i),u=r(97857),l=r.n(u),f=r(99289),d=r.n(f),p=r(5574),m=r.n(p),g=r(64119),h=r(218),x=r(11774),b=r(38345),v=r(97269),w=r(5966),k=r(52688),y=r(91604),S=r(59530),j=r(80507),C=r(45360),N=r(62435),F=r(27484),M=r.n(F),P=r(70178),Z=r.n(P),_=r(86074);M().extend(Z());t.default=function(){var e=C.ZP.useMessage(),t=m()(e,2),r=t[0],n=t[1],o=(0,S.useSelector)((function(e){return e.global.contractKit})),i=(0,S.useSelector)((function(e){return e.global.account})),u=(0,S.useSelector)((function(e){return e.global.session})),f=(0,S.useSelector)((function(e){return e.global.privateKey})),p=(0,N.useState)([]),F=m()(p,2),P=F[0],Z=F[1],R=(0,S.useIntl)(),T=(R.formatMessage({id:"tools.nameswitch.intlNameSwitch"}),R.formatMessage({id:"common.intlCopySuccess"}),R.formatMessage({id:"coffee.inputException"})),O=R.formatMessage({id:"msig.intlSendTransaction"}),z=R.formatMessage({id:"msig.intlSend"}),L=R.formatMessage({id:"msig.intlTransactionInfo"}),I=R.formatMessage({id:"msig.intlUploadFail"}),D=R.formatMessage({id:"msig.intlUploadSuccess"}),E=R.formatMessage({id:"msig.intlTransactionEmpty"}),A=R.formatMessage({id:"common.intlPleaseConnectWallet"}),H=R.formatMessage({id:"common.intlPleaseConnectNetwork"}),V=(0,N.useRef)(),Y=(0,N.useRef)(),J=(0,N.useRef)(),U=(0,N.useCallback)(function(){var e=d()(s()().mark((function e(t){var n,a,d,p,h,x,b,v,w,k,y,S,C,N,F,P,Z,_,R,T,O,z,L,I,D,E,V,Y,J,U,q,$,K,Q,W,B,G,X,ee,te,re,ne;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u&&u.broadcast){e.next=6;break}return r.error("".concat(A)),e.abrupt("return");case 6:if(i){e.next=9;break}return r.error("".concat(H)),e.abrupt("return");case 9:if("owner"===(n=u.permissionLevel.permission.toString())||"active"===n){e.next=13;break}return r.error("permission权限必须是owner或者active"),e.abrupt("return");case 13:return a=t.pid,d=t.count,p=t.disorder,h=t.split,x=u.actor.toString(),e.next=17,o.load("dfs3protocol");case 17:return b=e.sent,v=b.table("registry"),w=b.table("projects"),e.next=22,v.all({scope:"dfs3protocol",from:Number(a),to:Number(a),index_position:"secondary",key_type:"i64"});case 22:return k=e.sent,e.next=25,w.all({scope:"dfs3protocol",from:Number(a),to:Number(a)});case 25:if(y=e.sent,S=y[0].creator.toString(),C=y[0].nft_name.toString(),N=y[0].init_nft_price.symbol.name,F="","DFS"!==N){e.next=34;break}F="eosio.token",e.next=44;break;case 34:if("USDT"!==N){e.next=38;break}F="usdtusdtusdt",e.next=44;break;case 38:if("ORDI"!==N){e.next=42;break}F="ordiordiordi",e.next=44;break;case 42:return r.error("不支持当前项目"),e.abrupt("return");case 44:return P={account:"dfsfreecpu11",name:"freecpu",authorization:[{actor:"dfs.service",permission:"cpu"},u.permissionLevel],data:g._9.from({user:x})},Z=j.aU.from(P),e.next=48,u.client.v1.chain.get_info();case 48:if(_=e.sent,R=_.getTransactionHeader(),R.expiration.toString(),T=[],O=Number(d),z=0,L="",!((I=Number(h))<0)){e.next=59;break}return r.error("拆分文件数量需要大于等于1"),e.abrupt("return",!1);case 59:p&&k.sort((function(){return Math.random()-.5})),D=0;case 61:if(!(D<k.length)){e.next=94;break}if(k[D].owner.toString()!==x){e.next=64;break}return e.abrupt("continue",91);case 64:if(!(k[D].current_price.value>200)){e.next=66;break}return e.abrupt("continue",91);case 66:if(!(z>=O)){e.next=68;break}return e.abrupt("break",94);case 68:if(!(z>=3e3)){e.next=70;break}return e.abrupt("break",94);case 70:return L=M()().add(3600-z++,"seconds").utc().format("YYYY-MM-DDTHH:mm:ss"),E=k[D].current_price.toString(),V="buy:"+k[D].id.toString(),Y={account:F,name:"transfer",authorization:[u.permissionLevel],data:g.FE.from({from:x,to:"dfs3protocol",quantity:E,memo:V})},J=j.aU.from(Y),U=void 0,q=void 0,$=[],U=j.YW.from(l()(l()({},R),{},{expiration:L,actions:[Z,J]})),$[0]=f.signDigest(U.signingDigest(u.chain.id.toString())),e.next=82,(0,g.zI)(u.transact({transaction:U},{broadcast:!1,transactPlugins:[]}));case 82:if(K=e.sent,Q=m()(K,2),W=Q[0],B=Q[1],!W){e.next=89;break}return r.error(W),e.abrupt("return",!1);case 89:q=j.uQ.from(l()(l()({},U),{},{signatures:[].concat($,c()(B.signatures))})),T.push(q);case 91:++D,e.next=61;break;case 94:for(G=Math.ceil(T.length/I),X=1;T.length;)ee=T.splice(0,G),te=JSON.stringify(ee,null,2),re="data:,".concat(te),(ne=document.createElement("a")).href=re,ne.download="".concat(x,"_").concat(a,"_").concat(z,"-").concat(X++,"_").concat(C,"_").concat(S,"_expiration@").concat(L,".json"),ne.click();return e.abrupt("return",!0);case 100:e.prev=100,e.t0=e.catch(0),(0,g.Tv)(e.t0,r);case 103:return e.abrupt("return",!0);case 104:case"end":return e.stop()}}),e,null,[[0,100]])})));return function(t){return e.apply(this,arguments)}}(),[o,u,i]),q=(0,N.useCallback)(d()(s()().mark((function e(){var t,n,o,i,c;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==P.length){e.next=3;break}return r.error(E),e.abrupt("return",!1);case 3:e.prev=3,t=[],n=a()(P),e.prev=6,i=s()().mark((function e(){var r,n;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.value,e.next=3,new Promise((function(e){var t=new FileReader;t.readAsText(r.originFileObj),t.onload=function(){return e(t.result)}}));case 3:n=e.sent,JSON.parse(n).forEach((function(e){var r=j.uQ.from(e);t.push(r)}));case 6:case"end":return e.stop()}}),e)})),n.s();case 9:if((o=n.n()).done){e.next=13;break}return e.delegateYield(i(),"t0",11);case 11:e.next=9;break;case 13:e.next=18;break;case 15:e.prev=15,e.t1=e.catch(6),n.e(e.t1);case 18:return e.prev=18,n.f(),e.finish(18);case 21:c=[],t.forEach((function(e){var t=new Promise((function(t,r){u.client.v1.chain.push_transaction(e).then((function(e){e&&e.processed&&"executed"===e.processed.receipt.status?t(!0):t(!1)})).catch((function(e){t(!1)}))}));c.push(t)})),0,0,e.next=30;break;case 27:e.prev=27,e.t2=e.catch(3),(0,g.Tv)(e.t2,r);case 30:case"end":return e.stop()}}),e,null,[[3,27],[6,15,18,21]])}))),[P,r,u]),$=(0,N.useCallback)(function(){var e=d()(s()().mark((function e(t){var n;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("removed"!==t.file.status){e.next=3;break}return Z(t.fileList),e.abrupt("return");case 3:(n=new FileReader).readAsText(t.fileList[t.fileList.length-1].originFileObj),n.onload=function(){try{JSON.parse(n.result)?(Z(t.fileList),r.success("".concat(D))):r.error("".concat(I))}catch(e){(0,g.Tv)(e,r)}};case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);return(0,_.jsx)(x._z,{className:"",ghost:!0,children:!i||"dfsnetworkio"!==i.accountName.toString()&&"dfsnetworkbp"!==i.accountName.toString()&&"testaccount1"!==i.accountName.toString()&&"testaccount2"!==i.accountName.toString()&&"testaccount3"!==i.accountName.toString()?(0,_.jsx)(_.Fragment,{}):(0,_.jsxs)("div",{className:"flex flex-wrap justify-around gap-3",children:[(0,_.jsx)(b.Z,{title:(0,_.jsx)("div",{children:(0,_.jsx)("span",{children:"创建购买交易"})}),style:{width:"400px"},children:(0,_.jsxs)(v.A,{formRef:V,onFinish:U,layout:"vertical",initialValues:{disorder:!0,split:"1"},children:[(0,_.jsx)(w.Z,{label:"项目ID",name:"pid",placeholder:"",rules:[{required:!0,message:"".concat(T),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,allowClear:!1,size:"large"}}),(0,_.jsx)(w.Z,{label:"购买数量",name:"count",placeholder:"",rules:[{required:!0,message:"".concat(T),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,allowClear:!1,size:"large"}}),(0,_.jsx)(w.Z,{label:"拆分文件数量",name:"split",placeholder:"",rules:[{required:!0,message:"".concat(T),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,allowClear:!1,size:"large",defaultValue:"1"}}),(0,_.jsx)(k.Z,{name:"disorder",label:"乱序",rules:[{required:!0,message:"".concat(T),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1}}),n]})}),(0,_.jsx)(b.Z,{title:(0,_.jsx)("div",{className:" font-semibold text-lg hardline mb-3",children:O}),style:{width:"400px"},children:(0,_.jsx)(v.A,{formRef:Y,onFinish:d()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",q());case 1:case"end":return e.stop()}}),e)}))),onReset:function(){var e;null===(e=Y.current)||void 0===e||e.resetFields(),Z([])},submitter:{searchConfig:{submitText:z},render:function(e,t){return[t[1],t[0]]}},children:(0,_.jsx)(y.Z,{label:L,name:"transactionInfo",action:"upload.do",fieldProps:{accept:".json",onChange:$,beforeUpload:function(){return!1},listType:"picture",onPreview:function(e){return J.current.handleOpen(e)},fileList:P}})})}),(0,_.jsx)(h.s,{ref:J})]})})}},64599:function(e,t,r){var n=r(96263);e.exports=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=n(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw s}}}},e.exports.__esModule=!0,e.exports.default=e.exports}}]);