(self.webpackChunk=self.webpackChunk||[]).push([[2674],{91604:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});var r=n(1413),a=n(87462),o=n(62435),s={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},i=n(84089),c=function(e,t){return o.createElement(i.Z,(0,a.Z)({},e,{ref:t,icon:s}))};var u=o.forwardRef(c),l=n(28459),f=n(2058),d=n(9105),p=n(90789),m=n(86074),g=o.forwardRef((function(e,t){var n=e.fieldProps,a=e.title,s=void 0===a?"单击或拖动文件到此区域进行上传":a,i=e.icon,c=void 0===i?(0,m.jsx)(u,{}):i,p=e.description,g=void 0===p?"支持单次或批量上传":p,h=e.action,x=e.accept,b=e.onChange,v=e.value,w=e.children,k=e.max,y=e.proFieldProps,S=(0,o.useContext)(l.ZP.ConfigContext),j=(0,o.useContext)(d.A),C=(null==y?void 0:y.mode)||j.mode||"edit",N=S.getPrefixCls("upload"),F=(void 0===k||!v||(null==v?void 0:v.length)<k)&&"read"!==C&&!0!==(null==y?void 0:y.readonly);return(0,m.jsxs)(f.Z.Dragger,(0,r.Z)((0,r.Z)({ref:t,name:"files",action:h,accept:x,fileList:v},n),{},{onChange:function(e){null==b||b(e),null!=n&&n.onChange&&(null==n||n.onChange(e))},style:(0,r.Z)((0,r.Z)({},null==n?void 0:n.style),{},{display:F?void 0:"none"}),children:[(0,m.jsx)("p",{className:"".concat(N,"-drag-icon"),children:c}),(0,m.jsx)("p",{className:"".concat(N,"-text"),children:s}),(0,m.jsx)("p",{className:"".concat(N,"-hint"),children:g}),w?(0,m.jsx)("div",{className:"".concat(N,"-extra"),style:{padding:16},children:w}):null]}))})),h=(0,p.G)(g,{getValueFromEvent:function(e){return e.fileList}})},218:function(e,t,n){"use strict";n.d(t,{s:function(){return d}});var r=n(5574),a=n.n(r),o=n(37476),s=n(90672),i=n(59530),c=n(45360),u=n(62435),l=n(86074),f=u.forwardRef((function(e,t){var n=c.ZP.useMessage(),r=a()(n,2),f=r[0],d=r[1],p=(0,u.useRef)(),m=(0,u.useState)(!1),g=a()(m,2),h=g[0],x=g[1],b=(0,u.useState)(""),v=a()(b,2),w=v[0],k=v[1],y=(0,u.useState)(""),S=a()(y,2),j=S[0],C=S[1],N=(0,i.useIntl)(),F=N.formatMessage({id:"msig.intlPreviewFail"}),M=N.formatMessage({id:"msig.intlClose"}),P=(0,u.useCallback)((function(e){var t=new FileReader;t.readAsText(e.originFileObj),t.onload=function(){try{var n,r=JSON.parse(t.result);if(r)null===(n=p.current)||void 0===n||n.setFieldValue("content",JSON.stringify(r,null,2)),k(JSON.stringify(r,null,2)),C(e.name),x(!0);else f.error("".concat(F))}catch(e){f.error("".concat(F))}}}),[]);return(0,u.useImperativeHandle)(t,(function(){return{handleOpen:P}})),(0,l.jsxs)(o.Y,{formRef:p,title:(0,l.jsx)("div",{className:"mt-3",children:j}),open:h,onOpenChange:function(e){x(e)},layout:"vertical",width:"700px",modalProps:{style:{top:25}},submitter:{searchConfig:{resetText:M},render:function(e,t){return[t[0]]}},children:[(0,l.jsx)(s.Z,{name:"content",fieldProps:{autoSize:{minRows:5},allowClear:!1,autoFocus:!1,onChange:void 0,value:w,size:"large"}}),d]})})),d=(0,u.memo)(f)},21024:function(e,t,n){"use strict";n.r(t);var r=n(64599),a=n.n(r),o=n(15009),s=n.n(o),i=n(19632),c=n.n(i),u=n(97857),l=n.n(u),f=n(99289),d=n.n(f),p=n(5574),m=n.n(p),g=n(64119),h=n(218),x=n(11774),b=n(38345),v=n(97269),w=n(5966),k=n(52688),y=n(91604),S=n(59530),j=n(80507),C=n(45360),N=n(62435),F=n(27484),M=n.n(F),P=n(70178),Z=n.n(P),_=n(86074);M().extend(Z());t.default=function(){var e=C.ZP.useMessage(),t=m()(e,2),n=t[0],r=t[1],o=(0,S.useSelector)((function(e){return e.global.contractKit})),i=(0,S.useSelector)((function(e){return e.global.account})),u=(0,S.useSelector)((function(e){return e.global.session})),f=(0,S.useSelector)((function(e){return e.global.privateKey})),p=(0,N.useState)([]),F=m()(p,2),P=F[0],Z=F[1],R=(0,S.useIntl)(),T=(R.formatMessage({id:"tools.nameswitch.intlNameSwitch"}),R.formatMessage({id:"common.intlCopySuccess"}),R.formatMessage({id:"coffee.inputException"})),O=R.formatMessage({id:"msig.intlSendTransaction"}),L=R.formatMessage({id:"msig.intlSend"}),z=R.formatMessage({id:"msig.intlTransactionInfo"}),I=R.formatMessage({id:"msig.intlUploadFail"}),D=R.formatMessage({id:"msig.intlUploadSuccess"}),E=R.formatMessage({id:"msig.intlTransactionEmpty"}),A=R.formatMessage({id:"common.intlPleaseConnectWallet"}),H=R.formatMessage({id:"common.intlPleaseConnectNetwork"}),V=(0,N.useRef)(),Y=(0,N.useRef)(),J=(0,N.useRef)(),U=(0,N.useCallback)(function(){var e=d()(s()().mark((function e(t){var r,a,d,p,h,x,b,v,w,k,y,S,C,N,F,P,Z,_,R,T,O,L,z,I,D,E,V,Y,J,U,q,$,K,Q,W,B,G;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u&&u.broadcast){e.next=6;break}return n.error("".concat(A)),e.abrupt("return");case 6:if(i){e.next=9;break}return n.error("".concat(H)),e.abrupt("return");case 9:if("owner"===(r=u.permissionLevel.permission.toString())||"active"===r){e.next=13;break}return n.error("permission权限必须是owner或者active"),e.abrupt("return");case 13:return a=t.pid,d=t.count,p=t.disorder,h=u.actor.toString(),e.next=17,o.load("dfs3protocol");case 17:return x=e.sent,b=x.table("registry"),v=x.table("projects"),e.next=22,b.all({scope:"dfs3protocol",from:Number(a),to:Number(a),index_position:"secondary",key_type:"i64"});case 22:return w=e.sent,e.next=25,v.all({scope:"dfs3protocol",from:Number(a),to:Number(a)});case 25:if(k=e.sent,y=k[0].creator.toString(),S=k[0].nft_name.toString(),C=k[0].init_nft_price.symbol.name,N="","DFS"!==C){e.next=34;break}N="eosio.token",e.next=44;break;case 34:if("USDT"!==C){e.next=38;break}N="usdtusdtusdt",e.next=44;break;case 38:if("ORDI"!==C){e.next=42;break}N="ordiordiordi",e.next=44;break;case 42:return n.error("不支持当前项目"),e.abrupt("return");case 44:return F={account:"dfsfreecpu11",name:"freecpu",authorization:[{actor:"dfs.service",permission:"cpu"},u.permissionLevel],data:g._9.from({user:h})},P=j.aU.from(F),e.next=48,u.client.v1.chain.get_info();case 48:Z=e.sent,_=Z.getTransactionHeader(),R=[],T=Number(d),O=0,L="",p&&w.sort((function(){return Math.random()-.5})),z=0;case 56:if(!(z<w.length)){e.next=87;break}if(w[z].owner.toString()!==h){e.next=59;break}return e.abrupt("continue",84);case 59:if(!(O>=T)){e.next=61;break}return e.abrupt("break",87);case 61:if(!(O>=3e3)){e.next=63;break}return e.abrupt("break",87);case 63:return L=M()().add(3600-O++,"seconds").utc().format("YYYY-MM-DDTHH:mm:ss"),I=w[z].current_price.toString(),D="buy:"+w[z].id.toString(),E={account:N,name:"transfer",authorization:[u.permissionLevel],data:g.FE.from({from:h,to:"dfs3protocol",quantity:I,memo:D})},V=j.aU.from(E),Y=void 0,J=void 0,U=[],Y=j.YW.from(l()(l()({},_),{},{expiration:L,actions:[P,V]})),U[0]=f.signDigest(Y.signingDigest(u.chain.id.toString())),e.next=75,(0,g.zI)(u.transact({transaction:Y},{broadcast:!1,transactPlugins:[]}));case 75:if(q=e.sent,$=m()(q,2),K=$[0],Q=$[1],!K){e.next=82;break}return n.error(K),e.abrupt("return",!1);case 82:J=j.uQ.from(l()(l()({},Y),{},{signatures:[].concat(U,c()(Q.signatures))})),R.push(J);case 84:++z,e.next=56;break;case 87:return W=JSON.stringify(R,null,2),B="data:,".concat(W),(G=document.createElement("a")).href=B,G.download="buy.json",G.download="pid".concat(a,"_").concat(y,"_").concat(S,"_").concat(h,"_cnt").concat(O,"_expiration@").concat(L,".json"),G.click(),e.abrupt("return",!0);case 97:e.prev=97,e.t0=e.catch(0),(0,g.Tv)(e.t0,n);case 100:return e.abrupt("return",!0);case 101:case"end":return e.stop()}}),e,null,[[0,97]])})));return function(t){return e.apply(this,arguments)}}(),[o,u,i]),q=(0,N.useCallback)(d()(s()().mark((function e(){var t,r,o,i,c;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==P.length){e.next=3;break}return n.error(E),e.abrupt("return",!1);case 3:e.prev=3,t=[],r=a()(P),e.prev=6,i=s()().mark((function e(){var n,r;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.value,e.next=3,new Promise((function(e){var t=new FileReader;t.readAsText(n.originFileObj),t.onload=function(){return e(t.result)}}));case 3:r=e.sent,JSON.parse(r).forEach((function(e){var n=j.uQ.from(e);t.push(n)}));case 6:case"end":return e.stop()}}),e)})),r.s();case 9:if((o=r.n()).done){e.next=13;break}return e.delegateYield(i(),"t0",11);case 11:e.next=9;break;case 13:e.next=18;break;case 15:e.prev=15,e.t1=e.catch(6),r.e(e.t1);case 18:return e.prev=18,r.f(),e.finish(18);case 21:c=[],t.forEach((function(e){var t=new Promise((function(t,n){u.client.v1.chain.push_transaction(e).then((function(e){e&&e.processed&&"executed"===e.processed.receipt.status?t(!0):t(!1)})).catch((function(e){t(!1)}))}));c.push(t)})),0,0,e.next=30;break;case 27:e.prev=27,e.t2=e.catch(3),(0,g.Tv)(e.t2,n);case 30:case"end":return e.stop()}}),e,null,[[3,27],[6,15,18,21]])}))),[P,n,u]),$=(0,N.useCallback)(function(){var e=d()(s()().mark((function e(t){var r;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("removed"!==t.file.status){e.next=3;break}return Z(t.fileList),e.abrupt("return");case 3:(r=new FileReader).readAsText(t.fileList[t.fileList.length-1].originFileObj),r.onload=function(){try{JSON.parse(r.result)?(Z(t.fileList),n.success("".concat(D))):n.error("".concat(I))}catch(e){(0,g.Tv)(e,n)}};case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);return(0,_.jsx)(x._z,{className:"",ghost:!0,children:!i||"dfsnetworkio"!==i.accountName.toString()&&"dfsnetworkbp"!==i.accountName.toString()&&"testaccount1"!==i.accountName.toString()&&"testaccount2"!==i.accountName.toString()&&"testaccount3"!==i.accountName.toString()?(0,_.jsx)(_.Fragment,{}):(0,_.jsxs)("div",{className:"flex flex-wrap justify-around gap-3",children:[(0,_.jsx)(b.Z,{title:(0,_.jsx)("div",{children:(0,_.jsx)("span",{children:"创建购买交易"})}),style:{width:"400px"},children:(0,_.jsxs)(v.A,{formRef:V,onFinish:U,layout:"vertical",initialValues:{disorder:!0},children:[(0,_.jsx)(w.Z,{label:"项目ID",name:"pid",placeholder:"",rules:[{required:!0,message:"".concat(T),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,allowClear:!1,size:"large"}}),(0,_.jsx)(w.Z,{label:"购买数量",name:"count",placeholder:"",rules:[{required:!0,message:"".concat(T),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,allowClear:!1,size:"large"}}),(0,_.jsx)(k.Z,{name:"disorder",label:"乱序",rules:[{required:!0,message:"".concat(T),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1}}),r]})}),(0,_.jsx)(b.Z,{title:(0,_.jsx)("div",{className:" font-semibold text-lg hardline mb-3",children:O}),style:{width:"400px"},children:(0,_.jsx)(v.A,{formRef:Y,onFinish:d()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",q());case 1:case"end":return e.stop()}}),e)}))),onReset:function(){var e;null===(e=Y.current)||void 0===e||e.resetFields(),Z([])},submitter:{searchConfig:{submitText:L},render:function(e,t){return[t[1],t[0]]}},children:(0,_.jsx)(y.Z,{label:z,name:"transactionInfo",action:"upload.do",fieldProps:{accept:".json",onChange:$,beforeUpload:function(){return!1},listType:"picture",onPreview:function(e){return J.current.handleOpen(e)},fileList:P}})})}),(0,_.jsx)(h.s,{ref:J})]})})}},64599:function(e,t,n){var r=n(96263);e.exports=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw s}}}},e.exports.__esModule=!0,e.exports.default=e.exports}}]);