(self.webpackChunk=self.webpackChunk||[]).push([[2674],{91604:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});var r=n(1413),a=n(87462),o=n(62435),s={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},i=n(84089),c=function(e,t){return o.createElement(i.Z,(0,a.Z)({},e,{ref:t,icon:s}))};var u=o.forwardRef(c),l=n(28459),f=n(2058),d=n(9105),p=n(90789),m=n(86074),g=o.forwardRef((function(e,t){var n=e.fieldProps,a=e.title,s=void 0===a?"单击或拖动文件到此区域进行上传":a,i=e.icon,c=void 0===i?(0,m.jsx)(u,{}):i,p=e.description,g=void 0===p?"支持单次或批量上传":p,h=e.action,x=e.accept,v=e.onChange,b=e.value,w=e.children,k=e.max,y=e.proFieldProps,S=(0,o.useContext)(l.ZP.ConfigContext),j=(0,o.useContext)(d.A),C=(null==y?void 0:y.mode)||j.mode||"edit",N=S.getPrefixCls("upload"),F=(void 0===k||!b||(null==b?void 0:b.length)<k)&&"read"!==C&&!0!==(null==y?void 0:y.readonly);return(0,m.jsxs)(f.Z.Dragger,(0,r.Z)((0,r.Z)({ref:t,name:"files",action:h,accept:x,fileList:b},n),{},{onChange:function(e){null==v||v(e),null!=n&&n.onChange&&(null==n||n.onChange(e))},style:(0,r.Z)((0,r.Z)({},null==n?void 0:n.style),{},{display:F?void 0:"none"}),children:[(0,m.jsx)("p",{className:"".concat(N,"-drag-icon"),children:c}),(0,m.jsx)("p",{className:"".concat(N,"-text"),children:s}),(0,m.jsx)("p",{className:"".concat(N,"-hint"),children:g}),w?(0,m.jsx)("div",{className:"".concat(N,"-extra"),style:{padding:16},children:w}):null]}))})),h=(0,p.G)(g,{getValueFromEvent:function(e){return e.fileList}})},218:function(e,t,n){"use strict";n.d(t,{s:function(){return d}});var r=n(5574),a=n.n(r),o=n(37476),s=n(90672),i=n(59530),c=n(45360),u=n(62435),l=n(86074),f=u.forwardRef((function(e,t){var n=c.ZP.useMessage(),r=a()(n,2),f=r[0],d=r[1],p=(0,u.useRef)(),m=(0,u.useState)(!1),g=a()(m,2),h=g[0],x=g[1],v=(0,u.useState)(""),b=a()(v,2),w=b[0],k=b[1],y=(0,u.useState)(""),S=a()(y,2),j=S[0],C=S[1],N=(0,i.useIntl)(),F=N.formatMessage({id:"msig.intlPreviewFail"}),M=N.formatMessage({id:"msig.intlClose"}),P=(0,u.useCallback)((function(e){var t=new FileReader;t.readAsText(e.originFileObj),t.onload=function(){try{var n,r=JSON.parse(t.result);if(r)null===(n=p.current)||void 0===n||n.setFieldValue("content",JSON.stringify(r,null,2)),k(JSON.stringify(r,null,2)),C(e.name),x(!0);else f.error("".concat(F))}catch(e){f.error("".concat(F))}}}),[]);return(0,u.useImperativeHandle)(t,(function(){return{handleOpen:P}})),(0,l.jsxs)(o.Y,{formRef:p,title:(0,l.jsx)("div",{className:"mt-3",children:j}),open:h,onOpenChange:function(e){x(e)},layout:"vertical",width:"700px",modalProps:{style:{top:25}},submitter:{searchConfig:{resetText:M},render:function(e,t){return[t[0]]}},children:[(0,l.jsx)(s.Z,{name:"content",fieldProps:{autoSize:{minRows:5},allowClear:!1,autoFocus:!1,onChange:void 0,value:w,size:"large"}}),d]})})),d=(0,u.memo)(f)},21024:function(e,t,n){"use strict";n.r(t);var r=n(64599),a=n.n(r),o=n(15009),s=n.n(o),i=n(19632),c=n.n(i),u=n(97857),l=n.n(u),f=n(99289),d=n.n(f),p=n(5574),m=n.n(p),g=n(64119),h=n(218),x=n(11774),v=n(38345),b=n(97269),w=n(5966),k=n(91604),y=n(59530),S=n(80507),j=n(45360),C=n(62435),N=n(27484),F=n.n(N),M=n(70178),P=n.n(M),Z=n(86074);F().extend(P());t.default=function(){var e=j.ZP.useMessage(),t=m()(e,2),n=t[0],r=t[1],o=(0,y.useSelector)((function(e){return e.global.contractKit})),i=(0,y.useSelector)((function(e){return e.global.account})),u=(0,y.useSelector)((function(e){return e.global.session})),f=(0,y.useSelector)((function(e){return e.global.privateKey})),p=(0,C.useState)([]),N=m()(p,2),M=N[0],P=N[1],_=(0,y.useIntl)(),R=(_.formatMessage({id:"tools.nameswitch.intlNameSwitch"}),_.formatMessage({id:"common.intlCopySuccess"}),_.formatMessage({id:"coffee.inputException"})),T=_.formatMessage({id:"msig.intlSendTransaction"}),O=_.formatMessage({id:"msig.intlSend"}),L=_.formatMessage({id:"msig.intlTransactionInfo"}),z=_.formatMessage({id:"msig.intlUploadFail"}),E=_.formatMessage({id:"msig.intlUploadSuccess"}),I=_.formatMessage({id:"msig.intlTransactionEmpty"}),D=_.formatMessage({id:"common.intlPleaseConnectWallet"}),A=_.formatMessage({id:"common.intlPleaseConnectNetwork"}),H=(0,C.useRef)(),Y=(0,C.useRef)(),J=(0,C.useRef)(),U=(0,C.useCallback)(function(){var e=d()(s()().mark((function e(t){var r,a,d,p,h,x,v,b,w,k,y,j,C,N,M,P,Z,_,R,T,O,L,z,E,I,H,Y,J,U,V,q,K,Q,W,$,B;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u&&u.broadcast){e.next=6;break}return n.error("".concat(D)),e.abrupt("return");case 6:if(i){e.next=9;break}return n.error("".concat(A)),e.abrupt("return");case 9:if("owner"===(r=u.permissionLevel.permission.toString())||"active"===r){e.next=13;break}return n.error("permission权限必须是owner或者active"),e.abrupt("return");case 13:return a=t.pid,d=t.count,p=u.actor.toString(),e.next=17,o.load("dfs3protocol");case 17:return h=e.sent,x=h.table("registry"),v=h.table("projects"),e.next=22,x.all({scope:"dfs3protocol",from:Number(a),to:Number(a),index_position:"secondary",key_type:"i64"});case 22:return b=e.sent,e.next=25,v.all({scope:"dfs3protocol",from:Number(a),to:Number(a)});case 25:if(w=e.sent,k=w[0].creator.toString(),y=w[0].nft_name.toString(),j=w[0].init_nft_price.symbol.name,C="","DFS"!==j){e.next=34;break}C="eosio.token",e.next=44;break;case 34:if("USDT"!==j){e.next=38;break}C="usdtusdtusdt",e.next=44;break;case 38:if("ORDI"!==j){e.next=42;break}C="ordiordiordi",e.next=44;break;case 42:return n.error("不支持当前项目"),e.abrupt("return");case 44:return N={account:"dfsfreecpu11",name:"freecpu",authorization:[{actor:"dfs.service",permission:"cpu"},u.permissionLevel],data:g._9.from({user:p})},M=S.aU.from(N),e.next=48,u.client.v1.chain.get_info();case 48:P=e.sent,Z=P.getTransactionHeader(),_=[],R=Number(d),T=0,O="",L=0;case 55:if(!(L<b.length)){e.next=86;break}if(b[L].owner.toString()!==p){e.next=58;break}return e.abrupt("continue",83);case 58:if(!(T>=R)){e.next=60;break}return e.abrupt("break",86);case 60:if(!(T>=3e3)){e.next=62;break}return e.abrupt("break",86);case 62:return O=F()().add(3600-T++,"seconds").utc().format("YYYY-MM-DDTHH:mm:ss"),z=b[L].current_price.toString(),E="buy:"+b[L].id.toString(),I={account:C,name:"transfer",authorization:[u.permissionLevel],data:g.FE.from({from:p,to:"dfs3protocol",quantity:z,memo:E})},H=S.aU.from(I),Y=void 0,J=void 0,U=[],Y=S.YW.from(l()(l()({},Z),{},{expiration:O,actions:[M,H]})),U[0]=f.signDigest(Y.signingDigest(u.chain.id.toString())),e.next=74,(0,g.zI)(u.transact({transaction:Y},{broadcast:!1,transactPlugins:[]}));case 74:if(V=e.sent,q=m()(V,2),K=q[0],Q=q[1],!K){e.next=81;break}return n.error(K),e.abrupt("return",!1);case 81:J=S.uQ.from(l()(l()({},Y),{},{signatures:[].concat(U,c()(Q.signatures))})),_.push(J);case 83:++L,e.next=55;break;case 86:return W=JSON.stringify(_,null,2),$="data:,".concat(W),(B=document.createElement("a")).href=$,B.download="buy.json",B.download="pid".concat(a,"_").concat(k,"_").concat(y,"_").concat(p,"_cnt").concat(T,"_expiration@").concat(O,".json"),B.click(),e.abrupt("return",!0);case 96:e.prev=96,e.t0=e.catch(0),(0,g.Tv)(e.t0,n);case 99:return e.abrupt("return",!0);case 100:case"end":return e.stop()}}),e,null,[[0,96]])})));return function(t){return e.apply(this,arguments)}}(),[o,u,i]),V=(0,C.useCallback)(d()(s()().mark((function e(){var t,r,o,i,c,l,f,d,p;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==M.length){e.next=3;break}return n.error(I),e.abrupt("return",!1);case 3:e.prev=3,t=[],r=a()(M),e.prev=6,i=s()().mark((function e(){var n,r;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.value,e.next=3,new Promise((function(e){var t=new FileReader;t.readAsText(n.originFileObj),t.onload=function(){return e(t.result)}}));case 3:r=e.sent,JSON.parse(r).forEach((function(e){var n=S.uQ.from(e);t.push(n)}));case 6:case"end":return e.stop()}}),e)})),r.s();case 9:if((o=r.n()).done){e.next=13;break}return e.delegateYield(i(),"t0",11);case 11:e.next=9;break;case 13:e.next=18;break;case 15:e.prev=15,e.t1=e.catch(6),r.e(e.t1);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return c=[],t.forEach((function(e){var t=new Promise((function(t,n){u.client.v1.chain.push_transaction(e).then((function(e){e&&e.processed&&"executed"===e.processed.receipt.status?t(!0):t(!1)})).catch((function(e){t(!1)}))}));c.push(t)})),e.next=25,Promise.all(c);case 25:l=e.sent,f=0,d=0,l.forEach((function(e){e?++f:++d})),p="交易：".concat(l.length,"，成功：").concat(f,"，失败：").concat(d),5,0===f?n.error(p,5):0===d?n.success(p,5):n.info(p,5),e.next=37;break;case 34:e.prev=34,e.t2=e.catch(3),(0,g.Tv)(e.t2,n);case 37:case"end":return e.stop()}}),e,null,[[3,34],[6,15,18,21]])}))),[M,n,u]),q=(0,C.useCallback)(function(){var e=d()(s()().mark((function e(t){var r;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("removed"!==t.file.status){e.next=3;break}return P(t.fileList),e.abrupt("return");case 3:(r=new FileReader).readAsText(t.fileList[t.fileList.length-1].originFileObj),r.onload=function(){try{JSON.parse(r.result)?(P(t.fileList),n.success("".concat(E))):n.error("".concat(z))}catch(e){(0,g.Tv)(e,n)}};case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);return(0,Z.jsx)(x._z,{className:"",ghost:!0,children:!i||"dfsnetworkio"!==i.accountName.toString()&&"dfsnetworkbp"!==i.accountName.toString()&&"testaccount1"!==i.accountName.toString()&&"testaccount2"!==i.accountName.toString()&&"testaccount3"!==i.accountName.toString()?(0,Z.jsx)(Z.Fragment,{}):(0,Z.jsxs)("div",{className:"flex flex-wrap justify-around gap-3",children:[(0,Z.jsx)(v.Z,{title:(0,Z.jsx)("div",{children:(0,Z.jsx)("span",{children:"创建购买交易"})}),style:{width:"400px"},children:(0,Z.jsxs)(b.A,{formRef:H,onFinish:U,layout:"vertical",children:[(0,Z.jsx)(w.Z,{label:"项目ID",name:"pid",placeholder:"",rules:[{required:!0,message:"".concat(R),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,allowClear:!1,size:"large"}}),(0,Z.jsx)(w.Z,{label:"购买数量",name:"count",placeholder:"",rules:[{required:!0,message:"".concat(R),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,allowClear:!1,size:"large"}}),r]})}),(0,Z.jsx)(v.Z,{title:(0,Z.jsx)("div",{className:" font-semibold text-lg hardline mb-3",children:T}),style:{width:"400px"},children:(0,Z.jsx)(b.A,{formRef:Y,onFinish:d()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",V());case 1:case"end":return e.stop()}}),e)}))),onReset:function(){var e;null===(e=Y.current)||void 0===e||e.resetFields(),P([])},submitter:{searchConfig:{submitText:O},render:function(e,t){return[t[1],t[0]]}},children:(0,Z.jsx)(k.Z,{label:L,name:"transactionInfo",action:"upload.do",fieldProps:{accept:".json",onChange:q,beforeUpload:function(){return!1},listType:"picture",onPreview:function(e){return J.current.handleOpen(e)},fileList:M}})})}),(0,Z.jsx)(h.s,{ref:J})]})})}},64599:function(e,t,n){var r=n(96263);e.exports=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw s}}}},e.exports.__esModule=!0,e.exports.default=e.exports}}]);