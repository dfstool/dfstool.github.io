"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4563],{74563:function(e,t,n){n.d(t,{gb:function(){return F},ot:function(){return C},_h:function(){return O}});var r=n(15009),a=n.n(r),s=n(99289),o=n.n(s),i=n(5574),l=n.n(i),u=n(64119),c=n(37476),d=n(98097),p=n(59530),f=n(45360),x=n(27484),v=n.n(x),h=n(38823),m=n.n(h),S=n(70178),k=n.n(S),j=n(62435),b=n(86074);v().extend(k()),v().extend(m());var g=j.forwardRef((function(e,t){var n=f.ZP.useMessage(),r=l()(n,2),s=r[0],i=r[1],x=(0,p.useSelector)((function(e){return e.global.contractKit})),h=(0,j.useState)(),m=l()(h,2),S=m[0],k=m[1],g=(0,j.useState)(),F=l()(g,2),w=F[0],y=F[1],D=(0,j.useRef)(),I=(0,j.useState)(!1),O=l()(I,2),_=O[0],N=O[1],C=(0,j.useState)(!0),M=l()(C,2),R=M[0],z=M[1],Z=(0,j.useCallback)(function(){var e=o()(a()().mark((function e(t,n){var r,o,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.load("dfsweb3desoc");case 3:return r=e.sent,o=r.table("profiles"),e.next=7,o.all({scope:"dfsweb3desoc",from:n.voter.toString(),to:n.voter.toString()});case 7:i=e.sent,k(i[0]),z(!1),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),(0,u.Tv)(e.t0,s);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}(),[s]),P=(0,j.useCallback)((function(e){Z(x,e),y(e),N(!0)}),[x]);(0,j.useImperativeHandle)(t,(function(){return{handleOpen:P}}));var T=(0,j.useCallback)(o()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)}))),[]),Y=(0,j.useCallback)((function(e){return e?"DFSNode.Online - 广州"===e?"DFSOnline-广州@":"DFSNode.Online - 杭州"===e?"DFSOnline-杭州@":"DFSNode.Online - 香港"===e?"DFSOnline-香港@":"DFSNode.Online - 张家口"===e?"DFSOnline-张家口@":"DFSNode.Online - 呼和浩特"===e?"DFSOnline-呼和浩特@":"DFS-美国弗吉尼亚-Node"===e?"DFS-美国弗吉尼亚@":"DFS-北京节点（持续在线）"===e?"DFS-北京节点@":"DFS-广州（持续在线）"===e?"DFS-广州@":e+"@":""}),[]),H=(0,j.useMemo)((function(){return[{title:"sex",dataIndex:"sex",key:"sex",render:function(e,t){return Object.keys(t).length?(0,b.jsx)("span",{children:t.sex.toNumber()}):(0,b.jsx)("span",{children:"null"})}},{title:"cover",dataIndex:"cover",key:"cover",render:function(e,t){return Object.keys(t).length?(0,b.jsx)("span",{children:t.cover}):(0,b.jsx)("span",{children:"null"})}},{title:"desc",dataIndex:"desc",key:"desc",render:function(e,t){return Object.keys(t).length?(0,b.jsx)("span",{children:t.desc}):(0,b.jsx)("span",{children:"null"})}},{title:"avatar",dataIndex:"avatar",key:"avatar",render:function(e,t){return Object.keys(t).length?(0,b.jsx)("span",{children:t.avatar}):(0,b.jsx)("span",{children:"null"})}},{title:"join",dataIndex:"join",key:"join",render:function(e,t){return Object.keys(t).length?(0,b.jsx)("span",{children:v().utc(t.join.toString()).local().format()}):(0,b.jsx)("span",{children:"null"})}},{title:"update",dataIndex:"update",key:"update",render:function(e,t){return Object.keys(t).length?(0,b.jsx)("span",{children:v().utc(t.update.toString()).local().format()}):(0,b.jsx)("span",{children:"null"})}}]}),[]);return(0,b.jsxs)(c.Y,{formRef:D,title:"",open:_,onFinish:T,onOpenChange:function(e){N(e)},layout:"horizontal",width:"350px",submitter:!1,children:[(0,b.jsx)(d.vY,{title:(0,b.jsx)("div",{className:"flex items-center",children:(0,b.jsx)("div",{className:"",children:Y(null==S?void 0:S.nick)+(null==w?void 0:w.voter.toString())})}),loading:R,column:1,dataSource:S,columns:H}),i]})})),F=(0,j.memo)(g),w=n(2487),y=n(53667),D=n.n(y),I=j.forwardRef((function(e,t){var n=f.ZP.useMessage(),r=l()(n,2),s=r[0],i=r[1],d=(0,p.useSelector)((function(e){return e.global.contractKit})),x=(0,j.useState)(),v=l()(x,2),h=v[0],m=v[1],S=(0,j.useRef)(),k=(0,j.useState)(!1),g=l()(k,2),F=g[0],y=g[1],I=(0,j.useState)([]),O=l()(I,2),_=O[0],N=O[1],C=(0,j.useState)(!0),M=l()(C,2),R=M[0],z=M[1],Z=(0,p.useIntl)(),P=Z.formatMessage({id:"vote.intlTotalVotes"}),T=Z.formatMessage({id:"vote.intlExportData"}),Y=Z.formatMessage({id:"vote.intlExportComplete"}),H=(0,j.useCallback)(function(){var e=o()(a()().mark((function e(t,n){var r,o,i,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.load("dfsbpsvoters");case 3:return r=e.sent,o=r.table("vlists",n.owner),e.next=7,o.all();case 7:i=e.sent,l=i.sort((function(e,t){return t.vote_power.value-e.vote_power.value})),N(l),z(!1),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),(0,u.Tv)(e.t0,s);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}(),[s]),V=(0,j.useCallback)((function(e){H(d,e),m(e),y(!0)}),[d]);(0,j.useImperativeHandle)(t,(function(){return{handleOpen:V}}));var q=(0,j.useCallback)(o()(a()().mark((function e(){var t,n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(e){var t=0,n=e.map((function(e,n){return t+=e.vote_power.value,{"#":(n+1).toString(),"投票人":e.voter.toString(),"投票时间":e.vote_time.toString(),"票数":(e.vote_power.value/1e8).toFixed(0)}}));return n.push({"#":"汇总","投票人":e.length.toString(),"投票时间":"","票数":(t/1e8).toFixed(0)}),n},(n={}).fileName="当前节点投票汇总",n.datas=[{sheetData:t(_),sheetName:"投票数据",sheetFilter:["#","投票人","投票时间","票数"],sheetHeader:["#","投票人","投票时间","票数"]}],new(D())(n).saveExcel(),s.info(Y),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)}))),[_]);return(0,b.jsxs)(c.Y,{formRef:S,title:"".concat(P,": ").concat(Number(null==h?void 0:h.total_votes)?(Number(null==h?void 0:h.total_votes)/1e8).toFixed(0):0),open:F,onFinish:q,onOpenChange:function(e){y(e)},layout:"horizontal",width:"440px",submitter:{searchConfig:{submitText:T}},modalProps:{style:{top:25}},children:[(0,b.jsx)(w.Z,{dataSource:_,loading:R,renderItem:function(e){return(0,b.jsxs)(w.Z.Item,{children:[(0,b.jsx)(w.Z.Item.Meta,{title:e.voter.toString(),description:e.vote_time.toString()}),(0,b.jsx)("div",{className:"font-semibold",children:(e.vote_power.value/1e8).toFixed(0)})]})}}),i]})})),O=(0,j.memo)(I),_=n(7134),N=j.forwardRef((function(e,t){var n=f.ZP.useMessage(),r=l()(n,2),s=r[0],i=r[1],x=(0,j.useState)(),v=l()(x,2),h=v[0],m=v[1],S=(0,j.useState)(),k=l()(S,2),g=k[0],F=k[1],w=(0,j.useRef)(),y=(0,j.useState)(!1),D=l()(y,2),I=D[0],N=D[1],C=(0,j.useRef)(),M=(0,p.useSelector)((function(e){return e.global.session})),R=(0,p.useSelector)((function(e){return e.global.account})),z=(0,j.useState)("https://dfs.land/assets/icons/48x48.png"),Z=l()(z,2),P=Z[0],T=Z[1],Y=(0,p.useIntl)(),H=Y.formatMessage({id:"producer.intlVote"}),V=Y.formatMessage({id:"common.intlPleaseConnectWallet"}),q=Y.formatMessage({id:"common.intlPleaseConnectNetwork"}),E=Y.formatMessage({id:"node.intlVoteSuccess"}),W=Y.formatMessage({id:"node.intlVoteFail"}),A=(0,j.useCallback)((function(e){var t=e.logo;t&&!t.startsWith("http")&&t.startsWith("Qm")?t="https://imagedelivery.net/hc5yVyoIvwlbf8YqJjqHMw/".concat(t,"/public"):void 0!==t&&/^(https|http|ftp):\/\/[a-zA-Z0-9\-.]+\.[a-zA-Z]{2,}(:[0-9]{1,5})?(\/[\S]*)?$/.test(t)||(t="https://dfs.land/assets/icons/48x48.png"),T(t)}),[]),K=(0,j.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];m(e),A(e),F(t),N(!0)}),[A]);(0,j.useImperativeHandle)(t,(function(){return{handleOpen:K}}));var J=(0,j.useCallback)(o()(a()().mark((function e(){var t,n,r,o,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(M&&M.broadcast){e.next=5;break}return s.error("".concat(V)),e.abrupt("return");case 5:if(R){e.next=8;break}return s.error("".concat(q)),e.abrupt("return");case 8:return t={action:{account:"dfsbpsvoters",name:"vote",authorization:[M.permissionLevel],data:{voter:M.actor,producer:g?null==h?void 0:h.bp.toString():null==h?void 0:h.owner}}},e.next=11,(0,u.zI)(M.transact(t));case 11:return n=e.sent,r=l()(n,2),o=r[0],i=r[1],o?s.error(o):i&&i.response?s.success("".concat(E)):s.error("".concat(W)),e.abrupt("return",!0);case 17:case"end":return e.stop()}}),e)}))),[M,R,h,g]),L=(0,j.useCallback)((function(e){return e?"DFSNode.Online - 广州"===e?"DFSOnline-广州@":"DFSNode.Online - 杭州"===e?"DFSOnline-杭州@":"DFSNode.Online - 香港"===e?"DFSOnline-香港@":"DFSNode.Online - 张家口"===e?"DFSOnline-张家口@":"DFSNode.Online - 呼和浩特"===e?"DFSOnline-呼和浩特@":"DFS-美国弗吉尼亚-Node"===e?"DFS-美国弗吉尼亚@":"DFS-北京节点（持续在线）"===e?"DFS-北京节点@":"DFS-广州（持续在线）"===e?"DFS-广州@":e+"@":""}),[]),Q=(0,j.useMemo)((function(){return g?[{title:"rpcurl",dataIndex:"rpcurl",key:"rpcurl",render:function(e,t){return(0,b.jsx)("span",{children:t.rpcurl})}},{title:"p2purl",dataIndex:"p2purl",key:"p2purl",render:function(e,t){return(0,b.jsx)("span",{children:t.p2purl})}},{title:"location",dataIndex:"location",key:"location",render:function(e,t){return(0,b.jsx)("span",{children:t.location})}},{title:"intro",dataIndex:"intro",key:"intro",render:function(e,t){return(0,b.jsx)("div",{children:t.intro.split("\n").map((function(e,t){return(0,b.jsx)("div",{children:e},t)}))})}}]:[{title:"rank",dataIndex:"rank",key:"rank",render:function(e,t){return(0,b.jsx)("span",{children:t.rank})}},{title:"total_votes",dataIndex:"total_votes",key:"total_votes",render:function(e,t){return(0,b.jsx)("a",{onClick:function(){return C.current.handleOpen(t)},children:(Number(t.total_votes)/1e8).toFixed(0)})}},{title:"is_reward",dataIndex:"is_reward",key:"is_reward",render:function(e,t){return(0,b.jsx)("span",{children:t.is_reward})}},{title:"is_active",dataIndex:"is_active",key:"is_active",render:function(e,t){return(0,b.jsx)("span",{children:String(t.is_active)})}},{title:"current_status",dataIndex:"current_status",key:"current_status",render:function(e,t){return(0,b.jsx)("span",{children:t.current_status})}},{title:"rpcstatus",dataIndex:"rpcstatus",key:"rpcstatus",render:function(e,t){return(0,b.jsx)("span",{children:t.rpcstatus})}},{title:"p2pstatus",dataIndex:"p2pstatus",key:"p2pstatus",render:function(e,t){return(0,b.jsx)("span",{children:t.p2pstatus})}},{title:"rpcurl",dataIndex:"rpcurl",key:"rpcurl",render:function(e,t){return(0,b.jsx)("span",{children:t.rpcurl})}},{title:"p2purl",dataIndex:"p2purl",key:"p2purl",render:function(e,t){return(0,b.jsx)("span",{children:t.p2purl})}},{title:"total_reward",dataIndex:"total_reward",key:"total_reward",render:function(e,t){return(0,b.jsx)("span",{children:t.total_reward})}},{title:"url",dataIndex:"url",key:"url",render:function(e,t){return(0,b.jsx)("a",{href:t.url,target:"blank",children:t.url})}},{title:"location",dataIndex:"location",key:"location",render:function(e,t){return(0,b.jsx)("span",{children:t.location})}},{title:"intro",dataIndex:"intro",key:"intro",render:function(e,t){return(0,b.jsx)("div",{children:t.intro.split("\n").map((function(e,t){return(0,b.jsx)("div",{children:e},t)}))})}}]}),[g]);return(0,b.jsxs)(c.Y,{formRef:w,title:"",open:I,onFinish:J,onOpenChange:function(e){N(e)},layout:"horizontal",width:"400px",modalProps:g?{okText:"".concat(H)}:{style:{top:25},okText:"".concat(H)},children:[(0,b.jsx)(d.vY,{title:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(_.C,{className:"mr-2",size:"default",shape:"square",src:P}),(0,b.jsx)("div",{className:"",children:L(null==h?void 0:h.nick)+(g?null==h?void 0:h.bp.toString():null==h?void 0:h.owner)})]}),column:1,dataSource:h,columns:Q}),(0,b.jsx)(O,{ref:C}),i]})})),C=(0,j.memo)(N)}}]);