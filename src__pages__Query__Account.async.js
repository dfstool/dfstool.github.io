"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[229],{19298:function(e,t,n){n.r(t);var r=n(15009),a=n.n(r),s=n(99289),c=n.n(s),o=n(5574),u=n.n(o),i=n(84737),l=n(3990),f=n(64119),p=n(11774),d=n(38345),v=n(59530),h=n(80507),m=n(45360),b=n(69677),g=n(57953),k=n(92398),y=n(9669),x=n.n(y),N=n(27484),S=n.n(N),w=n(96486),j=n(62435),V=(n(31145),n(86074));t.default=function(){var e=m.ZP.useMessage(),t=u()(e,2),n=t[0],r=t[1],s=(0,v.useDispatch)(),o=(0,v.useSelector)((function(e){return e.global.session})),y=(0,v.useSelector)((function(e){return e.global.contractKit})),N=(0,v.useSelector)((function(e){return e.global.accountKit})),P=(0,v.useSelector)((function(e){return e.account.activeKey})),T=(0,v.useSelector)((function(e){return e.account.accountInfo})),L=(0,v.useSelector)((function(e){return e.account.loading})),M=(0,j.useRef)(),C=(0,j.useState)(""),O=u()(C,2),z=O[0],q=O[1],A=(0,v.useSearchParams)(),I=u()(A,2),_=I[0],E=I[1],K=(0,v.useIntl)(),D=K.formatMessage({id:"account.intlAccount"}),Z=K.formatMessage({id:"account.intlSearch"}),B=K.formatMessage({id:"contract.intlAccountFormatError"}),F=K.formatMessage({id:"account.intlSearchAccount"}),R=K.formatMessage({id:"account.intlProfile"}),U=K.formatMessage({id:"account.intlAuth"}),$=K.formatMessage({id:"account.intlToken"}),G=K.formatMessage({id:"account.intlLiq"}),H=K.formatMessage({id:"account.intlTx"}),J=(0,j.useMemo)((function(){return T?T.accountName.toString():""}),[T]),Q=(0,j.useCallback)(function(){var e=c()(a()().mark((function e(t,r){var c,i,p,d;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(/^[a-z1-5.]{1,12}$/.test(t)){e.next=8;break}if(t||r.hasOwnProperty("type")){e.next=4;break}return e.abrupt("return",!1);case 4:return n.error("".concat(B)),e.abrupt("return",!1);case 8:return e.next=10,(0,f.zI)(o.client.v1.chain.get_abi(t));case 10:if(c=e.sent,i=u()(c,2),p=i[0],d=i[1],!p){e.next=17;break}return n.error(p),e.abrupt("return",!1);case 17:return!p&&d.hasOwnProperty("abi"),s(l.N.setIsContract(!0)),e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[o,n]),W=(0,j.useCallback)(function(){var e=c()(a()().mark((function e(t,r,c,o){var i,p,d,v,m,b,g,k,y,N,w,j,V,P,T,L,M,C,O,z,q,A;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=[],d={},v=[],m=[],b=0,g={balValue:0,reserveValue:0,diffValue:0},"usdtusdtusdt-USDT-8",k="eosio.token-DFS-8",y=[],(p={})["usdtusdtusdt-USDT-8"]=1,p[k]=c[0].reserve0.value/c[0].reserve1.value,c.forEach((function(e){var t=e.contract0.toString()+"-"+e.sym0.toString().split(",")[1]+"-"+e.sym0.toString().split(",")[0],n=e.contract1.toString()+"-"+e.sym1.toString().split(",")[1]+"-"+e.sym1.toString().split(",")[0];i.includes(t)||(i.push(t),d[t]=i.length),i.includes(n)||(i.push(n),d[n]=i.length),"eosio.token"===e.contract0.toString()?p.hasOwnProperty(n)||(p[n]=e.reserve0.value/e.reserve1.value*p[k]):"eosio.token"===e.contract1.toString()?p.hasOwnProperty(t)||(p[t]=e.reserve1.value/e.reserve0.value*p[k]):"usdtusdtusdt"===e.contract0.toString()?p.hasOwnProperty(n)||(p[n]=e.reserve0.value/e.reserve1.value):"usdtusdtusdt"===e.contract1.toString()?p.hasOwnProperty(t)||(p[t]=e.reserve1.value/e.reserve0.value):y.push({key0:t,key1:n,value0:e.reserve0.value,value1:e.reserve1.value})})),y.forEach((function(e){p.hasOwnProperty(e.key0)&&!p.hasOwnProperty(e.key1)?p[e.key1]=e.value0/e.value1*p[e.key0]:!p.hasOwnProperty(e.key0)&&p.hasOwnProperty(e.key1)?p[e.key0]=e.value1/e.value0*p[e.key1]:p.hasOwnProperty(e.key0)||p.hasOwnProperty(e.key1)||(p[e.key0]=0,p[e.key1]=0)})),e.next=17,(0,f.zI)(x().get("https://api2.dfsmoon.com/v2/state/get_tokens?limit=1000&account=".concat(o),{timeout:2e3}));case 17:if(N=e.sent,w=u()(N,2),j=w[0],V=w[1],j||200!==V.status){e.next=26;break}V.data.tokens.forEach((function(e){var t=e.contract+"-"+e.symbol,n=p[t+"-"+e.precision],r=e.amount*n;b+=r,v.push({key:t,contract:e.contract,sym:e.symbol,precision:String(e.precision),price:n,asset:h.xR.from(e.amount.toFixed(e.precision)+" "+e.symbol),value:r})})),v.sort((function(e,t){return d[e.key+"-"+e.precision]-d[t.key+"-"+t.precision]})),e.next=43;break;case 26:P=0;case 27:if(!(P<i.length)){e.next=43;break}return T=i[P].split("-")[0],L=i[P].split("-")[1],M=i[P].split("-")[2],C=p[i[P]],e.next=34,t.client.v1.chain.get_currency_balance(T,o,L);case 34:if((O=e.sent).length){e.next=37;break}return e.abrupt("continue",40);case 37:z=O[0].value*C,b+=z,v.push({key:T+"-"+L,contract:T,sym:L,precision:M,price:C,asset:O[0],value:z});case 40:P++,e.next=27;break;case 43:return e.next=45,r.load("loglogloglog");case 45:return q=e.sent,A=q.table("liqs"),e.next=49,A.all({scope:o});case 49:e.sent.forEach((function(e){var t=c.find((function(t){return t.mid.equals(e.mid)})),n=t.contract0.toString(),r=t.contract1.toString(),a=t.sym0.name,s=t.sym1.name,o=t.sym0.precision,u=t.sym1.precision,i=n+"-"+a,l=r+"-"+s,f=p[i+"-"+o],d=p[l+"-"+u],v=e.bal0.value,h=e.bal1.value,b=v*f,k=h*d,y=e.token.toNumber()/t.liquidity_token.toNumber(),x=y*t.reserve0.value,N=y*t.reserve1.value,w=x*f,j=N*d,V=w+j-b-k,P=S()().diff(S().utc(e.start.toString()),"days");g.reserveValue+=w+j,g.balValue+=b+k,m.push({ratio:y,contract0:n,sym0:a,precision0:o,bal0:v,key0:i,bal0Value:b,reserve0Value:w,contract1:r,sym1:s,precision1:u,bal1:h,key1:l,reserve0:x,reserve1:N,price0:f,price1:d,bal1Value:k,reserve1Value:j,diffValue:V,days:P})})),g.diffValue=g.reserveValue-g.balValue,s(l.N.setTokensLoading(!1)),s(l.N.setTokens(v)),s(l.N.setLiqTokens(m)),s(l.N.setTokensValue(b)),s(l.N.setLiqsValue(g)),e.next=63;break;case 59:e.prev=59,e.t0=e.catch(0),s(l.N.setTokensLoading(!1)),(0,f.Tv)(e.t0,n);case 63:case"end":return e.stop()}}),e,null,[[0,59]])})));return function(t,n,r,a){return e.apply(this,arguments)}}(),[n]),X=(0,j.useCallback)(function(){var e=c()(a()().mark((function e(t,r){var c,i,p,d,v,m,b,g,k,S,w,j,V,P,T;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(N&&y&&o)){e.next=59;break}return s(l.N.setLoading(!0)),s(l.N.setTokensLoading(!0)),e.next=5,Q(t,r);case 5:if(e.sent){e.next=9;break}return s(l.N.setLoading(!1)),s(l.N.setTokensLoading(!1)),e.abrupt("return");case 9:return e.prev=9,c="",e.next=13,N.load(t);case 13:return i=e.sent,e.next=16,y.load("swapswapswap");case 16:return p=e.sent,e.next=19,y.load("dfsweb3desoc");case 19:return d=e.sent,e.next=22,y.load("dfsbpsvoters");case 22:return v=e.sent,m=p.table("markets"),b=d.table("profiles"),g=v.table("voters"),e.next=28,m.all();case 28:return k=e.sent,e.next=31,g.all({scope:"dfsbpsvoters",from:t,to:t});case 31:return S=e.sent,e.next=34,b.all({scope:"dfsweb3desoc",from:t,to:t});case 34:return(w=e.sent).length||w.push({avatar:"",cover:"",desc:"",join:"",nick:"",owner:h.VG.from(t),sex:h.zM.from(2),update:""}),e.next=38,(0,f.zI)(x().get("https://api2.dfsmoon.com/v2/history/get_creator?account=".concat(i.accountName.toString())));case 38:j=e.sent,V=u()(j,2),P=V[0],T=V[1],P||200!==T.status||(c=T.data.creator),W(o,y,k,t),s(l.N.setMarkets(k)),s(l.N.setAccountInfo(i)),s(l.N.setCreator(c)),s(l.N.setProfile(w[0])),s(l.N.setVoter(S[0])),q(""),s(l.N.setLoading(!1)),M.current&&M.current.handleSearch(),e.next=59;break;case 54:e.prev=54,e.t0=e.catch(9),s(l.N.setLoading(!1)),s(l.N.setTokensLoading(!1)),(0,f.Tv)(e.t0,n);case 59:case"end":return e.stop()}}),e,null,[[9,54]])})));return function(t,n){return e.apply(this,arguments)}}(),[N,y,o,Q,n,W]),Y=(0,j.useCallback)((0,w.debounce)(function(){var e=c()(a()().mark((function e(t){var n,r,s,c;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target.value,/^[a-z1-5.]{1,12}$/.test(n)){e.next=6;break}0===n.trim().length?q(""):q("error"),e.next=12;break;case 6:return e.next=8,(0,f.zI)(o.client.v1.chain.get_account(n));case 8:r=e.sent,s=u()(r,2),c=s[1],q(c?"":"error");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),1e3),[o]),ee=[{key:"info",label:(0,V.jsx)("span",{className:"text-lg font-semibold",children:R}),children:!!T&&(0,V.jsx)(i.i3,{handleSearch:X})},{key:"auth",label:(0,V.jsx)("span",{className:"text-lg font-semibold",children:U}),children:!!T&&(0,V.jsx)(i.Bf,{})},{key:"token",label:(0,V.jsx)("span",{className:"text-lg font-semibold",children:$}),children:!!T&&(0,V.jsx)(i.DL,{})},{key:"liq",label:(0,V.jsx)("span",{className:"text-lg font-semibold",children:G}),children:!!T&&(0,V.jsx)(i.uq,{})},{key:"tx",label:(0,V.jsx)("span",{className:"text-lg font-semibold",children:H}),children:!!T&&(0,V.jsx)(i.ps,{ref:M})},{key:"tip",label:(0,V.jsx)("span",{className:"text-lg font-semibold",children:J}),disabled:!0}],te=(0,j.useCallback)((function(e,t){var n={};e&&(n.search=e),n.tab=t||P,E(n)}),[P]);return(0,j.useEffect)((function(){var e=_.get("search"),t=_.get("tab");t&&s(l.N.setActiveKey(t)),e&&X(e,""),te(e,t)}),[X]),(0,j.useEffect)((function(){var e=T?T.accountName.toString():"";te(e,P)}),[T,P,te]),(0,V.jsxs)(p._z,{className:"account",ghost:!0,children:[(0,V.jsxs)(d.Z,{children:[(0,V.jsx)("div",{className:"hardline text-lg font-semibold mb-3",children:F}),(0,V.jsx)(b.Z.Search,{className:"pl-[13px] ",loading:L,addonBefore:(0,V.jsx)(g.Z,{spinning:L,children:D}),placeholder:"Search...",allowClear:!0,enterButton:Z,size:"large",status:z,onSearch:X,onChange:Y}),(0,V.jsx)(k.Z,{className:"mt-2",defaultActiveKey:"info",items:ee,activeKey:P,onChange:function(e){s(l.N.setActiveKey(e))}})]}),r]})}},31145:function(){}}]);