"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[229],{19298:function(e,t,n){n.r(t);var r=n(15009),a=n.n(r),s=n(99289),o=n.n(s),c=n(5574),u=n.n(c),l=n(26824),i=n(3990),p=n(64119),f=n(11774),d=n(38345),v=n(59530),h=n(80507),g=n(45360),m=n(69677),b=n(57953),k=n(92398),y=n(9669),x=n.n(y),N=n(27484),S=n.n(N),w=n(96486),j=n(62435),P=(n(31145),n(86074));t.default=function(){var e=g.ZP.useMessage(),t=u()(e,2),n=t[0],r=t[1],s=(0,v.useDispatch)(),c=(0,v.useSelector)((function(e){return e.global.session})),y=(0,v.useSelector)((function(e){return e.global.contractKit})),N=(0,v.useSelector)((function(e){return e.global.accountKit})),V=(0,v.useSelector)((function(e){return e.account.activeKey})),M=(0,v.useSelector)((function(e){return e.account.accountInfo})),T=(0,v.useSelector)((function(e){return e.account.loading})),L=(0,v.useSelector)((function(e){return e.account.approvals2})),C=(0,v.useSelector)((function(e){return e.account.proposals})),O=(0,j.useRef)(),z=(0,j.useState)(""),A=u()(z,2),q=A[0],I=A[1],_=(0,v.useSearchParams)(),E=u()(_,2),K=E[0],D=E[1],Z=K.get("tab")?K.get("tab"):void 0,B=(0,v.useIntl)(),F=B.formatMessage({id:"account.intlAccount"}),R=B.formatMessage({id:"account.intlSearch"}),U=B.formatMessage({id:"contract.intlAccountFormatError"}),$=B.formatMessage({id:"account.intlSearchAccount"}),G=B.formatMessage({id:"account.intlProfile"}),H=B.formatMessage({id:"account.intlAuth"}),J=B.formatMessage({id:"account.intlToken"}),Q=B.formatMessage({id:"account.intlLiq"}),W=B.formatMessage({id:"account.intlTx"}),X=B.formatMessage({id:"account.intlProposal"}),Y=(0,j.useMemo)((function(){return M?M.accountName.toString():""}),[M]),ee=(0,j.useCallback)(function(){var e=o()(a()().mark((function e(t,r){var o,l,f,d;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(/^[a-z1-5.]{1,12}$/.test(t)){e.next=8;break}if(t||r.hasOwnProperty("type")){e.next=4;break}return e.abrupt("return",!1);case 4:return n.error("".concat(U)),e.abrupt("return",!1);case 8:return e.next=10,(0,p.zI)(c.client.v1.chain.get_abi(t));case 10:if(o=e.sent,l=u()(o,2),f=l[0],d=l[1],!f){e.next=17;break}return n.error(f),e.abrupt("return",!1);case 17:return!f&&d.hasOwnProperty("abi"),s(i.N.setIsContract(!0)),e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[c,n]),te=(0,j.useCallback)(function(){var e=o()(a()().mark((function e(t,r,o,c){var l,f,d,v,g,m,b,k,y,N,w,j,P,V,M,T,L,C,O,z,A,q;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l=[],d={},v=[],g=[],m=0,b={balValue:0,reserveValue:0,diffValue:0},"usdtusdtusdt-USDT-8",k="eosio.token-DFS-8",y=[],(f={})["usdtusdtusdt-USDT-8"]=1,f[k]=o[0].reserve0.value/o[0].reserve1.value,o.forEach((function(e){var t=e.contract0.toString()+"-"+e.sym0.toString().split(",")[1]+"-"+e.sym0.toString().split(",")[0],n=e.contract1.toString()+"-"+e.sym1.toString().split(",")[1]+"-"+e.sym1.toString().split(",")[0];l.includes(t)||(l.push(t),d[t]=l.length),l.includes(n)||(l.push(n),d[n]=l.length),"eosio.token"===e.contract0.toString()?f.hasOwnProperty(n)||(f[n]=e.reserve0.value/e.reserve1.value*f[k]):"eosio.token"===e.contract1.toString()?f.hasOwnProperty(t)||(f[t]=e.reserve1.value/e.reserve0.value*f[k]):"usdtusdtusdt"===e.contract0.toString()?f.hasOwnProperty(n)||(f[n]=e.reserve0.value/e.reserve1.value):"usdtusdtusdt"===e.contract1.toString()?f.hasOwnProperty(t)||(f[t]=e.reserve1.value/e.reserve0.value):y.push({key0:t,key1:n,value0:e.reserve0.value,value1:e.reserve1.value})})),y.forEach((function(e){f.hasOwnProperty(e.key0)&&!f.hasOwnProperty(e.key1)?f[e.key1]=e.value0/e.value1*f[e.key0]:!f.hasOwnProperty(e.key0)&&f.hasOwnProperty(e.key1)?f[e.key0]=e.value1/e.value0*f[e.key1]:f.hasOwnProperty(e.key0)||f.hasOwnProperty(e.key1)||(f[e.key0]=0,f[e.key1]=0)})),e.next=17,(0,p.zI)(x().get("https://api2.dfsmoon.com/v2/state/get_tokens?limit=1000&account=".concat(c),{timeout:2e3}));case 17:if(N=e.sent,w=u()(N,2),j=w[0],P=w[1],j||200!==P.status){e.next=26;break}P.data.tokens.forEach((function(e){var t=e.contract+"-"+e.symbol,n=f[t+"-"+e.precision],r=e.amount*n;m+=r,v.push({key:t,contract:e.contract,sym:e.symbol,precision:String(e.precision),price:n,asset:h.xR.from(e.amount.toFixed(e.precision)+" "+e.symbol),value:r})})),v.sort((function(e,t){return d[e.key+"-"+e.precision]-d[t.key+"-"+t.precision]})),e.next=43;break;case 26:V=0;case 27:if(!(V<l.length)){e.next=43;break}return M=l[V].split("-")[0],T=l[V].split("-")[1],L=l[V].split("-")[2],C=f[l[V]],e.next=34,t.client.v1.chain.get_currency_balance(M,c,T);case 34:if((O=e.sent).length){e.next=37;break}return e.abrupt("continue",40);case 37:z=O[0].value*C,m+=z,v.push({key:M+"-"+T,contract:M,sym:T,precision:L,price:C,asset:O[0],value:z});case 40:V++,e.next=27;break;case 43:return e.next=45,r.load("loglogloglog");case 45:return A=e.sent,q=A.table("liqs"),e.next=49,q.all({scope:c});case 49:e.sent.forEach((function(e){var t=o.find((function(t){return t.mid.equals(e.mid)})),n=t.contract0.toString(),r=t.contract1.toString(),a=t.sym0.name,s=t.sym1.name,c=t.sym0.precision,u=t.sym1.precision,l=n+"-"+a,i=r+"-"+s,p=f[l+"-"+c],d=f[i+"-"+u],v=e.bal0.value,h=e.bal1.value,m=v*p,k=h*d,y=e.token.toNumber()/t.liquidity_token.toNumber(),x=y*t.reserve0.value,N=y*t.reserve1.value,w=x*p,j=N*d,P=w+j-m-k,V=S()().diff(S().utc(e.start.toString()),"days");b.reserveValue+=w+j,b.balValue+=m+k,g.push({ratio:y,contract0:n,sym0:a,precision0:c,bal0:v,key0:l,bal0Value:m,reserve0Value:w,contract1:r,sym1:s,precision1:u,bal1:h,key1:i,reserve0:x,reserve1:N,price0:p,price1:d,bal1Value:k,reserve1Value:j,diffValue:P,days:V})})),b.diffValue=b.reserveValue-b.balValue,s(i.N.setTokensLoading(!1)),s(i.N.setTokens(v)),s(i.N.setLiqTokens(g)),s(i.N.setTokensValue(m)),s(i.N.setLiqsValue(b)),e.next=63;break;case 59:e.prev=59,e.t0=e.catch(0),s(i.N.setTokensLoading(!1)),(0,p.Tv)(e.t0,n);case 63:case"end":return e.stop()}}),e,null,[[0,59]])})));return function(t,n,r,a){return e.apply(this,arguments)}}(),[n]),ne=(0,j.useCallback)(function(){var e=o()(a()().mark((function e(t,r){var o,l,f,d,v,g,m,b,k,S,w,j,P,V,M,T,L,C,z,A;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(N&&y&&c)){e.next=72;break}return s(i.N.setLoading(!0)),s(i.N.setTokensLoading(!0)),e.next=5,ee(t,r);case 5:if(e.sent){e.next=9;break}return s(i.N.setLoading(!1)),s(i.N.setTokensLoading(!1)),e.abrupt("return");case 9:return e.prev=9,o="",e.next=13,N.load(t);case 13:return l=e.sent,e.next=16,y.load("swapswapswap");case 16:return f=e.sent,e.next=19,y.load("dfsweb3desoc");case 19:return d=e.sent,e.next=22,y.load("dfsbpsvoters");case 22:return v=e.sent,e.next=25,y.load("eosio.msig");case 25:return g=e.sent,m=f.table("markets"),b=d.table("profiles"),k=v.table("voters"),S=g.table("approvals2"),w=g.table("proposal"),e.next=33,m.all();case 33:return j=e.sent,e.next=36,k.all({scope:"dfsbpsvoters",from:t,to:t});case 36:return P=e.sent,e.next=39,b.all({scope:"dfsweb3desoc",from:t,to:t});case 39:return(V=e.sent).length||V.push({avatar:"",cover:"",desc:"",join:"",nick:"",owner:h.VG.from(t),sex:h.zM.from(2),update:""}),e.next=43,S.all({scope:t});case 43:return M=e.sent,e.next=46,w.all({scope:t});case 46:return T=e.sent,e.next=49,(0,p.zI)(x().get("https://api2.dfsmoon.com/v2/history/get_creator?account=".concat(l.accountName.toString())));case 49:L=e.sent,C=u()(L,2),z=C[0],A=C[1],z||200!==A.status||(o=A.data.creator),te(c,y,j,t),s(i.N.setMarkets(j)),s(i.N.setAccountInfo(l)),s(i.N.setCreator(o)),s(i.N.setProfile(V[0])),s(i.N.setVoter(P[0])),s(i.N.setProposals(T)),s(i.N.setApprovals2(M)),I(""),s(i.N.setLoading(!1)),O.current&&O.current.handleSearch(),e.next=72;break;case 67:e.prev=67,e.t0=e.catch(9),s(i.N.setLoading(!1)),s(i.N.setTokensLoading(!1)),(0,p.Tv)(e.t0,n);case 72:case"end":return e.stop()}}),e,null,[[9,67]])})));return function(t,n){return e.apply(this,arguments)}}(),[N,y,c,ee,n,te]),re=(0,j.useCallback)((0,w.debounce)(function(){var e=o()(a()().mark((function e(t){var n,r,s,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target.value,/^[a-z1-5.]{1,12}$/.test(n)){e.next=6;break}0===n.trim().length?I(""):I("error"),e.next=12;break;case 6:return e.next=8,(0,p.zI)(c.client.v1.chain.get_account(n));case 8:r=e.sent,s=u()(r,2),o=s[1],I(o?"":"error");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),1e3),[c]),ae=[{key:"info",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:G}),children:!!M&&(0,P.jsx)(l.i3,{handleSearch:ne})},{key:"auth",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:H}),children:!!M&&(0,P.jsx)(l.Bf,{})},{key:"token",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:J}),children:!!M&&(0,P.jsx)(l.DL,{})},{key:"liq",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:Q}),children:!!M&&(0,P.jsx)(l.uq,{})},{key:"tx",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:W}),children:!!M&&(0,P.jsx)(l.ps,{ref:O})},{key:"proposal",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:X}),children:!!M&&(0,P.jsx)(l.f9,{proposer:M.accountName.toString(),approvals2:L,proposals:C,loading:T,handleSearch:ne})},{key:"tip",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:Y}),disabled:!0}],se=(0,j.useCallback)((function(e,t){var n={};e&&(n.search=e),n.tab=t||V,D(n)}),[V]);return(0,j.useEffect)((function(){var e=K.get("search"),t=K.get("tab");t&&s(i.N.setActiveKey(t)),e&&ne(e,""),se(e,t)}),[ne]),(0,j.useEffect)((function(){var e=M?M.accountName.toString():"";se(e,V)}),[M,V,se]),(0,P.jsxs)(f._z,{className:"account",ghost:!0,children:[(0,P.jsxs)(d.Z,{title:(0,P.jsx)("span",{className:"hardline font-semibold text-lg mb-3",children:$}),children:[(0,P.jsx)(m.Z.Search,{className:" ",loading:T,addonBefore:(0,P.jsx)(b.Z,{spinning:T,children:F}),placeholder:"Search...",allowClear:!0,enterButton:R,size:"large",status:q,onSearch:ne,onChange:re}),(0,P.jsx)(k.Z,{className:"mt-2",defaultActiveKey:"info",items:ae,activeKey:Z,onChange:function(e){s(i.N.setActiveKey(e))}})]}),r]})}},31145:function(){}}]);