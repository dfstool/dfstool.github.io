"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[229],{19298:function(e,t,n){n.r(t);var r=n(15009),a=n.n(r),s=n(99289),c=n.n(s),o=n(5574),u=n.n(o),i=n(84737),l=n(3990),f=n(64119),p=n(11774),d=n(38345),v=n(59530),h=n(80507),b=n(45360),k=n(69677),m=n(57953),g=n(92398),y=n(9669),x=n.n(y),N=n(27484),S=n.n(N),w=n(96486),j=n(62435),V=(n(31145),n(86074));t.default=function(){var e=b.ZP.useMessage(),t=u()(e,2),n=t[0],r=t[1],s=(0,v.useDispatch)(),o=(0,v.useSelector)((function(e){return e.global.session})),y=(0,v.useSelector)((function(e){return e.global.contractKit})),N=(0,v.useSelector)((function(e){return e.global.accountKit})),P=(0,v.useSelector)((function(e){return e.account.activeKey})),T=(0,v.useSelector)((function(e){return e.account.accountInfo})),L=(0,v.useSelector)((function(e){return e.account.loading})),M=(0,j.useState)(""),O=u()(M,2),C=O[0],q=O[1],z=(0,v.useSearchParams)(),A=u()(z,2),E=A[0],I=A[1],K=(0,v.useIntl)(),_=K.formatMessage({id:"account.intlAccount"}),D=K.formatMessage({id:"account.intlSearch"}),Z=K.formatMessage({id:"contract.intlAccountFormatError"}),B=K.formatMessage({id:"account.intlSearchAccount"}),F=K.formatMessage({id:"account.intlProfile"}),U=K.formatMessage({id:"account.intlAuth"}),$=K.formatMessage({id:"account.intlToken"}),G=K.formatMessage({id:"account.intlLiq"}),R=K.formatMessage({id:"account.intlTx"}),H=(0,j.useMemo)((function(){return T?T.accountName.toString():""}),[T]),J=(0,j.useCallback)(function(){var e=c()(a()().mark((function e(t,r){var c,i,p,d;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(/^[a-z1-5.]{1,12}$/.test(t)){e.next=8;break}if(t||r.hasOwnProperty("type")){e.next=4;break}return e.abrupt("return",!1);case 4:return n.error("".concat(Z)),e.abrupt("return",!1);case 8:return e.next=10,(0,f.zI)(o.client.v1.chain.get_abi(t));case 10:if(c=e.sent,i=u()(c,2),p=i[0],d=i[1],!p){e.next=17;break}return n.error(p),e.abrupt("return",!1);case 17:return!p&&d.hasOwnProperty("abi"),s(l.N.setIsContract(!0)),e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[o,n]),Q=(0,j.useCallback)(function(){var e=c()(a()().mark((function e(t,r,c,o){var i,p,d,v,b,k,m,g,y,N,w,j,V,P,T,L,M,O,C,q,z,A;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=[],d={},v=[],b=[],k=0,m={balValue:0,reserveValue:0,diffValue:0},"usdtusdtusdt-USDT-8",g="eosio.token-DFS-8",y=[],(p={})["usdtusdtusdt-USDT-8"]=1,p[g]=c[0].reserve0.value/c[0].reserve1.value,c.forEach((function(e){var t=e.contract0.toString()+"-"+e.sym0.toString().split(",")[1]+"-"+e.sym0.toString().split(",")[0],n=e.contract1.toString()+"-"+e.sym1.toString().split(",")[1]+"-"+e.sym1.toString().split(",")[0];i.includes(t)||(i.push(t),d[t]=i.length),i.includes(n)||(i.push(n),d[n]=i.length),"eosio.token"===e.contract0.toString()?p.hasOwnProperty(n)||(p[n]=e.reserve0.value/e.reserve1.value*p[g]):"eosio.token"===e.contract1.toString()?p.hasOwnProperty(t)||(p[t]=e.reserve1.value/e.reserve0.value*p[g]):"usdtusdtusdt"===e.contract0.toString()?p.hasOwnProperty(n)||(p[n]=e.reserve0.value/e.reserve1.value):"usdtusdtusdt"===e.contract1.toString()?p.hasOwnProperty(t)||(p[t]=e.reserve1.value/e.reserve0.value):y.push({key0:t,key1:n,value0:e.reserve0.value,value1:e.reserve1.value})})),y.forEach((function(e){p.hasOwnProperty(e.key0)&&!p.hasOwnProperty(e.key1)?p[e.key1]=e.value0/e.value1*p[e.key0]:!p.hasOwnProperty(e.key0)&&p.hasOwnProperty(e.key1)?p[e.key0]=e.value1/e.value0*p[e.key1]:p.hasOwnProperty(e.key0)||p.hasOwnProperty(e.key1)||(p[e.key0]=0,p[e.key1]=0)})),e.next=17,(0,f.zI)(x().get("https://api2.dfsmoon.com/v2/state/get_tokens?limit=1000&account=".concat(o),{timeout:2e3}));case 17:if(N=e.sent,w=u()(N,2),j=w[0],V=w[1],j||200!==V.status){e.next=26;break}V.data.tokens.forEach((function(e){var t=e.contract+"-"+e.symbol,n=p[t+"-"+e.precision],r=e.amount*n;k+=r,v.push({key:t,contract:e.contract,sym:e.symbol,precision:String(e.precision),price:n,asset:h.xR.from(e.amount.toFixed(e.precision)+" "+e.symbol),value:r})})),v.sort((function(e,t){return d[e.key+"-"+e.precision]-d[t.key+"-"+t.precision]})),e.next=43;break;case 26:P=0;case 27:if(!(P<i.length)){e.next=43;break}return T=i[P].split("-")[0],L=i[P].split("-")[1],M=i[P].split("-")[2],O=p[i[P]],e.next=34,t.client.v1.chain.get_currency_balance(T,o,L);case 34:if((C=e.sent).length){e.next=37;break}return e.abrupt("continue",40);case 37:q=C[0].value*O,k+=q,v.push({key:T+"-"+L,contract:T,sym:L,precision:M,price:O,asset:C[0],value:q});case 40:P++,e.next=27;break;case 43:return e.next=45,r.load("loglogloglog");case 45:return z=e.sent,A=z.table("liqs"),e.next=49,A.all({scope:o});case 49:e.sent.forEach((function(e){var t=c.find((function(t){return t.mid.equals(e.mid)})),n=t.contract0.toString(),r=t.contract1.toString(),a=t.sym0.name,s=t.sym1.name,o=t.sym0.precision,u=t.sym1.precision,i=n+"-"+a,l=r+"-"+s,f=p[i+"-"+o],d=p[l+"-"+u],v=e.bal0.value,h=e.bal1.value,k=v*f,g=h*d,y=e.token.toNumber()/t.liquidity_token.toNumber(),x=y*t.reserve0.value,N=y*t.reserve1.value,w=x*f,j=N*d,V=w+j-k-g,P=S()().diff(S().utc(e.start.toString()),"days");m.reserveValue+=w+j,m.balValue+=k+g,b.push({ratio:y,contract0:n,sym0:a,precision0:o,bal0:v,key0:i,bal0Value:k,reserve0Value:w,contract1:r,sym1:s,precision1:u,bal1:h,key1:l,reserve0:x,reserve1:N,price0:f,price1:d,bal1Value:g,reserve1Value:j,diffValue:V,days:P})})),m.diffValue=m.reserveValue-m.balValue,s(l.N.setTokensLoading(!1)),s(l.N.setTokens(v)),s(l.N.setLiqTokens(b)),s(l.N.setTokensValue(k)),s(l.N.setLiqsValue(m)),e.next=63;break;case 59:e.prev=59,e.t0=e.catch(0),s(l.N.setTokensLoading(!1)),(0,f.Tv)(e.t0,n);case 63:case"end":return e.stop()}}),e,null,[[0,59]])})));return function(t,n,r,a){return e.apply(this,arguments)}}(),[n]),W=(0,j.useCallback)(function(){var e=c()(a()().mark((function e(t,r){var c,u,i,p,d,v,b,k,m,g;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(N&&y&&o)){e.next=49;break}return s(l.N.setLoading(!0)),s(l.N.setTokensLoading(!0)),e.next=5,J(t,r);case 5:if(e.sent){e.next=9;break}return s(l.N.setLoading(!1)),s(l.N.setTokensLoading(!1)),e.abrupt("return");case 9:return e.prev=9,e.next=12,N.load(t);case 12:return c=e.sent,e.next=15,y.load("swapswapswap");case 15:return u=e.sent,e.next=18,y.load("dfsweb3desoc");case 18:return i=e.sent,e.next=21,y.load("dfsbpsvoters");case 21:return p=e.sent,d=u.table("markets"),v=i.table("profiles"),b=p.table("voters"),e.next=27,d.all();case 27:return k=e.sent,e.next=30,b.all({scope:"dfsbpsvoters",from:t,to:t});case 30:return m=e.sent,e.next=33,v.all({scope:"dfsweb3desoc",from:t,to:t});case 33:(g=e.sent).length||g.push({avatar:"",cover:"",desc:"",join:"",nick:"",owner:h.VG.from(t),sex:h.zM.from(2),update:""}),Q(o,y,k,t),s(l.N.setMarkets(k)),s(l.N.setAccountInfo(c)),s(l.N.setProfile(g[0])),s(l.N.setVoter(m[0])),q(""),s(l.N.setLoading(!1)),e.next=49;break;case 44:e.prev=44,e.t0=e.catch(9),s(l.N.setLoading(!1)),s(l.N.setTokensLoading(!1)),(0,f.Tv)(e.t0,n);case 49:case"end":return e.stop()}}),e,null,[[9,44]])})));return function(t,n){return e.apply(this,arguments)}}(),[N,y,o,J,n,Q]),X=(0,j.useCallback)((0,w.debounce)(function(){var e=c()(a()().mark((function e(t){var n,r,s,c;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target.value,/^[a-z1-5.]{1,12}$/.test(n)){e.next=6;break}0===n.trim().length?q(""):q("error"),e.next=12;break;case 6:return e.next=8,(0,f.zI)(o.client.v1.chain.get_account(n));case 8:r=e.sent,s=u()(r,2),c=s[1],q(c?"":"error");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),1e3),[o]),Y=[{key:"info",label:(0,V.jsx)("span",{className:"text-lg font-semibold",children:F}),children:!!T&&(0,V.jsx)(i.i3,{})},{key:"auth",label:(0,V.jsx)("span",{className:"text-lg font-semibold",children:U}),children:!!T&&(0,V.jsx)(i.Bf,{})},{key:"token",label:(0,V.jsx)("span",{className:"text-lg font-semibold",children:$}),children:!!T&&(0,V.jsx)(i.DL,{})},{key:"liq",label:(0,V.jsx)("span",{className:"text-lg font-semibold",children:G}),children:!!T&&(0,V.jsx)(i.uq,{})},{key:"tx",label:(0,V.jsx)("span",{className:"text-lg font-semibold",children:R}),children:!!T&&(0,V.jsx)(i.ps,{})},{key:"tip",label:(0,V.jsx)("span",{className:"text-lg font-semibold",children:H}),disabled:!0}],ee=(0,j.useCallback)((function(e,t){var n={};e&&(n.search=e),n.tab=t||P,I(n)}),[P]);return(0,j.useEffect)((function(){var e=E.get("search"),t=E.get("tab");t&&s(l.N.setActiveKey(t)),e&&W(e,""),ee(e,t)}),[W]),(0,j.useEffect)((function(){var e=T?T.accountName.toString():"";ee(e,P)}),[T,P,ee]),(0,V.jsxs)(p._z,{className:"account",ghost:!0,children:[(0,V.jsxs)(d.Z,{children:[(0,V.jsx)("div",{className:"hardline text-lg font-semibold mb-3",children:B}),(0,V.jsx)(k.Z.Search,{className:"pl-[13px] ",loading:L,addonBefore:(0,V.jsx)(m.Z,{spinning:L,children:_}),placeholder:"Search...",allowClear:!0,enterButton:D,size:"large",status:C,onSearch:W,onChange:X}),(0,V.jsx)(g.Z,{className:"mt-2",defaultActiveKey:"info",items:Y,activeKey:P,onChange:function(e){s(l.N.setActiveKey(e))}})]}),r]})}},31145:function(){}}]);