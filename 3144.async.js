"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3144],{64317:function(e,t,a){var n=a(1413),r=a(91),s=a(22270),i=a(62435),l=a(66758),o=a(56499),c=a(86074),u=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],m=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],d=function(e,t){var a=e.fieldProps,m=e.children,d=e.params,p=e.proFieldProps,f=e.mode,h=e.valueEnum,x=e.request,y=e.showSearch,b=e.options,k=(0,r.Z)(e,u),j=(0,i.useContext)(l.Z);return(0,c.jsx)(o.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,s.h)(h),request:x,params:d,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({options:b,mode:f,showSearch:y,getPopupContainer:j.getPopupContainer},a),ref:t,proFieldProps:p},k),{},{children:m}))},p=i.forwardRef((function(e,t){var a=e.fieldProps,u=e.children,d=e.params,p=e.proFieldProps,f=e.mode,h=e.valueEnum,x=e.request,y=e.options,b=(0,r.Z)(e,m),k=(0,n.Z)({options:y,mode:f||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},a),j=(0,i.useContext)(l.Z);return(0,c.jsx)(o.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,s.h)(h),request:x,params:d,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({getPopupContainer:j.getPopupContainer},k),ref:t,proFieldProps:p},b),{},{children:u}))})),f=i.forwardRef(d);f.SearchSelect=p,f.displayName="ProFormComponent",t.Z=f},16529:function(e,t,a){a.d(t,{s:function(){return d},S:function(){return h}});var n=a(5574),r=a.n(n),s=a(59530),i=a(85265),l=a(42075),o=a(15867),c=a(62435),u=a(86074),m=c.forwardRef((function(e,t){var a=(0,s.useIntl)(),n=a.formatMessage({id:"iframe.Close"}),m=a.formatMessage({id:"iframe.Jump"}),d=e.src,p=e.title,f=(0,c.useState)(!1),h=r()(f,2),x=h[0],y=h[1];(0,c.useImperativeHandle)(t,(function(){return{setIsDrawerOpen:y}}));var b=(0,c.useCallback)((function(){y(!1)}),[]),k=(0,c.useCallback)((function(){window.open(d),y(!1)}),[d]);return(0,u.jsx)(i.Z,{title:p,placement:"bottom",closable:!1,open:x,onClose:b,styles:{body:{padding:"0px"},header:{padding:"10px"}},height:"90%",destroyOnClose:!0,extra:(0,u.jsxs)(l.Z,{children:[(0,u.jsx)(o.ZP,{type:"primary",onClick:k,children:m}),(0,u.jsx)(o.ZP,{type:"primary",onClick:b,children:n})]}),children:(0,u.jsx)("iframe",{title:"",style:{borderWidth:"0px"},width:"100%",height:"100%",src:d})})})),d=(0,c.memo)(m),p=a(99021),f=c.forwardRef((function(e,t){var a=(0,c.useState)([]),n=r()(a,2),s=n[0],l=n[1],o=(0,c.useState)(!1),m=r()(o,2),d=m[0],f=m[1],h=(0,c.useCallback)((function(e){f(!0),l(e.split("|"))}),[]);return(0,c.useImperativeHandle)(t,(function(){return{handleOpen:h}})),(0,u.jsx)(i.Z,{placement:"bottom",closable:!0,open:d,onClose:function(){return f(!1)},styles:{body:{padding:"0px",textAlign:"center"},header:{padding:"10px"}},height:"91%",destroyOnClose:!0,children:s.map((function(e,t){return(0,u.jsx)(p.Z,{src:e,preview:!1},t)}))})})),h=(0,c.memo)(f)},23144:function(e,t,a){a.d(t,{cS:function(){return Q},K4:function(){return be},xt:function(){return je},OA:function(){return Se}});var n=a(16529),r=a(35132),s=a(15867),i=a(27484),l=a.n(i),o=a(70178),c=a.n(o),u=a(62435),m=a(15009),d=a.n(m),p=a(99289),f=a.n(p),h=a(5574),x=a.n(h),y=a(3990),b=a(64119),k=a(64317),j=a(1413),v=a(91),S=a(66758),g=a(56499),C=a(86074),q=["proFieldProps","fieldProps"],Z="date",N=u.forwardRef((function(e,t){var a=e.proFieldProps,n=e.fieldProps,r=(0,v.Z)(e,q),s=(0,u.useContext)(S.Z);return(0,C.jsx)(g.Z,(0,j.Z)({ref:t,valueType:Z,fieldProps:(0,j.Z)({getPopupContainer:s.getPopupContainer},n),proFieldProps:a,filedConfig:{valueType:Z,customLightMode:!0}},r))})),B=["proFieldProps","fieldProps"],F="dateMonth",T=u.forwardRef((function(e,t){var a=e.proFieldProps,n=e.fieldProps,r=(0,v.Z)(e,B),s=(0,u.useContext)(S.Z);return(0,C.jsx)(g.Z,(0,j.Z)({ref:t,valueType:F,fieldProps:(0,j.Z)({getPopupContainer:s.getPopupContainer},n),proFieldProps:a,filedConfig:{valueType:F,customLightMode:!0}},r))})),E=["fieldProps"],w="dateQuarter",P=u.forwardRef((function(e,t){var a=e.fieldProps,n=(0,v.Z)(e,E),r=(0,u.useContext)(S.Z);return(0,C.jsx)(g.Z,(0,j.Z)({ref:t,valueType:w,fieldProps:(0,j.Z)({getPopupContainer:r.getPopupContainer},a),filedConfig:{valueType:w,customLightMode:!0}},n))})),I=["proFieldProps","fieldProps"],M="dateWeek",O=u.forwardRef((function(e,t){var a=e.proFieldProps,n=e.fieldProps,r=(0,v.Z)(e,I),s=(0,u.useContext)(S.Z);return(0,C.jsx)(g.Z,(0,j.Z)({ref:t,valueType:M,fieldProps:(0,j.Z)({getPopupContainer:s.getPopupContainer},n),proFieldProps:a,filedConfig:{valueType:M,customLightMode:!0}},r))})),D=["proFieldProps","fieldProps"],z="dateYear",R=u.forwardRef((function(e,t){var a=e.proFieldProps,n=e.fieldProps,r=(0,v.Z)(e,D),s=(0,u.useContext)(S.Z);return(0,C.jsx)(g.Z,(0,j.Z)({ref:t,valueType:z,fieldProps:(0,j.Z)({getPopupContainer:s.getPopupContainer},n),proFieldProps:a,filedConfig:{valueType:z,customLightMode:!0}},r))})),_=N;_.Week=O,_.Month=T,_.Quarter=P,_.Year=R,_.displayName="ProFormComponent";var A=_,U=a(37476),L=a(5966),H=a(59530),J=a(80507),K=a(45360),W=u.forwardRef((function(e,t){var a=(0,H.useDispatch)(),n=K.ZP.useMessage(),r=x()(n,2),s=r[0],i=r[1],l=(0,H.useSelector)((function(e){return e.jiu.activeKey})),o=(0,H.useSelector)((function(e){return e.global.session})),c=(0,H.useSelector)((function(e){return e.global.account})),m=(0,H.useSelector)((function(e){return e.global.contractKit})),p=(0,H.useSelector)((function(e){return e.account.markets})),h=(0,u.useRef)(),j=(0,u.useState)(!1),v=x()(j,2),S=v[0],g=v[1],q=(0,H.useIntl)(),Z=q.formatMessage({id:"common.intlInputException"}),N=q.formatMessage({id:"common.intlPleaseConnectWallet"}),B=q.formatMessage({id:"common.intlPleaseConnectNetwork"}),F=q.formatMessage({id:"common.intlTxSuccess"}),T=q.formatMessage({id:"common.intlTxFail"}),E=q.formatMessage({id:"jiu.intlQuantityMustGreater"},{num:e.params.transferTokenMinAmount,sym:e.params.transferTokenSym}),w=q.formatMessage({id:"jiu.intlFinished"}),P=(0,u.useCallback)((function(){g(!0)}),[]);(0,u.useImperativeHandle)(t,(function(){return{handleOpen:P}}));var I=(0,u.useCallback)((function(t){var a=e.params,n=a.inputPrefix;switch(a.inputType){case 1:return n+t.input.trim().slice(6);case 2:return n+t.input.trim().split("-")[0].slice(2,4)+t.input.trim().split("-")[1]+t.input.trim().split("-")[2]}}),[e.params]),M=(0,u.useCallback)(function(){var t=f()(d()().mark((function t(n){var r,i,l,u,f,h,k,j,v,S,g,C,q,Z,P,M,O,D,z,R,_,A,U,L,H,K,W,Y,G,Q,V,$,X,ee,te,ae,ne,re,se,ie;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.params.finish,i=e.params.liqMid,l=e.params.liqTokenKey,u=e.params.liqSym,f=e.params.liqTokenMinAmount,h=e.params.transferTokenSym,k=e.params.transferTokenMinAmount,j=e.params.transferTokenContract,v=e.params.transferTokenPrecision,S=e.params.receiveAccount,g=e.params.ruleType,C="",0,q="",Z=0,2===g&&(C=e.params.holdTokenContract,e.params.holdTokenMinAmount,q=e.params.holdTokenSym,Z=e.params.allTokenMinAmount),!r){t.next=19;break}return s.info("".concat(w)),t.abrupt("return",!0);case 19:if(t.prev=19,o&&o.broadcast){t.next=25;break}return s.error("".concat(N)),t.abrupt("return",!1);case 25:if(c){t.next=28;break}return s.error("".concat(B)),t.abrupt("return",!1);case 28:if(!(Number(n.quantity)<1)){t.next=31;break}return s.error("".concat(E)),t.abrupt("return",!1);case 31:if(P=[],!p||!p.length){t.next=36;break}P=p,t.next=44;break;case 36:return t.next=38,m.load("swapswapswap");case 38:return M=t.sent,O=M.table("markets"),t.next=42,O.all();case 42:P=t.sent,a(y.N.setMarkets(P));case 44:return t.next=46,m.load("loglogloglog");case 46:return D=t.sent,z=D.table("liqs"),t.next=50,z.all({scope:(0,b.fD)(c.accountName.toString())});case 50:if(R=t.sent,_=0,A=u,(U=R.find((function(e){return e.mid.toNumber()===i})))&&(L=P.find((function(e){return e.mid.equals(U.mid)})),H=U.token.toNumber()/L.liquidity_token.toNumber(),K=H*L.reserve0.value,W=H*L.reserve1.value,Y=L.reserve0.symbol.name,G=L.reserve1.symbol.name,0===l?(_=K,A=Y):(_=W,A=G)),Q=0,V=[],2!==g){t.next=72;break}return t.next=60,o.client.v1.chain.get_currency_balance(C,c.accountName.toString(),q);case 60:if((V=t.sent).length&&(Q=V[0].value),$=_+Q,!(Number(n.quantity)<k)){t.next=67;break}return s.error("转账数量至少".concat(k).concat(h)),t.abrupt("return",!1);case 67:if(!($<Z)){t.next=70;break}return s.error("JIU/DFS做市+".concat(q,"余额至少").concat(Z).concat(q)),t.abrupt("return",!1);case 70:t.next=80;break;case 72:if(X=_,!(Number(n.quantity)<k)){t.next=77;break}return s.error("转账数量至少".concat(k).concat(h)),t.abrupt("return",!1);case 77:if(!(X<f)){t.next=80;break}return s.error("JIU/DFS矿池做市至少".concat(f).concat(A)),t.abrupt("return",!1);case 80:return ee=I(n),te=J.xR.from(Number(n.quantity),J.xR.Symbol.fromParts(h,v)),ae={action:{account:j,name:"transfer",authorization:[o.permissionLevel],data:{from:o.actor,to:S,quantity:te.toString(),memo:ee}}},t.next=85,(0,b.zI)(o.transact(ae));case 85:return ne=t.sent,re=x()(ne,2),se=re[0],ie=re[1],se?s.error(se):ie&&ie.response?s.success("".concat(F)):s.error("".concat(T)),t.abrupt("return",!0);case 93:t.prev=93,t.t0=t.catch(19),console.log(t.t0.message),s.error(t.t0.message);case 97:case"end":return t.stop()}}),t,null,[[19,93]])})));return function(e){return t.apply(this,arguments)}}(),[o,c,m,e.params,p,I]),O=(0,u.useCallback)((function(){var t=e.params,a=t.inputLabel,n=t.inputPlaceholder,r=t.schemes;switch(t.inputType){case 1:return(0,C.jsx)(k.Z,{name:"input",label:(0,C.jsx)("span",{className:" font-semibold",children:a}),placeholder:n,fieldProps:{autoFocus:!1,size:"large"},rules:[{required:!0,whitespace:!0,message:"".concat(Z),pattern:/^.+$/}],valueEnum:r});case 2:return(0,C.jsx)(A,{width:"100%",name:"input",label:(0,C.jsx)("span",{className:" font-semibold",children:a}),placeholder:n,fieldProps:{autoFocus:!1,size:"large",width:"100%"},rules:[{required:!0,message:"".concat(Z)}]})}}),[e.params]);return(0,C.jsxs)(U.Y,{formRef:h,title:"活动"+l,open:S,onFinish:M,onOpenChange:function(e){g(e)},layout:"vertical",width:"400px",style:{overflowWrap:"anywhere"},children:[(0,C.jsx)("div",{children:e.params.inputTip}),O(),(0,C.jsx)(L.Z,{name:"quantity",label:(0,C.jsx)("span",{className:" font-semibold",children:"发送".concat(e.params.transferTokenSym,"数量(至少 ").concat(e.params.transferTokenMinAmount," ").concat(e.params.transferTokenSym,")")}),placeholder:"ex: ".concat(e.params.transferTokenMinAmount),fieldProps:{autoFocus:!1,size:"large"},rules:[{required:!0,whitespace:!0,message:"".concat(Z),pattern:/^\d+(\.\d+)?$/}]}),i]})})),Y=(0,u.memo)(W);l().extend(c());var G=function(e){var t=(0,u.useRef)(),a=e.params.src,i=e.params.title,l=(0,u.useRef)();return(0,C.jsxs)("div",{className:"",children:[(0,C.jsx)(r.Z.Title,{level:4,className:"text-center",children:i}),(0,C.jsx)("div",{className:"text-center mt-8",children:(0,C.jsxs)("a",{className:" font-bold text-lg",onClick:function(){return t.current.setIsDrawerOpen(!0)},children:["活动详情"," ",e.params.finish?(0,C.jsx)("span",{className:" text-red-600",children:"(已结束)"}):(0,C.jsx)("span",{className:" text-green-600",children:"(进行中)"})]})}),(0,C.jsx)("div",{className:"mt-14",children:(0,C.jsx)(s.ZP,{type:"primary",size:"large",block:!0,onClick:function(){return l.current.handleOpen()},children:"立即参与"})}),(0,C.jsx)(Y,{ref:l,params:e.params}),(0,C.jsx)(n.s,{ref:t,src:a,title:i})]})},Q=(0,u.memo)(G),V=a(97857),$=a.n(V),X=a(81876),ee=a(31120),te=a(20701),ae=a(11924),ne=a(79360),re=a(24770),se=a(79642),ie=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a},le=(0,u.forwardRef)((function(e,t){var a=e.chartRef,n=e.style,r=void 0===n?{height:"inherit"}:n,s=e.className,i=e.loading,l=e.loadingTemplate,o=e.errorTemplate,c=ie(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),m=(0,ae.Z)(te.sg,c),d=m.chart,p=m.container;return(0,u.useEffect)((function(){(0,ne.J)(a,d.current)}),[d.current]),(0,u.useImperativeHandle)(t,(function(){return{getChart:function(){return d.current}}})),u.createElement(re.Z,{errorTemplate:o},i&&u.createElement(se.Z,{loadingTemplate:l,theme:e.theme}),u.createElement("div",{className:s,style:r,ref:p}))})),oe=a(38345),ce=a(92340),ue=a(57953),me=a(62120),de=a(9669),pe=a.n(de),fe=a(55835),he=a(53667),xe=a.n(he);l().extend(c());var ye=function(e){var t=K.ZP.useMessage(),a=x()(t,2),n=a[0],r=a[1],i=(0,H.useNavigate)(),o=(0,u.useRef)(!1),c=(0,H.useDispatch)(),m=(0,H.useSelector)((function(e){return e.global.contractKit})),p=(0,H.useSelector)((function(e){return e.global.session})),h=(0,H.useSelector)((function(e){return e.jiu.liqsCache})),k=(0,H.useSelector)((function(e){return e.jiu.assetsCache})),j=(0,H.useSelector)((function(e){return e.account.markets})),v=(0,H.useSelector)((function(e){return e.jiu.activeKey})),S=(0,u.useState)([]),g=x()(S,2),q=g[0],Z=g[1],N=(0,u.useState)([]),B=x()(N,2),F=B[0],T=B[1],E=(0,u.useState)([]),w=x()(E,2),P=w[0],I=w[1],M=(0,u.useState)([]),O=x()(M,2),D=O[0],z=O[1],R=(0,u.useState)([]),_=x()(R,2),A=_[0],U=_[1],L=(0,u.useState)(!1),J=x()(L,2),W=J[0],Y=J[1],G=(0,u.useState)([]),Q=x()(G,2),V=Q[0],te=Q[1],ae=(0,u.useState)(""),ne=x()(ae,2),re=ne[0],se=ne[1],ie=(0,H.useIntl)().formatMessage({id:"jiu.intlMissingData"}),de=(0,u.useCallback)(function(){var e=f()(d()().mark((function e(t){var a,r,s,i,o,c,u,m,p,f,h,y,k,j,v,S,g,C,q,Z,N,B,F,T,E,w,P,I,M;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="jiutothemoon",r="000d9cae502dd1cc895745e204f83cc892bc4c450f92a03ecd4fe057709853cc",s=(0,fe.js)("md5"),i=r+a,s.update(i),o=s.digest("hex").substring(0,8),c={key:o,chainId:r,account:a,skip:0,lastUpdate:"2020-01-01T01:01:01.000Z",error:!1,data:[]},e.next=9,ee.db.txList.where({key:o}).toArray();case 9:if((u=e.sent).length&&(c=u[0]),!(t&&l().utc(c.lastUpdate).valueOf()>l().utc(t).valueOf())){e.next=13;break}return e.abrupt("return",c.data);case 13:m=[],p=500,f=c.lastUpdate,h=c.skip;case 17:return e.next=20,(0,b.zI)(pe().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&sort=asc&simple=true&noBinary=true&account=".concat(a,"&after=").concat(f,"&limit=").concat(p)));case 20:if(y=e.sent,k=x()(y,2),j=k[0],v=k[1],j||200!==v.status){e.next=73;break}if(S=v.data.simple_actions,g=S.length,C=v.data.total.value,q=1,0!==C){e.next=32;break}return ee.db.txList.put(c),e.abrupt("return",c.data);case 32:for(Z=0;Z<S.length;Z++)h<=Z&&m.push(S[Z]);if(m.length){e.next=36;break}return c.error&&n.error(ie),e.abrupt("return",c.data);case 36:N=m.length-1;case 37:if(!(N>0)){e.next=46;break}if(m[N].transaction_id!==m[N-1].transaction_id){e.next=42;break}q+=1,e.next=43;break;case 42:return e.abrupt("break",46);case 43:N--,e.next=37;break;case 46:if(h=q,g!==p){e.next=58;break}if(B=m[m.length-1].timestamp,f=B,!(t&&l().utc(B).valueOf()>l().utc(t).valueOf())){e.next=56;break}return m.forEach((function(e){c.data.push(e)})),c.lastUpdate=B,c.skip=h,ee.db.txList.put(c),e.abrupt("return",c.data);case 56:e.next=71;break;case 58:return m.forEach((function(e){c.data.push(e)})),F=m[m.length-1].timestamp,c.lastUpdate=F,c.skip=h,e.next=64,(0,b.zI)(pe().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&simple=true&noBinary=true&account=".concat(a,"&skip=0&limit=1")));case 64:return T=e.sent,E=x()(T,2),w=E[0],P=E[1],w||200!==P.status?n.error(w):(I=P.data.total.value,c.data.length!==I?(c.error=!0,n.error(ie)):c.error=!1),ee.db.txList.put(c),e.abrupt("return",c.data);case 71:e.next=77;break;case 73:return m.length&&(m.forEach((function(e){c.data.push(e)})),M=m[m.length-1].timestamp,c.lastUpdate=M,c.skip=h,c.error=!0),ee.db.txList.put(c),n.error(j),e.abrupt("return",c.data);case 77:e.next=17;break;case 79:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n]),he=(0,u.useCallback)(function(){var t=f()(d()().mark((function t(a,r){var s,i,o,u,m,p,f,x,v,S,g,C,q,N,B,F,E,w,P,M,O,D,R,_,A,L,H,J,K,W,G,Q,V,ee,ae,ne,re,ie,le,oe,ce,ue,me,pe;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s=e.params.startTime,i=e.params.endTime,o=e.params.receiveAccount,u=e.params.transferTokenContract,m=e.params.transferTokenMinAmount,p=e.params.transferTokenSym,f=e.params.liqMid,x=e.params.liqTokenKey,v=e.params.liqSym,S=e.params.liqTokenMinAmount,g=e.params.ruleType,C="",0,q="",N=0,2===g&&(C=e.params.holdTokenContract,e.params.holdTokenMinAmount,q=e.params.holdTokenSym,N=e.params.allTokenMinAmount),B=e.params.schemesRegexp,F=[],E={},w=[],P=[],M=[],O=[],D=[],R=[],_=[],t.next=29,de(i);case 29:A=t.sent,L=0;case 31:if(!(L<A.length)){t.next=41;break}if(H=l().utc(s).valueOf(),J=l().utc(i).valueOf(),K=l().utc(A[L].timestamp).valueOf(),H<=K&&K<=J&&A[L].contract===u&&"transfer"===A[L].action&&A[L].data.symbol===p&&A[L].data.to===o&&"dfsminingout"!==A[L].data.from&&"swapswapswap"!==A[L].data.from&&""!==A[L].data.memo.trim()&&F.push(A[L]),!(K>J)){t.next=38;break}return t.abrupt("break",41);case 38:L++,t.next=31;break;case 41:if(F.forEach((function(e){var t=e.data.from,a=e.data.memo.trim(),n=e.data.amount;E.hasOwnProperty(t)?n>=m&&B[0].test(a)&&(E[t]=e):B[0].test(a)&&(E[t]=e)})),W=[],!j||!j.length){t.next=47;break}W=j,t.next=55;break;case 47:return t.next=49,r.load("swapswapswap");case 49:return G=t.sent,Q=G.table("markets"),t.next=53,Q.all();case 53:W=t.sent,c(y.N.setMarkets(W));case 55:return t.next=57,r.load("loglogloglog");case 57:V=t.sent,ee=V.table("liqs"),ae=Object.keys(E),ne={},re={},ie=d()().mark((function e(){var t,n,r,s,i,l,o,c,u,m,p,y;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(se("".concat(le+1," / ").concat(ae.length)),t=0,n=v,r=[],!h.hasOwnProperty(ae[le])){e.next=8;break}r=h[ae[le]],e.next=12;break;case 8:return e.next=10,ee.all({scope:(0,b.fD)(ae[le])});case 10:r=e.sent,ne[ae[le]]=r;case 12:if((s=r.find((function(e){return e.mid.toNumber()===f})))&&(i=W.find((function(e){return e.mid.equals(s.mid)})),l=s.token.toNumber()/i.liquidity_token.toNumber(),o=l*i.reserve0.value,c=l*i.reserve1.value,u=i.reserve0.symbol.name,m=i.reserve1.symbol.name,0===x?(t=o,n=u):(t=c,n=m)),E[ae[le]].liqBalance=t,E[ae[le]].liqSym=n,p=0,y=[],2!==g){e.next=29;break}if(!k.hasOwnProperty(ae[le])){e.next=23;break}y=k[ae[le]],e.next=27;break;case 23:return e.next=25,a.client.v1.chain.get_currency_balance(C,ae[le],q);case 25:y=e.sent,re[ae[le]]=y;case 27:y.length&&(p=y[0].value),E[ae[le]].holdBalance=p;case 29:case"end":return e.stop()}}),e)})),le=0;case 64:if(!(le<ae.length)){t.next=69;break}return t.delegateYield(ie(),"t0",66);case 66:le++,t.next=64;break;case 69:for(Object.keys(ne).length&&c(X.N.setLiqsCache($()($()({},h),ne))),Object.keys(re).length&&c(X.N.setAssetsCache($()($()({},k),re))),1===g?ae.forEach((function(e){var t=E[e].liqBalance;E[e].data.amount>=m&&t>=S?w.push(E[e]):P.push(E[e])})):2===g&&ae.forEach((function(e){var t=E[e].liqBalance+E[e].holdBalance;E[e].data.amount>=m&&t>=N?w.push(E[e]):P.push(E[e])})),oe={},ce=[],ue=1;ue<B.length;ue++)oe["scheme".concat(ue)]={vote:0,name:"方案".concat(ue)},ce.push("方案".concat(ue));w.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,i=l().utc(e.timestamp).local().format(),o=e.data.quantity,c=e.transaction_id,u=1;u<B.length;u++)if(B[u].test(a)){oe["scheme".concat(u)].vote+=1,O.push({key:t,account:n,liqBalance:r,liqSym:s,time:i,quantity:o,scheme:oe["scheme".concat(u)].name,memo:a,txid:c,valid:!0});break}})),Object.keys(oe).forEach((function(e,t){M.push({key:t,scheme:oe[e].name,vote:oe[e].vote,ratio:oe[e].vote/w.length})})),Z(M),T(O.sort((function(e,t){return e.time.localeCompare(t.time)}))),te(ce),P.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,i=l().utc(e.timestamp).local().format(),o=e.data.quantity,c=e.transaction_id,u=1;u<B.length;u++)if(B[u].test(a)){oe["scheme".concat(u)].vote+=1,D.push({key:t,account:n,liqBalance:r,liqSym:s,time:i,quantity:o,scheme:oe["scheme".concat(u)].name,memo:a,txid:c,valid:!1});break}})),I(D.sort((function(e,t){return e.time.localeCompare(t.time)}))),me=0,M.forEach((function(e){e.vote>me&&(me=e.vote,pe=e)})),O.forEach((function(e){e.scheme===pe.scheme?R.push(e):_.push(e)})),z(R.sort((function(e,t){return e.time.localeCompare(t.time)}))),U(_.sort((function(e,t){return e.time.localeCompare(t.time)}))),Y(!1),t.next=94;break;case 90:t.prev=90,t.t1=t.catch(0),Y(!1),(0,b.Tv)(t.t1,n,"handleGetData");case 94:case"end":return t.stop()}}),t,null,[[0,90]])})));return function(e,a){return t.apply(this,arguments)}}(),[de,n,k,h,j,e.params]),ye={data:q,xField:"scheme",yField:"vote",meta:{vote:{alias:"票数"}},label:{},color:function(){return"#5B8FF9"},minColumnWidth:30,maxColumnWidth:30},be=(0,u.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,a){return(0,C.jsx)("span",{children:a+1})}},{title:"账号",dataIndex:"account",key:"account",sorter:function(e,t){return e.account.localeCompare(t.account)},render:function(e,t){return(0,C.jsx)("a",{onClick:function(){return i("/query/account?search=".concat(t.account,"&tab=info"))},children:t.account})}},{title:"JIU/DFS矿池做市",dataIndex:"liqBalance",key:"liqBalance",sorter:function(e,t){return t.liqBalance-e.liqBalance},render:function(e,t){var a=t.valid;return(0,C.jsx)("span",{children:(0,b.CE)(t.liqBalance.toFixed(a?0:4))+" "+t.liqSym})}},{title:"转账数量",dataIndex:"quantity",key:"quantity",sorter:function(e,t){return Number(t.quantity.split(" ")[0])-Number(e.quantity.split(" ")[0])},render:function(e,t){var a=t.valid,n=Number(t.quantity.split(" ")[0]),r=t.quantity.split(" ")[1];return(0,C.jsx)("span",{children:(0,b.CE)(n.toFixed(a?0:4))+" "+r})}},{title:"转账时间",dataIndex:"time",key:"time",sorter:function(e,t){return t.time.localeCompare(e.time)},render:function(e,t){return(0,C.jsx)("span",{children:t.time})}},{title:"投票方案",dataIndex:"scheme",key:"scheme",sorter:function(e,t){return e.scheme.localeCompare(t.scheme)},filters:V.map((function(e){return{text:e,value:e}})),onFilter:function(e,t){return e===t.scheme},render:function(e,t){return(0,C.jsx)("span",{children:t.scheme})}},{title:"原始数据",dataIndex:"memo",key:"memo",render:function(e,t){return(0,C.jsx)("span",{children:t.memo})}},{title:"交易id",dataIndex:"txid",key:"txid",render:function(e,t){return(0,C.jsx)("a",{onClick:function(){return i("/query/transaction?search=".concat(t.txid,"&tab=summary"))},children:t.txid.slice(0,8)})}}]}),[V]),ke=(0,u.useMemo)((function(){return[{title:"方案",dataIndex:"scheme",key:"scheme",width:"auto",render:function(e,t){return(0,C.jsx)("span",{children:t.scheme})}},{title:"票数",dataIndex:"vote",key:"vote",width:"auto",render:function(e,t){return(0,C.jsx)("span",{children:t.vote})}},{title:"得票率",dataIndex:"ratio",width:"auto",key:"ratio",render:function(e,t){return(0,C.jsxs)("span",{children:[(100*t.ratio).toFixed(2),"%"]})}}]}),[]),je=(0,u.useCallback)((function(){var t=function(t){var a=0,n=0,r=t.map((function(e,t){var r=e.valid,s=Number(e.quantity.split(" ")[0]),i=e.quantity.split(" ")[1];return a+=e.liqBalance,n+=s,{"#":t+1,"账号":e.account,"JIU/DFS矿池做市":(0,b.CE)(e.liqBalance.toFixed(r?0:4))+" "+e.liqSym,"转账数量":(0,b.CE)(s.toFixed(r?0:4))+" "+i,"转账时间":e.time,"投票方案":e.scheme,"原始数据":e.memo,"交易id":e.txid}}));return r.push({"#":0,"账号":"汇总","JIU/DFS矿池做市":(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym,"转账数量":(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym,"转账时间":"","投票方案":"","原始数据":"","交易id":""}),r},a=function(e){return e.map((function(e){return e.title}))},n=0,r=q.map((function(e){return n+=e.vote,{"方案":e.scheme,"票数":e.vote,"得票率":(100*e.ratio).toFixed(2)+"%"}}));r.push({"方案":"汇总","票数":n,"得票率":"100%"});var s={};s.fileName="活动".concat(v,"数据汇总"),s.datas=[{sheetData:r,sheetName:"投票结果",sheetFilter:["方案","票数","得票率"],sheetHeader:["方案","票数","得票率"]},{sheetData:t(F),sheetName:"有效投票详情",sheetFilter:a(be),sheetHeader:a(be)},{sheetData:t(P),sheetName:"无效投票详情",sheetFilter:a(be),sheetHeader:a(be)},{sheetData:t(D),sheetName:"获奖用户",sheetFilter:a(be),sheetHeader:a(be)},{sheetData:t(A),sheetName:"非获奖用户",sheetFilter:a(be),sheetHeader:a(be)}],new(xe())(s).saveExcel()}),[e.params,v,be,F,P,D,A,q]);return(0,u.useEffect)((function(){p&&m&&!o.current&&(o.current=!0,Y(!0),he(p,m))}),[he,m,p]),(0,C.jsxs)("div",{className:"result1",children:[(0,C.jsx)(s.ZP,{type:"primary",className:"mt-3 ml-3",onClick:je,children:"导出数据"}),(0,C.jsxs)(oe.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"投票结果"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:[(0,C.jsx)(ue.Z,{size:"large",spinning:W,tip:re,children:(0,C.jsx)(le,$()($()({},ye),{},{loading:W}))}),(0,C.jsx)(ce.Z,{className:"mt-4 summary",scroll:{x:!0},size:"small",columns:ke,dataSource:q,defaultData:[],loading:{spinning:W,tip:re,size:"large"},search:!1,options:!1,pagination:!1,summary:function(e){var t=0;return e.forEach((function(e){t+=e.vote})),(0,C.jsxs)(me.Z.Summary.Row,{children:[(0,C.jsx)(me.Z.Summary.Cell,{index:0,children:(0,C.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,C.jsx)(me.Z.Summary.Cell,{index:1,children:(0,C.jsx)("span",{className:"font-bold",children:t})}),(0,C.jsx)(me.Z.Summary.Cell,{index:2,children:(0,C.jsx)("span",{className:"font-bold",children:"100%"})})]})}})]}),(0,C.jsx)(oe.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"有效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"0"},children:(0,C.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:F,defaultData:[],loading:{spinning:W,tip:re,size:"large"},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0])})),(0,C.jsxs)(me.Z.Summary.Row,{children:[(0,C.jsx)(me.Z.Summary.Cell,{index:0}),(0,C.jsx)(me.Z.Summary.Cell,{index:1,children:(0,C.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,C.jsx)(me.Z.Summary.Cell,{index:2,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:3,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:4}),(0,C.jsx)(me.Z.Summary.Cell,{index:5}),(0,C.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),(0,C.jsx)(oe.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"无效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:P,defaultData:[],loading:{spinning:W,tip:re,size:"large"},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0])})),(0,C.jsxs)(me.Z.Summary.Row,{children:[(0,C.jsx)(me.Z.Summary.Cell,{index:0}),(0,C.jsx)(me.Z.Summary.Cell,{index:1,children:(0,C.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,C.jsx)(me.Z.Summary.Cell,{index:2,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:3,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:4}),(0,C.jsx)(me.Z.Summary.Cell,{index:5}),(0,C.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),(0,C.jsx)(oe.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"获奖用户"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:D,defaultData:[],loading:{spinning:W,tip:re,size:"large"},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0])})),(0,C.jsxs)(me.Z.Summary.Row,{children:[(0,C.jsx)(me.Z.Summary.Cell,{index:0}),(0,C.jsx)(me.Z.Summary.Cell,{index:1,children:(0,C.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,C.jsx)(me.Z.Summary.Cell,{index:2,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:3,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:4}),(0,C.jsx)(me.Z.Summary.Cell,{index:5}),(0,C.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),(0,C.jsx)(oe.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"非获奖用户"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:A,defaultData:[],loading:{spinning:W,tip:re,size:"large"},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0])})),(0,C.jsxs)(me.Z.Summary.Row,{children:[(0,C.jsx)(me.Z.Summary.Cell,{index:0}),(0,C.jsx)(me.Z.Summary.Cell,{index:1,children:(0,C.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,C.jsx)(me.Z.Summary.Cell,{index:2,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:3,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:4}),(0,C.jsx)(me.Z.Summary.Cell,{index:5}),(0,C.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),r]})},be=(0,u.memo)(ye);l().extend(c());var ke=function(e){var t=K.ZP.useMessage(),a=x()(t,2),n=a[0],r=a[1],i=(0,H.useNavigate)(),o=(0,u.useRef)(!1),c=(0,H.useDispatch)(),m=(0,H.useSelector)((function(e){return e.global.contractKit})),p=(0,H.useSelector)((function(e){return e.global.session})),h=(0,H.useSelector)((function(e){return e.jiu.liqsCache})),k=(0,H.useSelector)((function(e){return e.jiu.assetsCache})),j=(0,H.useSelector)((function(e){return e.jiu.activeKey})),v=(0,H.useSelector)((function(e){return e.account.markets})),S=(0,u.useState)([]),g=x()(S,2),q=g[0],Z=g[1],N=(0,u.useState)([]),B=x()(N,2),F=B[0],T=B[1],E=(0,u.useState)([]),w=x()(E,2),P=w[0],I=w[1],M=(0,u.useState)([]),O=x()(M,2),D=O[0],z=O[1],R=(0,u.useState)([]),_=x()(R,2),A=_[0],U=_[1],L=(0,u.useState)(!1),J=x()(L,2),W=J[0],Y=J[1],G=(0,u.useState)([]),Q=x()(G,2),V=Q[0],te=Q[1],ae=(0,u.useState)(""),ne=x()(ae,2),re=ne[0],se=ne[1],ie=(0,H.useIntl)().formatMessage({id:"jiu.intlMissingData"}),de=(0,u.useCallback)(function(){var e=f()(d()().mark((function e(t){var a,r,s,i,o,c,u,m,p,f,h,y,k,j,v,S,g,C,q,Z,N,B,F,T,E,w,P,I,M;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="jiutothemoon",r="000d9cae502dd1cc895745e204f83cc892bc4c450f92a03ecd4fe057709853cc",s=(0,fe.js)("md5"),i=r+a,s.update(i),o=s.digest("hex").substring(0,8),c={key:o,chainId:r,account:a,skip:0,lastUpdate:"2020-01-01T01:01:01.000Z",error:!1,data:[]},e.next=9,ee.db.txList.where({key:o}).toArray();case 9:if((u=e.sent).length&&(c=u[0]),!(t&&l().utc(c.lastUpdate).valueOf()>l().utc(t).valueOf())){e.next=13;break}return e.abrupt("return",c.data);case 13:m=[],p=500,f=c.lastUpdate,h=c.skip;case 17:return e.next=20,(0,b.zI)(pe().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&sort=asc&simple=true&noBinary=true&account=".concat(a,"&after=").concat(f,"&limit=").concat(p)));case 20:if(y=e.sent,k=x()(y,2),j=k[0],v=k[1],j||200!==v.status){e.next=73;break}if(S=v.data.simple_actions,g=S.length,C=v.data.total.value,q=1,0!==C){e.next=32;break}return ee.db.txList.put(c),e.abrupt("return",c.data);case 32:for(Z=0;Z<S.length;Z++)h<=Z&&m.push(S[Z]);if(m.length){e.next=36;break}return c.error&&n.error(ie),e.abrupt("return",c.data);case 36:N=m.length-1;case 37:if(!(N>0)){e.next=46;break}if(m[N].transaction_id!==m[N-1].transaction_id){e.next=42;break}q+=1,e.next=43;break;case 42:return e.abrupt("break",46);case 43:N--,e.next=37;break;case 46:if(h=q,g!==p){e.next=58;break}if(B=m[m.length-1].timestamp,f=B,!(t&&l().utc(B).valueOf()>l().utc(t).valueOf())){e.next=56;break}return m.forEach((function(e){c.data.push(e)})),c.lastUpdate=B,c.skip=h,ee.db.txList.put(c),e.abrupt("return",c.data);case 56:e.next=71;break;case 58:return m.forEach((function(e){c.data.push(e)})),F=m[m.length-1].timestamp,c.lastUpdate=F,c.skip=h,e.next=64,(0,b.zI)(pe().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&simple=true&noBinary=true&account=".concat(a,"&skip=0&limit=1")));case 64:return T=e.sent,E=x()(T,2),w=E[0],P=E[1],w||200!==P.status?n.error(w):(I=P.data.total.value,c.data.length!==I?(c.error=!0,n.error(ie)):c.error=!1),ee.db.txList.put(c),e.abrupt("return",c.data);case 71:e.next=77;break;case 73:return m.length&&(m.forEach((function(e){c.data.push(e)})),M=m[m.length-1].timestamp,c.lastUpdate=M,c.skip=h,c.error=!0),ee.db.txList.put(c),n.error(j),e.abrupt("return",c.data);case 77:e.next=17;break;case 79:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n]),he=(0,u.useCallback)(function(){var t=f()(d()().mark((function t(a,r){var s,i,o,u,m,p,f,x,j,S,g,C,q,N,B,F,E,w,P,M,O,D,R,_,A,L,H,J,K,W,G,Q,V,ee,ae,ne,re,ie,le,oe,ce,ue,me,pe;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s=e.params.startTime,i=e.params.endTime,o=e.params.receiveAccount,u=e.params.transferTokenContract,m=e.params.transferTokenMinAmount,p=e.params.transferTokenSym,f=e.params.liqMid,x=e.params.liqTokenKey,j=e.params.liqSym,S=e.params.liqTokenMinAmount,g=e.params.ruleType,C="",0,q="",N=0,2===g&&(C=e.params.holdTokenContract,e.params.holdTokenMinAmount,q=e.params.holdTokenSym,N=e.params.allTokenMinAmount),B=e.params.schemesRegexp,F=[],E={},w=[],P=[],M=[],O=[],D=[],R=[],_=[],t.next=29,de(i);case 29:A=t.sent,L=0;case 31:if(!(L<A.length)){t.next=41;break}if(H=l().utc(s).valueOf(),J=l().utc(i).valueOf(),K=l().utc(A[L].timestamp).valueOf(),H<=K&&K<=J&&A[L].contract===u&&"transfer"===A[L].action&&A[L].data.symbol===p&&A[L].data.to===o&&"dfsminingout"!==A[L].data.from&&"swapswapswap"!==A[L].data.from&&""!==A[L].data.memo.trim()&&F.push(A[L]),!(K>J)){t.next=38;break}return t.abrupt("break",41);case 38:L++,t.next=31;break;case 41:if(F.forEach((function(e){var t=e.data.from,a=e.data.memo.trim(),n=e.data.amount;E.hasOwnProperty(t)?n>=m&&B[0].test(a)&&(E[t]=e):B[0].test(a)&&(E[t]=e)})),W=[],!v||!v.length){t.next=47;break}W=v,t.next=55;break;case 47:return t.next=49,r.load("swapswapswap");case 49:return G=t.sent,Q=G.table("markets"),t.next=53,Q.all();case 53:W=t.sent,c(y.N.setMarkets(W));case 55:return t.next=57,r.load("loglogloglog");case 57:V=t.sent,ee=V.table("liqs"),ae=Object.keys(E),ne={},re={},ie=d()().mark((function e(){var t,n,r,s,i,l,o,c,u,m,p,y;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(se("".concat(le+1," / ").concat(ae.length)),t=0,n=j,r=[],!h.hasOwnProperty(ae[le])){e.next=8;break}r=h[ae[le]],e.next=12;break;case 8:return e.next=10,ee.all({scope:(0,b.fD)(ae[le])});case 10:r=e.sent,ne[ae[le]]=r;case 12:if((s=r.find((function(e){return e.mid.toNumber()===f})))&&(i=W.find((function(e){return e.mid.equals(s.mid)})),l=s.token.toNumber()/i.liquidity_token.toNumber(),o=l*i.reserve0.value,c=l*i.reserve1.value,u=i.reserve0.symbol.name,m=i.reserve1.symbol.name,0===x?(t=o,n=u):(t=c,n=m)),E[ae[le]].liqBalance=t,E[ae[le]].liqSym=n,p=0,y=[],2!==g){e.next=29;break}if(!k.hasOwnProperty(ae[le])){e.next=23;break}y=k[ae[le]],e.next=27;break;case 23:return e.next=25,a.client.v1.chain.get_currency_balance(C,ae[le],q);case 25:y=e.sent,re[ae[le]]=y;case 27:y.length&&(p=y[0].value),E[ae[le]].holdBalance=p;case 29:case"end":return e.stop()}}),e)})),le=0;case 64:if(!(le<ae.length)){t.next=69;break}return t.delegateYield(ie(),"t0",66);case 66:le++,t.next=64;break;case 69:for(Object.keys(ne).length&&c(X.N.setLiqsCache($()($()({},h),ne))),Object.keys(re).length&&c(X.N.setAssetsCache($()($()({},k),re))),1===g?ae.forEach((function(e){var t=E[e].liqBalance;E[e].data.amount>=m&&t>=S?w.push(E[e]):P.push(E[e])})):2===g&&ae.forEach((function(e){var t=E[e].liqBalance+E[e].holdBalance;E[e].data.amount>=m&&t>=N?w.push(E[e]):P.push(E[e])})),oe={},ce=[],ue=1;ue<B.length;ue++)oe["scheme".concat(ue)]={vote:0,name:"方案".concat(ue)},ce.push("方案".concat(ue));w.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,i=l().utc(e.timestamp).local().format(),o=e.data.quantity,c=e.transaction_id,u=e.holdBalance,m=r+u,d=1;d<B.length;d++)if(B[d].test(a)){oe["scheme".concat(d)].vote+=1,O.push({key:t,account:n,liqBalance:r,liqSym:s,time:i,quantity:o,scheme:oe["scheme".concat(d)].name,memo:a,txid:c,holdBalance:u,holdTokenSym:q,allBalance:m,valid:!0});break}})),Object.keys(oe).forEach((function(e,t){M.push({key:t,scheme:oe[e].name,vote:oe[e].vote,ratio:oe[e].vote/w.length})})),Z(M),T(O.sort((function(e,t){return e.time.localeCompare(t.time)}))),te(ce),P.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,i=l().utc(e.timestamp).local().format(),o=e.data.quantity,c=e.transaction_id,u=e.holdBalance,m=r+u,d=1;d<B.length;d++)if(B[d].test(a)){oe["scheme".concat(d)].vote+=1,D.push({key:t,account:n,liqBalance:r,liqSym:s,time:i,quantity:o,scheme:oe["scheme".concat(d)].name,memo:a,txid:c,holdBalance:u,holdTokenSym:q,allBalance:m,valid:!1});break}})),I(D.sort((function(e,t){return e.time.localeCompare(t.time)}))),me=0,M.forEach((function(e){e.vote>me&&(me=e.vote,pe=e)})),O.forEach((function(e){e.scheme===pe.scheme?R.push(e):_.push(e)})),z(R.sort((function(e,t){return e.time.localeCompare(t.time)}))),U(_.sort((function(e,t){return e.time.localeCompare(t.time)}))),Y(!1),t.next=94;break;case 90:t.prev=90,t.t1=t.catch(0),Y(!1),(0,b.Tv)(t.t1,n,"handleGetData");case 94:case"end":return t.stop()}}),t,null,[[0,90]])})));return function(e,a){return t.apply(this,arguments)}}(),[de,n,k,h,v,e.params]),ye={data:q,xField:"scheme",yField:"vote",meta:{vote:{alias:"票数"}},label:{},color:function(){return"#5B8FF9"},minColumnWidth:30,maxColumnWidth:30},be=(0,u.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,a){return(0,C.jsx)("span",{children:a+1})}},{title:"账号",dataIndex:"account",key:"account",sorter:function(e,t){return e.account.localeCompare(t.account)},render:function(e,t){return(0,C.jsx)("a",{onClick:function(){return i("/query/account?search=".concat(t.account,"&tab=info"))},children:t.account})}},{title:"JIU/DFS矿池做市",dataIndex:"liqBalance",key:"liqBalance",sorter:function(e,t){return t.liqBalance-e.liqBalance},render:function(e,t){var a=t.valid;return(0,C.jsx)("span",{children:(0,b.CE)(t.liqBalance.toFixed(a?0:4))+" "+t.liqSym})}},{title:"".concat(e.params.holdTokenSym,"账号余额"),dataIndex:"holdBalance",key:"holdBalance",sorter:function(e,t){return t.holdBalance-e.holdBalance},render:function(e,t){var a=t.valid;return(0,C.jsx)("span",{children:(0,b.CE)(t.holdBalance.toFixed(a?0:4))+" "+t.holdTokenSym})}},{title:"做市+持有",dataIndex:"allBalance",key:"allBalance",sorter:function(e,t){return t.allBalance-e.allBalance},render:function(e,t){var a=t.valid;return(0,C.jsx)("span",{children:(0,b.CE)(t.allBalance.toFixed(a?0:4))+" "+t.holdTokenSym})}},{title:"转账数量",dataIndex:"quantity",key:"quantity",sorter:function(e,t){return Number(t.quantity.split(" ")[0])-Number(e.quantity.split(" ")[0])},render:function(e,t){var a=t.valid,n=Number(t.quantity.split(" ")[0]),r=t.quantity.split(" ")[1];return(0,C.jsx)("span",{children:(0,b.CE)(n.toFixed(a?0:4))+" "+r})}},{title:"转账时间",dataIndex:"time",key:"time",sorter:function(e,t){return t.time.localeCompare(e.time)},render:function(e,t){return(0,C.jsx)("span",{children:t.time})}},{title:"投票方案",dataIndex:"scheme",key:"scheme",sorter:function(e,t){return e.scheme.localeCompare(t.scheme)},filters:V.map((function(e){return{text:e,value:e}})),onFilter:function(e,t){return e===t.scheme},render:function(e,t){return(0,C.jsx)("span",{children:t.scheme})}},{title:"原始数据",dataIndex:"memo",key:"memo",render:function(e,t){return(0,C.jsx)("span",{children:t.memo})}},{title:"交易id",dataIndex:"txid",key:"txid",render:function(e,t){return(0,C.jsx)("a",{onClick:function(){return i("/query/transaction?search=".concat(t.txid,"&tab=summary"))},children:t.txid.slice(0,8)})}}]}),[V,e.params]),ke=(0,u.useMemo)((function(){return[{title:"方案",dataIndex:"scheme",key:"scheme",width:"auto",render:function(e,t){return(0,C.jsx)("span",{children:t.scheme})}},{title:"票数",dataIndex:"vote",key:"vote",width:"auto",render:function(e,t){return(0,C.jsx)("span",{children:t.vote})}},{title:"得票率",dataIndex:"ratio",width:"auto",key:"ratio",render:function(e,t){return(0,C.jsxs)("span",{children:[(100*t.ratio).toFixed(2),"%"]})}}]}),[]),je=(0,u.useCallback)((function(){var t=function(t){var a=0,n=0,r=0,s=0,i=t.map((function(e,t){var s=e.valid,i=Number(e.quantity.split(" ")[0]),l=e.quantity.split(" ")[1];return a+=e.liqBalance,n+=i,r+=e.holdBalance,{"#":t+1,"账号":e.account,"JIU/DFS矿池做市":(0,b.CE)(e.liqBalance.toFixed(s?0:4))+" "+e.liqSym,"JIU账号余额":(0,b.CE)(e.holdBalance.toFixed(s?0:4))+" "+e.holdTokenSym,"做市+持有":(0,b.CE)(e.allBalance.toFixed(s?0:4))+" "+e.holdTokenSym,"转账数量":(0,b.CE)(i.toFixed(s?0:4))+" "+l,"转账时间":e.time,"投票方案":e.scheme,"原始数据":e.memo,"交易id":e.txid}}));return s=a+r,i.push({"#":0,"账号":"汇总","JIU/DFS矿池做市":(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym,"JIU账号余额":(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym,"做市+持有":(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym,"转账数量":(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym,"转账时间":"","投票方案":"","原始数据":"","交易id":""}),i},a=function(e){return e.map((function(e){return e.title}))},n=0,r=q.map((function(e){return n+=e.vote,{"方案":e.scheme,"票数":e.vote,"得票率":(100*e.ratio).toFixed(2)+"%"}}));r.push({"方案":"汇总","票数":n,"得票率":"100%"});var s={};s.fileName="活动".concat(j,"数据汇总"),s.datas=[{sheetData:r,sheetName:"投票结果",sheetFilter:["方案","票数","得票率"],sheetHeader:["方案","票数","得票率"]},{sheetData:t(F),sheetName:"有效投票详情",sheetFilter:a(be),sheetHeader:a(be)},{sheetData:t(P),sheetName:"无效投票详情",sheetFilter:a(be),sheetHeader:a(be)},{sheetData:t(D),sheetName:"获奖用户",sheetFilter:a(be),sheetHeader:a(be)},{sheetData:t(A),sheetName:"非获奖用户",sheetFilter:a(be),sheetHeader:a(be)}],new(xe())(s).saveExcel()}),[e.params,j,be,F,P,D,A,q]);return(0,u.useEffect)((function(){p&&m&&!o.current&&(o.current=!0,Y(!0),he(p,m))}),[he,m,p]),(0,C.jsxs)("div",{className:"result2",children:[(0,C.jsx)(s.ZP,{type:"primary",className:"mt-3 ml-3",onClick:je,children:"导出数据"}),(0,C.jsxs)(oe.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"投票结果"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:[(0,C.jsx)(ue.Z,{size:"large",spinning:W,tip:re,children:(0,C.jsx)(le,$()($()({},ye),{},{loading:W}))}),(0,C.jsx)(ce.Z,{className:"mt-4 summary",scroll:{x:!0},size:"small",columns:ke,dataSource:q,defaultData:[],loading:{spinning:W,tip:re,size:"large"},search:!1,options:!1,pagination:!1,summary:function(e){var t=0;return e.forEach((function(e){t+=e.vote})),(0,C.jsxs)(me.Z.Summary.Row,{children:[(0,C.jsx)(me.Z.Summary.Cell,{index:0,children:(0,C.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,C.jsx)(me.Z.Summary.Cell,{index:1,children:(0,C.jsx)("span",{className:"font-bold",children:t})}),(0,C.jsx)(me.Z.Summary.Cell,{index:2,children:(0,C.jsx)("span",{className:"font-bold",children:"100%"})})]})}})]}),(0,C.jsx)(oe.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"有效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:F,defaultData:[],loading:{spinning:W,tip:re,size:"large"},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0,r=0,s=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0]),r+=e.holdBalance,s+=e.allBalance})),(0,C.jsxs)(me.Z.Summary.Row,{children:[(0,C.jsx)(me.Z.Summary.Cell,{index:0}),(0,C.jsx)(me.Z.Summary.Cell,{index:1,children:(0,C.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,C.jsx)(me.Z.Summary.Cell,{index:2,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:3,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:4,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:5,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),(0,C.jsx)(oe.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"无效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:P,defaultData:[],loading:{spinning:W,tip:re,size:"large"},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0,r=0,s=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0]),r+=e.holdBalance,s+=e.allBalance})),(0,C.jsxs)(me.Z.Summary.Row,{children:[(0,C.jsx)(me.Z.Summary.Cell,{index:0}),(0,C.jsx)(me.Z.Summary.Cell,{index:1,children:(0,C.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,C.jsx)(me.Z.Summary.Cell,{index:2,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:3,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:4,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:5,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),(0,C.jsx)(oe.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"获奖用户"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:D,defaultData:[],loading:{spinning:W,tip:re,size:"large"},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0,r=0,s=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0]),r+=e.holdBalance,s+=e.allBalance})),(0,C.jsxs)(me.Z.Summary.Row,{children:[(0,C.jsx)(me.Z.Summary.Cell,{index:0}),(0,C.jsx)(me.Z.Summary.Cell,{index:1,children:(0,C.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,C.jsx)(me.Z.Summary.Cell,{index:2,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:3,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:4,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:5,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),(0,C.jsx)(oe.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"非获奖用户"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:A,defaultData:[],loading:{spinning:W,tip:re,size:"large"},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0,r=0,s=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0]),r+=e.holdBalance,s+=e.allBalance})),(0,C.jsxs)(me.Z.Summary.Row,{children:[(0,C.jsx)(me.Z.Summary.Cell,{index:0}),(0,C.jsx)(me.Z.Summary.Cell,{index:1,children:(0,C.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,C.jsx)(me.Z.Summary.Cell,{index:2,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:3,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:4,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:5,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),r]})},je=(0,u.memo)(ke);l().extend(c());var ve=function(e){var t=K.ZP.useMessage(),a=x()(t,2),n=a[0],r=a[1],i=(0,H.useNavigate)(),o=(0,u.useRef)(!1),c=(0,H.useDispatch)(),m=(0,H.useSelector)((function(e){return e.global.contractKit})),p=(0,H.useSelector)((function(e){return e.global.session})),h=(0,H.useSelector)((function(e){return e.jiu.liqsCache})),k=(0,H.useSelector)((function(e){return e.jiu.assetsCache})),j=(0,H.useSelector)((function(e){return e.jiu.activeKey})),v=(0,H.useSelector)((function(e){return e.account.markets})),S=(0,u.useState)([]),g=x()(S,2),q=g[0],Z=g[1],N=(0,u.useState)([]),B=x()(N,2),F=B[0],T=B[1],E=(0,u.useState)(!1),w=x()(E,2),P=w[0],I=w[1],M=(0,u.useState)(""),O=x()(M,2),D=O[0],z=O[1],R=(0,H.useIntl)().formatMessage({id:"jiu.intlMissingData"}),_=(0,u.useCallback)(function(){var e=f()(d()().mark((function e(t){var a,r,s,i,o,c,u,m,p,f,h,y,k,j,v,S,g,C,q,Z,N,B,F,T,E,w,P,I,M;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="jiutothemoon",r="000d9cae502dd1cc895745e204f83cc892bc4c450f92a03ecd4fe057709853cc",s=(0,fe.js)("md5"),i=r+a,s.update(i),o=s.digest("hex").substring(0,8),c={key:o,chainId:r,account:a,skip:0,lastUpdate:"2020-01-01T01:01:01.000Z",error:!1,data:[]},e.next=9,ee.db.txList.where({key:o}).toArray();case 9:if((u=e.sent).length&&(c=u[0]),!(t&&l().utc(c.lastUpdate).valueOf()>l().utc(t).valueOf())){e.next=13;break}return e.abrupt("return",c.data);case 13:m=[],p=500,f=c.lastUpdate,h=c.skip;case 17:return e.next=20,(0,b.zI)(pe().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&sort=asc&simple=true&noBinary=true&account=".concat(a,"&after=").concat(f,"&limit=").concat(p)));case 20:if(y=e.sent,k=x()(y,2),j=k[0],v=k[1],j||200!==v.status){e.next=73;break}if(S=v.data.simple_actions,g=S.length,C=v.data.total.value,q=1,0!==C){e.next=32;break}return ee.db.txList.put(c),e.abrupt("return",c.data);case 32:for(Z=0;Z<S.length;Z++)h<=Z&&m.push(S[Z]);if(m.length){e.next=36;break}return c.error&&n.error(R),e.abrupt("return",c.data);case 36:N=m.length-1;case 37:if(!(N>0)){e.next=46;break}if(m[N].transaction_id!==m[N-1].transaction_id){e.next=42;break}q+=1,e.next=43;break;case 42:return e.abrupt("break",46);case 43:N--,e.next=37;break;case 46:if(h=q,g!==p){e.next=58;break}if(B=m[m.length-1].timestamp,f=B,!(t&&l().utc(B).valueOf()>l().utc(t).valueOf())){e.next=56;break}return m.forEach((function(e){c.data.push(e)})),c.lastUpdate=B,c.skip=h,ee.db.txList.put(c),e.abrupt("return",c.data);case 56:e.next=71;break;case 58:return m.forEach((function(e){c.data.push(e)})),F=m[m.length-1].timestamp,c.lastUpdate=F,c.skip=h,e.next=64,(0,b.zI)(pe().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&simple=true&noBinary=true&account=".concat(a,"&skip=0&limit=1")));case 64:return T=e.sent,E=x()(T,2),w=E[0],P=E[1],w||200!==P.status?n.error(w):(I=P.data.total.value,c.data.length!==I?(c.error=!0,n.error(R)):c.error=!1),ee.db.txList.put(c),e.abrupt("return",c.data);case 71:e.next=77;break;case 73:return m.length&&(m.forEach((function(e){c.data.push(e)})),M=m[m.length-1].timestamp,c.lastUpdate=M,c.skip=h,c.error=!0),ee.db.txList.put(c),n.error(j),e.abrupt("return",c.data);case 77:e.next=17;break;case 79:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n]),A=(0,u.useCallback)(function(){var t=f()(d()().mark((function t(a,r){var s,i,o,u,m,p,f,x,j,S,g,C,q,N,B,F,E,w,P,M,O,D,R,A,U,L,H,J,K,W,Y,G,Q,V,ee,te;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s=e.params.startTime,i=e.params.endTime,o=e.params.receiveAccount,u=e.params.transferTokenContract,m=e.params.transferTokenMinAmount,p=e.params.transferTokenSym,f=e.params.liqMid,x=e.params.liqTokenKey,j=e.params.liqSym,S=e.params.liqTokenMinAmount,g=e.params.ruleType,C="",0,q="",N=0,2===g&&(C=e.params.holdTokenContract,e.params.holdTokenMinAmount,q=e.params.holdTokenSym,N=e.params.allTokenMinAmount),B=e.params.pattern,F=[],E={},w=[],P=[],M=[],O=[],t.next=26,_(i);case 26:D=t.sent,R=0;case 28:if(!(R<D.length)){t.next=38;break}if(A=l().utc(s).valueOf(),U=l().utc(i).valueOf(),L=l().utc(D[R].timestamp).valueOf(),A<=L&&L<=U&&D[R].contract===u&&"transfer"===D[R].action&&D[R].data.symbol===p&&D[R].data.to===o&&"dfsminingout"!==D[R].data.from&&"swapswapswap"!==D[R].data.from&&""!==D[R].data.memo.trim()&&F.push(D[R]),!(L>U)){t.next=35;break}return t.abrupt("break",38);case 35:R++,t.next=28;break;case 38:if(F.forEach((function(e){var t=e.data.from,a=e.data.memo.trim(),n=e.data.amount;E.hasOwnProperty(t)?n>=m&&B.test(a)&&(E[t]=e):B.test(a)&&(E[t]=e)})),H=[],!v||!v.length){t.next=44;break}H=v,t.next=52;break;case 44:return t.next=46,r.load("swapswapswap");case 46:return J=t.sent,K=J.table("markets"),t.next=50,K.all();case 50:H=t.sent,c(y.N.setMarkets(H));case 52:return t.next=54,r.load("loglogloglog");case 54:W=t.sent,Y=W.table("liqs"),G=Object.keys(E),Q={},V={},ee=d()().mark((function e(){var t,n,r,s,i,l,o,c,u,m,p,y;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(z("".concat(te+1," / ").concat(G.length)),t=0,n=j,r=[],!h.hasOwnProperty(G[te])){e.next=8;break}r=h[G[te]],e.next=12;break;case 8:return e.next=10,Y.all({scope:(0,b.fD)(G[te])});case 10:r=e.sent,Q[G[te]]=r;case 12:if((s=r.find((function(e){return e.mid.toNumber()===f})))&&(i=H.find((function(e){return e.mid.equals(s.mid)})),l=s.token.toNumber()/i.liquidity_token.toNumber(),o=l*i.reserve0.value,c=l*i.reserve1.value,u=i.reserve0.symbol.name,m=i.reserve1.symbol.name,0===x?(t=o,n=u):(t=c,n=m)),E[G[te]].liqBalance=t,E[G[te]].liqSym=n,p=0,y=[],2!==g){e.next=29;break}if(!k.hasOwnProperty(G[te])){e.next=23;break}y=k[G[te]],e.next=27;break;case 23:return e.next=25,a.client.v1.chain.get_currency_balance(C,G[te],q);case 25:y=e.sent,V[G[te]]=y;case 27:y.length&&(p=y[0].value),E[G[te]].holdBalance=p;case 29:case"end":return e.stop()}}),e)})),te=0;case 61:if(!(te<G.length)){t.next=66;break}return t.delegateYield(ee(),"t0",63);case 63:te++,t.next=61;break;case 66:Object.keys(Q).length&&c(X.N.setLiqsCache($()($()({},h),Q))),Object.keys(V).length&&c(X.N.setAssetsCache($()($()({},k),V))),1===g?G.forEach((function(e){var t=E[e].liqBalance;E[e].data.amount>=m&&t>=S?w.push(E[e]):P.push(E[e])})):2===g&&G.forEach((function(e){var t=E[e].liqBalance+E[e].holdBalance;E[e].data.amount>=m&&t>=N?w.push(E[e]):P.push(E[e])})),w.forEach((function(e,t){var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,i=l().utc(e.timestamp).local().format(),o=e.data.quantity,c=e.transaction_id,u=e.holdBalance,m=r+u,d=B.exec(a),p="";p=d?d[1]:a,M.push({key:t,account:n,liqBalance:r,liqSym:s,time:i,quantity:o,scheme:p,memo:a,txid:c,holdBalance:u,holdTokenSym:q,allBalance:m,valid:!0})})),Z(M.sort((function(e,t){return e.time.localeCompare(t.time)}))),P.forEach((function(e,t){var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,i=l().utc(e.timestamp).local().format(),o=e.data.quantity,c=e.transaction_id,u=e.holdBalance,m=r+u,d=B.exec(a),p="";p=d?d[1]:a,O.push({key:t,account:n,liqBalance:r,liqSym:s,time:i,quantity:o,scheme:p,memo:a,txid:c,holdBalance:u,holdTokenSym:q,allBalance:m,valid:!1})})),T(O.sort((function(e,t){return e.time.localeCompare(t.time)}))),I(!1),t.next=80;break;case 76:t.prev=76,t.t1=t.catch(0),I(!1),(0,b.Tv)(t.t1,n,"handleGetData");case 80:case"end":return t.stop()}}),t,null,[[0,76]])})));return function(e,a){return t.apply(this,arguments)}}(),[_,n,k,h,v,e.params]),U=(0,u.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,a){return(0,C.jsx)("span",{children:a+1})}},{title:"账号",dataIndex:"account",key:"account",sorter:function(e,t){return e.account.localeCompare(t.account)},render:function(e,t){return(0,C.jsx)("a",{onClick:function(){return i("/query/account?search=".concat(t.account,"&tab=info"))},children:t.account})}},{title:"JIU/DFS矿池做市",dataIndex:"liqBalance",key:"liqBalance",sorter:function(e,t){return t.liqBalance-e.liqBalance},render:function(e,t){var a=t.valid;return(0,C.jsx)("span",{children:(0,b.CE)(t.liqBalance.toFixed(a?0:4))+" "+t.liqSym})}},{title:"".concat(e.params.holdTokenSym,"账号余额"),dataIndex:"holdBalance",key:"holdBalance",sorter:function(e,t){return t.holdBalance-e.holdBalance},render:function(e,t){var a=t.valid;return(0,C.jsx)("span",{children:(0,b.CE)(t.holdBalance.toFixed(a?0:4))+" "+t.holdTokenSym})}},{title:"做市+持有",dataIndex:"allBalance",key:"allBalance",sorter:function(e,t){return t.allBalance-e.allBalance},render:function(e,t){var a=t.valid;return(0,C.jsx)("span",{children:(0,b.CE)(t.allBalance.toFixed(a?0:4))+" "+t.holdTokenSym})}},{title:"转账数量",dataIndex:"quantity",key:"quantity",sorter:function(e,t){return Number(t.quantity.split(" ")[0])-Number(e.quantity.split(" ")[0])},render:function(e,t){var a=Number(t.quantity.split(" ")[0]),n=t.quantity.split(" ")[1],r=t.valid;return(0,C.jsx)("span",{children:(0,b.CE)(a.toFixed(r?0:4))+" "+n})}},{title:"转账时间",dataIndex:"time",key:"time",sorter:function(e,t){return t.time.localeCompare(e.time)},render:function(e,t){return(0,C.jsx)("span",{children:t.time})}},{title:"预测时间",dataIndex:"scheme",key:"scheme",sorter:function(e,t){return Number(e.scheme)-Number(t.scheme)},render:function(e,t){return(0,C.jsx)("span",{children:t.scheme})}},{title:"原始数据",dataIndex:"memo",key:"memo",render:function(e,t){return(0,C.jsx)("span",{children:t.memo})}},{title:"交易id",dataIndex:"txid",key:"txid",render:function(e,t){return(0,C.jsx)("a",{onClick:function(){return i("/query/transaction?search=".concat(t.txid,"&tab=summary"))},children:t.txid.slice(0,8)})}}]}),[e.params]),L=(0,u.useCallback)((function(){var t=function(t){var a=0,n=0,r=0,s=0,i=t.map((function(e,t){var s=e.valid,i=Number(e.quantity.split(" ")[0]),l=e.quantity.split(" ")[1];return a+=e.liqBalance,n+=i,r+=e.holdBalance,{"#":t+1,"账号":e.account,"JIU/DFS矿池做市":(0,b.CE)(e.liqBalance.toFixed(s?0:4))+" "+e.liqSym,"DFS账号余额":(0,b.CE)(e.holdBalance.toFixed(s?0:4))+" "+e.holdTokenSym,"做市+持有":(0,b.CE)(e.allBalance.toFixed(s?0:4))+" "+e.holdTokenSym,"转账数量":(0,b.CE)(i.toFixed(s?0:4))+" "+l,"转账时间":e.time,"预测时间":e.scheme,"原始数据":e.memo,"交易id":e.txid}}));return s=a+r,i.push({"#":0,"账号":"汇总","JIU/DFS矿池做市":(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym,"DFS账号余额":(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym,"做市+持有":(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym,"转账数量":(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym,"转账时间":"","预测时间":"","原始数据":"","交易id":""}),i},a=function(e){return e.map((function(e){return e.title}))},n={};n.fileName="活动".concat(j,"数据汇总"),n.datas=[{sheetData:t(q),sheetName:"有效预测详情",sheetFilter:a(U),sheetHeader:a(U)},{sheetData:t(F),sheetName:"无效预测详情",sheetFilter:a(U),sheetHeader:a(U)}],new(xe())(n).saveExcel()}),[e.params,j,U,q,F]);return(0,u.useEffect)((function(){p&&m&&!o.current&&(o.current=!0,I(!0),A(p,m))}),[A,m,p]),(0,C.jsxs)("div",{className:"result2",children:[(0,C.jsx)(s.ZP,{type:"primary",className:"mt-3 ml-3",onClick:L,children:"导出数据"}),(0,C.jsx)(oe.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"有效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:U,dataSource:q,defaultData:[],loading:{spinning:P,tip:D,size:"large"},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0,r=0,s=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0]),r+=e.holdBalance,s+=e.allBalance})),(0,C.jsxs)(me.Z.Summary.Row,{children:[(0,C.jsx)(me.Z.Summary.Cell,{index:0}),(0,C.jsx)(me.Z.Summary.Cell,{index:1,children:(0,C.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,C.jsx)(me.Z.Summary.Cell,{index:2,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:3,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:4,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:5,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),(0,C.jsx)(oe.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"无效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:U,dataSource:F,defaultData:[],loading:{spinning:P,tip:D,size:"large"},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0,r=0,s=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0]),r+=e.holdBalance,s+=e.allBalance})),(0,C.jsxs)(me.Z.Summary.Row,{children:[(0,C.jsx)(me.Z.Summary.Cell,{index:0}),(0,C.jsx)(me.Z.Summary.Cell,{index:1,children:(0,C.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,C.jsx)(me.Z.Summary.Cell,{index:2,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:3,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:4,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:5,children:(0,C.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,C.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),r]})},Se=(0,u.memo)(ve)}}]);