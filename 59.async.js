"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[59],{80059:function(e,t,n){n.d(t,{Wo:function(){return p},ox:function(){return R},kh:function(){return _},Uh:function(){return me},p4:function(){return he},Wr:function(){return O},tw:function(){return B},SX:function(){return $},Um:function(){return pe},DL:function(){return oe}});var r=n(62435),a=n(5574),s=n.n(a),o=[["Y",31536e6],["M",2592e6],["D",864e5],["H",36e5],["m",6e4],["s",1e3],["S",1]];function c(e,t){var n=t.format,r=void 0===n?"":n,a=new Date(e).getTime(),c=Date.now();return function(e,t){var n=e,r=/\[[^\]]*]/g,a=(t.match(r)||[]).map((function(e){return e.slice(1,-1)})),c=t.replace(r,"[]"),u=o.reduce((function(e,t){var r=s()(t,2),a=r[0],o=r[1];if(e.includes(a)){var c=Math.floor(n/o);return n-=c*o,e.replace(new RegExp("".concat(a,"+"),"g"),(function(e){var t=e.length;return c.toString().padStart(t,"0")}))}return e}),c),i=0;return u.replace(r,(function(){var e=a[i];return i+=1,e}))}(Math.max(a-c,0),r)}var u=n(75633),i=n(51409),l=n(86074);var d=function(e){var t=e.value,n=e.format,a=void 0===n?"HH:mm:ss":n,s=e.onChange,o=e.onFinish,d=e.className,p=(0,u.N)(),f=r.useRef(null),m=function(){var e=function(e){return new Date(e).getTime()}(t);e>=Date.now()&&(f.current=(0,i.Zi)((function(){p(),null==s||s(e-Date.now()),e<Date.now()&&(null==o||o(),f.current&&((0,i.cv)(f.current),f.current=null))}),33.333333333333336))};return r.useEffect((function(){return m(),function(){f.current&&((0,i.cv)(f.current),f.current=null)}}),[t]),(0,l.jsx)("div",{className:d,children:c(t,{format:a})})},p=r.memo(d),f=n(15009),m=n.n(f),x=n(99289),h=n.n(x),k=n(64119),v=n(25035),b=n(37476),y=n(31199),j=n(63434),g=n(5966),S=n(90672),w=n(59530),N=n(45360),D=n(83062),I=n(27484),C=n.n(I),F=r.forwardRef((function(e,t){var n=N.ZP.useMessage(),a=s()(n,2),o=a[0],c=a[1],u=(0,w.useSelector)((function(e){return e.global.session})),i=(0,w.useSelector)((function(e){return e.global.account})),d=(0,w.useSelector)((function(e){return e.ppp.projectNft})),p=(0,w.useSelector)((function(e){return e.ppp.projectLastRound})),f=(0,r.useState)([]),x=s()(f,2),I=x[0],F=x[1],R=(0,w.useIntl)(),T=R.formatMessage({id:"coffee.inputException"}),M=R.formatMessage({id:"common.intlPleaseConnectWallet"}),P=R.formatMessage({id:"common.intlPleaseConnectNetwork"}),Z=R.formatMessage({id:"common.intlTransferSuccess"}),_=R.formatMessage({id:"common.intlTransferFail"}),E=(0,r.useRef)(),Y=(0,r.useState)(!1),O=s()(Y,2),z=O[0],U=O[1],V=(0,r.useCallback)(function(){var e=h()(m()().mark((function e(t){var n,r,a,s,c,i,f,x,h,v,b,y;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=0,c=5,i=[],f=[],x=[],h={},v=p.value,d.forEach((function(e){var t=C().utc(e.last_trade).local().valueOf(),n=e.owner;t<v||(h.hasOwnProperty(n)||(h[n]=0),h[n]+=1,s+=1)})),!t){e.next=13;break}c=t,e.next=18;break;case 13:return s<300?c=5:s>=300&&s<600?c=10:s>=600&&s<1200?c=20:s>=1200&&s<2400?c=40:s>=2400&&(c=80),e.next=16,u.client.v1.chain.get_currency_balance("dfsppptokens","dogsbouns123","DOGS");case 16:y=e.sent,null===(b=E.current)||void 0===b||b.setFieldValue("balance",y[0].toString());case 18:Object.keys(h).forEach((function(e){h[e]>=c&&i.push({account:e,count:h[e]})})),i.sort((function(e,t){return t.count-e.count})),i.forEach((function(e){x.push(e.account),f.push({label:(0,l.jsxs)("div",{className:"flex justify-between w-[300px]",children:[(0,l.jsx)("div",{children:e.account}),(0,l.jsx)("div",{children:e.count})]}),value:e.account})})),F(f),null===(n=E.current)||void 0===n||n.setFieldValue("accounts",x),null===(r=E.current)||void 0===r||r.setFieldValue("count",s),null===(a=E.current)||void 0===a||a.setFieldValue("condition",c),e.next=30;break;case 27:e.prev=27,e.t0=e.catch(0),(0,k.Tv)(e.t0,o,"handleRewardInfo");case 30:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t){return e.apply(this,arguments)}}(),[u,d,p]),H=(0,r.useCallback)((function(){U(!0),V()}),[V]);(0,r.useImperativeHandle)(t,(function(){return{handleOpen:H}}));var A=(0,r.useCallback)(function(){var e=h()(m()().mark((function e(t){var n,r,a,c,l,d,p,f;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u&&u.broadcast){e.next=5;break}return o.error("".concat(M)),e.abrupt("return");case 5:if(i){e.next=8;break}return o.error("".concat(P)),e.abrupt("return");case 8:return n=t.accounts,r=t.memo,a=r?r.trim():"",c=[],n.forEach((function(e){c.push({account:"dfsppptokens",name:"transfer",authorization:[u.permissionLevel],data:{from:u.actor,to:e,quantity:"1.00000000 DOGS",memo:a}})})),e.next=14,(0,k.zI)(u.transact({actions:c}));case 14:if(l=e.sent,d=s()(l,2),p=d[0],f=d[1],!p){e.next=23;break}return o.error(p),e.abrupt("return");case 23:if(!f||!f.response){e.next=27;break}o.success("".concat(Z)),e.next=29;break;case 27:return o.error("".concat(_)),e.abrupt("return");case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[i,u]),B=(0,r.useCallback)((function(e){if(e.hasOwnProperty("condition")){var t,n=null===(t=E.current)||void 0===t?void 0:t.getFieldValue("condition");V(n)}}),[V]);return(0,l.jsxs)(b.Y,{formRef:E,title:"DOGS抢图奖励",open:z,onFinish:A,onOpenChange:function(e){U(e)},onValuesChange:B,initialValues:{count:0},layout:"vertical",width:"400px",modalProps:{destroyOnClose:!0,style:{top:25}},submitter:{searchConfig:{submitText:"发送"}},children:[(0,l.jsx)(y.Z,{name:"count",label:"当前NFT总量",placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:0,readOnly:!0}}),(0,l.jsx)(y.Z,{name:"condition",label:(0,l.jsxs)("div",{children:["奖励条件 (大于等于)",(0,l.jsx)(D.Z,{placement:"topLeft",title:"图片如果到了拆分点没有拆分，当前轮会计算在内，但下一轮则不会计算。图片如果在当前轮没有卖出，下一轮也不会计算在内",children:(0,l.jsx)(v.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"持有图片数量",min:5,rules:[{required:!0,message:"".concat(T),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!0,size:"large"}}),(0,l.jsx)(j.Z.Group,{name:"accounts",label:(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{children:"获奖账号 "}),I.length?"(".concat(I.length,")"):""]}),options:I,rules:[{required:!0,whitespace:!0,message:"".concat(T),pattern:/.*/}]}),(0,l.jsx)(g.Z,{name:"balance",label:"奖励账号余额 (dogsbouns123)",placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0}}),(0,l.jsx)(S.Z,{name:"memo",label:"Memo",placeholder:"留言信息",fieldProps:{size:"large",autoFocus:!1,allowClear:!0,defaultValue:"",autoSize:{minRows:1}}}),c]})})),R=(0,r.memo)(F),T=n(98097),M=n(70178),P=n.n(M);C().extend(P());var Z=(0,r.forwardRef)((function(){var e=(0,w.useSelector)((function(e){return e.ppp.project})),t=(0,w.useSelector)((function(e){return e.ppp.projectNftLoading})),n=(0,r.useMemo)((function(){return[{title:"项目ID",dataIndex:"id",key:"id",render:function(e,t){return(0,l.jsx)("span",{children:t.id})}},{title:"项目名称",dataIndex:"projectName",key:"projectName",render:function(e,t){return(0,l.jsx)("span",{children:t.projectName})}},{title:"项目描述",dataIndex:"desc",key:"desc",render:function(e,t){return(0,l.jsx)("span",{children:t.desc})}},{title:"NFT名称",dataIndex:"nftName",key:"nftName",render:function(e,t){return(0,l.jsx)("span",{children:t.nftName})}},{title:"代币名称",dataIndex:"tokenNameRelease",key:"tokenNameRelease",render:function(e,t){return(0,l.jsx)("span",{children:t.tokenNameRelease})}},{title:"矿池ID",dataIndex:"mid",key:"mid",render:function(e,t){return(0,l.jsx)("span",{children:t.mid})}},{title:"创建者",dataIndex:"creator",key:"creator",render:function(e,t){return(0,l.jsx)("span",{children:t.creator})}},{title:"创建时间",dataIndex:"createTime",key:"createTime",render:function(e,t){return(0,l.jsx)("div",{children:t.createTime})}},{title:"NFT初始发行量",dataIndex:"initNftNumber",key:"initNftNumber",render:function(e,t){return(0,l.jsx)("div",{children:t.initNftNumber})}},{title:"NFT流通量",dataIndex:"nftSupply",key:"nftSupply",render:function(e,t){return(0,l.jsx)("div",{children:t.nftSupply})}},{title:"NFT最大发行量",dataIndex:"nftMaxSupply",key:"nftMaxSupply",render:function(e,t){return(0,l.jsx)("div",{children:t.nftMaxSupply})}},{title:"NFT初始价格",dataIndex:"initNftPrice",key:"initNftPrice",render:function(e,t){return(0,l.jsx)("div",{children:t.initNftPrice})}},{title:"分裂价格",dataIndex:"splitNftPrice",key:"splitNftPrice",render:function(e,t){return(0,l.jsx)("div",{children:t.splitNftPrice})}},{title:"每轮时间",dataIndex:"secPerRound",key:"secPerRound",render:function(e,t){return(0,l.jsx)("div",{children:t.secPerRound})}},{title:"NFT每轮涨幅",dataIndex:"increasePerRound",key:"increasePerRound",render:function(e,t){return(0,l.jsx)("div",{children:t.increasePerRound})}},{title:"NFT销毁时间",dataIndex:"secToBurnNft",key:"secToBurnNft",render:function(e,t){return(0,l.jsx)("div",{children:t.secToBurnNft})}},{title:"销毁兑换",dataIndex:"tokenPerNft",key:"tokenPerNft",render:function(e,t){return(0,l.jsx)("div",{children:t.tokenPerNft})}},{title:"NFT交易手续费(含奖励池)",dataIndex:"tradeFeeRatio",key:"tradeFeeRatio",render:function(e,t){return(0,l.jsx)("div",{children:t.tradeFeeRatio})}},{title:"NFT交易手续费(不含奖励池)",dataIndex:"tradeFeeRatioWithoutRewardPool",key:"tradeFeeRatioWithoutRewardPool",render:function(e,t){return(0,l.jsx)("div",{children:t.tradeFeeRatioWithoutRewardPool})}},{title:"奖励池手续费",dataIndex:"rewordPoolFeeRatio",key:"rewordPoolFeeRatio",render:function(e,t){return(0,l.jsx)("div",{children:t.rewordPoolFeeRatio})}},{title:"利润率",dataIndex:"profitRate",key:"profitRate",render:function(e,t){return(0,l.jsx)("div",{children:t.profitRate})}},{title:"拆分利润率",dataIndex:"profitRateSplit",key:"profitRateSplit",render:function(e,t){return(0,l.jsx)("div",{children:t.profitRateSplit})}},{title:"年化利率",dataIndex:"profitRateApr",key:"profitRateApr",render:function(e,t){return(0,l.jsx)("div",{children:t.profitRateApr})}},{title:"Website",dataIndex:"website",key:"website",render:function(e,t){return(0,l.jsx)("div",{children:t.website})}},{title:"Twitter",dataIndex:"twitter",key:"twitter",render:function(e,t){return(0,l.jsx)("div",{children:t.twitter})}},{title:"Telegram",dataIndex:"telegram",key:"telegram",render:function(e,t){return(0,l.jsx)("div",{children:t.telegram})}}]}),[e]);return(0,l.jsx)("div",{className:"ml-3",children:(0,l.jsx)(T.vY,{loading:t,columns:n,dataSource:e})})})),_=(0,r.memo)(Z),E=n(92340);C().extend(P());var Y=(0,r.forwardRef)((function(){var e=(0,w.useSelector)((function(e){return e.ppp.projectNftGrow})),t=(0,w.useSelector)((function(e){return e.ppp.projectSecPerRound})),n=(0,w.useSelector)((function(e){return e.ppp.projectNftLoading})),a=(0,w.useSelector)((function(e){return e.ppp.project})),s=(0,r.useMemo)((function(){return"".concat((a.tradeFeeRatioValue/2*100).toFixed(2),"%")}),[a]),o=(0,r.useMemo)((function(){return"".concat((a.tradeFeeRatioValue/2*100).toFixed(2),"%")}),[a]),c=(0,r.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,n){return(0,l.jsx)("span",{children:n+1})}},{title:"轮次时间(".concat(t/3600,"小时)"),dataIndex:"time",key:"time",render:function(e,t){return(0,l.jsx)("div",{children:t.time})}},{title:"NFT数量",dataIndex:"count",key:"count",render:function(e,t){return(0,l.jsx)("div",{children:t.count})}},{title:"NFT市值",dataIndex:"asset",key:"asset",render:function(e,t){return(0,l.jsx)("div",{children:t.asset})}},{title:"手续费(".concat(s,")"),dataIndex:"asset",key:"asset",render:function(e,t){return(0,l.jsx)("div",{children:t.tradeFee})}},{title:"奖励池(".concat(o,")"),dataIndex:"asset",key:"asset",render:function(e,t){return(0,l.jsx)("div",{children:t.rewordPool})}},{title:"协议费(0.5%)",dataIndex:"asset",key:"asset",render:function(e,t){return(0,l.jsx)("div",{children:t.protocolFee})}}]}),[t,a,s,o]);return(0,l.jsx)("div",{className:"ppp-tab-grow",children:(0,l.jsx)(E.Z,{loading:{spinning:n,size:"large"},scroll:{x:!0},size:"small",columns:c,dataSource:e,defaultData:[],options:!1,search:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1})})})),O=(0,r.memo)(Y),z=n(40956),U=n(49591),V=n(15867),H=n(51165);C().extend(P());var A=function(e){var t=(0,w.useDispatch)(),n=(0,w.useNavigate)(),a=N.ZP.useMessage(),o=s()(a,2),c=o[0],u=o[1],i=(0,w.useSelector)((function(e){return e.ppp.projectNft})),d=(0,w.useSelector)((function(e){return e.ppp.project})),f=(0,w.useSelector)((function(e){return e.ppp.projectNftReset})),x=(0,w.useSelector)((function(e){return e.ppp.projectId})),v=(0,w.useSelector)((function(e){return e.ppp.projectSecToBurnNft})),b=(0,w.useSelector)((function(e){return e.ppp.projectAccountFilter})),y=(0,w.useSelector)((function(e){return e.ppp.projectNftLoading})),j=(0,w.useSelector)((function(e){return e.ppp.projectProfitRate})),g=(0,w.useSelector)((function(e){return e.ppp.projectProfitRateSplit})),S=(0,w.useSelector)((function(e){return e.ppp.projectTotalHolder})),D=(0,w.useSelector)((function(e){return e.global.session})),I=(0,w.useSelector)((function(e){return e.global.account})),F=(0,w.useSelector)((function(e){return e.ppp.projectTotalInvest})),R=(0,w.useSelector)((function(e){return e.ppp.projectTotalValue})),T=(0,w.useSelector)((function(e){return e.ppp.projectEndTime})),M=(0,r.useState)([]),P=s()(M,2),Z=P[0],_=P[1],Y=(0,w.useIntl)(),O=Y.formatMessage({id:"tokens.intlUpdate"}),A=Y.formatMessage({id:"common.intlPleaseConnectWallet"}),B=Y.formatMessage({id:"common.intlPleaseConnectNetwork"}),q=Y.formatMessage({id:"common.intlTransferSuccess"}),L=Y.formatMessage({id:"common.intlTransferFail"}),G=(0,r.useCallback)((function(){var e=T/1e3;return 0===e?"":e<60?"(".concat(e.toFixed(0),"秒)"):e>=60&&e<3600?"(".concat((e/60).toFixed(1),"分)"):"(".concat((e/3600).toFixed(1),"时)")}),[T]),W=(0,r.useCallback)((function(e){var n=e.owner,r=i.filter((function(e){return e.owner===n}));t(z.N.setProjectNft(r))}),[i]),$=(0,r.useCallback)((function(){t(z.N.setProjectNft(f))}),[f]),K=(0,r.useCallback)(h()(m()().mark((function t(){var n,r,a,o,u,l,p,f;return m()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(D&&D.broadcast){t.next=5;break}return c.error("".concat(A)),t.abrupt("return");case 5:if(I){t.next=8;break}return c.error("".concat(B)),t.abrupt("return");case 8:if(Z.length){t.next=11;break}return c.error("复选项不能为空"),t.abrupt("return");case 11:if(n=d.tokenName,r="","DFS"!==n){t.next=17;break}r="eosio.token",t.next=28;break;case 17:if("USDT"!==n){t.next=21;break}r="usdtusdtusdt",t.next=28;break;case 21:if("ORDI"!==n){t.next=25;break}r="ordiordiordi",t.next=28;break;case 25:return c.error("不支持当前项目"),console.log("不支持当前项目"),t.abrupt("return");case 28:return a=i.filter((function(e){return Z.includes(e.id)})),o=[],a.forEach((function(e){o.push({account:r,name:"transfer",authorization:[D.permissionLevel],data:{from:D.actor,to:"dfs3protocol",quantity:e.current_price,memo:"buy:".concat(e.id)}})})),t.next=33,(0,k.zI)(D.transact({actions:o}));case 33:if(u=t.sent,l=s()(u,2),p=l[0],f=l[1],!p){t.next=42;break}return c.error(p),t.abrupt("return");case 42:if(!f||!f.response){t.next=46;break}c.success("".concat(q)),t.next=48;break;case 46:return c.error("".concat(L)),t.abrupt("return");case 48:e.handleGetProjectNft(x);case 49:case"end":return t.stop()}}),t)}))),[D,Z,i,d,e,x]),X=(0,r.useCallback)(h()(m()().mark((function t(){var n,r,a,o,u,l;return m()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(D&&D.broadcast){t.next=5;break}return c.error("".concat(A)),t.abrupt("return");case 5:if(I){t.next=8;break}return c.error("".concat(B)),t.abrupt("return");case 8:if(Z.length){t.next=11;break}return c.error("复选项不能为空"),t.abrupt("return");case 11:return n=i.filter((function(e){return Z.includes(e.id)})),r=[],n.forEach((function(e){r.push({account:"dfs3protocol",name:"split",authorization:[D.permissionLevel],data:{assetid:e.id}})})),t.next=16,(0,k.zI)(D.transact({actions:r}));case 16:if(a=t.sent,o=s()(a,2),u=o[0],l=o[1],!u){t.next=25;break}return c.error(u),t.abrupt("return");case 25:if(!l||!l.response){t.next=29;break}c.success("".concat(q)),t.next=31;break;case 29:return c.error("".concat(L)),t.abrupt("return");case 31:e.handleGetProjectNft(x);case 32:case"end":return t.stop()}}),t)}))),[D,Z,i,d,e,x]),J=(0,r.useCallback)(h()(m()().mark((function t(){var n,r,a,o,u,l;return m()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(D&&D.broadcast){t.next=5;break}return c.error("".concat(A)),t.abrupt("return");case 5:if(I){t.next=8;break}return c.error("".concat(B)),t.abrupt("return");case 8:if(Z.length){t.next=11;break}return c.error("复选项不能为空"),t.abrupt("return");case 11:return n=i.filter((function(e){return Z.includes(e.id)})),r=[],n.forEach((function(e){r.push({account:"dfs3protocol",name:"burn",authorization:[D.permissionLevel],data:{assetid:e.id}})})),t.next=16,(0,k.zI)(D.transact({actions:r}));case 16:if(a=t.sent,o=s()(a,2),u=o[0],l=o[1],!u){t.next=25;break}return c.error(u),t.abrupt("return");case 25:if(!l||!l.response){t.next=29;break}c.success("".concat(q)),t.next=31;break;case 29:return c.error("".concat(L)),t.abrupt("return");case 31:e.handleGetProjectNft(x);case 32:case"end":return t.stop()}}),t)}))),[D,Z,i,d,e,x]),Q=(0,r.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,n){return(0,l.jsx)("span",{children:n+1})}},{title:"ID",dataIndex:"id",key:"id",search:!1,render:function(e,t){return(0,l.jsx)("div",{children:t.id})}},{title:"CID",dataIndex:"cid",key:"cid",search:!1,render:function(e,t){return(0,l.jsxs)("div",{children:["#",t.cid]})}},{title:"状态",dataIndex:"status",key:"status",filters:[{text:"可买",value:"buy"},{text:"已售",value:"sell"},{text:"可拆分",value:"split"},{text:"可销毁",value:"burn"}],onFilter:function(e,t){return"buy"===e?t.status.includes("可买"):"sell"===e?"已售"===t.status:"split"===e?"可拆分"===t.status:"burn"!==e||t.status.includes("可销毁")},sorter:function(e,t){return e.status.localeCompare(t.status)},search:!1,render:function(e,t){return(0,l.jsx)("div",{children:t.status})}},{title:"持有者(".concat(S,")"),dataIndex:"owner",key:"owner",filters:b,onFilter:function(e,t){return e===t.owner},sorter:function(e,t){return e.owner.localeCompare(t.owner)},render:function(e,t){return(0,l.jsx)("a",{onClick:function(){return n("/query/account?search=".concat(t.owner,"&tab=info"))},children:t.owner})}},{title:"投入成本(".concat(F.toFixed(0),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest.localeCompare(t.invest)},search:!1,render:function(e,t){return(0,l.jsx)("div",{children:t.invest})}},{title:"当前价格(".concat(R.toFixed(0),")"),dataIndex:"current_price",key:"current_price",sorter:function(e,t){return e.current_price.localeCompare(t.current_price)},search:!1,render:function(e,t){return(0,l.jsx)("div",{children:t.current_price})}},{title:"卖出利润(".concat(j.toFixed(2),"%/").concat(g.toFixed(2),"%)"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit.localeCompare(t.profit)},search:!1,render:function(e,t){return(0,l.jsx)("div",{children:t.profit})}},{title:"购买时间".concat(G()),dataIndex:"last_trade",key:"last_trade",sorter:function(e,t){return C()(t.last_trade).valueOf()-C()(e.last_trade).valueOf()},search:!1,render:function(e,t){var n=C().utc(t.last_trade).local().format("YYYY-MM-DDTHH:mm:ss");return(0,l.jsx)("div",{children:n})}},{title:"销毁时间",dataIndex:"last_trade",key:"last_trade",sorter:function(e,t){return C()(e.last_trade).valueOf()-C()(t.last_trade).valueOf()},search:!1,render:function(e,t){var n=C().utc(t.last_trade).add(v,"seconds").local().format("YYYY-MM-DDTHH:mm:ss");return(0,l.jsx)("div",{children:n})}},{title:"销毁倒计时",dataIndex:"last_trade",key:"last_trade",search:!1,render:function(e,t){var n=C().utc(t.last_trade).add(v,"seconds").local().valueOf();return(0,l.jsx)(p,{value:n})}}]}),[v,b,j,S,R,G]);return(0,l.jsxs)("div",{className:"ppp-tab-nft",children:[(0,l.jsx)(E.Z,{loading:{spinning:y,size:"large"},scroll:{x:!0},size:"small",columns:Q,dataSource:i,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:function(t,n,r){return[r[1],(0,l.jsx)(V.ZP,{type:"primary",onClick:function(){e.handleGetProjectNft(x),_([])},children:O},"update"),r[0]]}},rowSelection:{type:"checkbox",selectedRowKeys:Z,onChange:function(e){_(e)}},onSubmit:W,onReset:$,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1}),!!Z.length&&(0,l.jsxs)(H.Z.Group,{trigger:"click",type:"primary",style:{insetInlineEnd:50},icon:(0,l.jsx)(U.Z,{}),children:[(0,l.jsx)(H.Z,{type:"primary",description:"购买",onClick:K},"1"),(0,l.jsx)(H.Z,{type:"primary",description:"拆分",onClick:X},"2"),(0,l.jsx)(H.Z,{type:"primary",description:"销毁",onClick:J},"3")]}),u]})},B=(0,r.memo)(A),q=n(7134),L=n(62120),G=n(12399);C().extend(P());var W=function(e){var t=(0,w.useDispatch)(),n=(0,w.useNavigate)(),a=(0,w.useSelector)((function(e){return e.ppp.projectNftRank})),s=(0,w.useSelector)((function(e){return e.ppp.projectNftRankReset})),o=(0,w.useSelector)((function(e){return e.ppp.projectId})),c=(0,w.useSelector)((function(e){return e.ppp.projectAccountFilter})),u=(0,w.useSelector)((function(e){return e.ppp.projectNftLoading})),i=(0,w.useSelector)((function(e){return e.ppp.projectTotalHolder})),d=(0,w.useSelector)((function(e){return e.ppp.projectTotalInvest})),p=(0,w.useSelector)((function(e){return e.ppp.projectTotalProfit})),f=(0,w.useSelector)((function(e){return e.ppp.projectTotalBalance})),m=(0,w.useSelector)((function(e){return e.ppp.projectRewardPool})),x=(0,w.useSelector)((function(e){return e.ppp.projectNftSupply})),h=(0,r.useRef)(),v=(0,w.useIntl)().formatMessage({id:"tokens.intlUpdate"}),b=(0,r.useCallback)((function(e){var n=e.owner,r=a.filter((function(e){return e.owner===n}));t(z.N.setProjectNftRank(r))}),[a]),y=(0,r.useCallback)((function(){t(z.N.setProjectNftRank(s))}),[s]),j=(0,r.useCallback)((function(t,n,r){return[r[1],(0,l.jsx)(V.ZP,{type:"primary",onClick:function(){e.handleGetProjectNft(o)},children:v},"update"),r[0]]}),[e,o]),g=(0,r.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,n){return(0,l.jsx)("span",{children:n+1})}},{title:"持有者(".concat(i,")"),dataIndex:"owner",key:"owner",filters:c,onFilter:function(e,t){return e===t.owner},sorter:function(e,t){return e.owner.localeCompare(t.owner)},render:function(e,t){return(0,l.jsx)("a",{onClick:function(){return n("/query/account?search=".concat(t.owner,"&tab=info"))},children:t.owner})}},{title:"持有数量(".concat(x,")"),dataIndex:"number",key:"number",sorter:function(e,t){return e.number-t.number},search:!1,render:function(e,t){return(0,l.jsx)("div",{children:t.number})}},{title:"持有占比",dataIndex:"percent",key:"percent",search:!1,render:function(e,t){return(0,l.jsxs)("div",{children:[t.percent.toFixed(2),"%"]})}},{title:"账号余额(".concat(f.toFixed(0),")"),dataIndex:"balance",key:"balance",search:!1,render:function(e,t){return(0,l.jsx)("div",{children:t.balance})}},{title:"投入成本(".concat(d.toFixed(0),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,l.jsx)("div",{children:t.investAsset})}},{title:"卖出利润(".concat(p.toFixed(0),")"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,l.jsx)("div",{children:t.profitAsset})}},{title:"销毁奖励(DFS本位)",dataIndex:"burnRewardDfs",key:"burnRewardDfs",search:!1,render:function(e,t){return(0,l.jsxs)("div",{children:[(0,k.CE)(t.burnRewardDfs)," DFS"]})}},{title:"销毁奖励(USDT本位)",dataIndex:"burnRewardUsdt",key:"burnRewardUsdt",search:!1,render:function(e,t){return(0,l.jsxs)("div",{children:[(0,k.CE)(t.burnRewardUsdt)," USDT"]})}}]}),[c,p,d,i,x]),S=(0,r.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,n){return(0,l.jsx)("span",{children:n+1})}},{title:"名称",dataIndex:"sym",key:"sym",render:function(e,t){var n=t.logo;return(0,l.jsxs)("div",{children:[(0,l.jsx)(q.C,{className:"mr-2",size:"default",src:n}),(0,l.jsx)("span",{children:t.sym})]})}},{title:"数量",dataIndex:"balance",key:"balance",render:function(e,t){return(0,l.jsx)("div",{children:t.balance})}},{title:"价值(DFS本位)",dataIndex:"dfsValue",key:"dfsValue",render:function(e,t){return(0,l.jsxs)("div",{children:[(0,k.CE)(t.dfsValue)," DFS"]})}},{title:"价值(USDT本位)",dataIndex:"usdtValue",key:"usdtValue",render:function(e,t){return(0,l.jsxs)("div",{children:[(0,k.CE)(t.usdtValue)," USDT"]})}}]}),[]);return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"ppp-tab-pool mt-2",children:[(0,l.jsx)("div",{className:" font-semibold text-base hardline ml-2 mb-1",children:"奖励池"}),(0,l.jsx)(E.Z,{loading:{spinning:u,size:"large"},scroll:{x:!0},size:"small",columns:S,dataSource:m,defaultData:[],search:!1,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1,summary:function(e){var t=0,n=0;return e.forEach((function(e){t+=e.usdtValue,n+=e.dfsValue})),(0,l.jsxs)(L.Z.Summary.Row,{children:[(0,l.jsx)(L.Z.Summary.Cell,{index:0}),(0,l.jsx)(L.Z.Summary.Cell,{index:1,children:(0,l.jsx)("span",{className:"font-semibold",children:"汇 总"})}),(0,l.jsx)(L.Z.Summary.Cell,{index:2}),(0,l.jsx)(L.Z.Summary.Cell,{index:3,children:(0,l.jsxs)("span",{className:"font-semibold",children:[(0,k.CE)(n)," DFS"]})}),(0,l.jsx)(L.Z.Summary.Cell,{index:4,children:(0,l.jsxs)("span",{className:"font-semibold",children:[(0,k.CE)(t)," USDT"]})})]})}})]}),(0,l.jsxs)("div",{className:"ppp-tab-rank mt-3",children:[(0,l.jsx)("div",{className:"font-semibold text-base hardline ml-2",children:"持有者排名"}),(0,l.jsx)(E.Z,{loading:{spinning:u,size:"large"},scroll:{x:!0},size:"small",columns:g,dataSource:a,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:j},onSubmit:b,onReset:y,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1})]}),109===o&&(0,l.jsx)(H.Z,{icon:(0,l.jsx)(G.Z,{}),type:"primary",style:{insetInlineEnd:50},onClick:function(){return h.current.handleOpen()}}),(0,l.jsx)(R,{ref:h})]})},$=(0,r.memo)(W),K=n(5621),X=n(38345),J=n(6466),Q=n(57953),ee=n(71230),te=n(15746),ne=n(96074),re=n(9669),ae=n.n(re);C().extend(P());var se=function(e){var t=(0,w.useDispatch)(),n=N.ZP.useMessage(),a=s()(n,2),o=a[0],c=a[1],u=(0,w.useNavigate)(),i=(0,w.useSelector)((function(e){return e.global.host})),d=(0,w.useSelector)((function(e){return e.global.contractKit})),p=(0,r.useState)(!1),f=s()(p,2),x=f[0],v=f[1],b=(0,w.useSelector)((function(e){return e.statistics.holderDataSource})),y=(0,w.useSelector)((function(e){return e.statistics.holderDataSourceReset})),j=(0,w.useSelector)((function(e){return e.ppp.projectToken})),g=(0,w.useSelector)((function(e){return e.ppp.project})),S=(0,r.useState)(0),D=s()(S,2),I=D[0],C=D[1],F=(0,r.useState)(0),R=s()(F,2),T=R[0],M=R[1],P=(0,r.useState)(0),Z=s()(P,2),_=Z[0],Y=Z[1],O=(0,r.useState)(0),z=s()(O,2),U=z[0],H=z[1],A=(0,w.useIntl)(),B=A.formatMessage({id:"tokens.intlHolder"}),q=A.formatMessage({id:"tokens.intlHold"}),L=A.formatMessage({id:"tokens.intlLiq"}),G=A.formatMessage({id:"tokens.intlTotalValue"}),W=A.formatMessage({id:"tokens.intlRatio"}),$=A.formatMessage({id:"tokens.intlSupply"}),re=A.formatMessage({id:"tokens.intlMarketCap"}),se=A.formatMessage({id:"tokens.intlPrice"}),oe=A.formatMessage({id:"tokens.intlRank"}),ce=A.formatMessage({id:"tokens.intlUpdate"}),ue=A.formatMessage({id:"tokens.intlTotalBal"}),ie=(0,r.useCallback)(function(){var e=h()(m()().mark((function e(t){var n,r,a,c,u,l,d,p,f,x;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=1e3,a="",c="";case 4:return e.next=7,(0,k.zI)(ae().post("".concat(i,"/v2/chain/get_scope_rows"),{code:j.contract,table:"accounts",lower_bound:a,primary_lower_bound:c,limit:r,index_position:"primary",key_type:"name"}));case 7:if(u=e.sent,l=s()(u,2),d=l[0],p=l[1],d||200!==p.status){e.next=22;break}for(f=p.data.rows,x=0;x<f.length;++x)f[x].data.balance.split(" ")[1]===t&&n.push({account:f[x].scope,balance:f[x].data.balance});if(!p.data.more){e.next=19;break}a=p.data.next_key,c=p.data.next_primary_key,e.next=20;break;case 19:return e.abrupt("break",26);case 20:e.next=24;break;case 22:return o.error(d),e.abrupt("break",26);case 24:e.next=4;break;case 26:return e.abrupt("return",n);case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[o,j]),le=(0,r.useCallback)(h()(m()().mark((function e(){var t,n,r,a,s,o,c;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.load("swapswapswap");case 2:return t=e.sent,n=t.table("markets"),e.next=6,n.all();case 6:return r=e.sent,a=r.find((function(e){return e.mid.toNumber()===Number(j.mid)})),"usdtusdtusdt-USDT",o="eosio.token-DFS",c=[],(s={})["usdtusdtusdt-USDT"]=1,s[o]=(0,k.ri)(r[0].reserve0)/(0,k.ri)(r[0].reserve1),r.forEach((function(e){var t=e.contract0.toString()+"-"+e.sym0.toString().split(",")[1],n=e.contract1.toString()+"-"+e.sym1.toString().split(",")[1],r=(0,k.ri)(e.reserve0),a=(0,k.ri)(e.reserve1);"eosio.token"===e.contract0.toString()?s.hasOwnProperty(n)||(s[n]=r/a*s[o]):"eosio.token"===e.contract1.toString()?s.hasOwnProperty(t)||(s[t]=a/r*s[o]):"usdtusdtusdt"===e.contract0.toString()?s.hasOwnProperty(n)||(s[n]=r/a):"usdtusdtusdt"===e.contract1.toString()?s.hasOwnProperty(t)||(s[t]=a/r):c.push({key0:t,key1:n,value0:r,value1:a})})),c.forEach((function(e){s.hasOwnProperty(e.key0)&&!s.hasOwnProperty(e.key1)?s[e.key1]=e.value0/e.value1*s[e.key0]:!s.hasOwnProperty(e.key0)&&s.hasOwnProperty(e.key1)?s[e.key0]=e.value1/e.value0*s[e.key1]:s.hasOwnProperty(e.key0)||s.hasOwnProperty(e.key1)||(s[e.key0]=0,s[e.key1]=0)})),e.abrupt("return",{tokenPriceMap:s,marketData:a});case 17:case"end":return e.stop()}}),e)}))),[d,j]),de=(0,r.useCallback)(h()(m()().mark((function e(){var t,n,r;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.load("swapswapswap");case 2:return t=e.sent,n=t.table("liquidity"),e.next=6,n.all({scope:j.mid});case 6:return r=e.sent,e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)}))),[d,j]),pe=(0,r.useCallback)(h()(m()().mark((function e(){var t,n,r;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.load(j.contract);case 2:return t=e.sent,n=t.table("stat"),e.next=6,n.all({scope:j.symbol});case 6:return r=e.sent,e.abrupt("return",[parseFloat(r[0].supply.toString()),parseFloat(r[0].max_supply.toString())]);case 8:case"end":return e.stop()}}),e)}))),[d,j]),fe=(0,r.useCallback)(h()(m()().mark((function e(){var n,r,a,c,u,i,l,d,p,f,x,h,b,y;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,v(!0),n={},r={},a=[],e.next=7,le();case 7:return c=e.sent,u=c.tokenPriceMap,i=c.marketData,e.next=12,ie(j.symbol);case 12:return l=e.sent,e.next=15,de();case 15:return d=e.sent,e.next=18,pe();case 18:for(p=e.sent,f=s()(p,1),x=f[0],l.forEach((function(e){n[e.account]=Number(e.balance.split(" ")[0])})),d.forEach((function(e){var t=parseFloat(i.liquidity_token.toString()),n=parseFloat(i.reserve0.value.toString()),a=parseFloat(i.reserve1.value.toString()),s=parseFloat(e.token.toString())/t,o=0;o=i.sym0.toString()===j.symbol?n*s:a*s;var c=e.owner.toString();r[c]=o})),h=j.contract+"-"+j.symbol,Object.keys(n).forEach((function(e,t){var s=n[e],o=r[e]?r[e]:0;s+o>0&&a.push({key:t,rank:t,account:e,hold:s,liq:o,totalBal:s+o,value:(s+o)*u[h],ratio:(s+o)/x})})),b=a.sort((function(e,t){return t.value-e.value})),y=0;y<b.length;y++)b[y].rank=y;t(K.N.setHolderDataSource(b)),t(K.N.setHolderDataSourceReset(b)),C(b.length),M(x*u[h]),Y(x),H(u[h]),v(!1),e.next=40;break;case 36:e.prev=36,e.t0=e.catch(0),v(!1),(0,k.Tv)(e.t0,o,"handleGetHolder");case 40:case"end":return e.stop()}}),e,null,[[0,36]])}))),[ie,le,pe,de,j]),me=(0,r.useCallback)((function(e){var n=e.account,r=b.filter((function(e){return e.account===n}));t(K.N.setHolderDataSource(r))}),[b]),xe=(0,r.useCallback)((function(){t(K.N.setHolderDataSource(y))}),[y]),he=(0,r.useMemo)((function(){return[{title:"".concat(oe),dataIndex:"key",key:"key",search:!1,render:function(e,t){return(0,l.jsx)("span",{children:t.rank+1})}},{title:"".concat(B),dataIndex:"account",key:"account",render:function(e,t){return(0,l.jsx)("a",{onClick:function(){return u("/query/account?search=".concat(t.account,"&tab=info"))},children:t.account})}},{title:"".concat(q),dataIndex:"hold",key:"hold",search:!1,sorter:function(e,t){return t.hold-e.hold},render:function(e,t){return(0,l.jsx)("span",{children:(0,k.CE)(t.hold)})}},{title:"".concat(L," (").concat(j.pair,")"),dataIndex:"liq",key:"liq",search:!1,sorter:function(e,t){return t.liq-e.liq},render:function(e,t){return(0,l.jsx)("span",{children:(0,k.CE)(t.liq)})}},{title:"".concat(ue),dataIndex:"totalBal",key:"totalBal",search:!1,sorter:function(e,t){return t.totalBal-e.totalBal},render:function(e,t){return(0,l.jsx)("span",{children:(0,k.CE)(t.totalBal)})}},{title:"".concat(G),dataIndex:"value",key:"value",search:!1,sorter:function(e,t){return t.value-e.value},render:function(e,t){return(0,l.jsx)("span",{children:(0,k.CE)(t.value,"$")})}},{title:"".concat(W),dataIndex:"ratio",key:"ratio",search:!1,sorter:function(e,t){return t.ratio-e.ratio},render:function(e,t){return(0,l.jsxs)("span",{children:[(0,k.CE)(100*t.ratio),"%"]})}}]}),[j]);return(0,r.useEffect)((function(){d&&g.mid&&fe()}),[d,fe,g]),(0,l.jsxs)("div",{className:"ppp-tab-token",children:[(0,l.jsx)(Q.Z,{size:"large",spinning:x,children:(0,l.jsx)(X.Z,{headerBordered:!0,headStyle:{justifyContent:"center"},className:"",children:(0,l.jsxs)(ee.Z,{gutter:10,children:[(0,l.jsx)(te.Z,{lg:{span:"6"},md:{span:"12"},sm:{span:"12"},xs:{span:"12"},children:(0,l.jsx)(J.Z,{layout:"center",statistic:{title:(0,l.jsx)("div",{className:"text-center",children:$}),value:(0,k.CE)(_)}})}),(0,l.jsx)(te.Z,{lg:{span:"6"},md:{span:"12"},sm:{span:"12"},xs:{span:"12"},children:(0,l.jsx)(J.Z,{layout:"center",statistic:{title:(0,l.jsx)("div",{className:"text-center",children:se}),value:(0,k.CE)(U,"$")}})}),(0,l.jsx)(te.Z,{lg:{span:"6"},md:{span:"12"},sm:{span:"12"},xs:{span:"12"},children:(0,l.jsx)(J.Z,{layout:"center",statistic:{title:(0,l.jsx)("div",{className:"text-center",children:re}),value:(0,k.CE)(T,"$")}})}),(0,l.jsx)(te.Z,{lg:{span:"6"},md:{span:"12"},sm:{span:"12"},xs:{span:"12"},children:(0,l.jsx)(J.Z,{layout:"center",statistic:{title:(0,l.jsx)("div",{className:"text-center",children:B}),value:I}})})]})})}),(0,l.jsx)(ne.Z,{className:"my-2"}),(0,l.jsx)(E.Z,{className:"mb-3",scroll:{x:!0},size:"small",columns:he,dataSource:b,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:function(e,t,n){return[n[1],(0,l.jsx)(V.ZP,{onClick:function(){v(!0),fe()},children:ce},"update"),n[0]]}},onSubmit:me,onReset:xe,options:!1,pagination:{pageSize:100},tableAlertRender:!1,tableAlertOptionRender:!1,loading:{spinning:x,size:"large"}}),c]})},oe=(0,r.memo)(se),ce=n(97857),ue=n.n(ce),ie=n(98165),le=n(80507);C().extend(P());var de=function(){var e=N.ZP.useMessage(),t=s()(e,2),n=t[0],a=t[1],o=(0,w.useNavigate)(),c=(0,w.useDispatch)(),u=(0,w.useSelector)((function(e){return e.global.session})),i=(0,w.useSelector)((function(e){return e.ppp.projectSwapLog})),d=(0,w.useSelector)((function(e){return e.ppp.project})),p=(0,w.useSelector)((function(e){return e.ppp.pppTokenLogos})),f=(0,r.useState)(!1),x=s()(f,2),v=x[0],b=x[1],y=(0,r.useState)(!1),j=s()(y,2),g=j[0],S=j[1],D=(0,r.useState)(""),I=s()(D,2),F=I[0],R=I[1],T=(0,r.useState)([]),M=s()(T,2),P=M[0],Z=M[1],_=(0,r.useState)([]),Y=s()(_,2),O=Y[0],U=Y[1],V=(0,r.useState)([]),H=s()(V,2),A=H[0],B=H[1],L=(0,r.useRef)(0),G=(0,w.useIntl)(),W=G.formatMessage({id:"swaplog.intlUser"}),$=G.formatMessage({id:"swaplog.intlFrom"}),K=G.formatMessage({id:"swaplog.intlTo"}),X=G.formatMessage({id:"swaplog.intlTime"}),J=(0,r.useCallback)(function(){var e=h()(m()().mark((function e(t){var r,a,o,u,i,l,f,x,h,v,y,j,g,S,w,N,D,I,F,T,M;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=[],a=[],o=[],u=[],i=d.mid,l=d.tokenName,e.next=9,t.client.v1.chain.get_table_rows({code:"loglogloglog",table:"logs",scope:"loglogloglog",lower_bound:le.zM.from(i),upper_bound:le.zM.from(i),index_position:"secondary",key_type:"i64",limit:100,reverse:!0});case 9:for(f=e.sent,x=0;x<f.rows.length;x++)h=f.rows[x],v=h.in.split(" "),y=s()(v,2),j=y[0],g=y[1],S=h.out.split(" "),w=s()(S,2),N=w[0],D=w[1],I="",F="",T="",M=0,l===g?(I="Buy",F=p[D],T=h.out,M=Number(N)):(I="Sell",F=p[g],T=h.in,M=Number(j)),r.push(ue()(ue()({},h),{},{key:x,create_time:C().utc(h.create_time).local().format("MM-DDTHH:mm:ss"),inSym:g,outSym:D,inAmount:Number(j),outAmount:Number(N),type:I,logo:F,amount:T,amountValue:M}));r.forEach((function(e){a.includes(e.inSym)||a.push(e.inSym),o.includes(e.outSym)||o.push(e.outSym),u.includes(e.user)||u.push(e.user)})),Z(a.sort()),U(o.sort()),B(u.sort()),c(z.N.setProjectSwapLog(r)),R(C()().format("YYYY-MM-DDTHH:mm:ss")),b(!1),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(0),b(!1),(0,k.Tv)(e.t0,n,"handleGetSwapLog");case 24:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(t){return e.apply(this,arguments)}}(),[n,d,p]),Q=(0,r.useCallback)(h()(m()().mark((function e(){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!d.mid){e.next=6;break}return S(!0),e.next=4,J(u);case 4:S(!1),R(C()().format("YYYY-MM-DDTHH:mm:ss"));case 6:case"end":return e.stop()}}),e)}))),[J,u,d]);(0,r.useEffect)((function(){u&&d.mid&&(i.length?b(!1):b(!0),J(u))}),[u,d,J]),(0,r.useEffect)((function(){return u&&d.mid&&(L.current=setInterval(Q,5e3)),function(){return clearInterval(L.current)}}),[Q,u,d]);var ee=(0,r.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t){return(0,l.jsx)("span",{children:t.key+1})}},{title:"".concat(W),dataIndex:"user",key:"user",sorter:function(e,t){return e.user.localeCompare(t.user)},filters:A.map((function(e){return{text:e,value:e}})),onFilter:function(e,t){return e===t.user},render:function(e,t){return(0,l.jsx)("a",{onClick:function(){return o("/query/account?search=".concat(t.user,"&tab=info"))},children:t.user})}},{title:"".concat(X),dataIndex:"create_time",key:"create_time",sorter:function(e,t){return C().utc(e.create_time).unix()-C().utc(t.create_time).unix()},render:function(e,t){return(0,l.jsx)("span",{children:t.create_time})}},{title:"操作",dataIndex:"type",key:"type",render:function(e,t){return"Sell"===t.type?(0,l.jsx)("span",{className:" text-red-600",children:t.type}):(0,l.jsx)("span",{className:" text-green-600",children:t.type})}},{title:"数量",dataIndex:"amount",key:"amount",sorter:function(e,t){return t.amountValue-e.amountValue},render:function(e,t){return(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(q.C,{className:"mr-2",src:t.logo}),(0,l.jsx)("div",{children:t.amount})]})}},{title:"".concat($),dataIndex:"in",key:"in",filters:P.map((function(e){return{text:e,value:e}})),onFilter:function(e,t){return e===t.inSym},sorter:function(e,t){return t.inAmount-e.inAmount},render:function(e,t){return(0,l.jsx)("span",{children:t.in})}},{title:"".concat(K),dataIndex:"to",key:"to",filters:O.map((function(e){return{text:e,value:e}})),onFilter:function(e,t){return e===t.outSym},sorter:function(e,t){return t.outAmount-e.outAmount},render:function(e,t){return(0,l.jsx)("span",{children:t.out})}}]}),[P,O,A]);return(0,l.jsxs)("div",{className:"ppp-tab-swaplog",children:[(0,l.jsx)("div",{className:"flex justify-between items-center",children:(0,l.jsxs)("div",{children:[(0,l.jsx)(ie.Z,{spin:g,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:Q}),(0,l.jsx)("span",{className:"ml-[8px]",children:F})]})}),(0,l.jsx)(E.Z,{className:"mb-3",scroll:{x:!0},size:"small",columns:ee,dataSource:i,defaultData:[],search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,loading:{spinning:v,size:"large"}}),a]})},pe=(0,r.memo)(de);C().extend(P());var fe=function(){var e=N.ZP.useMessage(),t=s()(e,2),n=t[0],a=t[1],o=(0,w.useNavigate)(),c=(0,w.useDispatch)(),u=(0,w.useSelector)((function(e){return e.global.session})),i=(0,w.useSelector)((function(e){return e.ppp.projectDonateLog})),d=(0,w.useSelector)((function(e){return e.ppp.project})),p=(0,w.useSelector)((function(e){return e.ppp.pppTokenLogos})),f=(0,w.useSelector)((function(e){return e.ppp.tokenPriceMap})),x=(0,r.useState)(!1),v=s()(x,2),b=v[0],y=v[1],j=(0,r.useState)(!1),g=s()(j,2),S=g[0],D=g[1],I=(0,r.useState)(""),F=s()(I,2),R=F[0],T=F[1],M=(0,r.useState)([]),P=s()(M,2),Z=P[0],_=P[1],Y=(0,r.useState)([]),O=s()(Y,2),U=O[0],V=O[1],H=(0,w.useIntl)(),A=H.formatMessage({id:"swaplog.intlUser"}),B=H.formatMessage({id:"swaplog.intlTime"}),L=(0,r.useCallback)(function(){var e=h()(m()().mark((function e(t){var r,a,o,u,i,l,x,h,v,b,j,g,S,w,N,D,I,F,R;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=[],a=[],o=[],u=d.id.toString(),e.next=7,t.client.v1.chain.get_table_rows({code:"dfspppreward",table:"donatelogs",scope:u,limit:1e3,reverse:!0,key_type:"i64"});case 7:for(i=e.sent,l=0;l<i.rows.length;l++)x=i.rows[l],h=x.from,v=x.quantity,b=v.split(" "),j=s()(b,2),g=j[0],S=j[1],w="",N=Number(g),D=x.memo,I=C().utc(x.time).local().format("YYYY-MM-DDTHH:mm:ss"),0,R="","DFS"===S?(w="https://dfs.land/assets/tokens/eosio.token-DFS.png",R="eosio.token-DFS-8"):"USDT"===S?(w="https://dfs.land/assets/tokens/usdtusdtusdt-USDT.png",R="usdtusdtusdt-USDT-8"):"BTC"===S?(w="https://dfs.land/assets/tokens/btcbtcbtcbtc-BTC.png",R="btcbtcbtcbtc-BTC-8"):(w=p[S],R="dfsppptokens-".concat(S,"-8")),F=f[R]*N,r.push({key:l,user:h,quantity:v,symbol:S,memo:D,time:I,logo:w,amount:g,amountValue:N,value:F});r.forEach((function(e){a.includes(e.symbol)||a.push(e.symbol),o.includes(e.user)||o.push(e.user)})),_(a.sort()),V(o.sort()),c(z.N.setProjectDonateLog(r)),T(C()().format("YYYY-MM-DDTHH:mm:ss")),y(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),y(!1),(0,k.Tv)(e.t0,n,"handleGetDonateLog");case 21:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t){return e.apply(this,arguments)}}(),[n,d,p,f]),G=(0,r.useCallback)(h()(m()().mark((function e(){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!d.mid){e.next=6;break}return D(!0),e.next=4,L(u);case 4:D(!1),T(C()().format("YYYY-MM-DDTHH:mm:ss"));case 6:case"end":return e.stop()}}),e)}))),[L,u,d]);(0,r.useEffect)((function(){u&&d.mid&&(i.length?y(!1):y(!0),L(u))}),[u,d,L]);var W=(0,r.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t){return(0,l.jsx)("span",{children:t.key+1})}},{title:"".concat(A),dataIndex:"user",key:"user",sorter:function(e,t){return e.user.localeCompare(t.user)},filters:U.map((function(e){return{text:e,value:e}})),onFilter:function(e,t){return e===t.user},render:function(e,t){return(0,l.jsx)("a",{onClick:function(){return o("/query/account?search=".concat(t.user,"&tab=info"))},children:t.user})}},{title:"".concat(B),dataIndex:"time",key:"time",sorter:function(e,t){return C().utc(e.time).unix()-C().utc(t.time).unix()},render:function(e,t){return(0,l.jsx)("span",{children:t.time})}},{title:"数量",dataIndex:"amount",key:"amount",sorter:function(e,t){return t.amountValue-e.amountValue},filters:Z.map((function(e){return{text:e,value:e}})),onFilter:function(e,t){return e===t.symbol},render:function(e,t){return(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(q.C,{className:"mr-2",src:t.logo}),(0,l.jsx)("div",{children:t.quantity})]})}},{title:"价值",dataIndex:"value",key:"value",sorter:function(e,t){return t.value-e.value},render:function(e,t){return(0,l.jsx)("span",{children:(0,k.CE)(t.value,"$")})}},{title:"留言",dataIndex:"memo",key:"memo",render:function(e,t){return(0,l.jsx)("span",{children:t.memo})}}]}),[Z,U]);return(0,l.jsxs)("div",{className:"ppp-tab-donate-log",children:[(0,l.jsx)("div",{className:"flex justify-between items-center",children:(0,l.jsxs)("div",{children:[(0,l.jsx)(ie.Z,{spin:S,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:G}),(0,l.jsx)("span",{className:"ml-[8px]",children:R})]})}),(0,l.jsx)(E.Z,{className:"mb-3",scroll:{x:!0},size:"small",columns:W,dataSource:i,defaultData:[],search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,loading:{spinning:b,size:"large"}}),a]})},me=(0,r.memo)(fe);C().extend(P());var xe=function(){var e=N.ZP.useMessage(),t=s()(e,2),n=t[0],a=t[1],o=(0,w.useNavigate)(),c=(0,w.useDispatch)(),u=(0,w.useSelector)((function(e){return e.global.session})),i=(0,w.useSelector)((function(e){return e.ppp.projectDonateRank})),d=(0,w.useSelector)((function(e){return e.ppp.project})),p=(0,w.useSelector)((function(e){return e.ppp.pppTokenLogos})),f=(0,w.useSelector)((function(e){return e.ppp.tokenPriceMap})),x=(0,r.useState)(0),v=s()(x,2),b=v[0],y=v[1],j=(0,r.useState)(0),g=s()(j,2),S=g[0],D=g[1],I=(0,r.useState)(0),F=s()(I,2),R=F[0],T=F[1],M=(0,r.useState)(0),P=s()(M,2),Z=P[0],_=P[1],Y=(0,r.useState)(!1),O=s()(Y,2),U=O[0],V=O[1],H=(0,r.useState)(!1),A=s()(H,2),B=A[0],L=A[1],G=(0,r.useState)(""),W=s()(G,2),$=W[0],K=W[1],X=(0,r.useState)([]),J=s()(X,2),Q=J[0],ee=J[1],te=(0,w.useIntl)().formatMessage({id:"swaplog.intlUser"}),ne=(0,r.useCallback)(function(){var e=h()(m()().mark((function e(t){var r,a,o,u,i,l,x,h,v,b,j,g,S,w,N,I,F,R,M,P,Z,E,Y,O;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=[],a=[],o={},u=[],i=d.id.toString(),e.next=8,t.client.v1.chain.get_table_rows({code:"dfspppreward",table:"donatelogs",scope:i,limit:1e3,reverse:!0,key_type:"i64"});case 8:for(l=e.sent,x=0;x<l.rows.length;x++)h=l.rows[x],v=h.from,b=h.quantity,j=b.split(" "),g=s()(j,2),S=g[0],w=g[1],N="",I=Number(S),F=h.memo,R=C().utc(h.time).local().format("YYYY-MM-DDTHH:mm:ss"),0,P="","DFS"===w?(N="https://dfs.land/assets/tokens/eosio.token-DFS.png",P="eosio.token-DFS-8"):"USDT"===w?(N="https://dfs.land/assets/tokens/usdtusdtusdt-USDT.png",P="usdtusdtusdt-USDT-8"):"BTC"===w?(N="https://dfs.land/assets/tokens/btcbtcbtcbtc-BTC.png",P="btcbtcbtcbtc-BTC-8"):(N=p[w],P="dfsppptokens-".concat(w,"-8")),M=f[P]*I,r.push({key:x,user:v,quantity:b,symbol:w,memo:F,time:R,logo:N,amount:S,amountValue:I,value:M});r.forEach((function(e){u.includes(e.user)||u.push(e.user),o.hasOwnProperty(e.user)?("DFS"===e.symbol?o[e.user].dfs+=e.amountValue:"USDT"===e.symbol?o[e.user].usdt+=e.amountValue:"BTC"===e.symbol?o[e.user].btc+=e.amountValue:o[e.user].ppp+=e.amountValue,o[e.user].value+=e.value):(o[e.user]={dfs:0,usdt:0,btc:0,ppp:0,value:0},"DFS"===e.symbol?o[e.user].dfs=e.amountValue:"USDT"===e.symbol?o[e.user].usdt=e.amountValue:"BTC"===e.symbol?o[e.user].btc=e.amountValue:o[e.user].ppp=e.amountValue,o[e.user].value=e.value)})),Z=0,E=0,Y=0,O=0,Object.keys(o).forEach((function(e,t){Z+=o[e].dfs,E+=o[e].usdt,Y+=o[e].btc,O+=o[e].ppp,a.push({key:t,user:e,dfs:o[e].dfs,usdt:o[e].usdt,btc:o[e].btc,ppp:o[e].ppp,valueUsdt:o[e].value,valueDfs:o[e].value/f["eosio.token-DFS-8"]})})),a.sort((function(e,t){return t.valueUsdt-e.valueUsdt})),T(Y),ee(u.sort()),D(E),y(Z),_(O),c(z.N.setProjectDonateLog(r)),c(z.N.setProjectDonateRank(a)),K(C()().format("YYYY-MM-DDTHH:mm:ss")),V(!1),e.next=32;break;case 28:e.prev=28,e.t0=e.catch(0),V(!1),(0,k.Tv)(e.t0,n,"handleGetDonateLog");case 32:case"end":return e.stop()}}),e,null,[[0,28]])})));return function(t){return e.apply(this,arguments)}}(),[n,d,p,f]),re=(0,r.useCallback)(h()(m()().mark((function e(){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!d.mid){e.next=6;break}return L(!0),e.next=4,ne(u);case 4:L(!1),K(C()().format("YYYY-MM-DDTHH:mm:ss"));case 6:case"end":return e.stop()}}),e)}))),[ne,u,d]);(0,r.useEffect)((function(){u&&d.mid&&(i.length?V(!1):V(!0),ne(u))}),[u,d,ne]);var ae=(0,r.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,n){return(0,l.jsx)("span",{children:n+1})}},{title:"".concat(te),dataIndex:"user",key:"user",sorter:function(e,t){return e.user.localeCompare(t.user)},filters:Q.map((function(e){return{text:e,value:e}})),onFilter:function(e,t){return e===t.user},render:function(e,t){return(0,l.jsx)("a",{onClick:function(){return o("/query/account?search=".concat(t.user,"&tab=info"))},children:t.user})}},{title:"总价值(USDT)",dataIndex:"value",key:"value",sorter:function(e,t){return e.valueUsdt-t.valueUsdt},render:function(e,t){return(0,l.jsx)("span",{children:(0,k.CE)(t.valueUsdt)})}},{title:"总价值(DFS)",dataIndex:"value",key:"value",sorter:function(e,t){return e.valueDfs-t.valueDfs},render:function(e,t){return(0,l.jsx)("span",{children:(0,k.CE)(t.valueDfs)})}},{title:"DFS(".concat(b.toFixed(0),")"),dataIndex:"dfs",key:"dfs",sorter:function(e,t){return t.dfs-e.dfs},render:function(e,t){return(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(q.C,{className:"mr-2",src:"https://dfs.land/assets/tokens/eosio.token-DFS.png"}),(0,l.jsx)("div",{children:t.dfs.toFixed(8)+" DFS"})]})}},{title:"".concat(d.tokenNameRelease,"(").concat(Z.toFixed(0),")"),dataIndex:"ppp",key:"ppp",sorter:function(e,t){return t.ppp-e.ppp},render:function(e,t){return(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(q.C,{className:"mr-2",src:p[d.tokenNameRelease]}),(0,l.jsx)("div",{children:t.ppp.toFixed(8)+" ".concat(d.tokenNameRelease)})]})}},{title:"BTC(".concat(R.toFixed(4),")"),dataIndex:"btc",key:"btc",sorter:function(e,t){return t.btc-e.btc},render:function(e,t){return(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(q.C,{className:"mr-2",src:"https://dfs.land/assets/tokens/btcbtcbtcbtc-BTC.png"}),(0,l.jsx)("div",{children:t.btc.toFixed(8)+" BTC"})]})}},{title:"USDT(".concat(S.toFixed(0),")"),dataIndex:"usdt",key:"usdt",sorter:function(e,t){return t.usdt-e.usdt},render:function(e,t){return(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(q.C,{className:"mr-2",src:"https://dfs.land/assets/tokens/usdtusdtusdt-USDT.png"}),(0,l.jsx)("div",{children:t.usdt.toFixed(8)+" USDT"})]})}}]}),[Q,d,p,R,b,Z,S]);return(0,l.jsxs)("div",{className:"ppp-tab-donate-rank",children:[(0,l.jsx)("div",{className:"flex justify-between items-center",children:(0,l.jsxs)("div",{children:[(0,l.jsx)(ie.Z,{spin:B,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:re}),(0,l.jsx)("span",{className:"ml-[8px]",children:$})]})}),(0,l.jsx)(E.Z,{className:"mb-3",scroll:{x:!0},size:"small",columns:ae,dataSource:i,defaultData:[],search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,loading:{spinning:U,size:"large"}}),a]})},he=(0,r.memo)(xe)}}]);