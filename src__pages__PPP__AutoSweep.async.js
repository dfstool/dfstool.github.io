"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1477],{22452:function(e,t,r){var n=r(1413),s=r(91),o=r(62435),a=r(66758),c=r(56499),i=r(86074),u=["fieldProps","proFieldProps"],l="dateTime",d=o.forwardRef((function(e,t){var r=e.fieldProps,d=e.proFieldProps,p=(0,s.Z)(e,u),f=(0,o.useContext)(a.Z);return(0,i.jsx)(c.Z,(0,n.Z)({ref:t,fieldProps:(0,n.Z)({getPopupContainer:f.getPopupContainer},r),valueType:l,proFieldProps:d,filedConfig:{valueType:l,customLightMode:!0}},p))}));t.Z=d},64317:function(e,t,r){var n=r(1413),s=r(91),o=r(22270),a=r(62435),c=r(66758),i=r(56499),u=r(86074),l=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],p=function(e,t){var r=e.fieldProps,d=e.children,p=e.params,f=e.proFieldProps,m=e.mode,h=e.valueEnum,v=e.request,x=e.showSearch,b=e.options,g=(0,s.Z)(e,l),j=(0,a.useContext)(c.Z);return(0,u.jsx)(i.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,o.h)(h),request:v,params:p,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({options:b,mode:m,showSearch:x,getPopupContainer:j.getPopupContainer},r),ref:t,proFieldProps:f},g),{},{children:d}))},f=a.forwardRef((function(e,t){var r=e.fieldProps,l=e.children,p=e.params,f=e.proFieldProps,m=e.mode,h=e.valueEnum,v=e.request,x=e.options,b=(0,s.Z)(e,d),g=(0,n.Z)({options:x,mode:m||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},r),j=(0,a.useContext)(c.Z);return(0,u.jsx)(i.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,o.h)(h),request:v,params:p,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({getPopupContainer:j.getPopupContainer},g),ref:t,proFieldProps:f},b),{},{children:l}))})),m=a.forwardRef(p);m.SearchSelect=f,m.displayName="ProFormComponent",t.Z=m},53944:function(e,t,r){r.r(t);var n=r(19632),s=r.n(n),o=r(97857),a=r.n(o),c=r(15009),i=r.n(c),u=r(99289),l=r.n(u),d=r(5574),p=r.n(d),f=r(80059),m=r(40956),h=r(64119),v=r(87603),x=r(25035),b=r(98165),g=r(11774),j=r(38345),k=r(97269),w=r(64317),A=r(31199),y=r(52688),S=r(22452),F=r(5966),Z=r(59530),N=r(80507),_=r(45360),C=r(83062),P=r(7134),T=r(66309),V=r(15867),M=r(9669),E=r.n(M),D=r(27484),Y=r.n(D),z=r(70178),L=r.n(z),q=r(62435),O=r(51409),R=r(86074);Y().extend(L());var H=[];t.default=function(){var e=(0,Z.useDispatch)(),t=_.ZP.useMessage(),r=p()(t,2),n=r[0],o=r[1],c=(0,Z.useSelector)((function(e){return e.global.contractKit})),u=(0,Z.useSelector)((function(e){return e.global.account})),d=(0,Z.useSelector)((function(e){return e.global.session})),M=(0,Z.useSelector)((function(e){return e.global.privateKey})),D=(0,Z.useSelector)((function(e){return e.ppp.valueEnum})),z=(0,Z.useSelector)((function(e){return e.ppp.stats})),L=(0,Z.useSelector)((function(e){return e.ppp.vipAccounts})),$=(0,Z.useSelector)((function(e){return e.ppp.accessAccounts})),I=(0,Z.useSelector)((function(e){return e.ppp.projects})),U=(0,q.useState)(0),W=p()(U,2),K=W[0],J=W[1],Q=(0,q.useState)(0),B=p()(Q,2),G=B[0],X=B[1],ee=(0,q.useState)(0),te=p()(ee,2),re=te[0],ne=te[1],se=(0,q.useState)(0),oe=p()(se,2),ae=oe[0],ce=oe[1],ie=(0,q.useState)(0),ue=p()(ie,2),le=ue[0],de=ue[1],pe=(0,q.useState)([]),fe=p()(pe,2),me=fe[0],he=fe[1],ve=(0,q.useState)(""),xe=p()(ve,2),be=xe[0],ge=xe[1],je=(0,q.useState)(""),ke=p()(je,2),we=ke[0],Ae=ke[1],ye=(0,q.useState)("2000-01-01T01:01:01"),Se=p()(ye,2),Fe=Se[0],Ze=Se[1],Ne=(0,q.useState)(0),_e=p()(Ne,2),Ce=_e[0],Pe=_e[1],Te=(0,q.useState)(0),Ve=p()(Te,2),Me=Ve[0],Ee=Ve[1],De=(0,q.useState)(!1),Ye=p()(De,2),ze=Ye[0],Le=Ye[1],qe=(0,q.useState)({}),Oe=p()(qe,2),Re=Oe[0],He=Oe[1],$e=(0,q.useState)({}),Ie=p()($e,2),Ue=Ie[0],We=Ie[1],Ke=(0,q.useState)(!1),Je=p()(Ke,2),Qe=Je[0],Be=Je[1],Ge=(0,q.useState)(!1),Xe=p()(Ge,2),et=Xe[0],tt=Xe[1],rt=(0,q.useState)(!1),nt=p()(rt,2),st=nt[0],ot=nt[1],at=(0,q.useState)(!1),ct=p()(at,2),it=ct[0],ut=ct[1],lt=(0,q.useState)(!1),dt=p()(lt,2),pt=dt[0],ft=dt[1],mt=(0,q.useState)(0),ht=p()(mt,2),vt=ht[0],xt=ht[1],bt=(0,q.useState)(!1),gt=p()(bt,2),jt=gt[0],kt=gt[1],wt=(0,q.useState)(!1),At=p()(wt,2),yt=At[0],St=At[1],Ft=(0,q.useState)(!1),Zt=p()(Ft,2),Nt=Zt[0],_t=Zt[1],Ct=(0,q.useState)(!1),Pt=p()(Ct,2),Tt=Pt[0],Vt=Pt[1],Mt=(0,q.useState)({}),Et=p()(Mt,2),Dt=Et[0],Yt=Et[1],zt=(0,q.useState)({}),Lt=p()(zt,2),qt=Lt[0],Ot=Lt[1],Rt=(0,Z.useIntl)(),Ht=Rt.formatMessage({id:"coffee.inputException"}),$t=Rt.formatMessage({id:"msig.intlTransactionEmpty"}),It=Rt.formatMessage({id:"common.intlPleaseConnectWallet"}),Ut=Rt.formatMessage({id:"common.intlPleaseConnectNetwork"}),Wt=(0,q.useRef)([]),Kt=(0,q.useRef)(!1),Jt=(0,q.useRef)({}),Qt=(0,q.useRef)(),Bt=(0,q.useRef)(0),Gt=(0,q.useRef)(!0),Xt=(0,q.useCallback)((function(){var e=0,t=0,r=0,n=0;for(var s in Jt.current)"success"===Jt.current[s].status?t+=1:"error"===Jt.current[s].status?r+=1:"processing"===Jt.current[s].status?n+=1:"default"===Jt.current[s].status&&(e+=1);J(t),X(r),ne(n),ce(e)}),[]),er=(0,q.useCallback)((function(e,t){var r=Y()(e).add(t,"seconds").valueOf();Ee(r)}),[]),tr=(0,q.useCallback)(function(){var e=l()(i()().mark((function e(t){var r,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n=Y()().format("YYYY-MM-DDTHH:mm:ss.SSS"),H.push({time:n}),t.forEach((function(e){if("success"!==Jt.current[e.cid].status&&"processing"!==Jt.current[e.cid].status&&("error"!==Jt.current[e.cid].status||!Jt.current[e.cid].message.includes("invalid price"))){var t=new Promise((function(t){Jt.current[e.cid].status="processing",Xt(),d.client.v1.chain.push_transaction(e.signedTransaction).then((function(r){r&&r.processed&&"executed"===r.processed.receipt.status?(Jt.current[e.cid].status="success",Xt(),t(!0)):("success"!==Jt.current[e.cid].status&&(Jt.current[e.cid].status="error",H.push({cid:e.cid,error:JSON.stringify(r),pos:"then"}),console.log(r),Xt()),t(!1))})).catch((function(r){if("success"!==Jt.current[e.cid].status){if(Jt.current[e.cid].status="error",Xt(),H.push({cid:e.cid,error:JSON.stringify(r),pos:"catch"}),r instanceof Error)if(r.message.includes("eosio_assert_message assertion failure"))r.details[0].message.includes("invalid price")&&(Jt.current[e.cid].message="invalid price");console.log(r)}t(!1)}))}));r.push(t)}}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[d,Xt]),rr=(0,q.useCallback)((function(e,t,r){if(1===t)e.sort((function(){return Math.random()-.5}));else if(2===t)e.sort((function(e,t){return Number(e.current_price.split(" ")[0])-Number(t.current_price.split(" ")[0])}));else if(3===t)e.sort((function(e,t){var r=Number(e.current_price.split(" ")[0]);return Number(t.current_price.split(" ")[0])-r}));else if(4===t)e.sort((function(e,t){return Y()(e.last_trade).valueOf()-Y()(t.last_trade).valueOf()}));else{if(5===t){var n=r.toFixed(8);return e.filter((function(e){return e.current_price.split(" ")[0]===n}))}if(6===t){var s,o=null===(s=Qt.current)||void 0===s?void 0:s.getFieldValue("accountsAuto");return o=o||[],e.filter((function(e){return o.includes(e.owner)}))}if(7===t){var a,c=null===(a=Qt.current)||void 0===a?void 0:a.getFieldValue("accountsAuto");c=c||[];var i=e.filter((function(e){return c.includes(e.owner)}));return i.sort((function(){return Math.random()-.5})),i}if(8===t){var u,l=null===(u=Qt.current)||void 0===u?void 0:u.getFieldValue("cidsAuto");return l=l||[],e.filter((function(e){return l.includes(e.cid.toString())}))}}return e}),[]),nr=(0,q.useCallback)(l()(i()().mark((function e(){var t,r,s,o,a,u,l,p,f,m;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=null===(t=Qt.current)||void 0===t?void 0:t.getFieldsValue(),s=r.pidAuto,o=Number(s.split("-")[1]),!c||!o){e.next=17;break}return kt(!0),e.next=7,d.client.v1.chain.get_table_rows({code:"dfs3protocol",table:"registry",scope:"dfs3protocol",key_type:"i64",index_position:"secondary",lower_bound:N.zM.from(o),upper_bound:N.zM.from(o),limit:2e3});case 7:u=e.sent,l=u.rows,p=new Set,l.forEach((function(e){p.add(e.owner)})),f=Array.from(p),m={},f.forEach((function(e){m[e]=e})),null===(a=Qt.current)||void 0===a||a.setFieldValue("accountsAuto",void 0),Yt(m),kt(!1);case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(0),kt(!0),(0,h.Tv)(e.t0,n,"handleHoldersUpdateAuto");case 23:case"end":return e.stop()}}),e,null,[[0,19]])}))),[c]),sr=(0,q.useCallback)(l()(i()().mark((function e(){var t,r,s,o,a,u,l,p;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=null===(t=Qt.current)||void 0===t?void 0:t.getFieldsValue(),s=r.pidAuto,o=Number(s.split("-")[1]),!c||!o){e.next=14;break}return St(!0),e.next=7,d.client.v1.chain.get_table_rows({code:"dfs3protocol",table:"registry",scope:"dfs3protocol",key_type:"i64",index_position:"secondary",lower_bound:N.zM.from(o),upper_bound:N.zM.from(o),limit:2e3});case 7:u=e.sent,l=u.rows,p={},l.forEach((function(e){p[e.cid]=e.cid})),null===(a=Qt.current)||void 0===a||a.setFieldValue("cidsAuto",void 0),Ot(p),St(!1);case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(0),St(!0),(0,h.Tv)(e.t0,n,"handleCidsUpdateAuto");case 20:case"end":return e.stop()}}),e,null,[[0,16]])}))),[c]),or=(0,q.useCallback)(function(){var e=l()(i()().mark((function e(t,r){var n,s,o,a,c,u,l;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.client.v1.chain.get_table_rows({code:"dfs3protocol",table:"registry",scope:"dfs3protocol",key_type:"i64",index_position:"secondary",lower_bound:N.zM.from(t),upper_bound:N.zM.from(t),limit:2e3});case 2:n=e.sent,s=n.rows,o=[],a=d.actor.toString(),c=0;case 7:if(!(c<s.length)){e.next=18;break}if(u=s[c].owner,l=Number(s[c].current_price.split(" ")[0]),u!==a){e.next=12;break}return e.abrupt("continue",15);case 12:if(!(l>=2*r)){e.next=14;break}return e.abrupt("continue",15);case 14:o.push(s[c]);case 15:++c,e.next=7;break;case 18:return e.abrupt("return",o);case 19:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),[d,u]),ar=(0,q.useCallback)(function(){var e=l()(i()().mark((function e(t){var r,s,o,a,l,p,f,m,v,x,b,g,j,k,w,A,y,S,F,Z,N,_,C,P,T,V,M,E,D,z,q;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,d&&d.broadcast){e.next=6;break}return n.error("".concat(It)),e.abrupt("return");case 6:if(u){e.next=9;break}return n.error("".concat(Ut)),e.abrupt("return");case 9:if("owner"===(s=d.permissionLevel.permission.toString())||"active"===s){e.next=13;break}return n.error("permission权限必须是owner或者active"),e.abrupt("return");case 13:return tt(!0),o=t.pidAuto,a=t.countAuto,l=t.startAuto,p=t.endAuto,f=t.wayAuto,m=t.fixedTimeAuto,v=t.targetTimeAuto,x=Number(o.split("-")[1]),b=Number(f),g=d.actor.toString(),e.next=20,c.load("dfs3protocol");case 20:return j=e.sent,k=j.table("projects"),e.next=24,k.all({scope:"dfs3protocol",from:x,to:x});case 24:for(w=e.sent,A=w[0],y=A.init_nft_price.value,S=A.init_nft_price.symbol.name,F=A.sec_per_round.toNumber(),Z=A.last_round.toString(),Z=Y().utc(Z).local().format("YYYY-MM-DDTHH:mm:ss"),N=Y()(Z).add(F,"seconds").format("YYYY-MM-DDTHH:mm:ss"),_=A.increase_per_round.toNumber()/100,C=y;C*_<2*y;)C*=_;if("DFS"===S||"USDT"===S||"ORDI"===S){e.next=39;break}return n.error("不支持当前项目"),tt(!1),e.abrupt("return");case 39:return e.next=41,or(x,y);case 41:if(P=e.sent,P=rr(P,b,C),!(l>P.length)){e.next=47;break}return n.error("开始序号超过当前项目最大值".concat(P.length)),tt(!1),e.abrupt("return");case 47:if(!p){e.next=56;break}if(!(l>p)){e.next=52;break}return n.error("开始序号超过结束序号"),tt(!1),e.abrupt("return");case 52:T=P.length>p?p:P.length,P=P.slice(l-1,T),e.next=57;break;case 56:P=P.slice(l-1);case 57:V=0,M=0,E=0;case 60:if(!(E<P.length)){e.next=72;break}if(D=Number(P[E].current_price.split(" ")[0]),!(V>=a)){e.next=64;break}return e.abrupt("break",72);case 64:if(!(V>=3e3)){e.next=66;break}return e.abrupt("break",72);case 66:V+=1,M+=D;case 69:++E,e.next=60;break;case 72:return z=L.includes(g)?M.toFixed(8)+" "+S:(1.003*M).toFixed(8)+" "+S,null===(r=Qt.current)||void 0===r||r.setFieldValue("amountAuto",z),Ae(N),m?(Ee(Y()(v).valueOf()),ge(Y()(v).format("YYYY-MM-DDTHH:mm:ss"))):(er(Z,F),ge(N),null===(q=Qt.current)||void 0===q||q.setFieldValue("targetTimeAuto",void 0)),Pe(F),Ze(Z),Kt.current=!1,ft(!0),tt(!1),e.abrupt("return",!0);case 84:e.prev=84,e.t0=e.catch(0),tt(!1),(0,h.Tv)(e.t0,n,"handleFinishAuto");case 88:case"end":return e.stop()}}),e,null,[[0,84]])})));return function(t){return e.apply(this,arguments)}}(),[er,u,c,d,L,or,rr]),cr=(0,q.useCallback)((function(){var e,t=Wt.current;if(0===t.length)return n.error($t),console.log($t),!1;var r=null===(e=Qt.current)||void 0===e?void 0:e.getFieldsValue(),s=r.disorderAuto,o=r.repeatAuto,a=r.intervalAuto,c=r.loop,i=r.fixedTimeAuto;try{s?t.sort((function(){return Math.random()-.5})):t.sort((function(e,t){return e.cid-t.cid})),console.log("handleCountDownFinishAuto",Y()().format()),H.push({position:"handleCountDownFinishAuto",time:Y()().format()}),tr(t);for(var u=1;u<o;u++)(0,O.iK)(tr,a*u,t);return c&&!i&&(Gt.current=!0,(0,O.gr)(Bt.current),Bt.current=(0,O.iK)((function(){var e;return null===(e=Qt.current)||void 0===e?void 0:e.submit()}),6e5)),!0}catch(e){(0,h.Tv)(e,n,"handleCountDownFinishAuto")}}),[me,tr]),ir=(0,q.useCallback)((function(){var e;null===(e=Qt.current)||void 0===e||e.resetFields(),X(0),J(0),ne(0),ce(0),he([]),ge(""),Ae(""),Ze(""),Ee(0),Pe(0),Jt.current={},We({}),He({}),de(0),Xt(),Kt.current=!1,Gt.current=!0}),[Xt]),ur=(0,q.useCallback)(function(){var t=l()(i()().mark((function t(r){var s,o,a,c,u,l,d,p,f,v;return i()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,r.load("dfs3protocol");case 3:return o=t.sent,a=o.table("projects"),c=o.table("stat"),t.next=8,a.all({scope:"dfs3protocol"});case 8:return u=t.sent,t.next=11,c.all({scope:"dfs3protocol"});case 11:return l=t.sent,t.next=14,E().get("https://api.dfs.land/dfschain/pppvolume2");case 14:200!==(d=t.sent).status&&n.error("获取pppvolume2数据失败"),p=d.data,f=[],u.forEach((function(e){p.hasOwnProperty(e.id.toString())&&f.push(e)})),f.sort((function(e,t){var r=e.id.toString(),n=t.id.toString();return p[n].volume_24h-p[r].volume_24h})),v={},f.forEach((function(e){var t=e.nft_img,r=e.id.toString(),n=e.project_name,s=e.creator.toString();v["pid-"+r]="".concat(r,"-").concat(n,"-").concat(s,"-").concat(t)})),null===(s=Qt.current)||void 0===s||s.setFieldValue("pidAuto",""),e(m.N.setValueEnum(v)),e(m.N.setProjects(u)),e(m.N.setStats(l)),ot(!1),t.next=33;break;case 29:t.prev=29,t.t0=t.catch(0),ot(!1),(0,h.Tv)(t.t0,n,"handleValueEnum");case 33:case"end":return t.stop()}}),t,null,[[0,29]])})));return function(e){return t.apply(this,arguments)}}(),[]),lr=(0,q.useCallback)((function(){return d&&d.broadcast?u?(ot(!0),void ur(c)):(n.error("".concat(Ut)),!1):(n.error("".concat(It)),!1)}),[d,u,ur,c]),dr=(0,q.useCallback)(l()(i()().mark((function e(){var t,r,s,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(me.length){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,Be(!0),t={},e.next=7,d.client.v1.chain.get_table_rows({code:"dfs3protocol",table:"registry",scope:"dfs3protocol",key_type:"i64",index_position:"secondary",lower_bound:N.zM.from(Re.pid),upper_bound:N.zM.from(Re.pid),limit:2e3});case 7:r=e.sent,s=r.rows,o=0,me.forEach((function(e){var r=e.from,n=e.cid;s.filter((function(t){return t.cid===e.cid}))[0].owner===r?(t[n]="success",o+=1):t[n]="default"})),de(o),We(t),Be(!1),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(2),Be(!1),(0,h.Tv)(e.t0,n,"handleCheckOwnCountAuto");case 20:case"end":return e.stop()}}),e,null,[[2,16]])}))),[c,n,Re,me,d]),pr=(0,q.useCallback)(l()(i()().mark((function e(){var t,r,n,s,o,a,c,u,l,d,p,f;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(t=Qt.current)||void 0===t?void 0:t.getFieldsValue(),n=r.pidAuto,s=r.wayAuto,n){e.next=3;break}return e.abrupt("return");case 3:for(ut(!0),o=Number(n.split("-")[1]),a=Number(s),c=I.filter((function(e){return e.id.toNumber()===o}))[0],u=c.init_nft_price.value,l=c.increase_per_round.toNumber()/100,d=u;d*l<2*u;)d*=l;return e.next=13,or(o,u);case 13:p=e.sent,p=rr(p,a,d),f=p.length,xt(f),ut(!1);case 18:case"end":return e.stop()}}),e)}))),[I,or,rr]),fr=(0,q.useCallback)((function(e){if(e.hasOwnProperty("countAuto")){var t,r=null===(t=Qt.current)||void 0===t?void 0:t.getFieldValue("pidAuto");if(!r)return;var s,o=e.countAuto,a=r.split("-")[1],c=z.filter((function(e){return e.cid.toString()===a}))[0].supply.toNumber();if(o>c)return n.error("购买数量超过当前项目最大值".concat(c)),void(null===(s=Qt.current)||void 0===s||s.setFieldValue("startAuto",1))}if(e.hasOwnProperty("pidAuto")){var i,u,l,d=(null===(i=Qt.current)||void 0===i?void 0:i.getFieldsValue()).wayAuto;if("6"===d||"7"===d)null===(l=Qt.current)||void 0===l||l.setFieldValue("accountsAuto",void 0),Yt({}),_t(!1);else if("8"===d){var p;null===(p=Qt.current)||void 0===p||p.setFieldValue("cidsAuto",void 0),Ot({}),Vt(!1)}null===(u=Qt.current)||void 0===u||u.setFieldValue("wayAuto","1"),pr()}if(e.hasOwnProperty("wayAuto")){var f,m,h=null===(f=Qt.current)||void 0===f?void 0:f.getFieldsValue(),v=h.wayAuto,x=h.pidAuto;"6"===v||"7"===v?x?(_t(!0),nr()):(n.error("请先选择项目"),_t(!0)):_t(!1),"8"===v?x?(Vt(!0),sr()):(n.error("请先选择项目"),Vt(!0)):Vt(!1),pr(),null===(m=Qt.current)||void 0===m||m.setFieldValue("countAuto",void 0)}if(e.hasOwnProperty("fixedTimeAuto")){var b,g,j,k=null===(b=Qt.current)||void 0===b?void 0:b.getFieldsValue(),w=k.fixedTimeAuto,A=k.targetTimeAuto;if(w)null===(g=Qt.current)||void 0===g||g.validateFields().catch((function(e){var t,r;e.errorFields.length?(null===(t=Qt.current)||void 0===t||t.setFieldValue("fixedTimeAuto",!1),n.error("输入异常")):A||(null===(r=Qt.current)||void 0===r||r.setFieldValue("fixedTimeAuto",!1),n.error("请先设置发送时间"))}));else null===(j=Qt.current)||void 0===j||j.setFieldValue("targetTimeAuto",void 0)}}),[z,n,Fe,Ce,we,nr,sr,pr,er]),mr=(0,q.useCallback)(l()(i()().mark((function e(){var t,r,o,l,f,m,v,x,b,g,j,k,w,A,y,S,F,Z,_,C,P,T,V,E,D,z,q,O,R,H,$,I,U,W,K,Q,B,G,ee,te,re,se,oe,ae,ie,ue,le,pe,fe,me,ve,xe,be,ge,je,ke,we,Ae;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,d&&d.broadcast){e.next=7;break}return n.error("".concat(It)),console.log(It),e.abrupt("return");case 7:if(u){e.next=11;break}return n.error("".concat(Ut)),console.log(Ut),e.abrupt("return");case 11:if("owner"===(o=d.permissionLevel.permission.toString())||"active"===o){e.next=16;break}return n.error("permission权限必须是owner或者active"),console.log("permission权限必须是owner或者active"),e.abrupt("return");case 16:return tt(!0),l=null===(t=Qt.current)||void 0===t?void 0:t.getFieldsValue(),f=l.pidAuto,m=l.countAuto,v=l.startAuto,x=l.endAuto,b=l.wayAuto,g=Number(f.split("-")[1]),j=Number(b),k=d.actor.toString(),e.next=23,c.load("dfs3protocol");case 23:return w=e.sent,A=w.table("projects"),e.next=27,A.all({scope:"dfs3protocol",from:g,to:g});case 27:for(y=e.sent,S=y[0],F=S.creator.toString(),Z=S.nft_name.toString(),_=S.project_name,C=S.init_nft_price.value,P=S.init_nft_price.symbol.name,T=S.increase_per_round.toNumber()/100,V=C;V*T<2*C;)V*=T;if(E="","DFS"!==P){e.next=42;break}E="eosio.token",e.next=54;break;case 42:if("USDT"!==P){e.next=46;break}E="usdtusdtusdt",e.next=54;break;case 46:if("ORDI"!==P){e.next=50;break}E="ordiordiordi",e.next=54;break;case 50:return n.error("不支持当前项目"),tt(!1),console.log("不支持当前项目"),e.abrupt("return");case 54:return e.next=56,or(g,C);case 56:if(D=e.sent,D=rr(D,j,V),!(v>D.length)){e.next=63;break}return n.error("开始序号超过当前项目最大值".concat(D.length)),tt(!1),console.log("开始序号超过当前项目最大值".concat(D.length)),e.abrupt("return");case 63:if(!x){e.next=73;break}if(!(v>x)){e.next=69;break}return n.error("开始序号超过结束序号"),console.log("开始序号超过结束序号"),tt(!1),e.abrupt("return");case 69:z=D.length>x?x:D.length,D=D.slice(v-1,z),e.next=74;break;case 73:D=D.slice(v-1);case 74:return q={account:"dfsfreecpu11",name:"freecpu",authorization:[{actor:"dfs.service",permission:"cpu"},d.permissionLevel],data:h._9.from({user:k})},O=N.aU.from(q),e.next=78,d.client.v1.chain.get_info();case 78:R=e.sent,H=R.getTransactionHeader(),$=Y()(),I=[],U={},W=0,K="",Q=0,B=0;case 87:if(!(B<D.length)){e.next=129;break}if(!(W>=m)){e.next=90;break}return e.abrupt("break",129);case 90:if(!(W>=3e3)){e.next=92;break}return e.abrupt("break",129);case 92:return K=Y()($).add(3600-W++,"seconds").utc().format("YYYY-MM-DDTHH:mm:ss"),G=D[B].current_price,ee=N.xR.from(G),te=ee.value,re=ee.symbol,se=N.xR.from(.003*te,re),oe="buy:"+D[B].id.toString(),Q+=te,ae={account:E,name:"transfer",authorization:[d.permissionLevel],data:h.FE.from({from:k,to:"dfs3protocol",quantity:G,memo:oe})},ie=N.aU.from(ae),ue={account:E,name:"transfer",authorization:[d.permissionLevel],data:h.FE.from({from:k,to:"davidaccount",quantity:se,memo:"nft fee"})},le=N.aU.from(ue),pe=void 0,fe=void 0,me=[],ve=L.includes(k)?[O,ie]:[O,ie,le],pe=N.YW.from(a()(a()({},H),{},{expiration:K,actions:ve})),me[0]=M.signDigest(pe.signingDigest(d.chain.id.toString())),e.next=112,(0,h.zI)(d.transact({transaction:pe},{broadcast:!1,transactPlugins:[]}));case 112:if(xe=e.sent,be=p()(xe,2),ge=be[0],je=be[1],!ge){e.next=121;break}return n.error(ge),tt(!1),console.log(ge),e.abrupt("return");case 121:fe=N.uQ.from(a()(a()({},pe),{},{signatures:[].concat(me,s()(je.signatures))})),ke=D[B].cid,we=D[B].id,U[ke]={status:"default",message:""},I.push({signedTransaction:fe,cid:ke,nftid:we,amount:te,from:k});case 126:++B,e.next=87;break;case 129:Ae=L.includes(k)?Q.toFixed(8)+" "+P:(1.003*Q).toFixed(8)+" "+P,null===(r=Qt.current)||void 0===r||r.setFieldValue("amountAuto",Ae),Jt.current=U,We({}),X(0),J(0),ne(0),ce(I.length),he(I),Wt.current=I,de(0),He({pid:g,creator:F,nft_name:Z,project_name:_}),de(0),n.success("创建完成"),tt(!1),console.log("创建完成"),e.next=152;break;case 147:e.prev=147,e.t0=e.catch(0),tt(!1),(0,h.Tv)(e.t0,n,"handleCreateTransactions"),console.log(e.t0);case 152:case"end":return e.stop()}}),e,null,[[0,147]])}))),[c,d,u,L]),hr=(0,q.useCallback)((function(e){var t;e<18e5&&!Kt.current&&(Kt.current=!0,mr());var r=null===(t=Qt.current)||void 0===t?void 0:t.getFieldValue("leadTimeAuto");r&&e<r&&Gt.current&&(Gt.current=!1,tr(Wt.current),console.log("handleCountdownChangeAuto",Y()().format(),e),H.push({position:"handleCountdownChangeAuto",time:Y()().format(),value:e}))}),[mr,tr]),vr=(0,q.useCallback)((function(e){var t,r,n=e.length;n?null===(t=Qt.current)||void 0===t||t.setFieldValue("countAuto",n):null===(r=Qt.current)||void 0===r||r.setFieldValue("countAuto",void 0);xt(n)}),[]),xr=(0,q.useCallback)((function(){ft(!1),Ee(0),ge(""),(0,O.gr)(Bt.current),Gt.current=!0}),[]),br=((0,q.useCallback)((function(){if(ze){if(u){var e=u.accountName.toString();return!!$.includes(e)||(Le(!1),!1)}return!0}if(u){var t=u.accountName.toString();return!!$.includes(t)&&(Le(!0),!0)}return!1}),[u,ze,$]),(0,q.useCallback)((function(){var e=Y()().format("YYYY-MM-DDTHH:mm:ss"),t=JSON.stringify(H,null,2),r="data:,".concat(t),n=document.createElement("a");n.href=r,n.download="log_".concat(e,".json"),n.click()}),[])),gr=(0,q.useCallback)((function(){var e;X(0),J(0),ne(0),ce(0),he([]),ge(""),Ee(0),Pe(0),Jt.current={},We({}),He({}),de(0),Xt(),Kt.current=!1,Gt.current=!0,null===(e=Qt.current)||void 0===e||e.setFieldValue("amountAuto","")}),[Xt]);return(0,q.useEffect)((function(){!c||Object.keys(D).length||st||(ot(!0),ur(c))}),[ur,D,c,st]),(0,q.useEffect)((function(){return function(){(0,O.gr)(Bt.current)}}),[]),(0,R.jsx)(g._z,{className:"",ghost:!0,children:(0,R.jsxs)("div",{className:"flex flex-wrap justify-center gap-5",children:[(0,R.jsxs)(j.Z,{title:(0,R.jsx)("div",{className:" font-semibold text-lg hardline",children:"使用说明"}),style:{maxWidth:"500px"},children:[(0,R.jsx)("div",{children:"1. 操作步骤如下："}),(0,R.jsxs)("div",{className:"ml-3",children:['a）进入"工具-简易钱包"页面 ',(0,R.jsx)(v.Z,{})," ","导入私钥 ",(0,R.jsx)(v.Z,{})," 点击右上角钱包图标"," ",(0,R.jsx)(v.Z,{})," 选择账号进行连接；"]}),(0,R.jsxs)("div",{className:"ml-3",children:['b）进入"PPP-自动扫货"页面 ',(0,R.jsx)(v.Z,{})," ",'选择"自动交易"表格 ',(0,R.jsx)(v.Z,{})," 选择项目"," ",(0,R.jsx)(v.Z,{})," 输入购买数量 ",(0,R.jsx)(v.Z,{})," ","点击启动按钮"]}),(0,R.jsx)("div",{className:"mt-3",children:"2. 注意事项："}),(0,R.jsx)("div",{className:"ml-3",children:"a）自动交易方式需要用户导入私钥才可以正常执行。私钥只保存在浏览器的数据库中，不会上传到服务器，请评估好风险后再使用。"}),(0,R.jsx)("div",{className:"ml-3",children:"b）每次切换账号前，都需要先断开账号的连接。"}),(0,R.jsx)("div",{className:"mt-3",children:"3. 费用说明："}),(0,R.jsx)("div",{className:"ml-3",children:"使用工具抢到的NFT，每个收取0.3%费用。例如工具抢到一个价值为100 DFS的NFT，则工具会收取0.3 DFS作为费用，抢购成功了，才会收取。"})]}),(0,R.jsxs)(j.Z,{title:(0,R.jsxs)("div",{className:" font-semibold text-lg hardline",children:["自动交易",(0,R.jsx)(C.Z,{placement:"topLeft",title:'需要在"工具-简易钱包"页面中导入私钥，然后点击右上角的钱包图标进行连接后，才能正常使用',children:(0,R.jsx)(x.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),style:{maxWidth:"500px"},children:[(0,R.jsxs)(k.A,{formRef:Qt,onFinish:ar,onValuesChange:fr,onReset:ir,loading:et,disabled:pt,layout:"vertical",initialValues:{disorderAuto:!0,startAuto:1,repeatAuto:10,intervalAuto:1e3,leadTimeAuto:0,loop:!0,fixedTimeAuto:!1},submitter:{searchConfig:{submitText:"启动"},render:function(e,t){return[t[1],t[0]]}},children:[(0,R.jsx)(w.Z,{name:"pidAuto",label:(0,R.jsxs)("div",{children:["项目",(0,R.jsx)(b.Z,{spin:st,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:lr})]}),valueEnum:D,placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(Ht),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,onChange:gr,filterOption:function(e,t){var r=t.label.split("-"),n=p()(r,3),s=n[0],o=n[1],a=n[2];return(s.padStart(3,"0")+o+a).toLowerCase().includes(e.toLowerCase())},optionItemRender:function(e){var t=e.label.split("-"),r=p()(t,4),n=r[0],s=r[1],o=r[2],a=r[3];return(0,R.jsxs)("div",{className:"flex items-center",children:[(0,R.jsx)("div",{className:"mr-2",children:n.padStart(3,"0")}),(0,R.jsx)(P.C,{className:"mr-2",size:"default",src:a}),(0,R.jsxs)("div",{children:[s," @",o]})]})}}}),(0,R.jsx)(w.Z,{name:"wayAuto",label:"购买方式",valueEnum:{1:"随机",2:"价格低到高",3:"价格高到低",4:"时间优先",5:"只抢拆分",6:"指定账号(顺序)",7:"指定账号(随机)",8:"指定序号"},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(Ht),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,defaultValue:"1"}}),!!Nt&&(0,R.jsx)(w.Z,{name:"accountsAuto",label:(0,R.jsxs)("div",{children:["选择账号",(0,R.jsx)(b.Z,{spin:jt,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:nr})]}),valueEnum:Dt,fieldProps:{mode:"multiple"},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(Ht),pattern:/^.+$/}]}),!!Tt&&(0,R.jsx)(w.Z,{name:"cidsAuto",label:(0,R.jsxs)("div",{children:["选择序号",(0,R.jsx)(b.Z,{spin:yt,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:sr})]}),valueEnum:qt,onChange:vr,fieldProps:{mode:"multiple"},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(Ht),pattern:/^.+$/}]}),(0,R.jsx)(A.Z,{label:(0,R.jsxs)("div",{children:[(0,R.jsx)("span",{children:"购买数量 "}),(0,R.jsx)("span",{className:"hover:cursor-pointer",style:{color:"#1677ff"},onClick:function(){var e,t;null===(e=Qt.current)||void 0===e||e.setFieldValue("countAuto",vt),null===(t=Qt.current)||void 0===t||t.validateFields(["countAuto"])},children:vt?"(".concat(vt,")"):""}),(0,R.jsx)(b.Z,{spin:it,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:pr})]}),name:"countAuto",placeholder:"",min:1,rules:[{required:!0,message:"".concat(Ht),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large"}}),(0,R.jsx)(A.Z,{label:(0,R.jsxs)("div",{children:["开始序号#",(0,R.jsx)(C.Z,{placement:"topLeft",title:"从具体某个序号开始进行购买",children:(0,R.jsx)(x.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"startAuto",placeholder:"",min:1,rules:[{required:!0,message:"".concat(Ht),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1}}),(0,R.jsx)(A.Z,{label:(0,R.jsxs)("div",{children:["结束序号#",(0,R.jsx)(C.Z,{placement:"topLeft",title:"只购买当前序号之前的NFT",children:(0,R.jsx)(x.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"endAuto",placeholder:"可选，默认是当前序号的最大值",min:1,rules:[{required:!1,message:"".concat(Ht),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large"}}),(0,R.jsx)(A.Z,{label:(0,R.jsxs)("div",{children:["整体重复发送次数",(0,R.jsx)(C.Z,{placement:"topLeft",title:"整体全部发送完成算一次，这里指定重复次数。重复发送失败了，不会影响金额",children:(0,R.jsx)(x.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"repeatAuto",placeholder:"",min:1,rules:[{required:!0,message:"".concat(Ht),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:10}}),(0,R.jsx)(A.Z,{label:(0,R.jsxs)("div",{children:["整体重复发送间隔(毫秒)",(0,R.jsx)(C.Z,{placement:"topLeft",title:"整体全部发送完成算一次，这里指定重复的间隔时间",children:(0,R.jsx)(x.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"intervalAuto",placeholder:"",min:300,rules:[{required:!0,message:"".concat(Ht),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1e3}}),(0,R.jsx)(A.Z,{label:(0,R.jsxs)("div",{children:["提前发送时间(毫秒)",(0,R.jsx)(C.Z,{placement:"topLeft",title:"在下一轮开始前多少毫秒发送交易",children:(0,R.jsx)(x.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"leadTimeAuto",placeholder:"",max:2e3,min:0,rules:[{required:!0,message:"".concat(Ht),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:0}}),(0,R.jsx)(y.Z,{name:"disorderAuto",label:(0,R.jsxs)("div",{children:["是否乱序",(0,R.jsx)(C.Z,{placement:"topLeft",title:"是否以乱序的方式来发送交易",children:(0,R.jsx)(x.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(Ht),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0}}),(0,R.jsx)(y.Z,{name:"loop",label:(0,R.jsxs)("div",{children:["是否循环运行",(0,R.jsx)(C.Z,{placement:"topLeft",title:"当前轮次运行完后，是否进行下一轮运行",children:(0,R.jsx)(x.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(Ht),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0}}),(0,R.jsx)(y.Z,{name:"fixedTimeAuto",label:(0,R.jsxs)("div",{children:["是否指定发送时间",(0,R.jsx)(C.Z,{placement:"topLeft",title:"",children:(0,R.jsx)(x.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(Ht),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!1}}),(0,R.jsx)(S.Z,{name:"targetTimeAuto",label:(0,R.jsxs)("div",{children:["指定发送时间",(0,R.jsx)(C.Z,{placement:"topLeft",title:"在指定时间点自动进行交易操作",children:(0,R.jsx)(x.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"",rules:[{required:!1,whitespace:!0,message:"".concat(Ht),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1},width:"100%"}),(0,R.jsx)(F.Z,{name:"amountAuto",label:(0,R.jsxs)("div",{children:["总金额",(0,R.jsx)(C.Z,{placement:"topLeft",title:"此次全部交易所需要的总金额，包含手续费。",children:(0,R.jsx)(x.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0}}),(0,R.jsx)(k.A.Item,{label:(0,R.jsxs)("div",{className:" font-semibold text-lg ",children:[(0,R.jsx)("span",{className:"hardline",children:"倒计时 "}),Re.pid?"(".concat(Re.pid,"-").concat(Re.project_name," @").concat(Re.creator,")"):""]}),children:(0,R.jsxs)("div",{className:"flex items-center gap-x-5 flex-wrap",children:[(0,R.jsx)(f.Wo,{className:"text-2xl",value:Me,onFinish:cr,onChange:hr}),(0,R.jsx)("div",{className:"text-2xl",children:"".concat(be)})]})}),(0,R.jsxs)(k.A.Item,{label:(0,R.jsxs)("div",{className:" font-semibold text-lg hardline",children:[(0,R.jsx)("span",{children:"结果 "}),me.length?"(".concat(me.length,")"):""]}),children:[(0,R.jsx)("div",{children:"成功：".concat(K,"，失败：").concat(G,"，处理中：").concat(re,"，待处理：").concat(ae)}),!!me.length&&(0,R.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(Jt.current).map((function(e,t){return(0,R.jsx)(T.Z,{color:Jt.current[e].status,children:"#".concat(e)},t)}))})]}),(0,R.jsxs)(k.A.Item,{label:(0,R.jsx)("div",{className:" font-semibold text-lg hardline",children:(0,R.jsxs)("div",{children:[(0,R.jsx)("span",{children:"校对 "}),me.length?"(".concat(me.length,")"):"",(0,R.jsx)(C.Z,{placement:"topLeft",title:"交易结束后，可点击校对按钮，判断交易结果是否跟链上数据匹配",children:(0,R.jsx)(x.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]})}),children:[(0,R.jsx)("div",{children:"拥有：".concat(le)}),!!me.length&&(0,R.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(Ue).map((function(e,t){return(0,R.jsx)(T.Z,{color:Ue[e],children:"#".concat(e)},t)}))})]})]}),(0,R.jsxs)("div",{className:"mt-2 ",children:[(0,R.jsx)(V.ZP,{type:"primary",className:"mr-2",onClick:xr,children:"停止"}),(0,R.jsx)(V.ZP,{className:"mr-2",loading:Qe,onClick:dr,children:"校对"}),(0,R.jsx)(V.ZP,{onClick:br,children:"日志"}),","]})]}),o]})})}}}]);