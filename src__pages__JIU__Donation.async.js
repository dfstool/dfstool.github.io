"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[418],{70799:function(e,t,a){a.r(t);var r=a(9783),n=a.n(r),s=a(15009),o=a.n(s),u=a(99289),c=a.n(u),i=a(5574),l=a.n(i),d=a(81876),p=a(31120),h=a(64119),f=a(11774),v=a(38345),m=a(59530),k=a(45360),x=a(2487),y=a(9669),b=a.n(y),g=a(55835),j=a(62435),w=a(86074);t.default=function(){var e=(0,m.useDispatch)(),t=k.ZP.useMessage(),a=l()(t,2),r=a[0],s=a[1],u=(0,m.useNavigate)(),i=(0,m.useSelector)((function(e){return e.global.contractKit})),y=(0,j.useState)(!1),S=l()(y,2),O=S[0],P=S[1],D=(0,m.useSelector)((function(e){return e.jiu.donationDataSource})),N=(0,j.useState)(0),C=l()(N,2),E=C[0],V=C[1],M=(0,j.useState)(0),I=l()(M,2),U=I[0],Z=I[1],_=(0,m.useIntl)(),L=_.formatMessage({id:"jiu.intlMissingData"}),T=_.formatMessage({id:"jiu.intlDonationRank"}),z=_.formatMessage({id:"jiu.intlDonationUsers"}),A=_.formatMessage({id:"jiu.intlDonationValue"}),B=_.formatMessage({id:"jiu.intlDonationAccount"}),q=(0,j.useCallback)(c()(o()().mark((function e(){var t,a,n,s,u,c,i,d,f,v,m,k,x,y,j,w,S,O,P,D,N,C,E,V,M,I,U,Z,_;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="jiutothemoon",a="000d9cae502dd1cc895745e204f83cc892bc4c450f92a03ecd4fe057709853cc",n=(0,g.js)("md5"),s=a+t,n.update(s),u=n.digest("hex").substring(0,8),c={key:u,chainId:a,account:t,skip:0,lastUpdate:"2020-01-01T01:01:01.000Z",error:!1,data:[]},e.next=9,p.db.txList.where({key:u}).toArray();case 9:(i=e.sent).length&&(c=i[0]),d=[],f=500,v=c.lastUpdate,m=c.skip;case 15:return e.next=18,(0,h.zI)(b().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&sort=asc&simple=true&noBinary=true&account=".concat(t,"&after=").concat(v,"&limit=").concat(f)));case 18:if(k=e.sent,x=l()(k,2),y=x[0],j=x[1],y||200!==j.status){e.next=65;break}if(w=j.data.simple_actions,S=w.length,O=j.data.total.value,P=1,0!==O){e.next=30;break}return p.db.txList.put(c),e.abrupt("return",c.data);case 30:for(D=0;D<w.length;D++)m<=D&&d.push(w[D]);if(d.length){e.next=34;break}return c.error&&r.error(L),e.abrupt("return",c.data);case 34:N=d.length-1;case 35:if(!(N>0)){e.next=44;break}if(d[N].transaction_id!==d[N-1].transaction_id){e.next=40;break}P+=1,e.next=41;break;case 40:return e.abrupt("break",44);case 41:N--,e.next=35;break;case 44:if(m=P,S!==f){e.next=50;break}C=d[d.length-1].timestamp,v=C,e.next=63;break;case 50:return d.forEach((function(e){c.data.push(e)})),E=d[d.length-1].timestamp,c.lastUpdate=E,c.skip=m,e.next=56,(0,h.zI)(b().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&simple=true&noBinary=true&account=".concat(t,"&skip=0&limit=1")));case 56:return V=e.sent,M=l()(V,2),I=M[0],U=M[1],I||200!==U.status?r.error(I):(Z=U.data.total.value,c.data.length!==Z?(c.error=!0,r.error(L)):c.error=!1),p.db.txList.put(c),e.abrupt("return",c.data);case 63:e.next=69;break;case 65:return d.length&&(d.forEach((function(e){c.data.push(e)})),_=d[d.length-1].timestamp,c.lastUpdate=_,c.skip=m,c.error=!0),p.db.txList.put(c),r.error(y),e.abrupt("return",c.data);case 69:e.next=15;break;case 71:case"end":return e.stop()}}),e)}))),[r]),F=(0,j.useCallback)(c()(o()().mark((function e(){var t,a,r,n,s,u;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.load("swapswapswap");case 2:return t=e.sent,a=t.table("markets"),e.next=6,a.all();case 6:return r=e.sent,"usdtusdtusdt-USDT",s="eosio.token-DFS",u=[],(n={})["usdtusdtusdt-USDT"]=1,n[s]=r[0].reserve0.value/r[0].reserve1.value,r.forEach((function(e){var t=e.contract0.toString()+"-"+e.sym0.toString().split(",")[1],a=e.contract1.toString()+"-"+e.sym1.toString().split(",")[1];"eosio.token"===e.contract0.toString()?n.hasOwnProperty(a)||(n[a]=e.reserve0.value/e.reserve1.value*n[s]):"eosio.token"===e.contract1.toString()?n.hasOwnProperty(t)||(n[t]=e.reserve1.value/e.reserve0.value*n[s]):"usdtusdtusdt"===e.contract0.toString()?n.hasOwnProperty(a)||(n[a]=e.reserve0.value/e.reserve1.value):"usdtusdtusdt"===e.contract1.toString()?n.hasOwnProperty(t)||(n[t]=e.reserve1.value/e.reserve0.value):u.push({key0:t,key1:a,value0:e.reserve0.value,value1:e.reserve1.value})})),u.forEach((function(e){n.hasOwnProperty(e.key0)&&!n.hasOwnProperty(e.key1)?n[e.key1]=e.value0/e.value1*n[e.key0]:!n.hasOwnProperty(e.key0)&&n.hasOwnProperty(e.key1)?n[e.key0]=e.value1/e.value0*n[e.key1]:n.hasOwnProperty(e.key0)||n.hasOwnProperty(e.key1)||(n[e.key0]=0,n[e.key1]=0)})),e.abrupt("return",n);case 16:case"end":return e.stop()}}),e)}))),[i]),$=(0,j.useCallback)(c()(o()().mark((function t(){var a,s,u,c,i,l,p,f;return o()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=0,s={},u=[],t.next=6,F();case 6:return c=t.sent,t.next=9,q();case 9:i=t.sent,i.filter((function(e){return"transfer"===e.action&&"jiutothemoon"===e.data.to&&"dfsminingout"!==e.data.from&&"swapswapswap"!==e.data.from})).forEach((function(e){var t=e.data.from,r=e.contract,o=e.data.amount,u=e.data.symbol,i=r+"-"+u,l=e.data.quantity.split(" ")[0].split(".")[1].length,d=c[i]*o;s.hasOwnProperty(t)?(s[t].hasOwnProperty(i)?(s[t][i].amount+=o,s[t][i].value+=d):s[t][i]={amount:o,symbol:u,precision:l,value:d},s[t].totalValue+=d,a+=d):(s[t]=n()(n()({},i,{amount:o,symbol:u,precision:l,value:d}),"totalValue",d),a+=d)})),l=o()().mark((function e(t){var r,n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s.hasOwnProperty(t)&&(r=/.+-.+/,n=[],Object.keys(s[t]).forEach((function(e){r.test(e)&&n.push(s[t][e])})),u.push({donation:n,totalValue:s[t].totalValue,account:t,ratio:s[t].totalValue/a}));case 1:case"end":return e.stop()}}),e)})),t.t0=o()().keys(s);case 14:if((t.t1=t.t0()).done){t.next=19;break}return p=t.t1.value,t.delegateYield(l(p),"t2",17);case 17:t.next=14;break;case 19:f=u.sort((function(e,t){return t.totalValue-e.totalValue})),e(d.N.setDonationDataSource(f)),V(f.length),Z(a),P(!1),t.next=30;break;case 26:t.prev=26,t.t3=t.catch(0),P(!1),(0,h.Tv)(t.t3,r);case 30:case"end":return t.stop()}}),t,null,[[0,26]])}))),[q,F]);return(0,j.useEffect)((function(){i?(D.length?P(!1):P(!0),$()):P(!0)}),[i,$]),(0,w.jsx)(f._z,{className:"",ghost:!0,children:(0,w.jsx)("div",{className:"flex justify-center",children:(0,w.jsxs)(v.Z,{className:"flex justify-center",title:(0,w.jsx)("div",{className:"text-xl font-semibold",children:T}),headerBordered:!0,headStyle:{justifyContent:"center"},style:{width:"500px"},children:[(0,w.jsxs)("div",{className:"text-base font-semibold",children:[z,"：",E]}),(0,w.jsxs)("div",{className:"text-base font-semibold",children:[A,"：$",(0,h.CE)(U)]}),(0,w.jsxs)("div",{className:"text-base font-semibold",children:[B,"：",(0,w.jsx)("span",{className:" cursor-pointer",onClick:function(){return u("/query/account?search=jiutothemoon&tab=info")},children:"jiutothemoon"})]}),(0,w.jsx)(x.Z,{dataSource:D,loading:O,renderItem:function(e,t){return(0,w.jsxs)(x.Z.Item,{children:[(0,w.jsx)(x.Z.Item.Meta,{title:"".concat(t+1,". ")+e.account,description:(0,w.jsxs)("div",{children:[(0,w.jsxs)("div",{children:["$",(0,h.CE)(e.totalValue)]}),(0,w.jsx)("div",{children:(100*e.ratio).toFixed(2)+"%"})]})}),(0,w.jsx)("div",{className:"font-semibold",children:e.donation.map((function(e,t){return(0,w.jsx)("div",{style:{textAlign:"right"},children:(0,h.CE)(e.amount)+" "+e.symbol},t)}))})]})}}),s]})})})}}}]);