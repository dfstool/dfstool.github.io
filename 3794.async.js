"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3794],{16529:function(e,t,a){a.d(t,{s:function(){return d},S:function(){return x}});var n=a(5574),r=a.n(n),s=a(59530),i=a(85265),l=a(42075),c=a(15867),o=a(62435),u=a(86074),m=o.forwardRef((function(e,t){var a=(0,s.useIntl)(),n=a.formatMessage({id:"iframe.Close"}),m=a.formatMessage({id:"iframe.Jump"}),d=e.src,p=e.title,h=(0,o.useState)(!1),x=r()(h,2),f=x[0],y=x[1];(0,o.useImperativeHandle)(t,(function(){return{setIsDrawerOpen:y}}));var b=(0,o.useCallback)((function(){y(!1)}),[]),k=(0,o.useCallback)((function(){window.open(d),y(!1)}),[d]);return(0,u.jsx)(i.Z,{title:p,placement:"bottom",closable:!1,open:f,onClose:b,styles:{body:{padding:"0px"},header:{padding:"10px"}},height:"90%",destroyOnClose:!0,extra:(0,u.jsxs)(l.Z,{children:[(0,u.jsx)(c.ZP,{type:"primary",onClick:k,children:m}),(0,u.jsx)(c.ZP,{type:"primary",onClick:b,children:n})]}),children:(0,u.jsx)("iframe",{title:"",style:{borderWidth:"0px"},width:"100%",height:"100%",src:d})})})),d=(0,o.memo)(m),p=a(99021),h=o.forwardRef((function(e,t){var a=(0,o.useState)([]),n=r()(a,2),s=n[0],l=n[1],c=(0,o.useState)(!1),m=r()(c,2),d=m[0],h=m[1],x=(0,o.useCallback)((function(e){h(!0),l(e.split("|"))}),[]);return(0,o.useImperativeHandle)(t,(function(){return{handleOpen:x}})),(0,u.jsx)(i.Z,{placement:"bottom",closable:!0,open:d,onClose:function(){return h(!1)},styles:{body:{padding:"0px",textAlign:"center"},header:{padding:"10px"}},height:"91%",destroyOnClose:!0,children:s.map((function(e,t){return(0,u.jsx)(p.Z,{src:e,preview:!1},t)}))})})),x=(0,o.memo)(h)},73794:function(e,t,a){a.d(t,{cS:function(){return F},K4:function(){return K},xt:function(){return Y},OA:function(){return G}});var n=a(16529),r=a(35132),s=a(15867),i=a(27484),l=a.n(i),c=a(70178),o=a.n(c),u=a(62435),m=a(15009),d=a.n(m),p=a(99289),h=a.n(p),x=a(5574),f=a.n(x),y=a(3990),b=a(64119),k=a(64317),j=a(50335),S=a(37476),C=a(5966),g=a(59530),v=a(80507),q=a(45360),N=a(86074),Z=u.forwardRef((function(e,t){var a=(0,g.useDispatch)(),n=q.ZP.useMessage(),r=f()(n,2),s=r[0],i=r[1],l=(0,g.useSelector)((function(e){return e.jiu.activeKey})),c=(0,g.useSelector)((function(e){return e.global.session})),o=(0,g.useSelector)((function(e){return e.global.account})),m=(0,g.useSelector)((function(e){return e.global.contractKit})),p=(0,g.useSelector)((function(e){return e.account.markets})),x=(0,u.useRef)(),Z=(0,u.useState)(!1),B=f()(Z,2),E=B[0],F=B[1],T=(0,g.useIntl)(),w=T.formatMessage({id:"common.intlInputException"}),I=T.formatMessage({id:"common.intlPleaseConnectWallet"}),M=T.formatMessage({id:"common.intlPleaseConnectNetwork"}),O=T.formatMessage({id:"common.intlTxSuccess"}),D=T.formatMessage({id:"common.intlTxFail"}),_=T.formatMessage({id:"jiu.intlQuantityMustGreater"},{num:e.params.transferTokenMinAmount,sym:e.params.transferTokenSym}),A=T.formatMessage({id:"jiu.intlFinished"}),U=(0,u.useCallback)((function(){F(!0)}),[]);(0,u.useImperativeHandle)(t,(function(){return{handleOpen:U}}));var P=(0,u.useCallback)((function(t){var a=e.params,n=a.inputPrefix;switch(a.inputType){case 1:return n+t.input.trim().slice(6);case 2:return n+t.input.trim().split("-")[1]+t.input.trim().split("-")[2]}}),[e.params]),z=(0,u.useCallback)(function(){var t=h()(d()().mark((function t(n){var r,i,l,u,h,x,k,j,S,C,g,q,N,Z,B,E,F,T,w,U,z,R,L,H,J,K,W,Y,$,G,Q,V,X,ee,te,ae,ne,re,se,ie;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.params.finish,i=e.params.liqMid,l=e.params.liqTokenKey,u=e.params.liqSym,h=e.params.liqTokenMinAmount,x=e.params.transferTokenSym,k=e.params.transferTokenMinAmount,j=e.params.transferTokenContract,S=e.params.transferTokenPrecision,C=e.params.receiveAccount,g=e.params.ruleType,q="",0,N="",Z=0,2===g&&(q=e.params.holdTokenContract,e.params.holdTokenMinAmount,N=e.params.holdTokenSym,Z=e.params.allTokenMinAmount),!r){t.next=19;break}return s.info("".concat(A)),t.abrupt("return",!0);case 19:if(t.prev=19,c&&c.broadcast){t.next=25;break}return s.error("".concat(I)),t.abrupt("return",!1);case 25:if(o){t.next=28;break}return s.error("".concat(M)),t.abrupt("return",!1);case 28:if(!(Number(n.quantity)<1)){t.next=31;break}return s.error("".concat(_)),t.abrupt("return",!1);case 31:if(B=[],!p||!p.length){t.next=36;break}B=p,t.next=44;break;case 36:return t.next=38,m.load("swapswapswap");case 38:return E=t.sent,F=E.table("markets"),t.next=42,F.all();case 42:B=t.sent,a(y.N.setMarkets(B));case 44:return t.next=46,m.load("loglogloglog");case 46:return T=t.sent,w=T.table("liqs"),t.next=50,w.all({scope:o.accountName.toString()});case 50:if(U=t.sent,z=0,R=u,(L=U.find((function(e){return e.mid.toNumber()===i})))&&(H=B.find((function(e){return e.mid.equals(L.mid)})),J=L.token.toNumber()/H.liquidity_token.toNumber(),K=J*H.reserve0.value,W=J*H.reserve1.value,Y=H.reserve0.symbol.name,$=H.reserve1.symbol.name,0===l?(z=K,R=Y):(z=W,R=$)),G=0,Q=[],2!==g){t.next=72;break}return t.next=60,c.client.v1.chain.get_currency_balance(q,o.accountName.toString(),N);case 60:if((Q=t.sent).length&&(G=Q[0].value),V=z+G,!(Number(n.quantity)<k)){t.next=67;break}return s.error("转账数量至少".concat(k).concat(x)),t.abrupt("return",!1);case 67:if(!(V<Z)){t.next=70;break}return s.error("JIU/DFS做市+".concat(N,"余额至少").concat(Z).concat(N)),t.abrupt("return",!1);case 70:t.next=80;break;case 72:if(X=z,!(Number(n.quantity)<k)){t.next=77;break}return s.error("转账数量至少".concat(k).concat(x)),t.abrupt("return",!1);case 77:if(!(X<h)){t.next=80;break}return s.error("JIU/DFS矿池做市至少".concat(h).concat(R)),t.abrupt("return",!1);case 80:return ee=P(n),te=v.xR.from(Number(n.quantity),v.xR.Symbol.fromParts(x,S)),ae={action:{account:j,name:"transfer",authorization:[c.permissionLevel],data:{from:c.actor,to:C,quantity:te.toString(),memo:ee}}},t.next=85,(0,b.zI)(c.transact(ae));case 85:return ne=t.sent,re=f()(ne,2),se=re[0],ie=re[1],se?s.error(se):ie&&ie.response?s.success("".concat(O)):s.error("".concat(D)),t.abrupt("return",!0);case 93:t.prev=93,t.t0=t.catch(19),console.log(t.t0.message),s.error(t.t0.message);case 97:case"end":return t.stop()}}),t,null,[[19,93]])})));return function(e){return t.apply(this,arguments)}}(),[c,o,m,e.params,p,P]),R=(0,u.useCallback)((function(){var t=e.params,a=t.inputLabel,n=t.inputPlaceholder,r=t.schemes;switch(t.inputType){case 1:return(0,N.jsx)(k.Z,{name:"input",label:(0,N.jsx)("span",{className:" font-semibold",children:a}),placeholder:n,fieldProps:{autoFocus:!1,size:"large"},rules:[{required:!0,whitespace:!0,message:"".concat(w),pattern:/^.+$/}],valueEnum:r});case 2:return(0,N.jsx)(j.Z,{width:"lg",name:"input",label:(0,N.jsx)("span",{className:" font-semibold",children:a}),placeholder:n,fieldProps:{autoFocus:!1,size:"large"},rules:[{required:!0,message:"".concat(w)}]})}}),[e.params]);return(0,N.jsxs)(S.Y,{formRef:x,title:"活动"+l,open:E,onFinish:z,onOpenChange:function(e){F(e)},layout:"vertical",width:"400px",children:[R(),(0,N.jsx)(C.Z,{name:"quantity",label:(0,N.jsx)("span",{className:" font-semibold",children:"发送".concat(e.params.transferTokenSym,"数量(至少 ").concat(e.params.transferTokenMinAmount," ").concat(e.params.transferTokenSym,")")}),placeholder:"ex: ".concat(e.params.transferTokenMinAmount),fieldProps:{autoFocus:!1,size:"large"},rules:[{required:!0,whitespace:!0,message:"".concat(w),pattern:/^\d+(\.\d+)?$/}]}),i]})})),B=(0,u.memo)(Z);l().extend(o());var E=function(e){var t=(0,u.useRef)(),a=e.params.src,i=e.params.title,l=(0,u.useRef)();return(0,N.jsxs)("div",{className:"",children:[(0,N.jsx)(r.Z.Title,{level:4,className:"text-center",children:i}),(0,N.jsx)("div",{className:"text-center mt-8",children:(0,N.jsx)("a",{className:" font-bold text-lg",onClick:function(){return t.current.setIsDrawerOpen(!0)},children:"活动详情"})}),(0,N.jsx)("div",{className:"mt-14",children:(0,N.jsx)(s.ZP,{type:"primary",size:"large",block:!0,onClick:function(){return l.current.handleOpen()},children:"立即参与"})}),(0,N.jsx)(B,{ref:l,params:e.params}),(0,N.jsx)(n.s,{ref:t,src:a,title:i})]})},F=(0,u.memo)(E),T=a(97857),w=a.n(T),I=a(81876),M=a(31120),O=a(78677),D=a(38345),_=a(92340),A=a(57953),U=a(62120),P=a(9669),z=a.n(P),R=a(55835),L=a(53667),H=a.n(L);l().extend(o());var J=function(e){var t=q.ZP.useMessage(),a=f()(t,2),n=a[0],r=a[1],i=(0,g.useNavigate)(),c=(0,u.useRef)(!1),o=(0,g.useDispatch)(),m=(0,g.useSelector)((function(e){return e.global.contractKit})),p=(0,g.useSelector)((function(e){return e.global.session})),x=(0,g.useSelector)((function(e){return e.jiu.liqsCache})),k=(0,g.useSelector)((function(e){return e.jiu.assetsCache})),j=(0,g.useSelector)((function(e){return e.account.markets})),S=(0,g.useSelector)((function(e){return e.jiu.activeKey})),C=(0,u.useState)([]),v=f()(C,2),Z=v[0],B=v[1],E=(0,u.useState)([]),F=f()(E,2),T=F[0],P=F[1],L=(0,u.useState)([]),J=f()(L,2),K=J[0],W=J[1],Y=(0,u.useState)([]),$=f()(Y,2),G=$[0],Q=$[1],V=(0,u.useState)([]),X=f()(V,2),ee=X[0],te=X[1],ae=(0,u.useState)(!1),ne=f()(ae,2),re=ne[0],se=ne[1],ie=(0,u.useState)([]),le=f()(ie,2),ce=le[0],oe=le[1],ue=(0,u.useState)(""),me=f()(ue,2),de=me[0],pe=me[1],he=(0,g.useIntl)().formatMessage({id:"jiu.intlMissingData"}),xe=(0,u.useCallback)(function(){var e=h()(d()().mark((function e(t){var a,r,s,i,c,o,u,m,p,h,x,y,k,j,S,C,g,v,q,N,Z,B,E,F,T,w,I,O,D;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="jiutothemoon",r="000d9cae502dd1cc895745e204f83cc892bc4c450f92a03ecd4fe057709853cc",s=(0,R.js)("md5"),i=r+a,s.update(i),c=s.digest("hex").substring(0,8),o={key:c,chainId:r,account:a,skip:0,lastUpdate:"2020-01-01T01:01:01.000Z",error:!1,data:[]},e.next=9,M.db.txList.where({key:c}).toArray();case 9:if((u=e.sent).length&&(o=u[0]),!(t&&l().utc(o.lastUpdate).valueOf()>l().utc(t).valueOf())){e.next=13;break}return e.abrupt("return",o.data);case 13:m=[],p=500,h=o.lastUpdate,x=o.skip;case 17:return e.next=20,(0,b.zI)(z().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&sort=asc&simple=true&noBinary=true&account=".concat(a,"&after=").concat(h,"&limit=").concat(p)));case 20:if(y=e.sent,k=f()(y,2),j=k[0],S=k[1],j||200!==S.status){e.next=73;break}if(C=S.data.simple_actions,g=C.length,v=S.data.total.value,q=1,0!==v){e.next=32;break}return M.db.txList.put(o),e.abrupt("return",o.data);case 32:for(N=0;N<C.length;N++)x<=N&&m.push(C[N]);if(m.length){e.next=36;break}return o.error&&n.error(he),e.abrupt("return",o.data);case 36:Z=m.length-1;case 37:if(!(Z>0)){e.next=46;break}if(m[Z].transaction_id!==m[Z-1].transaction_id){e.next=42;break}q+=1,e.next=43;break;case 42:return e.abrupt("break",46);case 43:Z--,e.next=37;break;case 46:if(x=q,g!==p){e.next=58;break}if(B=m[m.length-1].timestamp,h=B,!(t&&l().utc(B).valueOf()>l().utc(t).valueOf())){e.next=56;break}return m.forEach((function(e){o.data.push(e)})),o.lastUpdate=B,o.skip=x,M.db.txList.put(o),e.abrupt("return",o.data);case 56:e.next=71;break;case 58:return m.forEach((function(e){o.data.push(e)})),E=m[m.length-1].timestamp,o.lastUpdate=E,o.skip=x,e.next=64,(0,b.zI)(z().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&simple=true&noBinary=true&account=".concat(a,"&skip=0&limit=1")));case 64:return F=e.sent,T=f()(F,2),w=T[0],I=T[1],w||200!==I.status?n.error(w):(O=I.data.total.value,o.data.length!==O?(o.error=!0,n.error(he)):o.error=!1),M.db.txList.put(o),e.abrupt("return",o.data);case 71:e.next=77;break;case 73:return m.length&&(m.forEach((function(e){o.data.push(e)})),D=m[m.length-1].timestamp,o.lastUpdate=D,o.skip=x,o.error=!0),M.db.txList.put(o),n.error(j),e.abrupt("return",o.data);case 77:e.next=17;break;case 79:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n]),fe=(0,u.useCallback)(function(){var t=h()(d()().mark((function t(a,r){var s,i,c,u,m,p,h,f,S,C,g,v,q,N,Z,E,F,T,M,O,D,_,A,U,z,R,L,H,J,K,Y,$,G,V,X,ee,ae,ne,re,ie,le,ce,ue,me;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s=e.params.startTime,i=e.params.endTime,c=e.params.receiveAccount,u=e.params.transferTokenContract,m=e.params.transferTokenMinAmount,p=e.params.transferTokenSym,h=e.params.liqMid,f=e.params.liqTokenKey,S=e.params.liqSym,C=e.params.liqTokenMinAmount,g=e.params.ruleType,v="",0,q="",N=0,2===g&&(v=e.params.holdTokenContract,e.params.holdTokenMinAmount,q=e.params.holdTokenSym,N=e.params.allTokenMinAmount),Z=e.params.schemesRegexp,E=[],F={},T=[],M=[],O=[],D=[],_=[],A=[],U=[],t.next=29,xe(i);case 29:z=t.sent,R=0;case 31:if(!(R<z.length)){t.next=41;break}if(L=l().utc(s).valueOf(),H=l().utc(i).valueOf(),J=l().utc(z[R].timestamp).valueOf(),L<=J&&J<=H&&z[R].contract===u&&"transfer"===z[R].action&&z[R].data.symbol===p&&z[R].data.to===c&&"dfsminingout"!==z[R].data.from&&"swapswapswap"!==z[R].data.from&&""!==z[R].data.memo.trim()&&E.push(z[R]),!(J>H)){t.next=38;break}return t.abrupt("break",41);case 38:R++,t.next=31;break;case 41:if(E.forEach((function(e){var t=e.data.from,a=e.data.memo.trim(),n=e.data.amount;F.hasOwnProperty(t)?n>=m&&Z[0].test(a)&&(F[t]=e):Z[0].test(a)&&(F[t]=e)})),K=[],!j||!j.length){t.next=47;break}K=j,t.next=55;break;case 47:return t.next=49,r.load("swapswapswap");case 49:return Y=t.sent,$=Y.table("markets"),t.next=53,$.all();case 53:K=t.sent,o(y.N.setMarkets(K));case 55:return t.next=57,r.load("loglogloglog");case 57:G=t.sent,V=G.table("liqs"),X=Object.keys(F),ee={},ae={},ne=d()().mark((function e(){var t,n,r,s,i,l,c,o,u,m,p,y;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(pe("".concat(re+1," / ").concat(X.length)),t=0,n=S,r=[],!x.hasOwnProperty(X[re])){e.next=8;break}r=x[X[re]],e.next=12;break;case 8:return e.next=10,V.all({scope:X[re]});case 10:r=e.sent,ee[X[re]]=r;case 12:if((s=r.find((function(e){return e.mid.toNumber()===h})))&&(i=K.find((function(e){return e.mid.equals(s.mid)})),l=s.token.toNumber()/i.liquidity_token.toNumber(),c=l*i.reserve0.value,o=l*i.reserve1.value,u=i.reserve0.symbol.name,m=i.reserve1.symbol.name,0===f?(t=c,n=u):(t=o,n=m)),F[X[re]].liqBalance=t,F[X[re]].liqSym=n,p=0,y=[],2!==g){e.next=29;break}if(!k.hasOwnProperty(X[re])){e.next=23;break}y=k[X[re]],e.next=27;break;case 23:return e.next=25,a.client.v1.chain.get_currency_balance(v,X[re],q);case 25:y=e.sent,ae[X[re]]=y;case 27:y.length&&(p=y[0].value),F[X[re]].holdBalance=p;case 29:case"end":return e.stop()}}),e)})),re=0;case 64:if(!(re<X.length)){t.next=69;break}return t.delegateYield(ne(),"t0",66);case 66:re++,t.next=64;break;case 69:for(Object.keys(ee).length&&o(I.N.setLiqsCache(w()(w()({},x),ee))),Object.keys(ae).length&&o(I.N.setAssetsCache(w()(w()({},k),ae))),1===g?X.forEach((function(e){var t=F[e].liqBalance;F[e].data.amount>=m&&t>=C?T.push(F[e]):M.push(F[e])})):2===g&&X.forEach((function(e){var t=F[e].liqBalance+F[e].holdBalance;F[e].data.amount>=m&&t>=N?T.push(F[e]):M.push(F[e])})),ie={},le=[],ce=1;ce<Z.length;ce++)ie["scheme".concat(ce)]={vote:0,name:"方案".concat(ce)},le.push("方案".concat(ce));T.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,i=l().utc(e.timestamp).local().format(),c=e.data.quantity,o=e.transaction_id,u=1;u<Z.length;u++)if(Z[u].test(a)){ie["scheme".concat(u)].vote+=1,D.push({key:t,account:n,liqBalance:r,liqSym:s,time:i,quantity:c,scheme:ie["scheme".concat(u)].name,memo:a,txid:o});break}})),Object.keys(ie).forEach((function(e,t){O.push({key:t,scheme:ie[e].name,vote:ie[e].vote,ratio:ie[e].vote/T.length})})),B(O),P(D.sort((function(e,t){return e.time.localeCompare(t.time)}))),oe(le),M.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,i=l().utc(e.timestamp).local().format(),c=e.data.quantity,o=e.transaction_id,u=1;u<Z.length;u++)if(Z[u].test(a)){ie["scheme".concat(u)].vote+=1,_.push({key:t,account:n,liqBalance:r,liqSym:s,time:i,quantity:c,scheme:ie["scheme".concat(u)].name,memo:a,txid:o});break}})),W(_.sort((function(e,t){return e.time.localeCompare(t.time)}))),ue=0,O.forEach((function(e){e.vote>ue&&(ue=e.vote,me=e)})),D.forEach((function(e){e.scheme===me.scheme?A.push(e):U.push(e)})),Q(A.sort((function(e,t){return e.time.localeCompare(t.time)}))),te(U.sort((function(e,t){return e.time.localeCompare(t.time)}))),se(!1),t.next=94;break;case 90:t.prev=90,t.t1=t.catch(0),se(!1),(0,b.Tv)(t.t1,n);case 94:case"end":return t.stop()}}),t,null,[[0,90]])})));return function(e,a){return t.apply(this,arguments)}}(),[xe,n,k,x,j,e.params]),ye={data:Z,xField:"scheme",yField:"vote",meta:{vote:{alias:"票数"}},label:{},color:function(){return"#5B8FF9"},minColumnWidth:30,maxColumnWidth:30},be=(0,u.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,a){return(0,N.jsx)("span",{children:a+1})}},{title:"账号",dataIndex:"account",key:"account",sorter:function(e,t){return e.account.localeCompare(t.account)},render:function(e,t){return(0,N.jsx)("a",{onClick:function(){return i("/query/account?search=".concat(t.account,"&tab=info"))},children:t.account})}},{title:"JIU/DFS矿池做市",dataIndex:"liqBalance",key:"liqBalance",sorter:function(e,t){return t.liqBalance-e.liqBalance},render:function(e,t){return(0,N.jsx)("span",{children:(0,b.CE)(t.liqBalance.toFixed(0))+" "+t.liqSym})}},{title:"转账数量",dataIndex:"quantity",key:"quantity",sorter:function(e,t){return Number(t.quantity.split(" ")[0])-Number(e.quantity.split(" ")[0])},render:function(e,t){var a=Number(t.quantity.split(" ")[0]),n=t.quantity.split(" ")[1];return(0,N.jsx)("span",{children:(0,b.CE)(a.toFixed(0))+" "+n})}},{title:"转账时间",dataIndex:"time",key:"time",sorter:function(e,t){return t.time.localeCompare(e.time)},render:function(e,t){return(0,N.jsx)("span",{children:t.time})}},{title:"投票方案",dataIndex:"scheme",key:"scheme",sorter:function(e,t){return e.scheme.localeCompare(t.scheme)},filters:ce.map((function(e){return{text:e,value:e}})),onFilter:function(e,t){return e===t.scheme},render:function(e,t){return(0,N.jsx)("span",{children:t.scheme})}},{title:"原始数据",dataIndex:"memo",key:"memo",render:function(e,t){return(0,N.jsx)("span",{children:t.memo})}},{title:"交易id",dataIndex:"txid",key:"txid",render:function(e,t){return(0,N.jsx)("a",{onClick:function(){return i("/query/transaction?search=".concat(t.txid,"&tab=summary"))},children:t.txid.slice(0,8)})}}]}),[ce]),ke=(0,u.useMemo)((function(){return[{title:"方案",dataIndex:"scheme",key:"scheme",width:"auto",render:function(e,t){return(0,N.jsx)("span",{children:t.scheme})}},{title:"票数",dataIndex:"vote",key:"vote",width:"auto",render:function(e,t){return(0,N.jsx)("span",{children:t.vote})}},{title:"得票率",dataIndex:"ratio",width:"auto",key:"ratio",render:function(e,t){return(0,N.jsxs)("span",{children:[(100*t.ratio).toFixed(2),"%"]})}}]}),[]),je=(0,u.useCallback)((function(){var t=function(t){var a=0,n=0,r=t.map((function(e,t){var r=Number(e.quantity.split(" ")[0]),s=e.quantity.split(" ")[1];return a+=e.liqBalance,n+=r,{"#":t+1,"账号":e.account,"JIU/DFS矿池做市":(0,b.CE)(e.liqBalance.toFixed(0))+" "+e.liqSym,"转账数量":(0,b.CE)(r.toFixed(0))+" "+s,"转账时间":e.time,"投票方案":e.scheme,"原始数据":e.memo,"交易id":e.txid}}));return r.push({"#":0,"账号":"汇总","JIU/DFS矿池做市":(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym,"转账数量":(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym,"转账时间":"","投票方案":"","原始数据":"","交易id":""}),r},a=function(e){return e.map((function(e){return e.title}))},n=0,r=Z.map((function(e){return n+=e.vote,{"方案":e.scheme,"票数":e.vote,"得票率":(100*e.ratio).toFixed(2)+"%"}}));r.push({"方案":"汇总","票数":n,"得票率":"100%"});var s={};s.fileName="活动".concat(S,"数据汇总"),s.datas=[{sheetData:r,sheetName:"投票结果",sheetFilter:["方案","票数","得票率"],sheetHeader:["方案","票数","得票率"]},{sheetData:t(T),sheetName:"有效投票详情",sheetFilter:a(be),sheetHeader:a(be)},{sheetData:t(K),sheetName:"无效投票详情",sheetFilter:a(be),sheetHeader:a(be)},{sheetData:t(G),sheetName:"获奖用户",sheetFilter:a(be),sheetHeader:a(be)},{sheetData:t(ee),sheetName:"非获奖用户",sheetFilter:a(be),sheetHeader:a(be)}],new(H())(s).saveExcel()}),[e.params,S,be,T,K,G,ee,Z]);return(0,u.useEffect)((function(){p&&m&&!c.current&&(c.current=!0,se(!0),fe(p,m))}),[fe,m,p]),(0,N.jsxs)("div",{className:"result1",children:[(0,N.jsx)(s.ZP,{type:"primary",className:"mt-3 ml-3",onClick:je,children:"导出数据"}),(0,N.jsxs)(D.Z,{className:"mb-4",title:(0,N.jsx)("span",{className:" text-lg font-semibold",children:"投票结果"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:[(0,N.jsx)(A.Z,{size:"large",spinning:re,tip:de,children:(0,N.jsx)(O.Z,w()(w()({},ye),{},{loading:re}))}),(0,N.jsx)(_.Z,{className:"mt-4 summary",scroll:{x:!0},size:"small",columns:ke,dataSource:Z,defaultData:[],loading:{spinning:re,tip:de},search:!1,options:!1,pagination:!1,summary:function(e){var t=0;return e.forEach((function(e){t+=e.vote})),(0,N.jsxs)(U.Z.Summary.Row,{children:[(0,N.jsx)(U.Z.Summary.Cell,{index:0,children:(0,N.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,N.jsx)(U.Z.Summary.Cell,{index:1,children:(0,N.jsx)("span",{className:"font-bold",children:t})}),(0,N.jsx)(U.Z.Summary.Cell,{index:2,children:(0,N.jsx)("span",{className:"font-bold",children:"100%"})})]})}})]}),(0,N.jsx)(D.Z,{className:"mb-4",title:(0,N.jsx)("span",{className:" text-lg font-semibold",children:"有效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"0"},children:(0,N.jsx)(_.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:T,defaultData:[],loading:{spinning:re,tip:de},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0])})),(0,N.jsxs)(U.Z.Summary.Row,{children:[(0,N.jsx)(U.Z.Summary.Cell,{index:0}),(0,N.jsx)(U.Z.Summary.Cell,{index:1,children:(0,N.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,N.jsx)(U.Z.Summary.Cell,{index:2,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:3,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:4}),(0,N.jsx)(U.Z.Summary.Cell,{index:5}),(0,N.jsx)(U.Z.Summary.Cell,{index:6})]})}})}),(0,N.jsx)(D.Z,{className:"mb-4",title:(0,N.jsx)("span",{className:" text-lg font-semibold",children:"无效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,N.jsx)(_.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:K,defaultData:[],loading:{spinning:re,tip:de},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0])})),(0,N.jsxs)(U.Z.Summary.Row,{children:[(0,N.jsx)(U.Z.Summary.Cell,{index:0}),(0,N.jsx)(U.Z.Summary.Cell,{index:1,children:(0,N.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,N.jsx)(U.Z.Summary.Cell,{index:2,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:3,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:4}),(0,N.jsx)(U.Z.Summary.Cell,{index:5}),(0,N.jsx)(U.Z.Summary.Cell,{index:6})]})}})}),(0,N.jsx)(D.Z,{className:"mb-4",title:(0,N.jsx)("span",{className:" text-lg font-semibold",children:"获奖用户"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,N.jsx)(_.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:G,defaultData:[],loading:{spinning:re,tip:de},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0])})),(0,N.jsxs)(U.Z.Summary.Row,{children:[(0,N.jsx)(U.Z.Summary.Cell,{index:0}),(0,N.jsx)(U.Z.Summary.Cell,{index:1,children:(0,N.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,N.jsx)(U.Z.Summary.Cell,{index:2,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:3,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:4}),(0,N.jsx)(U.Z.Summary.Cell,{index:5}),(0,N.jsx)(U.Z.Summary.Cell,{index:6})]})}})}),(0,N.jsx)(D.Z,{className:"mb-4",title:(0,N.jsx)("span",{className:" text-lg font-semibold",children:"非获奖用户"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,N.jsx)(_.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:ee,defaultData:[],loading:{spinning:re,tip:de},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0])})),(0,N.jsxs)(U.Z.Summary.Row,{children:[(0,N.jsx)(U.Z.Summary.Cell,{index:0}),(0,N.jsx)(U.Z.Summary.Cell,{index:1,children:(0,N.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,N.jsx)(U.Z.Summary.Cell,{index:2,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:3,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:4}),(0,N.jsx)(U.Z.Summary.Cell,{index:5}),(0,N.jsx)(U.Z.Summary.Cell,{index:6})]})}})}),r]})},K=(0,u.memo)(J);l().extend(o());var W=function(e){var t=q.ZP.useMessage(),a=f()(t,2),n=a[0],r=a[1],i=(0,g.useNavigate)(),c=(0,u.useRef)(!1),o=(0,g.useDispatch)(),m=(0,g.useSelector)((function(e){return e.global.contractKit})),p=(0,g.useSelector)((function(e){return e.global.session})),x=(0,g.useSelector)((function(e){return e.jiu.liqsCache})),k=(0,g.useSelector)((function(e){return e.jiu.assetsCache})),j=(0,g.useSelector)((function(e){return e.jiu.activeKey})),S=(0,g.useSelector)((function(e){return e.account.markets})),C=(0,u.useState)([]),v=f()(C,2),Z=v[0],B=v[1],E=(0,u.useState)([]),F=f()(E,2),T=F[0],P=F[1],L=(0,u.useState)([]),J=f()(L,2),K=J[0],W=J[1],Y=(0,u.useState)([]),$=f()(Y,2),G=$[0],Q=$[1],V=(0,u.useState)([]),X=f()(V,2),ee=X[0],te=X[1],ae=(0,u.useState)(!1),ne=f()(ae,2),re=ne[0],se=ne[1],ie=(0,u.useState)([]),le=f()(ie,2),ce=le[0],oe=le[1],ue=(0,u.useState)(""),me=f()(ue,2),de=me[0],pe=me[1],he=(0,g.useIntl)().formatMessage({id:"jiu.intlMissingData"}),xe=(0,u.useCallback)(function(){var e=h()(d()().mark((function e(t){var a,r,s,i,c,o,u,m,p,h,x,y,k,j,S,C,g,v,q,N,Z,B,E,F,T,w,I,O,D;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="jiutothemoon",r="000d9cae502dd1cc895745e204f83cc892bc4c450f92a03ecd4fe057709853cc",s=(0,R.js)("md5"),i=r+a,s.update(i),c=s.digest("hex").substring(0,8),o={key:c,chainId:r,account:a,skip:0,lastUpdate:"2020-01-01T01:01:01.000Z",error:!1,data:[]},e.next=9,M.db.txList.where({key:c}).toArray();case 9:if((u=e.sent).length&&(o=u[0]),!(t&&l().utc(o.lastUpdate).valueOf()>l().utc(t).valueOf())){e.next=13;break}return e.abrupt("return",o.data);case 13:m=[],p=500,h=o.lastUpdate,x=o.skip;case 17:return e.next=20,(0,b.zI)(z().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&sort=asc&simple=true&noBinary=true&account=".concat(a,"&after=").concat(h,"&limit=").concat(p)));case 20:if(y=e.sent,k=f()(y,2),j=k[0],S=k[1],j||200!==S.status){e.next=73;break}if(C=S.data.simple_actions,g=C.length,v=S.data.total.value,q=1,0!==v){e.next=32;break}return M.db.txList.put(o),e.abrupt("return",o.data);case 32:for(N=0;N<C.length;N++)x<=N&&m.push(C[N]);if(m.length){e.next=36;break}return o.error&&n.error(he),e.abrupt("return",o.data);case 36:Z=m.length-1;case 37:if(!(Z>0)){e.next=46;break}if(m[Z].transaction_id!==m[Z-1].transaction_id){e.next=42;break}q+=1,e.next=43;break;case 42:return e.abrupt("break",46);case 43:Z--,e.next=37;break;case 46:if(x=q,g!==p){e.next=58;break}if(B=m[m.length-1].timestamp,h=B,!(t&&l().utc(B).valueOf()>l().utc(t).valueOf())){e.next=56;break}return m.forEach((function(e){o.data.push(e)})),o.lastUpdate=B,o.skip=x,M.db.txList.put(o),e.abrupt("return",o.data);case 56:e.next=71;break;case 58:return m.forEach((function(e){o.data.push(e)})),E=m[m.length-1].timestamp,o.lastUpdate=E,o.skip=x,e.next=64,(0,b.zI)(z().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&simple=true&noBinary=true&account=".concat(a,"&skip=0&limit=1")));case 64:return F=e.sent,T=f()(F,2),w=T[0],I=T[1],w||200!==I.status?n.error(w):(O=I.data.total.value,o.data.length!==O?(o.error=!0,n.error(he)):o.error=!1),M.db.txList.put(o),e.abrupt("return",o.data);case 71:e.next=77;break;case 73:return m.length&&(m.forEach((function(e){o.data.push(e)})),D=m[m.length-1].timestamp,o.lastUpdate=D,o.skip=x,o.error=!0),M.db.txList.put(o),n.error(j),e.abrupt("return",o.data);case 77:e.next=17;break;case 79:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n]),fe=(0,u.useCallback)(function(){var t=h()(d()().mark((function t(a,r){var s,i,c,u,m,p,h,f,j,C,g,v,q,N,Z,E,F,T,M,O,D,_,A,U,z,R,L,H,J,K,Y,$,G,V,X,ee,ae,ne,re,ie,le,ce,ue,me;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s=e.params.startTime,i=e.params.endTime,c=e.params.receiveAccount,u=e.params.transferTokenContract,m=e.params.transferTokenMinAmount,p=e.params.transferTokenSym,h=e.params.liqMid,f=e.params.liqTokenKey,j=e.params.liqSym,C=e.params.liqTokenMinAmount,g=e.params.ruleType,v="",0,q="",N=0,2===g&&(v=e.params.holdTokenContract,e.params.holdTokenMinAmount,q=e.params.holdTokenSym,N=e.params.allTokenMinAmount),Z=e.params.schemesRegexp,E=[],F={},T=[],M=[],O=[],D=[],_=[],A=[],U=[],t.next=29,xe(i);case 29:z=t.sent,R=0;case 31:if(!(R<z.length)){t.next=41;break}if(L=l().utc(s).valueOf(),H=l().utc(i).valueOf(),J=l().utc(z[R].timestamp).valueOf(),L<=J&&J<=H&&z[R].contract===u&&"transfer"===z[R].action&&z[R].data.symbol===p&&z[R].data.to===c&&"dfsminingout"!==z[R].data.from&&"swapswapswap"!==z[R].data.from&&""!==z[R].data.memo.trim()&&E.push(z[R]),!(J>H)){t.next=38;break}return t.abrupt("break",41);case 38:R++,t.next=31;break;case 41:if(E.forEach((function(e){var t=e.data.from,a=e.data.memo.trim(),n=e.data.amount;F.hasOwnProperty(t)?n>=m&&Z[0].test(a)&&(F[t]=e):Z[0].test(a)&&(F[t]=e)})),K=[],!S||!S.length){t.next=47;break}K=S,t.next=55;break;case 47:return t.next=49,r.load("swapswapswap");case 49:return Y=t.sent,$=Y.table("markets"),t.next=53,$.all();case 53:K=t.sent,o(y.N.setMarkets(K));case 55:return t.next=57,r.load("loglogloglog");case 57:G=t.sent,V=G.table("liqs"),X=Object.keys(F),ee={},ae={},ne=d()().mark((function e(){var t,n,r,s,i,l,c,o,u,m,p,y;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(pe("".concat(re+1," / ").concat(X.length)),t=0,n=j,r=[],!x.hasOwnProperty(X[re])){e.next=8;break}r=x[X[re]],e.next=12;break;case 8:return e.next=10,V.all({scope:X[re]});case 10:r=e.sent,ee[X[re]]=r;case 12:if((s=r.find((function(e){return e.mid.toNumber()===h})))&&(i=K.find((function(e){return e.mid.equals(s.mid)})),l=s.token.toNumber()/i.liquidity_token.toNumber(),c=l*i.reserve0.value,o=l*i.reserve1.value,u=i.reserve0.symbol.name,m=i.reserve1.symbol.name,0===f?(t=c,n=u):(t=o,n=m)),F[X[re]].liqBalance=t,F[X[re]].liqSym=n,p=0,y=[],2!==g){e.next=29;break}if(!k.hasOwnProperty(X[re])){e.next=23;break}y=k[X[re]],e.next=27;break;case 23:return e.next=25,a.client.v1.chain.get_currency_balance(v,X[re],q);case 25:y=e.sent,ae[X[re]]=y;case 27:y.length&&(p=y[0].value),F[X[re]].holdBalance=p;case 29:case"end":return e.stop()}}),e)})),re=0;case 64:if(!(re<X.length)){t.next=69;break}return t.delegateYield(ne(),"t0",66);case 66:re++,t.next=64;break;case 69:for(Object.keys(ee).length&&o(I.N.setLiqsCache(w()(w()({},x),ee))),Object.keys(ae).length&&o(I.N.setAssetsCache(w()(w()({},k),ae))),1===g?X.forEach((function(e){var t=F[e].liqBalance;F[e].data.amount>=m&&t>=C?T.push(F[e]):M.push(F[e])})):2===g&&X.forEach((function(e){var t=F[e].liqBalance+F[e].holdBalance;F[e].data.amount>=m&&t>=N?T.push(F[e]):M.push(F[e])})),ie={},le=[],ce=1;ce<Z.length;ce++)ie["scheme".concat(ce)]={vote:0,name:"方案".concat(ce)},le.push("方案".concat(ce));T.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,i=l().utc(e.timestamp).local().format(),c=e.data.quantity,o=e.transaction_id,u=e.holdBalance,m=r+u,d=1;d<Z.length;d++)if(Z[d].test(a)){ie["scheme".concat(d)].vote+=1,D.push({key:t,account:n,liqBalance:r,liqSym:s,time:i,quantity:c,scheme:ie["scheme".concat(d)].name,memo:a,txid:o,holdBalance:u,holdTokenSym:q,allBalance:m});break}})),Object.keys(ie).forEach((function(e,t){O.push({key:t,scheme:ie[e].name,vote:ie[e].vote,ratio:ie[e].vote/T.length})})),B(O),P(D.sort((function(e,t){return e.time.localeCompare(t.time)}))),oe(le),M.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,i=l().utc(e.timestamp).local().format(),c=e.data.quantity,o=e.transaction_id,u=e.holdBalance,m=r+u,d=1;d<Z.length;d++)if(Z[d].test(a)){ie["scheme".concat(d)].vote+=1,_.push({key:t,account:n,liqBalance:r,liqSym:s,time:i,quantity:c,scheme:ie["scheme".concat(d)].name,memo:a,txid:o,holdBalance:u,holdTokenSym:q,allBalance:m});break}})),W(_.sort((function(e,t){return e.time.localeCompare(t.time)}))),ue=0,O.forEach((function(e){e.vote>ue&&(ue=e.vote,me=e)})),D.forEach((function(e){e.scheme===me.scheme?A.push(e):U.push(e)})),Q(A.sort((function(e,t){return e.time.localeCompare(t.time)}))),te(U.sort((function(e,t){return e.time.localeCompare(t.time)}))),se(!1),t.next=94;break;case 90:t.prev=90,t.t1=t.catch(0),se(!1),(0,b.Tv)(t.t1,n);case 94:case"end":return t.stop()}}),t,null,[[0,90]])})));return function(e,a){return t.apply(this,arguments)}}(),[xe,n,k,x,S,e.params]),ye={data:Z,xField:"scheme",yField:"vote",meta:{vote:{alias:"票数"}},label:{},color:function(){return"#5B8FF9"},minColumnWidth:30,maxColumnWidth:30},be=(0,u.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,a){return(0,N.jsx)("span",{children:a+1})}},{title:"账号",dataIndex:"account",key:"account",sorter:function(e,t){return e.account.localeCompare(t.account)},render:function(e,t){return(0,N.jsx)("a",{onClick:function(){return i("/query/account?search=".concat(t.account,"&tab=info"))},children:t.account})}},{title:"JIU/DFS矿池做市",dataIndex:"liqBalance",key:"liqBalance",sorter:function(e,t){return t.liqBalance-e.liqBalance},render:function(e,t){return(0,N.jsx)("span",{children:(0,b.CE)(t.liqBalance.toFixed(0))+" "+t.liqSym})}},{title:"".concat(e.params.holdTokenSym,"账号余额"),dataIndex:"holdBalance",key:"holdBalance",sorter:function(e,t){return t.holdBalance-e.holdBalance},render:function(e,t){return(0,N.jsx)("span",{children:(0,b.CE)(t.holdBalance.toFixed(0))+" "+t.holdTokenSym})}},{title:"做市+持有",dataIndex:"allBalance",key:"allBalance",sorter:function(e,t){return t.allBalance-e.allBalance},render:function(e,t){return(0,N.jsx)("span",{children:(0,b.CE)(t.allBalance.toFixed(0))+" "+t.holdTokenSym})}},{title:"转账数量",dataIndex:"quantity",key:"quantity",sorter:function(e,t){return Number(t.quantity.split(" ")[0])-Number(e.quantity.split(" ")[0])},render:function(e,t){var a=Number(t.quantity.split(" ")[0]),n=t.quantity.split(" ")[1];return(0,N.jsx)("span",{children:(0,b.CE)(a.toFixed(0))+" "+n})}},{title:"转账时间",dataIndex:"time",key:"time",sorter:function(e,t){return t.time.localeCompare(e.time)},render:function(e,t){return(0,N.jsx)("span",{children:t.time})}},{title:"投票方案",dataIndex:"scheme",key:"scheme",sorter:function(e,t){return e.scheme.localeCompare(t.scheme)},filters:ce.map((function(e){return{text:e,value:e}})),onFilter:function(e,t){return e===t.scheme},render:function(e,t){return(0,N.jsx)("span",{children:t.scheme})}},{title:"原始数据",dataIndex:"memo",key:"memo",render:function(e,t){return(0,N.jsx)("span",{children:t.memo})}},{title:"交易id",dataIndex:"txid",key:"txid",render:function(e,t){return(0,N.jsx)("a",{onClick:function(){return i("/query/transaction?search=".concat(t.txid,"&tab=summary"))},children:t.txid.slice(0,8)})}}]}),[ce,e.params]),ke=(0,u.useMemo)((function(){return[{title:"方案",dataIndex:"scheme",key:"scheme",width:"auto",render:function(e,t){return(0,N.jsx)("span",{children:t.scheme})}},{title:"票数",dataIndex:"vote",key:"vote",width:"auto",render:function(e,t){return(0,N.jsx)("span",{children:t.vote})}},{title:"得票率",dataIndex:"ratio",width:"auto",key:"ratio",render:function(e,t){return(0,N.jsxs)("span",{children:[(100*t.ratio).toFixed(2),"%"]})}}]}),[]),je=(0,u.useCallback)((function(){var t=function(t){var a=0,n=0,r=0,s=0,i=t.map((function(e,t){var s=Number(e.quantity.split(" ")[0]),i=e.quantity.split(" ")[1];return a+=e.liqBalance,n+=s,r+=e.holdBalance,{"#":t+1,"账号":e.account,"JIU/DFS矿池做市":(0,b.CE)(e.liqBalance.toFixed(0))+" "+e.liqSym,"JIU账号余额":(0,b.CE)(e.holdBalance.toFixed(0))+" "+e.holdTokenSym,"做市+持有":(0,b.CE)(e.allBalance.toFixed(0))+" "+e.holdTokenSym,"转账数量":(0,b.CE)(s.toFixed(0))+" "+i,"转账时间":e.time,"投票方案":e.scheme,"原始数据":e.memo,"交易id":e.txid}}));return s=a+r,i.push({"#":0,"账号":"汇总","JIU/DFS矿池做市":(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym,"JIU账号余额":(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym,"做市+持有":(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym,"转账数量":(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym,"转账时间":"","投票方案":"","原始数据":"","交易id":""}),i},a=function(e){return e.map((function(e){return e.title}))},n=0,r=Z.map((function(e){return n+=e.vote,{"方案":e.scheme,"票数":e.vote,"得票率":(100*e.ratio).toFixed(2)+"%"}}));r.push({"方案":"汇总","票数":n,"得票率":"100%"});var s={};s.fileName="活动".concat(j,"数据汇总"),s.datas=[{sheetData:r,sheetName:"投票结果",sheetFilter:["方案","票数","得票率"],sheetHeader:["方案","票数","得票率"]},{sheetData:t(T),sheetName:"有效投票详情",sheetFilter:a(be),sheetHeader:a(be)},{sheetData:t(K),sheetName:"无效投票详情",sheetFilter:a(be),sheetHeader:a(be)},{sheetData:t(G),sheetName:"获奖用户",sheetFilter:a(be),sheetHeader:a(be)},{sheetData:t(ee),sheetName:"非获奖用户",sheetFilter:a(be),sheetHeader:a(be)}],new(H())(s).saveExcel()}),[e.params,j,be,T,K,G,ee,Z]);return(0,u.useEffect)((function(){p&&m&&!c.current&&(c.current=!0,se(!0),fe(p,m))}),[fe,m,p]),(0,N.jsxs)("div",{className:"result2",children:[(0,N.jsx)(s.ZP,{type:"primary",className:"mt-3 ml-3",onClick:je,children:"导出数据"}),(0,N.jsxs)(D.Z,{className:"mb-4",title:(0,N.jsx)("span",{className:" text-lg font-semibold",children:"投票结果"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:[(0,N.jsx)(A.Z,{size:"large",spinning:re,tip:de,children:(0,N.jsx)(O.Z,w()(w()({},ye),{},{loading:re}))}),(0,N.jsx)(_.Z,{className:"mt-4 summary",scroll:{x:!0},size:"small",columns:ke,dataSource:Z,defaultData:[],loading:{spinning:re,tip:de},search:!1,options:!1,pagination:!1,summary:function(e){var t=0;return e.forEach((function(e){t+=e.vote})),(0,N.jsxs)(U.Z.Summary.Row,{children:[(0,N.jsx)(U.Z.Summary.Cell,{index:0,children:(0,N.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,N.jsx)(U.Z.Summary.Cell,{index:1,children:(0,N.jsx)("span",{className:"font-bold",children:t})}),(0,N.jsx)(U.Z.Summary.Cell,{index:2,children:(0,N.jsx)("span",{className:"font-bold",children:"100%"})})]})}})]}),(0,N.jsx)(D.Z,{className:"mb-4",title:(0,N.jsx)("span",{className:" text-lg font-semibold",children:"有效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,N.jsx)(_.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:T,defaultData:[],loading:{spinning:re,tip:de},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0,r=0,s=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0]),r+=e.holdBalance,s+=e.allBalance})),(0,N.jsxs)(U.Z.Summary.Row,{children:[(0,N.jsx)(U.Z.Summary.Cell,{index:0}),(0,N.jsx)(U.Z.Summary.Cell,{index:1,children:(0,N.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,N.jsx)(U.Z.Summary.Cell,{index:2,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:3,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:4,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:5,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:6})]})}})}),(0,N.jsx)(D.Z,{className:"mb-4",title:(0,N.jsx)("span",{className:" text-lg font-semibold",children:"无效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,N.jsx)(_.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:K,defaultData:[],loading:{spinning:re,tip:de},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0,r=0,s=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0]),r+=e.holdBalance,s+=e.allBalance})),(0,N.jsxs)(U.Z.Summary.Row,{children:[(0,N.jsx)(U.Z.Summary.Cell,{index:0}),(0,N.jsx)(U.Z.Summary.Cell,{index:1,children:(0,N.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,N.jsx)(U.Z.Summary.Cell,{index:2,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:3,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:4,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:5,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:6})]})}})}),(0,N.jsx)(D.Z,{className:"mb-4",title:(0,N.jsx)("span",{className:" text-lg font-semibold",children:"获奖用户"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,N.jsx)(_.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:G,defaultData:[],loading:{spinning:re,tip:de},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0,r=0,s=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0]),r+=e.holdBalance,s+=e.allBalance})),(0,N.jsxs)(U.Z.Summary.Row,{children:[(0,N.jsx)(U.Z.Summary.Cell,{index:0}),(0,N.jsx)(U.Z.Summary.Cell,{index:1,children:(0,N.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,N.jsx)(U.Z.Summary.Cell,{index:2,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:3,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:4,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:5,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:6})]})}})}),(0,N.jsx)(D.Z,{className:"mb-4",title:(0,N.jsx)("span",{className:" text-lg font-semibold",children:"非获奖用户"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,N.jsx)(_.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:ee,defaultData:[],loading:{spinning:re,tip:de},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0,r=0,s=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0]),r+=e.holdBalance,s+=e.allBalance})),(0,N.jsxs)(U.Z.Summary.Row,{children:[(0,N.jsx)(U.Z.Summary.Cell,{index:0}),(0,N.jsx)(U.Z.Summary.Cell,{index:1,children:(0,N.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,N.jsx)(U.Z.Summary.Cell,{index:2,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:3,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:4,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:5,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:6})]})}})}),r]})},Y=(0,u.memo)(W);l().extend(o());var $=function(e){var t=q.ZP.useMessage(),a=f()(t,2),n=a[0],r=a[1],i=(0,g.useNavigate)(),c=(0,u.useRef)(!1),o=(0,g.useDispatch)(),m=(0,g.useSelector)((function(e){return e.global.contractKit})),p=(0,g.useSelector)((function(e){return e.global.session})),x=(0,g.useSelector)((function(e){return e.jiu.liqsCache})),k=(0,g.useSelector)((function(e){return e.jiu.assetsCache})),j=(0,g.useSelector)((function(e){return e.jiu.activeKey})),S=(0,g.useSelector)((function(e){return e.account.markets})),C=(0,u.useState)([]),v=f()(C,2),Z=v[0],B=v[1],E=(0,u.useState)([]),F=f()(E,2),T=F[0],O=F[1],A=(0,u.useState)(!1),P=f()(A,2),L=P[0],J=P[1],K=(0,u.useState)(""),W=f()(K,2),Y=W[0],$=W[1],G=(0,g.useIntl)().formatMessage({id:"jiu.intlMissingData"}),Q=(0,u.useCallback)(function(){var e=h()(d()().mark((function e(t){var a,r,s,i,c,o,u,m,p,h,x,y,k,j,S,C,g,v,q,N,Z,B,E,F,T,w,I,O,D;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="jiutothemoon",r="000d9cae502dd1cc895745e204f83cc892bc4c450f92a03ecd4fe057709853cc",s=(0,R.js)("md5"),i=r+a,s.update(i),c=s.digest("hex").substring(0,8),o={key:c,chainId:r,account:a,skip:0,lastUpdate:"2020-01-01T01:01:01.000Z",error:!1,data:[]},e.next=9,M.db.txList.where({key:c}).toArray();case 9:if((u=e.sent).length&&(o=u[0]),!(t&&l().utc(o.lastUpdate).valueOf()>l().utc(t).valueOf())){e.next=13;break}return e.abrupt("return",o.data);case 13:m=[],p=500,h=o.lastUpdate,x=o.skip;case 17:return e.next=20,(0,b.zI)(z().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&sort=asc&simple=true&noBinary=true&account=".concat(a,"&after=").concat(h,"&limit=").concat(p)));case 20:if(y=e.sent,k=f()(y,2),j=k[0],S=k[1],j||200!==S.status){e.next=73;break}if(C=S.data.simple_actions,g=C.length,v=S.data.total.value,q=1,0!==v){e.next=32;break}return M.db.txList.put(o),e.abrupt("return",o.data);case 32:for(N=0;N<C.length;N++)x<=N&&m.push(C[N]);if(m.length){e.next=36;break}return o.error&&n.error(G),e.abrupt("return",o.data);case 36:Z=m.length-1;case 37:if(!(Z>0)){e.next=46;break}if(m[Z].transaction_id!==m[Z-1].transaction_id){e.next=42;break}q+=1,e.next=43;break;case 42:return e.abrupt("break",46);case 43:Z--,e.next=37;break;case 46:if(x=q,g!==p){e.next=58;break}if(B=m[m.length-1].timestamp,h=B,!(t&&l().utc(B).valueOf()>l().utc(t).valueOf())){e.next=56;break}return m.forEach((function(e){o.data.push(e)})),o.lastUpdate=B,o.skip=x,M.db.txList.put(o),e.abrupt("return",o.data);case 56:e.next=71;break;case 58:return m.forEach((function(e){o.data.push(e)})),E=m[m.length-1].timestamp,o.lastUpdate=E,o.skip=x,e.next=64,(0,b.zI)(z().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&simple=true&noBinary=true&account=".concat(a,"&skip=0&limit=1")));case 64:return F=e.sent,T=f()(F,2),w=T[0],I=T[1],w||200!==I.status?n.error(w):(O=I.data.total.value,o.data.length!==O?(o.error=!0,n.error(G)):o.error=!1),M.db.txList.put(o),e.abrupt("return",o.data);case 71:e.next=77;break;case 73:return m.length&&(m.forEach((function(e){o.data.push(e)})),D=m[m.length-1].timestamp,o.lastUpdate=D,o.skip=x,o.error=!0),M.db.txList.put(o),n.error(j),e.abrupt("return",o.data);case 77:e.next=17;break;case 79:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n]),V=(0,u.useCallback)(function(){var t=h()(d()().mark((function t(a,r){var s,i,c,u,m,p,h,f,j,C,g,v,q,N,Z,E,F,T,M,D,_,A,U,P,z,R,L,H,K,W,Y,G,V,X,ee,te;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s=e.params.startTime,i=e.params.endTime,c=e.params.receiveAccount,u=e.params.transferTokenContract,m=e.params.transferTokenMinAmount,p=e.params.transferTokenSym,h=e.params.liqMid,f=e.params.liqTokenKey,j=e.params.liqSym,C=e.params.liqTokenMinAmount,g=e.params.ruleType,v="",0,q="",N=0,2===g&&(v=e.params.holdTokenContract,e.params.holdTokenMinAmount,q=e.params.holdTokenSym,N=e.params.allTokenMinAmount),Z=e.params.pattern,E=[],F={},T=[],M=[],D=[],_=[],t.next=26,Q(i);case 26:A=t.sent,U=0;case 28:if(!(U<A.length)){t.next=38;break}if(P=l().utc(s).valueOf(),z=l().utc(i).valueOf(),R=l().utc(A[U].timestamp).valueOf(),P<=R&&R<=z&&A[U].contract===u&&"transfer"===A[U].action&&A[U].data.symbol===p&&A[U].data.to===c&&"dfsminingout"!==A[U].data.from&&"swapswapswap"!==A[U].data.from&&""!==A[U].data.memo.trim()&&E.push(A[U]),!(R>z)){t.next=35;break}return t.abrupt("break",38);case 35:U++,t.next=28;break;case 38:if(E.forEach((function(e){var t=e.data.from,a=e.data.memo.trim(),n=e.data.amount;F.hasOwnProperty(t)?n>=m&&Z.test(a)&&(F[t]=e):Z.test(a)&&(F[t]=e)})),L=[],!S||!S.length){t.next=44;break}L=S,t.next=52;break;case 44:return t.next=46,r.load("swapswapswap");case 46:return H=t.sent,K=H.table("markets"),t.next=50,K.all();case 50:L=t.sent,o(y.N.setMarkets(L));case 52:return t.next=54,r.load("loglogloglog");case 54:W=t.sent,Y=W.table("liqs"),G=Object.keys(F),V={},X={},ee=d()().mark((function e(){var t,n,r,s,i,l,c,o,u,m,p,y;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if($("".concat(te+1," / ").concat(G.length)),t=0,n=j,r=[],!x.hasOwnProperty(G[te])){e.next=8;break}r=x[G[te]],e.next=12;break;case 8:return e.next=10,Y.all({scope:G[te]});case 10:r=e.sent,V[G[te]]=r;case 12:if((s=r.find((function(e){return e.mid.toNumber()===h})))&&(i=L.find((function(e){return e.mid.equals(s.mid)})),l=s.token.toNumber()/i.liquidity_token.toNumber(),c=l*i.reserve0.value,o=l*i.reserve1.value,u=i.reserve0.symbol.name,m=i.reserve1.symbol.name,0===f?(t=c,n=u):(t=o,n=m)),F[G[te]].liqBalance=t,F[G[te]].liqSym=n,p=0,y=[],2!==g){e.next=29;break}if(!k.hasOwnProperty(G[te])){e.next=23;break}y=k[G[te]],e.next=27;break;case 23:return e.next=25,a.client.v1.chain.get_currency_balance(v,G[te],q);case 25:y=e.sent,X[G[te]]=y;case 27:y.length&&(p=y[0].value),F[G[te]].holdBalance=p;case 29:case"end":return e.stop()}}),e)})),te=0;case 61:if(!(te<G.length)){t.next=66;break}return t.delegateYield(ee(),"t0",63);case 63:te++,t.next=61;break;case 66:Object.keys(V).length&&o(I.N.setLiqsCache(w()(w()({},x),V))),Object.keys(X).length&&o(I.N.setAssetsCache(w()(w()({},k),X))),1===g?G.forEach((function(e){var t=F[e].liqBalance;F[e].data.amount>=m&&t>=C?T.push(F[e]):M.push(F[e])})):2===g&&G.forEach((function(e){var t=F[e].liqBalance+F[e].holdBalance;F[e].data.amount>=m&&t>=N?T.push(F[e]):M.push(F[e])})),T.forEach((function(e,t){var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,i=l().utc(e.timestamp).local().format(),c=e.data.quantity,o=e.transaction_id,u=e.holdBalance,m=r+u,d=Z.exec(a),p="";p=d?d[1]:a,D.push({key:t,account:n,liqBalance:r,liqSym:s,time:i,quantity:c,scheme:p,memo:a,txid:o,holdBalance:u,holdTokenSym:q,allBalance:m})})),B(D.sort((function(e,t){return e.time.localeCompare(t.time)}))),M.forEach((function(e,t){var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,i=l().utc(e.timestamp).local().format(),c=e.data.quantity,o=e.transaction_id,u=e.holdBalance,m=r+u,d=Z.exec(a),p="";p=d?d[1]:a,_.push({key:t,account:n,liqBalance:r,liqSym:s,time:i,quantity:c,scheme:p,memo:a,txid:o,holdBalance:u,holdTokenSym:q,allBalance:m})})),O(_.sort((function(e,t){return e.time.localeCompare(t.time)}))),J(!1),t.next=80;break;case 76:t.prev=76,t.t1=t.catch(0),J(!1),(0,b.Tv)(t.t1,n);case 80:case"end":return t.stop()}}),t,null,[[0,76]])})));return function(e,a){return t.apply(this,arguments)}}(),[Q,n,k,x,S,e.params]),X=(0,u.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,a){return(0,N.jsx)("span",{children:a+1})}},{title:"账号",dataIndex:"account",key:"account",sorter:function(e,t){return e.account.localeCompare(t.account)},render:function(e,t){return(0,N.jsx)("a",{onClick:function(){return i("/query/account?search=".concat(t.account,"&tab=info"))},children:t.account})}},{title:"JIU/DFS矿池做市",dataIndex:"liqBalance",key:"liqBalance",sorter:function(e,t){return t.liqBalance-e.liqBalance},render:function(e,t){return(0,N.jsx)("span",{children:(0,b.CE)(t.liqBalance.toFixed(0))+" "+t.liqSym})}},{title:"".concat(e.params.holdTokenSym,"账号余额"),dataIndex:"holdBalance",key:"holdBalance",sorter:function(e,t){return t.holdBalance-e.holdBalance},render:function(e,t){return(0,N.jsx)("span",{children:(0,b.CE)(t.holdBalance.toFixed(0))+" "+t.holdTokenSym})}},{title:"做市+持有",dataIndex:"allBalance",key:"allBalance",sorter:function(e,t){return t.allBalance-e.allBalance},render:function(e,t){return(0,N.jsx)("span",{children:(0,b.CE)(t.allBalance.toFixed(0))+" "+t.holdTokenSym})}},{title:"转账数量",dataIndex:"quantity",key:"quantity",sorter:function(e,t){return Number(t.quantity.split(" ")[0])-Number(e.quantity.split(" ")[0])},render:function(e,t){var a=Number(t.quantity.split(" ")[0]),n=t.quantity.split(" ")[1];return(0,N.jsx)("span",{children:(0,b.CE)(a.toFixed(0))+" "+n})}},{title:"转账时间",dataIndex:"time",key:"time",sorter:function(e,t){return t.time.localeCompare(e.time)},render:function(e,t){return(0,N.jsx)("span",{children:t.time})}},{title:"预测时间",dataIndex:"scheme",key:"scheme",sorter:function(e,t){return Number(e.scheme)-Number(t.scheme)},render:function(e,t){return(0,N.jsx)("span",{children:t.scheme})}},{title:"原始数据",dataIndex:"memo",key:"memo",render:function(e,t){return(0,N.jsx)("span",{children:t.memo})}},{title:"交易id",dataIndex:"txid",key:"txid",render:function(e,t){return(0,N.jsx)("a",{onClick:function(){return i("/query/transaction?search=".concat(t.txid,"&tab=summary"))},children:t.txid.slice(0,8)})}}]}),[e.params]),ee=(0,u.useCallback)((function(){var t=function(t){var a=0,n=0,r=0,s=0,i=t.map((function(e,t){var s=Number(e.quantity.split(" ")[0]),i=e.quantity.split(" ")[1];return a+=e.liqBalance,n+=s,r+=e.holdBalance,{"#":t+1,"账号":e.account,"JIU/DFS矿池做市":(0,b.CE)(e.liqBalance.toFixed(0))+" "+e.liqSym,"DFS账号余额":(0,b.CE)(e.holdBalance.toFixed(0))+" "+e.holdTokenSym,"做市+持有":(0,b.CE)(e.allBalance.toFixed(0))+" "+e.holdTokenSym,"转账数量":(0,b.CE)(s.toFixed(0))+" "+i,"转账时间":e.time,"预测时间":e.scheme,"原始数据":e.memo,"交易id":e.txid}}));return s=a+r,i.push({"#":0,"账号":"汇总","JIU/DFS矿池做市":(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym,"DFS账号余额":(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym,"做市+持有":(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym,"转账数量":(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym,"转账时间":"","预测时间":"","原始数据":"","交易id":""}),i},a=function(e){return e.map((function(e){return e.title}))},n={};n.fileName="活动".concat(j,"数据汇总"),n.datas=[{sheetData:t(Z),sheetName:"有效预测详情",sheetFilter:a(X),sheetHeader:a(X)},{sheetData:t(T),sheetName:"无效预测详情",sheetFilter:a(X),sheetHeader:a(X)}],new(H())(n).saveExcel()}),[e.params,j,X,Z,T]);return(0,u.useEffect)((function(){p&&m&&!c.current&&(c.current=!0,J(!0),V(p,m))}),[V,m,p]),(0,N.jsxs)("div",{className:"result2",children:[(0,N.jsx)(s.ZP,{type:"primary",className:"mt-3 ml-3",onClick:ee,children:"导出数据"}),(0,N.jsx)(D.Z,{className:"mb-4",title:(0,N.jsx)("span",{className:" text-lg font-semibold",children:"有效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,N.jsx)(_.Z,{scroll:{x:!0},size:"small",columns:X,dataSource:Z,defaultData:[],loading:{spinning:L,tip:Y},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0,r=0,s=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0]),r+=e.holdBalance,s+=e.allBalance})),(0,N.jsxs)(U.Z.Summary.Row,{children:[(0,N.jsx)(U.Z.Summary.Cell,{index:0}),(0,N.jsx)(U.Z.Summary.Cell,{index:1,children:(0,N.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,N.jsx)(U.Z.Summary.Cell,{index:2,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:3,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:4,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:5,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:6})]})}})}),(0,N.jsx)(D.Z,{className:"mb-4",title:(0,N.jsx)("span",{className:" text-lg font-semibold",children:"无效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,N.jsx)(_.Z,{scroll:{x:!0},size:"small",columns:X,dataSource:T,defaultData:[],loading:{spinning:L,tip:Y},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0,r=0,s=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0]),r+=e.holdBalance,s+=e.allBalance})),(0,N.jsxs)(U.Z.Summary.Row,{children:[(0,N.jsx)(U.Z.Summary.Cell,{index:0}),(0,N.jsx)(U.Z.Summary.Cell,{index:1,children:(0,N.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,N.jsx)(U.Z.Summary.Cell,{index:2,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:3,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:4,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:5,children:(0,N.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,N.jsx)(U.Z.Summary.Cell,{index:6})]})}})}),r]})},G=(0,u.memo)($)}}]);