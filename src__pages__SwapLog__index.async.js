"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[615],{61776:function(e,t,r){r.r(t),r.d(t,{default:function(){return h}});var n=r(15009),o=r.n(n),a=r(52677),s=r.n(a),u=r(99289),c=r.n(u),i=r(5574),l=r.n(i),p=r(9004),d=r(19601),f=r(11774),m=r(92340),_=r(59530),g=r(45360),v=r(62435),b=r(86074),h=function(){var e=g.ZP.useMessage(),t=l()(e,2),r=t[0],n=t[1],a=(0,v.useState)(!1),u=l()(a,2),i=u[0],h=u[1],k=(0,_.useDispatch)(),S=(0,_.useSelector)((function(e){return e.global.session})),w=(0,_.useSelector)((function(e){return e.global.contractKit})),x=(0,_.useSelector)((function(e){return e.vote.producerDataSource1})),N=(0,v.useCallback)(function(){var e=c()(o()().mark((function e(t,n){var a,u,c,i,l,f,m,_,g,v,b,S,w,x,N,y,R,D,E;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.load("eosio");case 3:return a=e.sent,e.next=6,n.load("dfsbpsvoters");case 6:return u=e.sent,c=u.table("configs"),i=u.table("bpstatus"),l=a.table("producers"),f=u.table("bpinfos"),e.next=13,i.all();case 13:return m=e.sent,e.next=16,l.all();case 16:return _=e.sent,e.next=19,c.get();case 19:return g=e.sent,e.next=22,f.all();case 22:return v=e.sent,e.next=25,t.client.v1.chain.get_currency_balance("eosio.token","dfsbpsvoters","DFS");case 25:return b=e.sent,e.next=28,t.client.v1.chain.get_producer_schedule();case 28:S=e.sent,w=S.active.producers,x=m.reduce((function(e,t){return e+t.current_status.toNumber()}),0),N={totalNodes:m.length,totalProducers:w.length,totalNodesOnline:x,minimumRewardRank:g.minimum_reward_rank,minimumRewardVoters:g.minimum_reward_voters.value,bpRewardPoolBal:b[0].value},k(p.N.setNodeInfo(N)),(y=_.sort((function(e,t){return t.total_votes.value-e.total_votes.value}))).forEach((function(e,t){y[t].rank=t+1})),w.forEach((function(e,t){var r=y.find((function(t){return t.owner.toString()===e.producer_name.toString()}));w[t].is_active=r.is_active,w[t].last_claim_time=r.last_claim_time,w[t].producer_authority=r.producer_authority,w[t].producer_key=r.producer_key,w[t].total_votes=r.total_votes,w[t].url=r.url,w[t].rank=r.rank;var n=v.find((function(t){return t.bp.toString()===e.producer_name.toString()}));n?(w[t].intro=n.intro,w[t].location=n.location,w[t].logo=n.logo,w[t].nick=n.nick,w[t].p2purl=n.p2purl,w[t].rpcurl=n.rpcurl):(w[t].intro="",w[t].location="",w[t].logo="https://dfs.land/assets/icons/48x48.png",w[t].nick="",w[t].p2purl="NA",w[t].rpcurl="NA");var o=m.find((function(t){return t.bp.toString()===e.producer_name.toString()}));w[t].bp=o.bp,w[t].current_status=o.current_status,w[t].p2pstatus=o.p2pstatus,w[t].rpcstatus=o.rpcstatus,w[t].total_reward=o.total_reward})),R=0,w.forEach((function(e,t){w[t].key=t,"1"===w[t].current_status.toString()&&e.total_votes.value>=N.minimumRewardVoters&&R<N.minimumRewardRank?(R+=1,w[t].is_reward="1"):w[t].is_reward="0"})),D=[],E=[],w.forEach((function(e,t){t<15?D.push(e):E.push(e)})),k(d.N.setProducerDataSource1(D)),k(d.N.setProducerDataSource2(E)),h(!1),e.next=50;break;case 46:e.prev=46,e.t0=e.catch(0),h(!1),e.t0 instanceof Error?(console.log(e.t0.message),r.error(e.t0.message)):e.t0.response?(console.log(e.t0.response),r.error(JSON.stringify(e.t0.response.data))):e.t0.request?(console.log("no response"),r.error("No response")):(console.log(e.t0),"object"===s()(e.t0)?r.error(JSON.stringify(e.t0)):r.error(e.t0));case 50:case"end":return e.stop()}}),e,null,[[0,46]])})));return function(t,r){return e.apply(this,arguments)}}(),[]);(0,v.useEffect)((function(){S&&w?(x.length?h(!1):h(!0),N(S,w)):h(!0)}),[S,w,N]);var y=(0,v.useMemo)((function(){return[]}),[]);return(0,b.jsxs)(f._z,{className:"producer",ghost:!0,children:[(0,b.jsx)(m.Z,{className:"mb-3",scroll:{x:!0},size:"small",columns:y,dataSource:x,defaultData:[],search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,loading:i}),n]})}}}]);