"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[98],{42932:function(e,t,r){r.r(t),r.d(t,{default:function(){return j}});var n=r(15009),s=r.n(n),o=r(52677),a=r.n(o),c=r(99289),u=r.n(c),l=r(5574),i=r.n(l),d=r(95260),p=r(9004),f=r(19601),g=r(64119),h=r(11774),v=r(92340),b=r(59530),x=r(45360),_=r(71230),m=r(15746),S=r(62435),k=r(86074),N=0,w=0,j=function(){var e=x.ZP.useMessage(),t=i()(e,2),r=t[0],n=t[1],o=(0,S.useState)(!1),c=i()(o,2),l=c[0],j=c[1],y=(0,b.useDispatch)(),D=(0,b.useSelector)((function(e){return e.global.session})),I=(0,b.useSelector)((function(e){return e.global.contractKit})),R=(0,b.useSelector)((function(e){return e.vote.producerDataSource1})),C=(0,b.useSelector)((function(e){return e.vote.producerDataSource2})),P=(0,S.useState)(""),E=i()(P,2),O=E[0],Z=E[1],A=(0,S.useRef)(),z=(0,S.useCallback)(function(){var e=u()(s()().mark((function e(t,n){var o,c,u,l,i,d,g,h,v,b,x,_,m,S,k,N,w;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.load("eosio");case 3:return o=e.sent,e.next=6,n.load("dfsbpsvoters");case 6:return c=e.sent,u=c.table("bpstatus"),l=o.table("producers"),i=c.table("bpinfos"),e.next=12,u.all();case 12:return d=e.sent,e.next=15,l.all();case 15:return g=e.sent,e.next=18,i.all();case 18:return h=e.sent,e.next=21,t.client.v1.chain.get_currency_stats("eosio.token","DFS");case 21:return v=e.sent,e.next=24,t.client.v1.chain.get_currency_balance("eosio.token","dfsbpsvoters","DFS");case 24:return b=e.sent,e.next=27,t.client.v1.chain.get_producer_schedule();case 27:x=e.sent,_=x.active.producers,m=d.reduce((function(e,t){return e+t.current_status.toNumber()}),0),S={totalNodes:d.length,totalProducers:_.length,totalNodesOnline:m,rewardMinVotes:v.DFS.supply.value/1e4,bpRewardPoolBal:b[0].value},y(p.N.setNodeInfo(S)),(k=g.sort((function(e,t){return t.total_votes.value-e.total_votes.value}))).forEach((function(e,t){k[t].rank=t+1})),_.forEach((function(e,t){var r=k.find((function(t){return t.owner.toString()===e.producer_name.toString()}));_[t].is_active=r.is_active,_[t].last_claim_time=r.last_claim_time,_[t].producer_authority=r.producer_authority,_[t].producer_key=r.producer_key,_[t].total_votes=r.total_votes,_[t].url=r.url,_[t].rank=r.rank;var n=h.find((function(t){return t.bp.toString()===e.producer_name.toString()}));n?(_[t].intro=n.intro,_[t].location=n.location,_[t].logo=n.logo,_[t].nick=n.nick,_[t].p2purl=n.p2purl,_[t].rpcurl=n.rpcurl):(_[t].intro="",_[t].location="",_[t].logo="https://dfs.land/assets/icons/48x48.png",_[t].nick="",_[t].p2purl="NA",_[t].rpcurl="NA");var s=d.find((function(t){return t.bp.toString()===e.producer_name.toString()}));_[t].bp=s.bp,_[t].current_status=s.current_status,_[t].p2pstatus=s.p2pstatus,_[t].rpcstatus=s.rpcstatus,_[t].total_reward=s.total_reward})),0,_.forEach((function(e,t){_[t].key=t,"1"===_[t].current_status.toString()&&e.total_votes.value/1e8>=S.rewardMinVotes?(1,_[t].is_reward="1"):_[t].is_reward="0"})),N=[],w=[],_.forEach((function(e,t){t<15?N.push(e):w.push(e)})),y(f.N.setProducerDataSource1(N)),y(f.N.setProducerDataSource2(w)),j(!1),e.next=49;break;case 45:e.prev=45,e.t0=e.catch(0),j(!1),e.t0 instanceof Error?(console.log(e.t0.message),r.error(e.t0.message)):e.t0.response?(console.log(e.t0.response),r.error(JSON.stringify(e.t0.response.data))):e.t0.request?(console.log("no response"),r.error("No response")):(console.log(e.t0),"object"===a()(e.t0)?r.error(JSON.stringify(e.t0)):r.error(e.t0));case 49:case"end":return e.stop()}}),e,null,[[0,45]])})));return function(t,r){return e.apply(this,arguments)}}(),[]),M=(0,S.useCallback)(function(){var e=u()(s()().mark((function e(t){var r,n,o,a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=8;break}return e.next=3,(0,g.zI)(t.client.v1.chain.get_info());case 3:r=e.sent,n=i()(r,2),o=n[0],(a=n[1])?Z(a.head_block_producer.toString()):(Z(""),console.log(o));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);(0,S.useEffect)((function(){D&&I?(R.length&&C.length?j(!1):j(!0),z(D,I),M(D)):j(!0)}),[D,I,z,M]),(0,S.useEffect)((function(){return D&&(N=setInterval((function(){M(D)}),6e3)),function(){clearInterval(N)}}),[D,M]),(0,S.useEffect)((function(){return D&&I&&(w=setInterval((function(){z(D,I)}),12e4)),function(){clearInterval(w)}}),[D,I,z]);var F=(0,S.useMemo)((function(){return[{title:"Pruducer",dataIndex:"bp",key:"bp",fixed:!0,render:function(e,t){return O===t.bp.toString()?(0,k.jsx)("span",{className:"text-blue-500 hover:cursor-pointer",children:t.key+1+". "+t.bp.toString()}):(0,k.jsx)("span",{className:"hover:cursor-pointer",children:t.key+1+". "+t.bp.toString()})}},{title:"RPC",dataIndex:"rpcstatus",key:"rpcstatus",align:"center",render:function(e,t){return(0,k.jsx)("div",{children:"online"===t.rpcstatus?(0,k.jsx)("div",{children:1}):(0,k.jsx)("div",{className:"text-red-600 font-semibold",children:0})})}},{title:"P2P",dataIndex:"rpcstatus",key:"rpcstatus",align:"center",render:function(e,t){return(0,k.jsx)("div",{children:"online"===t.p2pstatus?(0,k.jsx)("div",{children:1}):(0,k.jsx)("div",{className:"text-red-600 font-semibold",children:0})})}},{title:"Reward",dataIndex:"current_status",key:"current_status",align:"center",render:function(e,t){return(0,k.jsx)("div",{children:"1"===t.current_status.toString()?(0,k.jsx)("div",{children:1}):(0,k.jsx)("div",{className:"text-red-600 font-semibold",children:0})})}}]}),[O]);return(0,k.jsxs)(h._z,{className:"producer",ghost:!0,children:[(0,k.jsxs)(_.Z,{gutter:10,className:"w-full",children:[(0,k.jsx)(m.Z,{lg:{span:"12"},md:{span:"12"},sm:{span:"24"},xs:{span:"24"},children:(0,k.jsx)(v.Z,{className:"mb-3",scroll:{x:!0},size:"small",columns:F,dataSource:R,defaultData:[],search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,loading:l,rowClassName:function(e){return e.bp.toString()===O?"bg-blue-200":""},onRow:function(e){return{onClick:function(){A.current.handleOpen(e)}}}})}),(0,k.jsx)(m.Z,{lg:{span:"12"},md:{span:"12"},sm:{span:"24"},xs:{span:"24"},children:(0,k.jsx)(v.Z,{className:"mb-3",scroll:{x:!0},size:"small",columns:F,dataSource:C,defaultData:[],search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,loading:l,rowClassName:function(e){return e.bp.toString()===O?"bg-blue-200":""},onRow:function(e){return{onClick:function(){A.current.handleOpen(e)}}}})})]}),(0,k.jsx)(d.Z,{ref:A}),n]})}}}]);