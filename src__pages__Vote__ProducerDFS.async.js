"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1098],{42932:function(e,t,n){n.r(t),n.d(t,{default:function(){return S}});var r=n(15009),s=n.n(r),a=n(99289),c=n.n(a),o=n(5574),u=n.n(o),i=n(74563),l=n(9004),d=n(19601),p=n(64119),f=n(11774),h=n(92340),v=n(59530),x=n(45360),g=n(71230),_=n(15746),w=n(9669),m=n.n(w),k=n(62435),b=n(86074),j=0,N=0,S=function(){var e=x.ZP.useMessage(),t=u()(e,2),n=t[0],r=t[1],a=(0,k.useState)(!1),o=u()(a,2),w=o[0],S=o[1],y=(0,v.useDispatch)(),I=(0,v.useSelector)((function(e){return e.global.session})),D=(0,v.useSelector)((function(e){return e.vote.producerDataSource1})),R=(0,v.useSelector)((function(e){return e.vote.producerDataSource2})),C=(0,k.useState)(""),P=u()(C,2),z=P[0],Z=P[1],A=(0,k.useRef)(),E=(0,k.useCallback)(function(){var e=c()(s()().mark((function e(t){var r,a,c,o,u,i,f,h,v;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m().get("https://api.dfs.land/dfschain/producers");case 3:return r=e.sent.data,e.next=6,t.client.v1.chain.get_currency_stats("eosio.token","DFS");case 6:return a=e.sent,e.next=9,t.client.v1.chain.get_currency_balance("eosio.token","dfsbpsvoters","DFS");case 9:return c=e.sent,e.next=12,t.client.v1.chain.get_producer_schedule();case 12:o=e.sent,u=o.active.producers,i=r.reduce((function(e,t){var n=0;return t.current_status&&(n=t.current_status),e+n}),0),f={totalNodes:r.length,totalProducers:u.length,totalNodesOnline:i,rewardMinVotes:a.DFS.supply.value/1e4,bpRewardPoolBal:c[0].value},y(l.N.setNodeInfo(f)),r.forEach((function(e,t){r[t].last_check||(r[t].current_status=0,r[t].p2pstatus="offline",r[t].rpcstatus="offline",r[t].total_reward="0.00000000 DFS");var n=r[t].logo;n&&!n.startsWith("http")&&n.startsWith("Qm")?r[t].logo="https://imagedelivery.net/hc5yVyoIvwlbf8YqJjqHMw/".concat(n,"/public"):void 0!==n&&/^(https|http|ftp):\/\/[a-zA-Z0-9\-.]+\.[a-zA-Z]{2,}(:[0-9]{1,5})?(\/[\S]*)?$/.test(n)||(r[t].logo="https://dfs.land/assets/icons/48x48.png"),r[t].key=t,r[t].rank=t+1,1===r[t].current_status&&Number(e.total_votes)/1e8>=f.rewardMinVotes?r[t].is_reward=1:r[t].is_reward=0})),u.forEach((function(e,t){var n=r.find((function(t){return t.owner===e.producer_name.toString()}));u[t].is_active=n.is_active,u[t].last_claim=n.last_claim,u[t].total_votes=n.total_votes,u[t].url=n.url,u[t].rank=n.rank,u[t].intro=n.intro,u[t].location=n.location,u[t].logo=n.logo,u[t].nick=n.nick,u[t].p2purl=n.p2purl,u[t].rpcurl=n.rpcurl,u[t].owner=n.owner,u[t].current_status=n.current_status,u[t].p2pstatus=n.p2pstatus,u[t].rpcstatus=n.rpcstatus,u[t].total_reward=n.total_reward,u[t].key=t,u[t].rank=n.rank,u[t].is_reward=n.is_reward})),h=[],v=[],u.forEach((function(e,t){t<15?h.push(e):v.push(e)})),y(d.N.setProducerDataSource1(h)),y(d.N.setProducerDataSource2(v)),S(!1),e.next=31;break;case 27:e.prev=27,e.t0=e.catch(0),S(!1),(0,p.Tv)(e.t0,n,"handleGetNodeInfo");case 31:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t){return e.apply(this,arguments)}}(),[n]),M=(0,k.useCallback)(function(){var e=c()(s()().mark((function e(t){var n,r,a,c;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=8;break}return e.next=3,(0,p.zI)(t.client.v1.chain.get_info());case 3:n=e.sent,r=u()(n,2),a=r[0],(c=r[1])?Z(c.head_block_producer.toString()):(Z(""),console.log(a));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);(0,k.useEffect)((function(){I?(D.length&&R.length?S(!1):S(!0),E(I),M(I)):S(!0)}),[I,E,M]),(0,k.useEffect)((function(){return I&&(j=setInterval((function(){M(I)}),6e3)),function(){clearInterval(j)}}),[I,M]),(0,k.useEffect)((function(){return I&&(N=setInterval((function(){E(I)}),12e4)),function(){clearInterval(N)}}),[I,E]);var O=(0,k.useMemo)((function(){return[{title:"Pruducer",dataIndex:"owner",key:"owner",fixed:!0,render:function(e,t){return z===t.owner?(0,b.jsx)("span",{className:"text-blue-500 hover:cursor-pointer",children:t.key+1+". "+t.owner}):(0,b.jsx)("span",{className:"hover:cursor-pointer",children:t.key+1+". "+t.owner})}},{title:"RPC",dataIndex:"rpcstatus",key:"rpcstatus",align:"center",render:function(e,t){return(0,b.jsx)("div",{children:"online"===t.rpcstatus?(0,b.jsx)("div",{children:1}):(0,b.jsx)("div",{className:"text-red-600 font-semibold",children:0})})}},{title:"P2P",dataIndex:"rpcstatus",key:"rpcstatus",align:"center",render:function(e,t){return(0,b.jsx)("div",{children:"online"===t.p2pstatus?(0,b.jsx)("div",{children:1}):(0,b.jsx)("div",{className:"text-red-600 font-semibold",children:0})})}},{title:"Reward",dataIndex:"current_status",key:"current_status",align:"center",render:function(e,t){return(0,b.jsx)("div",{children:1===t.current_status?(0,b.jsx)("div",{children:1}):(0,b.jsx)("div",{className:"text-red-600 font-semibold",children:0})})}}]}),[z]);return(0,b.jsxs)(f._z,{className:"producer",ghost:!0,children:[(0,b.jsxs)(g.Z,{gutter:10,className:"w-full",children:[(0,b.jsx)(_.Z,{lg:{span:"12"},md:{span:"12"},sm:{span:"24"},xs:{span:"24"},children:(0,b.jsx)(h.Z,{className:"mb-3",scroll:{x:!0},size:"small",columns:O,dataSource:D,defaultData:[],search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,loading:{spinning:w,size:"large"},rowClassName:function(e){return e.owner===z?"bg-blue-200":""},onRow:function(e){return{onClick:function(){A.current.handleOpen(e)}}}})}),(0,b.jsx)(_.Z,{lg:{span:"12"},md:{span:"12"},sm:{span:"24"},xs:{span:"24"},children:(0,b.jsx)(h.Z,{className:"mb-3",scroll:{x:!0},size:"small",columns:O,dataSource:R,defaultData:[],search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,loading:{spinning:w,size:"large"},rowClassName:function(e){return e.owner===z?"bg-blue-200":""},onRow:function(e){return{onClick:function(){A.current.handleOpen(e)}}}})})]}),(0,b.jsx)(i.ot,{ref:A}),r]})}}}]);