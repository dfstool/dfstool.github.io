"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[461],{98165:function(e,t,n){n.d(t,{Z:function(){return i}});var r=n(87462),a=n(62435),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"},o=n(84089),c=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var i=a.forwardRef(c)},7461:function(e,t,n){n.r(t),n.d(t,{default:function(){return z}});var r=n(15009),a=n.n(r),s=n(52677),o=n.n(s),c=n(99289),i=n.n(c),l=n(5574),u=n.n(l),d=n(64119),f=n(11774),m=n(92340),p=n(59530),x=n(80507),v=n(45360),h=n(66309),g=n(83062),b=n(7134),j=n(15867),k=n(71230),S=n(15746),_=n(55054),w=n(62435),N=n(98165),y=n(87462),Z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},F=n(84089),O=function(e,t){return w.createElement(F.Z,(0,y.Z)({},e,{ref:t,icon:Z}))};var D=w.forwardRef(O),R=n(9004),M=n(19601),C=n(98531),I=n(86074),A=0,P=0,z=function(){var e=v.ZP.useMessage(),t=u()(e,2),n=t[0],r=t[1],s=(0,w.useState)(!1),c=u()(s,2),l=c[0],y=c[1],Z=(0,p.useDispatch)(),F=(0,p.useSelector)((function(e){return e.global.session})),O=(0,p.useSelector)((function(e){return e.global.account})),z=(0,p.useSelector)((function(e){return e.global.contractKit})),E=(0,p.useSelector)((function(e){return e.vote.nodeDataSource})),V=(0,w.useState)(""),B=u()(V,2),L=B[0],W=B[1],q=(0,p.useSelector)((function(e){return e.dash.nodeInfo})),J=(0,w.useRef)(),T=(0,p.useIntl)(),G=T.formatMessage({id:"node.intlVotes"}),H=T.formatMessage({id:"node.intlStatus"}),K=T.formatMessage({id:"node.intlP2PStatus"}),Q=T.formatMessage({id:"node.intlRPCStatus"}),U=T.formatMessage({id:"node.intlLocation"}),X=T.formatMessage({id:"node.intlWebsite"}),Y=T.formatMessage({id:"node.intlTotalReward"}),$=T.formatMessage({id:"node.intlAction"}),ee=T.formatMessage({id:"node.intlNodes"}),te=T.formatMessage({id:"node.intlProducers"}),ne=T.formatMessage({id:"node.intlRewardPool"}),re=T.formatMessage({id:"node.intlRewardRank"}),ae=T.formatMessage({id:"producer.intlVote"}),se=T.formatMessage({id:"node.intlVoteSuccess"}),oe=T.formatMessage({id:"node.intlVoteFail"}),ce=T.formatMessage({id:"common.intlPleaseConnectWallet"}),ie=T.formatMessage({id:"common.intlPleaseConnectNetwork"}),le=(0,w.useCallback)(function(){var e=i()(a()().mark((function e(t,r){var s,c,i,l,u,d,f,m,p,v,h,g,b,j,k,S,_;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.load("eosio");case 3:return s=e.sent,e.next=6,r.load("dfsbpsvoters");case 6:return c=e.sent,i=c.table("configs"),l=c.table("bpstatus"),u=s.table("producers"),d=c.table("bpinfos"),e.next=13,l.all();case 13:return f=e.sent,e.next=16,u.all();case 16:return m=e.sent,e.next=19,i.get();case 19:return p=e.sent,e.next=22,d.all();case 22:return v=e.sent,e.next=25,t.client.v1.chain.get_currency_balance("eosio.token","dfsbpsvoters","DFS");case 25:return h=e.sent,e.next=28,t.client.v1.chain.get_producer_schedule();case 28:g=e.sent,b=g.active.producers,j=f.reduce((function(e,t){return e+t.current_status.toNumber()}),0),f.push({bp:x.VG.from("555444333211"),rpcstatus:"offline",p2pstatus:"offline",total_reward:x.xR.from("0.00000000 DFS"),current_status:x.zM.from(0)}),k={totalNodes:m.length,totalProducers:b.length,totalNodesOnline:j,minimumRewardRank:p.minimum_reward_rank,minimumRewardVoters:p.minimum_reward_voters.value,bpRewardPoolBal:h[0].value},Z(R.N.setNodeInfo(k)),f.forEach((function(e,t){var n=m.find((function(t){return t.owner.toString()===e.bp.toString()}));f[t].is_active=n.is_active,f[t].last_claim_time=n.last_claim_time,f[t].producer_authority=n.producer_authority,f[t].producer_key=n.producer_key,f[t].total_votes=n.total_votes,f[t].url=n.url;var r=v.find((function(t){return t.bp.toString()===e.bp.toString()}));r?(f[t].intro=r.intro,f[t].location=r.location,f[t].logo=r.logo,f[t].nick=r.nick,f[t].p2purl=r.p2purl,f[t].rpcurl=r.rpcurl):(f[t].intro="",f[t].location="",f[t].logo="https://dfs.land/assets/icons/48x48.png",f[t].nick="",f[t].p2purl="NA",f[t].rpcurl="NA")})),S=f.sort((function(e,t){return t.total_votes.value-e.total_votes.value})),_=0,S.forEach((function(e,t){S[t].key=t,S[t].rank=t+1,"1"===S[t].current_status.toString()&&e.total_votes.value>=k.minimumRewardVoters&&_<k.minimumRewardRank?(_+=1,S[t].is_reward="1"):S[t].is_reward="0"})),Z(M.N.setNodeDataSource(S)),y(!1),e.next=46;break;case 42:e.prev=42,e.t0=e.catch(0),y(!1),e.t0 instanceof Error?(console.log(e.t0.message),n.error(e.t0.message)):e.t0.response?(console.log(e.t0.response),n.error(JSON.stringify(e.t0.response.data))):e.t0.request?(console.log("no response"),n.error("No response")):(console.log(e.t0),"object"===o()(e.t0)?n.error(JSON.stringify(e.t0)):n.error(e.t0));case 46:case"end":return e.stop()}}),e,null,[[0,42]])})));return function(t,n){return e.apply(this,arguments)}}(),[]),ue=(0,w.useCallback)(function(){var e=i()(a()().mark((function e(t){var n,r,s,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=8;break}return e.next=3,(0,d.zI)(t.client.v1.chain.get_info());case 3:n=e.sent,r=u()(n,2),s=r[0],(o=r[1])?W(o.head_block_producer.toString()):(W(""),console.log(s));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),de=(0,w.useCallback)((function(e){switch(e.nick){case"DFSNode.Online - 广州":return e.key+1+". DFSOnline-广州";case"DFSNode.Online - 杭州":return e.key+1+". DFSOnline-杭州";case"DFSNode.Online - 香港":return e.key+1+". DFSOnline-香港";case"DFSNode.Online - 张家口":return e.key+1+". DFSOnline-张家口";case"DFSNode.Online - 呼和浩特":return e.key+1+". DFSOnline-呼和浩特";case"DFS-美国弗吉尼亚-Node":return e.key+1+". DFS-美国弗吉尼亚";case"DFS-北京节点（持续在线）":return e.key+1+". DFS-北京节点";case"DFS-广州（持续在线）":return e.key+1+". DFS-广州";default:return e.key+1+". "+e.nick}}),[]),fe=(0,w.useCallback)((function(e,t){var n=e.current_status.toString(),r=e.is_reward,a=e.is_active,s=e.total_votes.value,o=a?(0,I.jsx)(h.Z,{color:"blue",children:"Active"}):(0,I.jsx)(h.Z,{children:"Deactive"});return t<30?"1"===n?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(h.Z,{icon:(0,I.jsx)(N.Z,{spin:!0}),color:"blue",children:"Online+30%"}),o]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(h.Z,{className:"font-semibold",icon:(0,I.jsx)(D,{}),color:"red",children:"Offline+30%"}),o]}):t<q.minimumRewardRank?"1"===n&&s>=q.minimumRewardVoters?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(h.Z,{icon:(0,I.jsx)(N.Z,{spin:!0}),color:"blue",children:"Online"}),o]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(h.Z,{className:"font-semibold",icon:(0,I.jsx)(D,{}),color:"red",children:"Offline"}),o]}):"1"===n?"1"===r?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(h.Z,{icon:(0,I.jsx)(N.Z,{spin:!0}),color:"blue",children:"Online"}),o]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(h.Z,{icon:(0,I.jsx)(N.Z,{}),color:"blue",children:"Online"}),o]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(h.Z,{className:"font-semibold",icon:(0,I.jsx)(D,{}),color:"red",children:"Offline"}),o]})}),[]),me=(0,w.useCallback)(function(){var e=i()(a()().mark((function e(t){var r,s,o,c,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F&&F.broadcast){e.next=5;break}return n.error("".concat(ce)),e.abrupt("return");case 5:if(O){e.next=8;break}return n.error("".concat(ie)),e.abrupt("return");case 8:return r={action:{account:"dfsbpsvoters",name:"vote",authorization:[F.permissionLevel],data:{voter:F.actor,producer:t.bp.toString()}}},e.next=11,(0,d.zI)(F.transact(r));case 11:s=e.sent,o=u()(s,2),c=o[0],i=o[1],c?n.error(c):i&&i.response?n.success("".concat(se)):n.error("".concat(oe));case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[F,O]);(0,w.useEffect)((function(){F&&z?(E.length?y(!1):y(!0),le(F,z),ue(F)):y(!0)}),[F,z,le,ue]),(0,w.useEffect)((function(){return F&&(A=setInterval((function(){ue(F)}),6e3)),function(){clearInterval(A)}}),[F,ue]),(0,w.useEffect)((function(){return F&&z&&(P=setInterval((function(){le(F,z)}),12e4)),function(){clearInterval(P)}}),[F,z,le]);var pe=(0,w.useMemo)((function(){return[{title:(0,I.jsx)("span",{className:"text-blue-500",children:L||"Node"}),dataIndex:"bp",key:"bp",fixed:!0,render:function(e,t){return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(g.Z,{title:t.intro,placement:"topLeft",children:(0,I.jsx)("span",{className:"hover:cursor-pointer font-semibold",children:de(t)})}),(0,I.jsxs)("div",{className:"flex items-center",children:[(0,I.jsx)(b.C,{className:"mr-2",size:"default",shape:"square",src:t.logo}),(0,I.jsx)("div",{className:"",children:t.bp.toString()})]})]})}},{title:"".concat(G," / ").concat(H),dataIndex:"current_status",key:"current_status",sorter:function(e,t){return e.total_votes.value-t.total_votes.value},filters:[{text:"Online",value:"online"},{text:"Offline",value:"offline"},{text:"Active",value:"active"},{text:"Deactive",value:"deactive"}],onFilter:function(e,t){return"online"===e?"1"===t.current_status.toString():"offline"===e?"0"===t.current_status.toString():"active"===e?!0===t.is_active:"deactive"!==e||!1===t.is_active},render:function(e,t,n){return(0,I.jsxs)("div",{children:[(0,I.jsx)("div",{onClick:function(){return J.current.handleOpen(t)},children:(0,I.jsx)("a",{children:(t.total_votes.value/1e8).toFixed(0)})}),fe(t,n)]})}},{title:"".concat(Q," / ").concat(K),dataIndex:"rpcstatus",key:"rpcstatus",render:function(e,t){return(0,I.jsxs)("div",{children:["online"===t.rpcstatus?(0,I.jsx)("div",{children:t.rpcurl}):(0,I.jsx)("div",{className:"text-red-600 font-semibold",children:t.rpcurl}),"online"===t.p2pstatus?(0,I.jsx)("div",{children:t.p2purl}):(0,I.jsx)("div",{className:"text-red-600 font-semibold",children:t.p2purl})]})}},{title:"".concat(U," / ").concat(X),dataIndex:"url",key:"url",render:function(e,t){return(0,I.jsxs)("div",{children:[(0,I.jsx)("div",{children:t.location}),(0,I.jsx)("div",{style:{maxWidth:"200px"},children:(0,I.jsx)("a",{href:t.url,target:"blank",children:t.url})})]})}},{title:"".concat(Y),dataIndex:"total_reward",key:"total_reward",sorter:function(e,t){return t.total_reward.value-e.total_reward.value},render:function(e,t){return(0,I.jsx)("div",{children:t.total_reward.value.toFixed(2)+" "+t.total_reward.symbol.name})}},{title:"".concat($),dataIndex:"key",key:"key",align:"center",render:function(e,t){return(0,I.jsx)(j.ZP,{onClick:function(){return me(t)},children:ae})}}]}),[L]);return(0,I.jsxs)(f._z,{className:"node",ghost:!0,children:[(0,I.jsx)(m.Z,{scroll:{x:!0},size:"small",columns:pe,dataSource:E,defaultData:[],loading:l,rowClassName:function(e){return e.bp.toString()===L?"bg-blue-200":"555444333211"===e.bp.toString()?"bg-red-200":""},search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,headerTitle:(0,I.jsxs)(k.Z,{gutter:10,className:"w-full",children:[(0,I.jsx)(S.Z,{lg:{span:"6"},md:{span:"6"},sm:{span:"6"},xs:{span:"6"},children:(0,I.jsx)(_.Z,{title:(0,I.jsx)("div",{className:"text-center",children:ee}),valueStyle:{textAlign:"center"},value:"".concat(q.totalNodesOnline,"/").concat(q.totalNodes)})}),(0,I.jsx)(S.Z,{lg:{span:"6"},md:{span:"6"},sm:{span:"6"},xs:{span:"6"},children:(0,I.jsx)(_.Z,{title:(0,I.jsx)("div",{className:"text-center",children:te}),valueStyle:{textAlign:"center"},value:q.totalProducers})}),(0,I.jsx)(S.Z,{lg:{span:"6"},md:{span:"6"},sm:{span:"6"},xs:{span:"6"},children:(0,I.jsx)(_.Z,{title:(0,I.jsx)("div",{className:"text-center",children:re}),valueStyle:{textAlign:"center"},value:q.minimumRewardRank})}),(0,I.jsx)(S.Z,{lg:{span:"6"},md:{span:"6"},sm:{span:"6"},xs:{span:"6"},children:(0,I.jsx)(_.Z,{title:(0,I.jsx)("div",{className:"text-center",children:ne}),valueStyle:{textAlign:"center"},value:q.bpRewardPoolBal.toFixed(2)})})]})}),(0,I.jsx)(C.Z,{ref:J}),r]})}}}]);