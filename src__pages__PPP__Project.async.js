"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9430],{64225:function(e,t,r){r.r(t);var n=r(15009),s=r.n(n),a=r(99289),o=r.n(a),c=r(5574),u=r.n(c),i=r(38773),l=r(40956),p=r(64119),d=r(11774),f=r(38345),m=r(6466),b=r(59530),x=r(80507),h=r(45360),N=r(7134),v=r(34041),j=r(57953),k=r(38703),y=r(71230),_=r(15746),w=r(9669),S=r.n(w),g=r(27484),P=r.n(g),R=r(70178),F=r.n(R),C=r(62435),E=(r(8849),r(86074));P().extend(F());t.default=function(){var e=(0,b.useDispatch)(),t=h.ZP.useMessage(),r=u()(t,2),n=r[0],a=r[1],c=(0,b.useSelector)((function(e){return e.global.contractKit})),w=(0,b.useSelector)((function(e){return e.global.session})),g=(0,b.useSelector)((function(e){return e.ppp.projectOptions})),R=(0,b.useSelector)((function(e){return e.ppp.projectId})),F=(0,b.useSelector)((function(e){return e.ppp.projectNftSupply})),O=(0,b.useSelector)((function(e){return e.ppp.projectBuyNumber})),D=(0,b.useSelector)((function(e){return e.ppp.projectSellNumber})),T=(0,b.useSelector)((function(e){return e.ppp.projectBurnNumber})),Y=(0,b.useSelector)((function(e){return e.ppp.projectSplitNumber})),M=(0,b.useSelector)((function(e){return e.ppp.projectSecPerRound})),Z=(0,b.useSelector)((function(e){return e.ppp.projectNextRound})),H=(0,b.useSelector)((function(e){return e.ppp.projectNftLoading})),z=(0,b.useSelector)((function(e){return e.ppp.projectNftGrowCount})),L=(0,b.useSelector)((function(e){return e.global.host})),U=(0,C.useState)(!1),B=u()(U,2),I=B[0],V=B[1],A=(0,C.useState)(0),G=u()(A,2),W=G[0],K=G[1],X=(0,C.useRef)(0),q=(0,C.useCallback)(function(){var t=o()(s()().mark((function t(r){var a,o,c,u,i,d,f,m,b;return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,r.load("dfs3protocol");case 3:return a=t.sent,o=a.table("projects"),c=a.table("stat"),t.next=8,o.all({scope:"dfs3protocol"});case 8:return u=t.sent,t.next=11,c.all({scope:"dfs3protocol"});case 11:return i=t.sent,t.next=14,S().get("https://api.dfs.land/dfschain/pppvolume2");case 14:200!==(d=t.sent).status&&n.error("获取pppvolume2数据失败"),f=d.data,m=[],u.forEach((function(e){f.hasOwnProperty(e.id.toString())&&m.push(e)})),m.sort((function(e,t){var r=e.id.toString(),n=t.id.toString();return f[n].volume_24h-f[r].volume_24h})),b=[],m.forEach((function(e){var t=e.nft_img,r=e.id.toString(),n=e.project_name,s=e.creator.toString();b.push({value:r,label:(0,E.jsxs)("div",{className:"flex items-center",children:[(0,E.jsx)("div",{className:"mr-2",children:r.padStart(3,"0")}),(0,E.jsx)(N.C,{className:"mr-2",size:"default",src:t}),(0,E.jsxs)("div",{children:[n," @",s]})]}),desc:"".concat(r,"-").concat(n,"-").concat(s,"-").concat(t)})})),e(l.N.setProjectOptions(b)),e(l.N.setStats(i)),e(l.N.setProjects(u)),V(!1),t.next=32;break;case 28:t.prev=28,t.t0=t.catch(0),V(!1),(0,p.Tv)(t.t0,n);case 32:case"end":return t.stop()}}),t,null,[[0,28]])})));return function(e){return t.apply(this,arguments)}}(),[]),J=(0,C.useCallback)((function(e){if(e<0)X.current=100,K(100);else{var t=1e3*M,r=(t-e)/t*100,n=Math.ceil(r);n!==X.current&&(X.current=n,K(r))}}),[M]),Q=(0,C.useCallback)((function(t,r,n,s){var a=[],o=r.init_nft_price.symbol,c=0,u=0,i=0,p=0;Object.keys(t).forEach((function(e,r){var n=t[e].number,l=t[e].invest,d=t[e].profit;c+=n,u+=l,i+=d,p+=1,a.push({key:r,owner:e,number:n,percent:0,invest:l,profit:d,investAsset:x.xR.from(l,o).toString(),profitAsset:x.xR.from(d,o).toString(),burnRewardUsdt:0,burnRewardDfs:0,balance:s.filter((function(t){return t.account===e}))[0].balance})})),a.forEach((function(e){e.percent=e.number/c*100})),a.sort((function(e,t){return t.number-e.number}));var d=0,f=0;n.forEach((function(e){d+=e.usdtValue,f+=e.dfsValue})),a[0].burnRewardDfs=f/2,a[1].burnRewardDfs=f/10*3,a[2].burnRewardDfs=f/5,a[0].burnRewardUsdt=d/2,a[1].burnRewardUsdt=d/10*3,a[2].burnRewardUsdt=d/5,e(l.N.setProjectNftRank(a)),e(l.N.setProjectNftRankReset(a)),e(l.N.setProjectTotalHolder(p)),e(l.N.setProjectTotalInvest(u)),e(l.N.setProjectTotalProfit(i))}),[]),$=(0,C.useCallback)((function(t,r,n){var s=r.sec_per_round.toNumber(),a=P().utc(r.last_round.toString()),o=r.init_nft_price.value,c=2*o,u=r.init_nft_price.symbol,i=r.increase_per_round.toNumber()/100,d=o*i,f=r.trade_fee_ratio.toNumber()/1e4,m=.005,b=0,x=0;66===r.id.toNumber()?(b=f/2,x=f/2):(b=2*f/3,x=f/3);var h=[],N=[],v=0;t.forEach((function(e){var t=Number(e.current_price.split(" ")[0]);t>=c?(N.push(d),N.push(d),v+=2*d):(N.push(t),v+=t)})),h.push({key:0,time:a.local().format("YYYY-MM-DDTHH:mm:ss"),count:N.length,asset:(0,p.CE)(v.toFixed(0))+" "+u.name,tradeFee:(0,p.CE)((v*b).toFixed(0))+" "+u.name,protocolFee:(0,p.CE)((v*m).toFixed(0))+" "+u.name,rewordPool:(0,p.CE)((v*x).toFixed(0))+" "+u.name});for(var j=1;j<=z;++j){for(var k=0,y=N.length,_=0;_<y;++_){var w=N[_]*i;w>=c?(N.push(d),N[_]=d,k+=2*d):(N[_]=w,k+=w)}var S=a.add(s*j,"seconds").local().format("YYYY-MM-DDTHH:mm:ss");if(N.length>=n){h.push({key:j,time:S,count:n,asset:(0,p.CE)(k.toFixed(0))+" "+u.name,tradeFee:(0,p.CE)((k*b).toFixed(0))+" "+u.name,protocolFee:(0,p.CE)((k*m).toFixed(0))+" "+u.name,rewordPool:(0,p.CE)((k*x).toFixed(0))+" "+u.name});break}h.push({key:j,time:S,count:N.length,asset:(0,p.CE)(k.toFixed(0))+" "+u.name,tradeFee:(0,p.CE)((k*b).toFixed(0))+" "+u.name,protocolFee:(0,p.CE)((k*m).toFixed(0))+" "+u.name,rewordPool:(0,p.CE)((k*x).toFixed(0))+" "+u.name})}e(l.N.setProjectNftGrow(h))}),[z]),ee=(0,C.useCallback)(function(){var t=o()(s()().mark((function t(r,a){var o,u,i,d,f,m,b,x,h;return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c.load("swapswapswap");case 3:return o=t.sent,u=o.table("markets"),t.next=7,u.all();case 7:return i=t.sent,d=[],f={},a.forEach((function(e){var t=e.max_token_supply.symbol.name;f[t]=e.token_url})),m=[],"usdtusdtusdt-USDT-8",x="eosio.token-DFS-8",h=[],(b={})["usdtusdtusdt-USDT-8"]=1,b[x]=(0,p.ri)(i[0].reserve0)/(0,p.ri)(i[0].reserve1),i.forEach((function(e){var t=e.contract0.toString()+"-"+e.sym0.toString().split(",")[1]+"-"+e.sym0.toString().split(",")[0],r=e.contract1.toString()+"-"+e.sym1.toString().split(",")[1]+"-"+e.sym1.toString().split(",")[0];m.includes(t)||m.push(t),m.includes(r)||m.push(r);var n=(0,p.ri)(e.reserve0),s=(0,p.ri)(e.reserve1);"eosio.token"===e.contract0.toString()?b.hasOwnProperty(r)||(b[r]=n/s*b[x]):"eosio.token"===e.contract1.toString()?b.hasOwnProperty(t)||(b[t]=s/n*b[x]):"usdtusdtusdt"===e.contract0.toString()?b.hasOwnProperty(r)||(b[r]=n/s):"usdtusdtusdt"===e.contract1.toString()?b.hasOwnProperty(t)||(b[t]=s/n):h.push({key0:t,key1:r,value0:n,value1:s})})),h.forEach((function(e){b.hasOwnProperty(e.key0)&&!b.hasOwnProperty(e.key1)?b[e.key1]=e.value0/e.value1*b[e.key0]:!b.hasOwnProperty(e.key0)&&b.hasOwnProperty(e.key1)?b[e.key0]=e.value1/e.value0*b[e.key1]:b.hasOwnProperty(e.key0)||b.hasOwnProperty(e.key1)||(b[e.key0]=0,b[e.key1]=0)})),Object.keys(b).forEach((function(e){Number.isNaN(b[e])&&(b[e]=0)})),r.forEach((function(e,t){var r=e.cnt.toString(),n=e.balance.symbol.name,s=e.balance.symbol.precision,a=e.balance.value,o=r+"-"+n,c=b[o+"-"+s]*a,u=c/b[x],i="dfsppptokens"===r?f[n]:"https://dfs.land/assets/tokens/".concat(o,".png");d.push({key:t,sym:n,logo:i,balance:e.balance.toString(),contract:r,usdtValue:c,dfsValue:u})})),e(l.N.setProjectRewardPool(d)),t.abrupt("return",d);case 26:return t.prev=26,t.t0=t.catch(0),(0,p.Tv)(t.t0,n),t.abrupt("return",[]);case 30:case"end":return t.stop()}}),t,null,[[0,26]])})));return function(e,r){return t.apply(this,arguments)}}(),[w,c]),te=(0,C.useCallback)((function(t,r,n){var s=0,a=0;if(!r){for(var o=0;o<t.length;++o){var c=P().utc(t[o].last_trade).valueOf();if(c>=n){a=c;break}}for(var u=t.length-1;u>=0;--u)if(!t[u].split){s=P().utc(t[u].last_trade).valueOf()-a+1;break}}e(l.N.setProjectEndTime(s))}),[]),re=(0,C.useCallback)(function(){var e=o()(s()().mark((function e(t){var r,a,o,c,i,l,d,f,m,b,x;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],a=2e3,o="",c="",i="","DFS"!==t){e.next=9;break}i="eosio.token",e.next=19;break;case 9:if("USDT"!==t){e.next=13;break}i="usdtusdtusdt",e.next=19;break;case 13:if("ORDI"!==t){e.next=17;break}i="ordiordiordi",e.next=19;break;case 17:return n.error("不支持当前项目"),e.abrupt("return",[]);case 19:return e.next=22,(0,p.zI)(S().post("".concat(L,"/v2/chain/get_scope_rows"),{code:i,table:"accounts",lower_bound:o,primary_lower_bound:c,limit:a,index_position:"primary",key_type:"name"}));case 22:if(l=e.sent,d=u()(l,2),f=d[0],m=d[1],f||200!==m.status){e.next=37;break}for(b=m.data.rows,x=0;x<b.length;++x)b[x].data.balance.split(" ")[1]===t&&r.push({account:b[x].scope,balance:b[x].data.balance});if(!m.data.more){e.next=34;break}o=m.data.next_key,c=m.data.next_primary_key,e.next=35;break;case 34:return e.abrupt("break",41);case 35:e.next=39;break;case 37:return n.error(f),e.abrupt("break",41);case 39:e.next=19;break;case 41:return e.abrupt("return",r);case 42:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n]),ne=(0,C.useCallback)(function(){var t=o()(s()().mark((function t(r){var a,o,u,i,d,f,m,b,h,N,v,j,k,y,_,S,g,R,F,C,E,O,D,T,Y,M,Z,H,z,L,U,B,I,V,A,G,W,q,J,ne,se,ae,oe,ce,ue,ie,le,pe,de,fe,me,be,xe,he,Ne,ve,je,ke,ye,_e,we,Se,ge,Pe;return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e(l.N.setProjectNftLoading(!0)),t.next=4,w.client.v1.chain.get_table_rows({code:"dfs3protocol",table:"registry",scope:"dfs3protocol",key_type:"i64",index_position:"secondary",lower_bound:x.zM.from(r),upper_bound:x.zM.from(r),limit:5e3});case 4:return a=t.sent,t.next=7,c.load("dfs3protocol");case 7:return o=t.sent,t.next=10,c.load("dfspppreward");case 10:return u=t.sent,i=o.table("projects"),d=o.table("stat"),f=u.table("rewardpools"),t.next=16,i.all({scope:"dfs3protocol"});case 16:return m=t.sent,t.next=19,d.all({scope:"dfs3protocol",from:r,to:r});case 19:return b=t.sent,t.next=22,f.all({scope:r});case 22:for(h=t.sent,N=ee(h,m),v=m.filter((function(e){return e.id.toNumber()===r}))[0],j=v.id.toNumber(),k=v.mid.toNumber(),y=v.project_name,_=v.nft_name,S=v.nft_img,g=v.desc,R=v.twitter,F=v.telegram,C=v.website,E=v.token_url,O=v.creator.toString(),D=b[0].supply.toNumber(),T=b[0].max_supply.toNumber(),Y=v.init_nft_price.toString(),M=v.init_nft_price.value,Z=v.init_nft_price.symbol,z=(H=2*M)+" "+Z.name,L=v.init_nft_number.toNumber(),U=v.sec_per_round.toNumber(),B=v.sec_to_burn_nft.toNumber(),I=P().utc(v.create_time.toString()).local().format("YYYY-MM-DDTHH:mm:ss"),V=P().utc(v.last_round.toString()).valueOf(),A=V,G=P().utc(v.last_round.toString()).local().format("YYYY-MM-DDTHH:mm:ss"),W=P().utc(v.last_round.toString()).add(U,"seconds").local(),q=W.valueOf(),J=W.format("YYYY-MM-DDTHH:mm:ss"),ne=v.init_nft_price.symbol.precision,se=v.token_per_nft.toString(),ae=v.token_per_nft.symbol.name,oe={contract:"dfsppptokens",symbol:ae,mid:k,pair:"".concat(Z.name,"/").concat(ae)},ce=v.increase_per_round.toNumber()/100,ue=v.trade_fee_ratio.toNumber()/1e4,ie=0,le=0,66===j?(ie=ue/2,le=ue/2):(ie=2*ue/3,le=ue/3),pe=100*(ce-1-ce*(ue+.005)),de=0,fe=0,me=0,be=0,xe=[],he=[],Ne=[],ve={},je=Number((M*ce).toFixed(ne)),ke=M;ke*ce<H;)ke*=ce;return ye=(2*je*(1-ue-.005)-ke)/ke*100,_e=31536e3/U*pe,we={id:j,mid:k,projectName:y,nftName:_,tokenName:Z.name,tokenNameRelease:ae,nftImg:S,desc:g,twitter:R,telegram:F,website:C,tokenUrl:E,creator:O,nftSupply:D,nftMaxSupply:T,initNftPrice:Y,initNftNumber:L,splitNftPrice:z,secPerRound:U/3600+" Hours",increasePerRound:(100*ce-100).toFixed(2)+" %",tradeFeeRatio:100*ue+" %",tradeFeeRatioValue:ue,tradeFeeRatioWithoutRewardPool:(100*ie).toFixed(2)+" %",rewordPoolFeeRatio:(100*le).toFixed(2)+" %",secToBurnNft:B/3600+" Hours",tokenPerNft:se,createTime:I,profitRate:pe.toFixed(2)+" %",profitRateSplit:ye.toFixed(2)+" %",profitRateApr:_e.toFixed(0)+" %"},Se=0,a.rows.forEach((function(e){var t=P()().valueOf(),r=P().utc(e.last_trade).valueOf(),n=1e3*B,s=1e3*U,a=Number(e.current_price.split(" ")[0]),o=e.current_round,c="";Se+=a,a>=H?(be+=1,c="可拆分"):(t-r>n&&(de+=1,c="可销毁"),V>r||t-V>s?(fe+=1,c=c?"可买/"+c:"可买"):(me+=1,c="已售"));var u=0,i=0,l=!1;a>=H?(i=ke,u=2*je-ke-2*je*(ue+.005)):a===je&&o>1?(l=!0,i=ke/2,u=je-ke/2-je*(ue+.005)):(i=a/ce,u=a*(1-1/ce-ue-.005)),ve.hasOwnProperty(e.owner)||(ve[e.owner]={number:0,invest:0,profit:0}),ve[e.owner].profit+=u,ve[e.owner].number+=1,ve[e.owner].invest+=i,he.includes(e.owner)||he.push(e.owner),xe.push({key:e.id,id:e.id,cid:e.cid,pid:e.pid,owner:e.owner,current_round:e.current_round,current_price:e.current_price,last_trade:e.last_trade,create_time:e.create_time,profit:x.xR.from(u,Z).toString(),invest:x.xR.from(i,Z).toString(),status:c,split:l})})),t.next=81,re(Z.name);case 81:return ge=t.sent,t.next=84,N;case 84:Pe=t.sent,Q(ve,v,Pe,ge),$(xe,v,b[0].max_supply.toNumber()),he.sort(),he.forEach((function(e){Ne.push({text:e,value:e})})),xe.sort((function(e,t){return P()(e.last_trade).valueOf()-P()(t.last_trade).valueOf()})),te(xe,fe,A),e(l.N.setProjectNextRound({value:q,text:J})),e(l.N.setProjectLastRound({value:A,text:G})),e(l.N.setProjectSecToBurnNft(B)),e(l.N.setProjectNftSupply(D)),e(l.N.setProjectBurnNumber(de)),e(l.N.setProjectBuyNumber(fe)),e(l.N.setProjectSellNumber(me)),e(l.N.setProjectSplitNumber(be)),e(l.N.setProjectNft(xe)),e(l.N.setProjectNftReset(xe)),e(l.N.setProjectId(r)),e(l.N.setProjectTotalValue(Se)),e(l.N.setProjectSecPerRound(U)),e(l.N.setProjectAccountFilter(Ne)),e(l.N.setProjectNftLoading(!1)),e(l.N.setProjectProfitRate(pe)),e(l.N.setProjectProfitRateSplit(ye)),e(l.N.setProject(we)),e(l.N.setProjectToken(oe)),X.current=0,K(0),t.next=118;break;case 114:t.prev=114,t.t0=t.catch(0),e(l.N.setProjectNftLoading(!1)),(0,p.Tv)(t.t0,n);case 118:case"end":return t.stop()}}),t,null,[[0,114]])})));return function(e){return t.apply(this,arguments)}}(),[w,c,Q,$,ee,re]);return(0,C.useEffect)((function(){!c||g.length||I||(V(!0),q(c))}),[q,g,c,I]),(0,E.jsxs)(d._z,{className:"projects",ghost:!0,children:[(0,E.jsx)(v.default,{loading:I,size:"large",style:{width:"100%"},className:"mb-3",defaultValue:R?R.toString():void 0,onChange:function(e){ne(Number(e))},placeholder:"请选择项目",showSearch:!0,filterOption:function(e,t){var r=t.desc.split("-"),n=u()(r,3),s=n[0],a=n[1],o=n[2];return(s.padStart(3,"0")+a+o).toLowerCase().includes(e.toLowerCase())},options:g,optionRender:function(e){var t=e.data.desc.split("-"),r=u()(t,4),n=r[0],s=r[1],a=r[2],o=r[3];return(0,E.jsxs)("div",{className:"flex items-center",children:[(0,E.jsx)("div",{className:"mr-2",children:n.padStart(3,"0")}),(0,E.jsx)(N.C,{className:"mr-2",size:"default",src:o}),(0,E.jsxs)("div",{children:[s," @",a]})]})}}),(0,E.jsxs)(j.Z,{size:"large",spinning:H,children:[(0,E.jsxs)("div",{className:"flex items-center",children:[(0,E.jsx)("div",{children:"下一轮倒计时："}),(0,E.jsx)(i.Wo,{className:"mr-2 font-medium text-base",value:Z.value,onChange:J}),(0,E.jsx)("div",{className:" text-base",children:Z.text})]}),(0,E.jsx)(k.Z,{percent:W,showInfo:!1}),(0,E.jsx)(f.Z,{headerBordered:!0,headStyle:{justifyContent:"center"},className:"mb-3",children:(0,E.jsxs)(y.Z,{gutter:10,children:[(0,E.jsx)(_.Z,{lg:{span:"6"},md:{span:"12"},sm:{span:"12"},xs:{span:"12"},children:(0,E.jsx)(m.Z,{layout:"center",statistic:{title:(0,E.jsx)("div",{className:"text-center",children:"总量"}),value:F}})}),(0,E.jsx)(_.Z,{lg:{span:"6"},md:{span:"12"},sm:{span:"12"},xs:{span:"12"},children:(0,E.jsx)(m.Z,{layout:"center",statistic:{title:(0,E.jsx)("div",{className:"text-center",children:"可买 / 已售"}),value:"".concat(O," / ").concat(D)}})}),(0,E.jsx)(_.Z,{lg:{span:"6"},md:{span:"12"},sm:{span:"12"},xs:{span:"12"},children:(0,E.jsx)(m.Z,{layout:"center",statistic:{title:(0,E.jsx)("div",{className:"text-center",children:"可拆分"}),value:Y}})}),(0,E.jsx)(_.Z,{lg:{span:"6"},md:{span:"12"},sm:{span:"12"},xs:{span:"12"},children:(0,E.jsx)(m.Z,{layout:"center",statistic:{title:(0,E.jsx)("div",{className:"text-center",children:"可销毁"}),value:T}})})]})})]}),(0,E.jsx)(f.Z,{tabs:{items:[{key:"nft",label:(0,E.jsx)("span",{className:" text-base font-semibold",children:"NFT"}),children:(0,E.jsx)(i.tw,{handleGetProjectNft:ne})},{key:"rank",label:(0,E.jsx)("span",{className:" text-base font-semibold",children:"排名"}),children:(0,E.jsx)(i.SX,{handleGetProjectNft:ne})},{key:"grow",label:(0,E.jsx)("span",{className:" text-base font-semibold",children:"增长趋势"}),children:(0,E.jsx)(i.Wr,{})},{key:"about",label:(0,E.jsx)("span",{className:" text-base font-semibold",children:"关于"}),children:(0,E.jsx)(i.kh,{})},{key:"token",label:(0,E.jsx)("span",{className:" text-base font-semibold",children:"通证"}),children:(0,E.jsx)(i.DL,{})}],defaultActiveKey:"nft"}}),a]})}},8849:function(){}}]);