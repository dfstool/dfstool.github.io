"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8255],{67576:function(e,t,r){r.r(t);var n=r(15009),o=r.n(n),a=r(99289),u=r.n(a),s=r(5574),c=r.n(s),i=r(19601),l=r(64119),f=r(37476),p=r(5966),d=r(90672),m=r(59530),b=r(45360),v=r(27484),h=r.n(v),g=r(70178),x=r.n(g),w=r(62435),k=r(86074);h().extend(x());var M=w.forwardRef((function(e,t){var r=(0,m.useDispatch)(),n=b.ZP.useMessage(),a=c()(n,2),s=a[0],v=a[1],g=(0,m.useSelector)((function(e){return e.global.session})),x=(0,m.useSelector)((function(e){return e.global.account})),M=(0,m.useSelector)((function(e){return e.global.contractKit})),S=(0,m.useIntl)(),q=S.formatMessage({id:"common.intlInputException"}),z=S.formatMessage({id:"account.intlSearch"}),_=S.formatMessage({id:"contract.intlAccountFormatError"}),y=S.formatMessage({id:"node.intlNode"}),F=S.formatMessage({id:"tools.nodebonus.intlBonusAmount"}),V=S.formatMessage({id:"tools.nodebonus.intlRequireVote"}),C=S.formatMessage({id:"tools.nodebonus.intlBonusMemo"}),P=(0,w.useRef)(),R=(0,w.useState)(!1),j=c()(R,2),D=j[0],N=j[1],Y=(0,w.useMemo)((function(){return x&&x.data.core_liquid_balance?x.data.core_liquid_balance.toString():"0.00000000 DFS"}),[x]),Z=(0,w.useCallback)((function(){N(!0)}),[]);(0,w.useImperativeHandle)(t,(function(){return{handleOpen:Z}}));var A=(0,w.useCallback)(function(){var e=u()(o()().mark((function e(t,r){var n,a,u;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(/^[a-z1-5.]{1,12}$/.test(t)){e.next=8;break}if(t||r.hasOwnProperty("type")){e.next=4;break}return e.abrupt("return",!1);case 4:return s.error("".concat(_)),e.abrupt("return",!1);case 8:return e.next=10,(0,l.zI)(g.client.v1.chain.get_account(t));case 10:if(n=e.sent,a=c()(n,1),!(u=a[0])){e.next=16;break}return s.error(u),e.abrupt("return",!1);case 16:return e.abrupt("return",!0);case 17:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),[g,s]),B=(0,w.useCallback)(function(){var e=u()(o()().mark((function e(t){var n,a,u,c,f,p,d,m,b,v,g,x;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.node,a=t.bonusAmount,u=t.requireVote,c=t.bonusMemo,e.next=3,A(n,"");case 3:if(e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return e.prev=5,f=0,p=0,d=0,m=0,b=[],e.next=13,M.load("dfsbpsvoters");case 13:return v=e.sent,g=v.table("vlists",n),e.next=17,g.all();case 17:return(x=e.sent).forEach((function(e){p+=e.vote_power.value/1e8})),x.forEach((function(e,t){var r=e.voter.toString(),n=e.vote_power.value/1e8,o=n/p,s=o*Number(a);n<=Number(u)||(b.push({key:t,voter:r,vote:n,ratio:o,bonus:s,memo:c,voteTime:h().utc(e.vote_time.toString()).local().format("YYYY-MM-DDTHH:mm:ss")}),f+=1,d+=o,m+=s)})),b.sort((function(e,t){return t.vote-e.vote})),r(i.N.setBonusDataSource(b)),r(i.N.setSummary({node:n,totalVoters:f,totalVotes:p,totalRatio:d,totalBonus:m})),e.abrupt("return",!0);case 26:e.prev=26,e.t0=e.catch(5),(0,l.Tv)(e.t0,s);case 29:case"end":return e.stop()}}),e,null,[[5,26]])})));return function(t){return e.apply(this,arguments)}}(),[A]);return(0,k.jsxs)(f.Y,{formRef:P,title:z,open:D,onFinish:B,onOpenChange:function(e){N(e)},layout:"vertical",width:"400px",initialValues:{requireVote:0,memo:""},children:[(0,k.jsx)(p.Z,{name:"node",label:y,placeholder:"",fieldProps:{size:"large",autoFocus:!1},rules:[{required:!0,whitespace:!0,message:"".concat(q),pattern:/^[a-z1-5.]{1,12}$/}]}),(0,k.jsx)(p.Z,{name:"bonusAmount",label:F,placeholder:Y,rules:[{required:!0,message:"".concat(q),whitespace:!0,pattern:/^\d+(\.\d{1,8})?$/}],fieldProps:{size:"large",autoFocus:!1}}),(0,k.jsx)(d.Z,{name:"bonusMemo",label:C,placeholder:"",fieldProps:{size:"large",autoFocus:!1,autoSize:{minRows:1}}}),(0,k.jsx)(p.Z,{name:"requireVote",label:V,placeholder:"",rules:[{required:!0,message:"".concat(q),whitespace:!0,pattern:/^-?\d+(\.\d{1,8})?$/}],fieldProps:{size:"large",autoFocus:!1}}),v]})}));t.default=(0,w.memo)(M)}}]);