"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8255],{67576:function(e,t,r){r.r(t);var n=r(15009),o=r.n(n),a=r(99289),s=r.n(a),u=r(5574),c=r.n(u),i=r(19601),l=r(64119),f=r(37476),p=r(5966),m=r(90672),d=r(59530),b=r(45360),v=r(27484),h=r.n(v),g=r(70178),x=r.n(g),M=r(62435),w=r(86074);h().extend(x());var k=M.forwardRef((function(e,t){var r=(0,d.useDispatch)(),n=b.ZP.useMessage(),a=c()(n,2),u=a[0],v=a[1],g=(0,d.useSelector)((function(e){return e.global.session})),x=(0,d.useSelector)((function(e){return e.global.account})),k=(0,d.useSelector)((function(e){return e.global.contractKit})),S=(0,d.useIntl)(),q=S.formatMessage({id:"common.intlInputException"}),Y=S.formatMessage({id:"account.intlSearch"}),z=S.formatMessage({id:"contract.intlAccountFormatError"}),_=S.formatMessage({id:"node.intlNode"}),y=S.formatMessage({id:"tools.nodebonus.intlBonusAmount"}),D=S.formatMessage({id:"tools.nodebonus.intlRequireVote"}),F=S.formatMessage({id:"tools.nodebonus.intlBonusMemo"}),V=(0,M.useRef)(),C=(0,M.useState)(!1),P=c()(C,2),R=P[0],j=P[1],H=(0,M.useMemo)((function(){return x&&x.data.core_liquid_balance?x.data.core_liquid_balance.toString():"0.00000000 DFS"}),[x]),N=(0,M.useCallback)((function(){j(!0)}),[]);(0,M.useImperativeHandle)(t,(function(){return{handleOpen:N}}));var Z=(0,M.useCallback)(function(){var e=s()(o()().mark((function e(t,r){var n,a,s;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(/^[a-z1-5.]{1,12}$/.test(t)){e.next=8;break}if(t||r.hasOwnProperty("type")){e.next=4;break}return e.abrupt("return",!1);case 4:return u.error("".concat(z)),e.abrupt("return",!1);case 8:return e.next=10,(0,l.zI)(g.client.v1.chain.get_account(t));case 10:if(n=e.sent,a=c()(n,1),!(s=a[0])){e.next=16;break}return u.error(s),e.abrupt("return",!1);case 16:return e.abrupt("return",!0);case 17:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),[g,u]),A=(0,M.useCallback)(function(){var e=s()(o()().mark((function e(t){var n,a,s,c,f,p,m,d,b,v,g,x;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.node,a=t.bonusAmount,s=t.requireVote,c=t.bonusMemo,e.next=3,Z(n,"");case 3:if(e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return e.prev=5,f=0,p=0,m=0,d=0,b=[],e.next=13,k.load("dfsbpsvoters");case 13:return v=e.sent,g=v.table("vlists",n),e.next=17,g.all();case 17:return(x=e.sent).forEach((function(e){p+=e.vote_power.value/1e8})),x.forEach((function(e,t){var r=e.voter.toString(),n=e.vote_power.value/1e8,o=n/p,u=o*Number(a);n<=Number(s)||(b.push({key:t,voter:r,vote:n,ratio:o,bonus:u,memo:c,voteTime:h().utc(e.vote_time.toString()).local().format("YYYY-MM-DDTHH:mm:ss")}),f+=1,m+=o,d+=u)})),b.sort((function(e,t){return t.vote-e.vote})),r(i.N.setBonusDataSource(b)),r(i.N.setSummary({node:n,totalVoters:f,totalVotes:p,totalRatio:m,totalBonus:d,time:h()().format("YYYY-MM-DDTHH-mm-ss")})),e.abrupt("return",!0);case 26:e.prev=26,e.t0=e.catch(5),(0,l.Tv)(e.t0,u);case 29:case"end":return e.stop()}}),e,null,[[5,26]])})));return function(t){return e.apply(this,arguments)}}(),[Z]);return(0,w.jsxs)(f.Y,{formRef:V,title:Y,open:R,onFinish:A,onOpenChange:function(e){j(e)},layout:"vertical",width:"400px",initialValues:{requireVote:0,memo:""},children:[(0,w.jsx)(p.Z,{name:"node",label:_,placeholder:"",fieldProps:{size:"large",autoFocus:!1},rules:[{required:!0,whitespace:!0,message:"".concat(q),pattern:/^[a-z1-5.]{1,12}$/}]}),(0,w.jsx)(p.Z,{name:"bonusAmount",label:y,placeholder:H,rules:[{required:!0,message:"".concat(q),whitespace:!0,pattern:/^\d+(\.\d{1,8})?$/}],fieldProps:{size:"large",autoFocus:!1}}),(0,w.jsx)(m.Z,{name:"bonusMemo",label:F,placeholder:"",fieldProps:{size:"large",autoFocus:!1,autoSize:{minRows:1}}}),(0,w.jsx)(p.Z,{name:"requireVote",label:D,placeholder:"",rules:[{required:!0,message:"".concat(q),whitespace:!0,pattern:/^-?\d+(\.\d{1,8})?$/}],fieldProps:{size:"large",autoFocus:!1}}),v]})}));t.default=(0,M.memo)(k)}}]);