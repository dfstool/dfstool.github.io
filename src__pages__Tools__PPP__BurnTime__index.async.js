"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1866],{43931:function(e,r,t){t.r(r);var n=t(15009),a=t.n(n),c=t(19632),s=t.n(c),o=t(97857),u=t.n(o),i=t(99289),l=t.n(i),d=t(5574),f=t.n(d),p=t(64119),m=t(11774),b=t(92340),x=t(59530),k=t(80507),v=t(45360),g=t(27484),_=t.n(g),h=t(70178),w=t.n(h),y=t(62435),S=t(86074);_().extend(w());var Y=[];r.default=function(){var e=v.ZP.useMessage(),r=f()(e,2),t=r[0],n=(r[1],(0,x.useSelector)((function(e){return e.global.contractKit}))),c=(0,x.useSelector)((function(e){return e.global.account})),o=(0,x.useSelector)((function(e){return e.global.session})),i=(0,x.useSelector)((function(e){return e.global.privateKey})),d=((0,x.useSelector)((function(e){return e.ppp.vipAccounts})),(0,x.useSelector)((function(e){return e.ppp.accessAccounts}))),g=(0,y.useState)(!1),h=f()(g,2),w=h[0],j=h[1],M=(0,y.useState)(""),C=f()(M,2),D=(C[0],C[1]),N=(0,y.useState)([]),I=f()(N,2),F=I[0],H=I[1],z=(0,x.useIntl)(),E=(z.formatMessage({id:"coffee.inputException"}),z.formatMessage({id:"common.intlPleaseConnectWallet"})),O=z.formatMessage({id:"common.intlPleaseConnectNetwork"}),T=(0,y.useRef)(),V=(0,y.useRef)(!1),P=((0,y.useCallback)((function(){if(w){if(c){var e=c.accountName.toString();return!!d.includes(e)||(j(!1),!1)}return!0}if(c){var r=c.accountName.toString();return!!d.includes(r)&&(j(!0),!0)}return!1}),[c,w,d]),(0,y.useCallback)((function(){var e=_()().format("YYYY-MM-DDTHH:mm:ss"),r=JSON.stringify(Y,null,2),t="data:,".concat(r),n=document.createElement("a");n.href=t,n.download="log_".concat(e,".json"),n.click()}),[]),(0,y.useCallback)(function(){var e=l()(a()().mark((function e(r,n){var c,l,d,m,b,x,v,g,h,w,y,S;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.client.v1.chain.get_info();case 2:return c=e.sent,l=c.getTransactionHeader(),d=_()(),m=_()(d).add(3600,"seconds").utc().format("YYYY-MM-DDTHH:mm:ss"),v=[],g=[r,n],b=k.YW.from(u()(u()({},l),{},{expiration:m,actions:g})),v[0]=i.signDigest(b.signingDigest(o.chain.id.toString())),e.next=12,(0,p.zI)(o.transact({transaction:b},{broadcast:!1,transactPlugins:[]}));case 12:if(h=e.sent,w=f()(h,2),y=w[0],S=w[1],!y){e.next=19;break}return t.error(y),e.abrupt("return",!1);case 19:return x=k.uQ.from(u()(u()({},b),{},{signatures:[].concat(v,s()(S.signatures))})),e.abrupt("return",x);case 21:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),[o])),J=((0,y.useCallback)(function(){var e=l()(a()().mark((function e(r){var s,u,i,l,d,f,m,b,x,v,g,_,h,w,y,S,Y,j,M,C,N,I,F,H,z,J;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o&&o.broadcast){e.next=5;break}return t.error("".concat(E)),e.abrupt("return");case 5:if(c){e.next=8;break}return t.error("".concat(O)),e.abrupt("return");case 8:return e.next=10,n.load("swapswapswap");case 10:return s=e.sent,u=s.table("markets"),e.next=14,u.all();case 14:return i=e.sent,e.next=17,u.all();case 17:if(l=e.sent,i.length===l.length){e.next=22;break}return t.error("获取两次markets的数据长度不一致，请重新启动"),console.log("获取两次markets的数据长度不一致，请重新启动"),e.abrupt("return",!1);case 22:d=i[i.length-1].mid.toNumber(),f=d+1,m=o.actor.toString(),b=r.count,x=Number(b),v="swap:".concat(f,":0"),g=x.toFixed(8)+" DFS",_={account:"eosio.token",name:"transfer",authorization:[o.permissionLevel],data:p.FE.from({from:m,to:"swapswapswap",quantity:g,memo:v})},h=k.aU.from(_),w={account:"dfsfreecpu11",name:"freecpu",authorization:[{actor:"dfs.service",permission:"cpu"},o.permissionLevel],data:p._9.from({user:m})},y=k.aU.from(w),Y=1,j=5;case 35:return e.next=38,P(y,h);case 38:if(!(S=e.sent)){e.next=43;break}return e.abrupt("break",53);case 43:if(!(Y>j)){e.next=47;break}return t.error("交易信息为空，重试超过最大次数，退出执行"),console.log("交易信息为空，重试超过最大次数，退出执行"),e.abrupt("return",!1);case 47:return t.error("交易信息为空，重试第".concat(Y,"次")),console.log("交易信息为空，重试第".concat(Y,"次")),Y+=1,e.abrupt("continue",35);case 51:e.next=35;break;case 53:V.current=!1;case 54:if(!V.current){e.next=57;break}return e.abrupt("return",!0);case 57:return e.prev=57,null===(M=T.current)||void 0===M||M.setFieldValue("result","message"),e.next=61,o.client.v1.chain.push_transaction(S);case 61:if(!(C=e.sent)||!C.processed||"executed"!==C.processed.receipt.status){e.next=68;break}return t.success("交易完成"),null===(N=T.current)||void 0===N||N.setFieldValue("result",JSON.stringify(C)),e.abrupt("return",!0);case 68:return t.success("交易失败"),null===(I=T.current)||void 0===I||I.setFieldValue("result",JSON.stringify(C)),e.abrupt("return",!0);case 71:e.next=81;break;case 73:e.prev=73,e.t0=e.catch(57),z=null===(F=T.current)||void 0===F?void 0:F.getFieldValue("try"),null===(H=T.current)||void 0===H||H.setFieldValue("try",z+1),J="",e.t0 instanceof Error?(console.log(e.t0.details[0].message),e.t0.message.includes("eosio_assert_message assertion failure")&&(J=e.t0.details[0].message)):J=e.t0,D(J),console.log(J);case 81:e.next=54;break;case 83:case"end":return e.stop()}}),e,null,[[57,73]])})));return function(r){return e.apply(this,arguments)}}(),[o,c,n,P]),(0,y.useCallback)(l()(a()().mark((function e(){var r,s,u,i,l,d,f,p,m,b;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o&&o.broadcast){e.next=5;break}return t.error("".concat(E)),e.abrupt("return");case 5:if(c){e.next=8;break}return t.error("".concat(O)),e.abrupt("return");case 8:return e.next=10,n.load("dfs3protocol");case 10:return r=e.sent,s=r.table("projects"),u=r.table("globals"),e.next=15,u.all({scope:"dfs3protocol",from:"project",to:"project"});case 15:i=e.sent,l=i[0].val.toNumber(),d=l;case 18:return e.next=21,u.all({scope:"dfs3protocol",from:"project",to:"project"});case 21:if(f=e.sent,(d=f[0].val.toNumber())===l){e.next=25;break}return e.abrupt("break",27);case 25:e.next=18;break;case 27:return e.next=29,s.all({scope:"dfs3protocol",from:d,to:d});case 29:p=e.sent,m=p[0].init_nft_price.value,p[0].init_nft_price.symbol.name,p[0].creator.toString(),b=p[0].init_nft_number.toNumber(),m*b;case 35:case"end":return e.stop()}}),e)}))),[o,c,n]),(0,y.useCallback)((function(){V.current=!0}),[]),(0,y.useCallback)((function(){var e;V.current=!0,null===(e=T.current)||void 0===e||e.resetFields()}),[]),(0,y.useCallback)(l()(a()().mark((function e(){var r,t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.client.v1.chain.get_table_rows({code:"dfs3protocol",table:"registry",scope:"dfs3protocol",key_type:"i64",index_position:"secondary",lower_bound:k.zM.from(66),upper_bound:k.zM.from(66),limit:2e3});case 2:r=e.sent,t=[],r.rows.forEach((function(e,r){t.push({key:r,id:e.id,cid:e.cid,owner:e.owner,current_round:e.current_round,current_price:e.current_price,last_trade:e.last_trade})})),t.sort((function(e,r){return _()(e.last_trade).valueOf()-_()(r.last_trade).valueOf()})),H(t);case 7:case"end":return e.stop()}}),e)}))),[o])),A=(0,y.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,r,t){return(0,S.jsx)("span",{children:t+1})}},{title:"id",dataIndex:"id",key:"id",render:function(e,r){return(0,S.jsx)("div",{children:r.id})}},{title:"cid",dataIndex:"cid",key:"cid",render:function(e,r){return(0,S.jsx)("div",{children:r.cid})}},{title:"持有者",dataIndex:"owner",key:"owner",render:function(e,r){return(0,S.jsx)("div",{children:r.owner})}},{title:"当前轮次",dataIndex:"current_round",key:"current_round",render:function(e,r){return(0,S.jsx)("div",{children:r.current_round})}},{title:"当前价格",dataIndex:"current_price",key:"current_price",render:function(e,r){return(0,S.jsx)("div",{children:r.current_price})}},{title:"购买时间",dataIndex:"last_trade",key:"last_trade",render:function(e,r){var t=_().utc(r.last_trade).local().format("YYYY-MM-DDTHH:mm:ss");return(0,S.jsx)("div",{children:t})}},{title:"销毁时间",dataIndex:"last_trade",key:"last_trade",render:function(e,r){var t=_().utc(r.last_trade).add(24,"hours").local().format("YYYY-MM-DDTHH:mm:ss");return(0,S.jsx)("div",{children:t})}}]}),[F]);return(0,y.useEffect)((function(){n&&J()}),[o,J]),(0,S.jsx)(m._z,{className:"",ghost:!0,children:(0,S.jsx)(b.Z,{scroll:{x:!0},size:"small",columns:A,dataSource:F,defaultData:[],search:!1,options:!1,pagination:!1})})}}}]);