"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[428],{25738:function(e,t,n){n.r(t),n.d(t,{default:function(){return L}});var r=n(15009),a=n.n(r),s=n(99289),c=n.n(s),o=n(5574),i=n.n(o),u=n(84737),l=n(3990),f=n(64119),d=n(11774),p=n(38345),b=n(59530),m=n(80507),g=n(45360),v=n(69677),h=n(57953),x=n(92398),k=n(9669),y=n.n(k),N=n(27484),S=n.n(N),w=n(96486),j=n(62435),V=(n(20034),n(86074)),L=function(){var e=g.ZP.useMessage(),t=i()(e,2),n=t[0],r=t[1],s=(0,b.useDispatch)(),o=(0,b.useSelector)((function(e){return e.global.session})),k=(0,b.useSelector)((function(e){return e.global.contractKit})),N=(0,b.useSelector)((function(e){return e.global.accountKit})),L=(0,b.useSelector)((function(e){return e.account.activeKey})),T=(0,b.useSelector)((function(e){return e.account.accountInfo})),M=(0,b.useSelector)((function(e){return e.account.loading})),C=(0,j.useState)(""),q=i()(C,2),z=q[0],A=q[1],I=(0,b.useSearchParams)(),K=i()(I,2),_=K[0],E=K[1],P=(0,b.useIntl)(),Z=P.formatMessage({id:"account.intlAccount"}),B=P.formatMessage({id:"account.intlSearch"}),D=P.formatMessage({id:"contract.intlAccountFormatError"}),F=P.formatMessage({id:"account.intlSearchAccount"}),O=P.formatMessage({id:"account.intlProfile"}),$=P.formatMessage({id:"account.intlAuth"}),G=P.formatMessage({id:"account.intlToken"}),R=P.formatMessage({id:"account.intlLiq"}),U=P.formatMessage({id:"account.intlTx"}),H=(0,j.useCallback)(function(){var e=c()(a()().mark((function e(t,r){var c,u,d,p;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(/^[a-z1-5.]{1,12}$/.test(t)){e.next=8;break}if(t||r.hasOwnProperty("type")){e.next=4;break}return e.abrupt("return",!1);case 4:return n.error("".concat(D)),e.abrupt("return",!1);case 8:return e.next=10,(0,f.zI)(o.client.v1.chain.get_abi(t));case 10:if(c=e.sent,u=i()(c,2),d=u[0],p=u[1],!d){e.next=17;break}return n.error(d),e.abrupt("return",!1);case 17:return!d&&p.hasOwnProperty("abi"),s(l.N.setIsContract(!0)),e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[o,n]),J=(0,j.useCallback)(function(){var e=c()(a()().mark((function e(t,r,c,o){var u,d,p,b,g,v,h,x,k,N,w,j,V,L,T,M,C,q,z,A;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u=[],p={},b=[],g=[],v=0,h={balValue:0,reserveValue:0,diffValue:0},(d={})["usdtusdtusdt-USDT-8"]=1,c.forEach((function(e){var t=e.contract0.toString()+"-"+e.sym0.toString().split(",")[1]+"-"+e.sym0.toString().split(",")[0],n=e.contract1.toString()+"-"+e.sym1.toString().split(",")[1]+"-"+e.sym1.toString().split(",")[0];u.includes(t)||(u.push(t),p[t]=u.length),u.includes(n)||(u.push(n),p[n]=u.length),"usdtusdtusdt"===e.contract0.toString()?d[n]=e.reserve0.value/e.reserve1.value:"usdtusdtusdt"===e.contract1.toString()&&(d[t]=e.reserve1.value/e.reserve0.value)})),e.next=12,(0,f.zI)(y().get("https://api2.dfsmoon.com/v2/state/get_tokens?limit=1000&account=".concat(o),{timeout:2e3}));case 12:if(x=e.sent,k=i()(x,2),N=k[0],w=k[1],N||200!==w.status){e.next=21;break}w.data.tokens.forEach((function(e){var t=e.contract+"-"+e.symbol,n=d[t+"-"+e.precision],r=e.amount*n;v+=r,b.push({key:t,contract:e.contract,sym:e.symbol,precision:String(e.precision),price:n,asset:m.xR.from(e.amount.toFixed(e.precision)+" "+e.symbol),value:r})})),b.sort((function(e,t){return p[e.key+"-"+e.precision]-p[t.key+"-"+t.precision]})),e.next=38;break;case 21:j=0;case 22:if(!(j<u.length)){e.next=38;break}return V=u[j].split("-")[0],L=u[j].split("-")[1],T=u[j].split("-")[2],M=d[u[j]],e.next=29,t.client.v1.chain.get_currency_balance(V,o,L);case 29:if((C=e.sent).length){e.next=32;break}return e.abrupt("continue",35);case 32:q=C[0].value*M,v+=q,b.push({key:V+"-"+L,contract:V,sym:L,precision:T,price:M,asset:C[0],value:q});case 35:j++,e.next=22;break;case 38:return e.next=40,r.load("loglogloglog");case 40:return z=e.sent,A=z.table("liqs"),e.next=44,A.all({scope:o});case 44:e.sent.forEach((function(e){var t=c.find((function(t){return t.mid.equals(e.mid)})),n=t.contract0.toString(),r=t.contract1.toString(),a=t.sym0.name,s=t.sym1.name,o=t.sym0.precision,i=t.sym1.precision,u=n+"-"+a,l=r+"-"+s,f=d[u+"-"+o],p=d[l+"-"+i],b=e.bal0.value,m=e.bal1.value,v=b*f,x=m*p,k=e.token.toNumber()/t.liquidity_token.toNumber(),y=k*t.reserve0.value,N=k*t.reserve1.value,w=y*f,j=N*p,V=w+j-v-x,L=S()().diff(S().utc(e.start.toString()),"days");h.reserveValue+=w+j,h.balValue+=v+x,g.push({ratio:k,contract0:n,sym0:a,precision0:o,bal0:b,key0:u,bal0Value:v,reserve0Value:w,contract1:r,sym1:s,precision1:i,bal1:m,key1:l,reserve0:y,reserve1:N,price0:f,price1:p,bal1Value:x,reserve1Value:j,diffValue:V,days:L})})),h.diffValue=h.reserveValue-h.balValue,s(l.N.setTokensLoading(!1)),s(l.N.setTokens(b)),s(l.N.setLiqTokens(g)),s(l.N.setTokensValue(v)),s(l.N.setLiqsValue(h)),e.next=58;break;case 54:e.prev=54,e.t0=e.catch(0),s(l.N.setTokensLoading(!1)),(0,f.Tv)(e.t0,n);case 58:case"end":return e.stop()}}),e,null,[[0,54]])})));return function(t,n,r,a){return e.apply(this,arguments)}}(),[n]),Q=(0,j.useCallback)(function(){var e=c()(a()().mark((function e(t,r){var c,i,u,d,p,b,g,v,h,x;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(N&&k&&o)){e.next=49;break}return s(l.N.setLoading(!0)),s(l.N.setTokensLoading(!0)),e.next=5,H(t,r);case 5:if(e.sent){e.next=9;break}return s(l.N.setLoading(!1)),s(l.N.setTokensLoading(!1)),e.abrupt("return");case 9:return e.prev=9,e.next=12,N.load(t);case 12:return c=e.sent,e.next=15,k.load("swapswapswap");case 15:return i=e.sent,e.next=18,k.load("dfsweb3desoc");case 18:return u=e.sent,e.next=21,k.load("dfsbpsvoters");case 21:return d=e.sent,p=i.table("markets"),b=u.table("profiles"),g=d.table("voters"),e.next=27,p.all();case 27:return v=e.sent,e.next=30,g.all({scope:"dfsbpsvoters",from:t,to:t});case 30:return h=e.sent,e.next=33,b.all({scope:"dfsweb3desoc",from:t,to:t});case 33:(x=e.sent).length||x.push({avatar:"",cover:"",desc:"",join:"",nick:"",owner:m.VG.from(t),sex:m.zM.from(2),update:""}),J(o,k,v,t),s(l.N.setMarkets(v)),s(l.N.setAccountInfo(c)),s(l.N.setProfile(x[0])),s(l.N.setVoter(h[0])),A(""),s(l.N.setLoading(!1)),e.next=49;break;case 44:e.prev=44,e.t0=e.catch(9),s(l.N.setLoading(!1)),s(l.N.setTokensLoading(!1)),(0,f.Tv)(e.t0,n);case 49:case"end":return e.stop()}}),e,null,[[9,44]])})));return function(t,n){return e.apply(this,arguments)}}(),[N,k,o,H,n,J]),W=(0,j.useCallback)((0,w.debounce)(function(){var e=c()(a()().mark((function e(t){var n,r,s,c;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target.value,/^[a-z1-5.]{1,12}$/.test(n)){e.next=6;break}0===n.trim().length?A(""):A("error"),e.next=12;break;case 6:return e.next=8,(0,f.zI)(o.client.v1.chain.get_account(n));case 8:r=e.sent,s=i()(r,2),c=s[1],A(c?"":"error");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),1e3),[o]),X=[{key:"info",label:(0,V.jsx)("span",{className:"text-lg font-semibold",children:O}),children:!!T&&(0,V.jsx)(u.i3,{})},{key:"auth",label:(0,V.jsx)("span",{className:"text-lg font-semibold",children:$}),children:!!T&&(0,V.jsx)(u.Bf,{})},{key:"token",label:(0,V.jsx)("span",{className:"text-lg font-semibold",children:G}),children:!!T&&(0,V.jsx)(u.DL,{})},{key:"liq",label:(0,V.jsx)("span",{className:"text-lg font-semibold",children:R}),children:!!T&&(0,V.jsx)(u.uq,{})},{key:"tx",label:(0,V.jsx)("span",{className:"text-lg font-semibold",children:U}),children:!!T&&(0,V.jsx)(u.ps,{})}],Y=(0,j.useCallback)((function(e,t){var n={};e&&(n.search=e),n.tab=t||L,E(n)}),[L]);return(0,j.useEffect)((function(){var e=_.get("search"),t=_.get("tab");t&&s(l.N.setActiveKey(t)),e&&Q(e,""),Y(e,t)}),[Q]),(0,j.useEffect)((function(){var e=T?T.accountName.toString():"";Y(e,L)}),[T,L,Y]),(0,V.jsxs)(d._z,{className:"account",ghost:!0,children:[(0,V.jsxs)(p.Z,{children:[(0,V.jsx)("div",{className:"hardline text-lg font-semibold mb-3",children:F}),(0,V.jsx)(v.Z.Search,{className:"pl-[13px] ",loading:M,addonBefore:(0,V.jsx)(h.Z,{spinning:M,children:Z}),placeholder:"Search...",allowClear:!0,enterButton:B,size:"large",status:z,onSearch:Q,onChange:W}),(0,V.jsx)(x.Z,{className:"mt-2",defaultActiveKey:"info",items:X,activeKey:L,onChange:function(e){s(l.N.setActiveKey(e))}})]}),r]})}},20034:function(){}}]);