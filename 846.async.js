"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[846],{64317:function(e,t,a){var n=a(1413),r=a(91),s=a(22270),o=a(62435),c=a(66758),i=a(56499),u=a(86074),l=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],m=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],d=function(e,t){var a=e.fieldProps,m=e.children,d=e.params,p=e.proFieldProps,f=e.mode,h=e.valueEnum,x=e.request,b=e.showSearch,k=e.options,y=(0,r.Z)(e,l),g=(0,o.useContext)(c.Z);return(0,u.jsx)(i.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,s.h)(h),request:x,params:d,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({options:k,mode:f,showSearch:b,getPopupContainer:g.getPopupContainer},a),ref:t,proFieldProps:p},y),{},{children:m}))},p=o.forwardRef((function(e,t){var a=e.fieldProps,l=e.children,d=e.params,p=e.proFieldProps,f=e.mode,h=e.valueEnum,x=e.request,b=e.options,k=(0,r.Z)(e,m),y=(0,n.Z)({options:b,mode:f||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},a),g=(0,o.useContext)(c.Z);return(0,u.jsx)(i.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,s.h)(h),request:x,params:d,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({getPopupContainer:g.getPopupContainer},y),ref:t,proFieldProps:p},k),{},{children:l}))})),f=o.forwardRef(d);f.SearchSelect=p,f.displayName="ProFormComponent",t.Z=f},16529:function(e,t,a){a.d(t,{s:function(){return d},S:function(){return h}});var n=a(5574),r=a.n(n),s=a(59530),o=a(85265),c=a(42075),i=a(15867),u=a(62435),l=a(86074),m=u.forwardRef((function(e,t){var a=(0,s.useIntl)(),n=a.formatMessage({id:"iframe.Close"}),m=a.formatMessage({id:"iframe.Jump"}),d=e.src,p=e.title,f=(0,u.useState)(!1),h=r()(f,2),x=h[0],b=h[1];(0,u.useImperativeHandle)(t,(function(){return{setIsDrawerOpen:b}}));var k=(0,u.useCallback)((function(){b(!1)}),[]),y=(0,u.useCallback)((function(){window.open(d),b(!1)}),[d]);return(0,l.jsx)(o.Z,{title:p,placement:"bottom",closable:!1,open:x,onClose:k,styles:{body:{padding:"0px"},header:{padding:"10px"}},height:"90%",destroyOnClose:!0,extra:(0,l.jsxs)(c.Z,{children:[(0,l.jsx)(i.ZP,{type:"primary",onClick:y,children:m}),(0,l.jsx)(i.ZP,{type:"primary",onClick:k,children:n})]}),children:(0,l.jsx)("iframe",{title:"",style:{borderWidth:"0px"},width:"100%",height:"100%",src:d})})})),d=(0,u.memo)(m),p=a(99021),f=u.forwardRef((function(e,t){var a=(0,u.useState)([]),n=r()(a,2),s=n[0],c=n[1],i=(0,u.useState)(!1),m=r()(i,2),d=m[0],f=m[1],h=(0,u.useCallback)((function(e){f(!0),c(e.split("|"))}),[]);return(0,u.useImperativeHandle)(t,(function(){return{handleOpen:h}})),(0,l.jsx)(o.Z,{placement:"bottom",closable:!0,open:d,onClose:function(){return f(!1)},styles:{body:{padding:"0px",textAlign:"center"},header:{padding:"10px"}},height:"91%",destroyOnClose:!0,children:s.map((function(e,t){return(0,l.jsx)(p.Z,{src:e,preview:!1},t)}))})})),h=(0,u.memo)(f)},73846:function(e,t,a){a.d(t,{cS:function(){return T},K4:function(){return Y},xt:function(){return V}});var n=a(16529),r=a(35132),s=a(15867),o=a(27484),c=a.n(o),i=a(70178),u=a.n(i),l=a(62435),m=a(15009),d=a.n(m),p=a(99289),f=a.n(p),h=a(5574),x=a.n(h),b=a(3990),k=a(64119),y=a(37476),g=a(5966),v=a(64317),j=a(59530),q=a(80507),S=a(45360),C=a(86074),w=l.forwardRef((function(e,t){var a=(0,j.useDispatch)(),n=S.ZP.useMessage(),r=x()(n,2),s=r[0],o=r[1],c=(0,j.useSelector)((function(e){return e.jiu.activeKey})),i=(0,j.useSelector)((function(e){return e.global.session})),u=(0,j.useSelector)((function(e){return e.global.account})),m=(0,j.useSelector)((function(e){return e.global.contractKit})),p=(0,j.useSelector)((function(e){return e.account.markets})),h=(0,l.useRef)(),w=(0,l.useState)(!1),N=x()(w,2),B=N[0],T=N[1],Z=(0,j.useIntl)(),O=Z.formatMessage({id:"common.intlInputException"}),I=Z.formatMessage({id:"common.intlPleaseConnectWallet"}),P=Z.formatMessage({id:"common.intlPleaseConnectNetwork"}),M=Z.formatMessage({id:"common.intlTxSuccess"}),E=Z.formatMessage({id:"common.intlTxFail"}),F=Z.formatMessage({id:"jiu.intlQuantityMustGreater"},{num:e.params.transferTokenMinAmount,sym:e.params.transferTokenSym}),A=Z.formatMessage({id:"jiu.intlFinished"}),_=(0,l.useCallback)((function(){T(!0)}),[]);(0,l.useImperativeHandle)(t,(function(){return{handleOpen:_}}));var z=(0,l.useCallback)(function(){var t=f()(d()().mark((function t(n){var r,o,c,l,f,h,y,g,v,j,S,C,w,N,B,T,Z,O,_,z,L,R,D,U,K,J,W,H,Y,$,V,G,Q,X,ee,te,ae,ne,re,se,oe;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.params.finish,o=e.params.inputPrefix,c=e.params.liqMid,l=e.params.liqTokenKey,f=e.params.liqSym,h=e.params.liqTokenMinAmount,y=e.params.transferTokenSym,g=e.params.transferTokenMinAmount,v=e.params.transferTokenContract,j=e.params.transferTokenPrecision,S=e.params.receiveAccount,C=e.params.type,w="",0,N="",B=0,2===C&&(w=e.params.holdTokenContract,e.params.holdTokenMinAmount,N=e.params.holdTokenSym,B=e.params.allTokenMinAmount),!r){t.next=20;break}return s.info("".concat(A)),t.abrupt("return",!0);case 20:if(t.prev=20,i&&i.broadcast){t.next=26;break}return s.error("".concat(I)),t.abrupt("return",!1);case 26:if(u){t.next=29;break}return s.error("".concat(P)),t.abrupt("return",!1);case 29:if(!(Number(n.quantity)<1)){t.next=32;break}return s.error("".concat(F)),t.abrupt("return",!1);case 32:if(T=[],!p||!p.length){t.next=37;break}T=p,t.next=45;break;case 37:return t.next=39,m.load("swapswapswap");case 39:return Z=t.sent,O=Z.table("markets"),t.next=43,O.all();case 43:T=t.sent,a(b.N.setMarkets(T));case 45:return t.next=47,m.load("loglogloglog");case 47:return _=t.sent,z=_.table("liqs"),t.next=51,z.all({scope:u.accountName.toString()});case 51:if(L=t.sent,R=0,D=f,(U=L.find((function(e){return e.mid.toNumber()===c})))&&(K=T.find((function(e){return e.mid.equals(U.mid)})),J=U.token.toNumber()/K.liquidity_token.toNumber(),W=J*K.reserve0.value,H=J*K.reserve1.value,Y=K.reserve0.symbol.name,$=K.reserve1.symbol.name,0===l?(R=W,D=Y):(R=H,D=$)),V=0,G=[],2!==C){t.next=63;break}return t.next=61,i.client.v1.chain.get_currency_balance(w,u.accountName.toString(),N);case 61:(G=t.sent).length&&(V=G[0].value);case 63:if(1!==C&&3!==C){t.next=74;break}if(Q=R,!(Number(n.quantity)<g)){t.next=69;break}return s.error("转账数量至少".concat(g).concat(y)),t.abrupt("return",!1);case 69:if(!(Q<h)){t.next=72;break}return s.error("JIU/DFS矿池做市至少".concat(h).concat(D)),t.abrupt("return",!1);case 72:t.next=83;break;case 74:if(2!==C){t.next=83;break}if(X=R+V,!(Number(n.quantity)<g)){t.next=80;break}return s.error("转账数量至少".concat(g).concat(y)),t.abrupt("return",!1);case 80:if(!(X<B)){t.next=83;break}return s.error("JIU/DFS做市+".concat(N,"余额至少").concat(B).concat(N)),t.abrupt("return",!1);case 83:return ee=q.xR.from(Number(n.quantity),q.xR.Symbol.fromParts(y,j)),te="",te=3===C?o+n.input.trim():o+n.input.trim().slice(6),ae={action:{account:v,name:"transfer",authorization:[i.permissionLevel],data:{from:i.actor,to:S,quantity:ee.toString(),memo:te}}},t.next=89,(0,k.zI)(i.transact(ae));case 89:return ne=t.sent,re=x()(ne,2),se=re[0],oe=re[1],se?s.error(se):oe&&oe.response?s.success("".concat(M)):s.error("".concat(E)),t.abrupt("return",!0);case 97:t.prev=97,t.t0=t.catch(20),console.log(t.t0.message),s.error(t.t0.message);case 101:case"end":return t.stop()}}),t,null,[[20,97]])})));return function(e){return t.apply(this,arguments)}}(),[i,u,m,e.params,p]);return(0,C.jsxs)(y.Y,{formRef:h,title:"活动"+c,open:B,onFinish:z,onOpenChange:function(e){T(e)},layout:"vertical",width:"400px",children:[3===e.params.type?(0,C.jsx)(g.Z,{name:"input",label:(0,C.jsx)("span",{className:" font-semibold",children:e.params.inputLabel}),placeholder:e.params.inputPlaceholder,fieldProps:{autoFocus:!1,size:"large"},rules:[{required:!0,whitespace:!0,message:"".concat(O),pattern:/^\d{5,}(\.\d+)?$/}]}):(0,C.jsx)(v.Z,{name:"input",label:(0,C.jsx)("span",{className:" font-semibold",children:e.params.inputLabel}),placeholder:e.params.inputPlaceholder,fieldProps:{autoFocus:!1,size:"large"},rules:[{required:!0,whitespace:!0,message:"".concat(O),pattern:/^.+$/}],valueEnum:e.params.schemes}),(0,C.jsx)(g.Z,{name:"quantity",label:(0,C.jsx)("span",{className:" font-semibold",children:"发送".concat(e.params.transferTokenSym,"数量(至少 ").concat(e.params.transferTokenMinAmount," ").concat(e.params.transferTokenSym,")")}),placeholder:"ex: ".concat(e.params.transferTokenMinAmount),fieldProps:{autoFocus:!1,size:"large"},rules:[{required:!0,whitespace:!0,message:"".concat(O),pattern:/^\d+(\.\d+)?$/}]}),o]})})),N=(0,l.memo)(w);c().extend(u());var B=function(e){var t=(0,l.useRef)(),a=e.params.src,o=e.params.title,c=(0,l.useRef)();return(0,C.jsxs)("div",{className:"",children:[(0,C.jsx)(r.Z.Title,{level:4,className:"text-center",children:o}),(0,C.jsx)("div",{className:"text-center mt-8",children:(0,C.jsx)("a",{className:" font-bold text-lg",onClick:function(){return t.current.setIsDrawerOpen(!0)},children:"活动详情"})}),(0,C.jsx)("div",{className:"mt-14",children:(0,C.jsx)(s.ZP,{type:"primary",size:"large",block:!0,onClick:function(){return c.current.handleOpen()},children:"立即参与"})}),(0,C.jsx)(N,{ref:c,params:e.params}),(0,C.jsx)(n.s,{ref:t,src:a,title:o})]})},T=(0,l.memo)(B),Z=a(31120),O=a(9669),I=a.n(O),P=a(55835);c().extend(u());var M=a(97857),E=a.n(M),F=a(81876),A=a(20701),_=a(11924),z=a(79360),L=a(24770),R=a(79642),D=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a},U=(0,l.forwardRef)((function(e,t){var a=e.chartRef,n=e.style,r=void 0===n?{height:"inherit"}:n,s=e.className,o=e.loading,c=e.loadingTemplate,i=e.errorTemplate,u=D(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),m=(0,_.Z)(A.sg,u),d=m.chart,p=m.container;return(0,l.useEffect)((function(){(0,z.J)(a,d.current)}),[d.current]),(0,l.useImperativeHandle)(t,(function(){return{getChart:function(){return d.current}}})),l.createElement(L.Z,{errorTemplate:i},o&&l.createElement(R.Z,{loadingTemplate:c,theme:e.theme}),l.createElement("div",{className:s,style:r,ref:p}))})),K=a(38345),J=a(92340),W=a(57953);c().extend(u());var H=function(e){var t=S.ZP.useMessage(),a=x()(t,2),n=a[0],r=a[1],s=(0,j.useNavigate)(),o=(0,l.useRef)(!1),i=(0,j.useDispatch)(),u=(0,j.useSelector)((function(e){return e.global.contractKit})),m=(0,j.useSelector)((function(e){return e.global.session})),p=(0,j.useSelector)((function(e){return e.jiu.liqsCache})),h=(0,j.useSelector)((function(e){return e.jiu.assetsCache})),y=(0,j.useSelector)((function(e){return e.account.markets})),g=(0,l.useState)([]),v=x()(g,2),q=v[0],w=v[1],N=(0,l.useState)([]),B=x()(N,2),T=B[0],O=B[1],M=(0,l.useState)([]),A=x()(M,2),_=A[0],z=A[1],L=(0,l.useState)([]),R=x()(L,2),D=R[0],H=R[1],Y=(0,l.useState)(!1),$=x()(Y,2),V=$[0],G=$[1],Q=(0,l.useState)([]),X=x()(Q,2),ee=X[0],te=X[1],ae=(0,l.useState)(""),ne=x()(ae,2),re=ne[0],se=ne[1],oe=(0,j.useIntl)().formatMessage({id:"jiu.intlMissingData"}),ce=(0,l.useCallback)(function(){var e=f()(d()().mark((function e(t){var a,r,s,o,i,u,l,m,p,f,h,b,y,g,v,j,q,S,C,w,N,B,T,O,M,E,F,A,_;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="jiutothemoon",r="000d9cae502dd1cc895745e204f83cc892bc4c450f92a03ecd4fe057709853cc",s=(0,P.js)("md5"),o=r+a,s.update(o),i=s.digest("hex").substring(0,8),u={key:i,chainId:r,account:a,skip:0,lastUpdate:"2020-01-01T01:01:01.000Z",error:!1,data:[]},e.next=9,Z.db.txList.where({key:i}).toArray();case 9:if((l=e.sent).length&&(u=l[0]),!(t&&c().utc(u.lastUpdate).valueOf()>c().utc(t).valueOf())){e.next=13;break}return e.abrupt("return",u.data);case 13:m=[],p=500,f=u.lastUpdate,h=u.skip;case 17:return e.next=20,(0,k.zI)(I().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&sort=asc&simple=true&noBinary=true&account=".concat(a,"&after=").concat(f,"&limit=").concat(p)));case 20:if(b=e.sent,y=x()(b,2),g=y[0],v=y[1],g||200!==v.status){e.next=73;break}if(j=v.data.simple_actions,q=j.length,S=v.data.total.value,C=1,0!==S){e.next=32;break}return Z.db.txList.put(u),e.abrupt("return",u.data);case 32:for(w=0;w<j.length;w++)h<=w&&m.push(j[w]);if(m.length){e.next=36;break}return u.error&&n.error(oe),e.abrupt("return",u.data);case 36:N=m.length-1;case 37:if(!(N>0)){e.next=46;break}if(m[N].transaction_id!==m[N-1].transaction_id){e.next=42;break}C+=1,e.next=43;break;case 42:return e.abrupt("break",46);case 43:N--,e.next=37;break;case 46:if(h=C,q!==p){e.next=58;break}if(B=m[m.length-1].timestamp,f=B,!(t&&c().utc(B).valueOf()>c().utc(t).valueOf())){e.next=56;break}return m.forEach((function(e){u.data.push(e)})),u.lastUpdate=B,u.skip=h,Z.db.txList.put(u),e.abrupt("return",u.data);case 56:e.next=71;break;case 58:return m.forEach((function(e){u.data.push(e)})),T=m[m.length-1].timestamp,u.lastUpdate=T,u.skip=h,e.next=64,(0,k.zI)(I().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&simple=true&noBinary=true&account=".concat(a,"&skip=0&limit=1")));case 64:return O=e.sent,M=x()(O,2),E=M[0],F=M[1],E||200!==F.status?n.error(E):(A=F.data.total.value,u.data.length!==A?(u.error=!0,n.error(oe)):u.error=!1),Z.db.txList.put(u),e.abrupt("return",u.data);case 71:e.next=77;break;case 73:return m.length&&(m.forEach((function(e){u.data.push(e)})),_=m[m.length-1].timestamp,u.lastUpdate=_,u.skip=h,u.error=!0),Z.db.txList.put(u),n.error(g),e.abrupt("return",u.data);case 77:e.next=17;break;case 79:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n]),ie=(0,l.useCallback)(function(){var t=f()(d()().mark((function t(a,r){var s,o,u,l,m,f,x,g,v,j,q,S,C,N,B,T,Z,I,P,M,A,_,L,R,D,U,K,J,W,Y,$,V,Q,X,ee,ae,ne,re,oe,ie,ue,le,me;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s=e.params.startTime,o=e.params.endTime,u=e.params.receiveAccount,l=e.params.transferTokenContract,m=e.params.transferTokenMinAmount,f=e.params.transferTokenSym,x=e.params.liqMid,g=e.params.liqTokenKey,v=e.params.liqSym,j=e.params.liqTokenMinAmount,q=e.params.type,S="",0,C="",N=0,2===q&&(S=e.params.holdTokenContract,e.params.holdTokenMinAmount,C=e.params.holdTokenSym,N=e.params.allTokenMinAmount),B=e.params.schemesRegexp,T=[],Z={},I=[],P=[],M=[],A=[],_=[],L=[],t.next=28,ce(o);case 28:R=t.sent,D=0;case 30:if(!(D<R.length)){t.next=40;break}if(U=c().utc(s).valueOf(),K=c().utc(o).valueOf(),J=c().utc(R[D].timestamp).valueOf(),U<=J&&J<=K&&R[D].contract===l&&"transfer"===R[D].action&&R[D].data.symbol===f&&R[D].data.to===u&&"dfsminingout"!==R[D].data.from&&"swapswapswap"!==R[D].data.from&&""!==R[D].data.memo.trim()&&T.push(R[D]),!(J>K)){t.next=37;break}return t.abrupt("break",40);case 37:D++,t.next=30;break;case 40:if(T.forEach((function(e){var t=e.data.from,a=e.data.memo.trim(),n=e.data.amount;Z.hasOwnProperty(t)?n>=m&&B[0].test(a)&&(Z[t]=e):Z[t]=e})),W=[],!y||!y.length){t.next=46;break}W=y,t.next=54;break;case 46:return t.next=48,r.load("swapswapswap");case 48:return Y=t.sent,$=Y.table("markets"),t.next=52,$.all();case 52:W=t.sent,i(b.N.setMarkets(W));case 54:return t.next=56,r.load("loglogloglog");case 56:V=t.sent,Q=V.table("liqs"),X=Object.keys(Z),ee={},ae={},ne=d()().mark((function e(){var t,n,r,s,o,c,i,u,l,m,f,b;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(se("".concat(re+1," / ").concat(X.length)),t=0,n=v,r=[],!p.hasOwnProperty(X[re])){e.next=8;break}r=p[X[re]],e.next=12;break;case 8:return e.next=10,Q.all({scope:X[re]});case 10:r=e.sent,ee[X[re]]=r;case 12:if((s=r.find((function(e){return e.mid.toNumber()===x})))&&(o=W.find((function(e){return e.mid.equals(s.mid)})),c=s.token.toNumber()/o.liquidity_token.toNumber(),i=c*o.reserve0.value,u=c*o.reserve1.value,l=o.reserve0.symbol.name,m=o.reserve1.symbol.name,0===g?(t=i,n=l):(t=u,n=m)),Z[X[re]].liqBalance=t,Z[X[re]].liqSym=n,f=0,b=[],2!==q){e.next=29;break}if(!h.hasOwnProperty(X[re])){e.next=23;break}b=h[X[re]],e.next=27;break;case 23:return e.next=25,a.client.v1.chain.get_currency_balance(S,X[re],C);case 25:b=e.sent,ae[X[re]]=b;case 27:b.length&&(f=b[0].value),Z[X[re]].holdBalance=f;case 29:case"end":return e.stop()}}),e)})),re=0;case 63:if(!(re<X.length)){t.next=68;break}return t.delegateYield(ne(),"t0",65);case 65:re++,t.next=63;break;case 68:for(Object.keys(ee).length&&i(F.N.setLiqsCache(E()(E()({},p),ee))),Object.keys(ae).length&&i(F.N.setAssetsCache(E()(E()({},h),ae))),1===q?X.forEach((function(e){var t=Z[e].liqBalance;Z[e].data.amount>=m&&t>=j?I.push(Z[e]):P.push(Z[e])})):2===q&&X.forEach((function(e){var t=Z[e].liqBalance+Z[e].holdBalance;Z[e].data.amount>=m&&t>=N?I.push(Z[e]):P.push(Z[e])})),oe={},ie=[],ue=1;ue<B.length;ue++)oe["scheme".concat(ue)]={vote:0,name:"方案".concat(ue)},ie.push("方案".concat(ue));I.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,o=c().utc(e.timestamp).local().format(),i=e.data.quantity,u=e.transaction_id,l=1;l<B.length;l++)if(B[l].test(a)){oe["scheme".concat(l)].vote+=1,A.push({key:t,account:n,liqBalance:r,liqSym:s,time:o,quantity:i,scheme:oe["scheme".concat(l)].name,memo:a,txid:u});break}})),Object.keys(oe).forEach((function(e){M.push({scheme:oe[e].name,vote:oe[e].vote})})),w(M),O(A.sort((function(e,t){return e.time.localeCompare(t.time)}))),te(ie),P.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,o=c().utc(e.timestamp).local().format(),i=e.data.quantity,u=e.transaction_id,l=1;l<B.length;l++)if(B[l].test(a)){oe["scheme".concat(l)].vote+=1,_.push({key:t,account:n,liqBalance:r,liqSym:s,time:o,quantity:i,scheme:oe["scheme".concat(l)].name,memo:a,txid:u});break}})),z(_.sort((function(e,t){return e.time.localeCompare(t.time)}))),le=0,M.forEach((function(e){e.vote>le&&(le=e.vote,me=e)})),A.forEach((function(e){e.scheme===me.scheme&&L.push(e)})),H(L.sort((function(e,t){return e.time.localeCompare(t.time)}))),G(!1),t.next=92;break;case 88:t.prev=88,t.t1=t.catch(0),G(!1),(0,k.Tv)(t.t1,n);case 92:case"end":return t.stop()}}),t,null,[[0,88]])})));return function(e,a){return t.apply(this,arguments)}}(),[ce,n,h,p,y,e.params]),ue={data:q,xField:"scheme",yField:"vote",meta:{vote:{alias:"票数"}},label:{},color:function(){return"#5B8FF9"},minColumnWidth:30,maxColumnWidth:30},le=(0,l.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,a){return(0,C.jsx)("span",{children:a+1})}},{title:"账号",dataIndex:"account",key:"account",sorter:function(e,t){return e.account.localeCompare(t.account)},render:function(e,t){return(0,C.jsx)("a",{onClick:function(){return s("/query/account?search=".concat(t.account,"&tab=info"))},children:t.account})}},{title:"JIU/DFS矿池做市",dataIndex:"liqBalance",key:"liqBalance",sorter:function(e,t){return t.liqBalance-e.liqBalance},render:function(e,t){return(0,C.jsx)("span",{children:t.liqBalance.toFixed(0)+" "+t.liqSym})}},{title:"转账数量",dataIndex:"quantity",key:"quantity",sorter:function(e,t){return Number(t.quantity.split(" ")[0])-Number(e.quantity.split(" ")[0])},render:function(e,t){return(0,C.jsx)("span",{children:t.quantity})}},{title:"转账时间",dataIndex:"time",key:"time",sorter:function(e,t){return t.time.localeCompare(e.time)},render:function(e,t){return(0,C.jsx)("span",{children:t.time})}},{title:"投票方案",dataIndex:"scheme",key:"scheme",sorter:function(e,t){return e.scheme.localeCompare(t.scheme)},filters:ee.map((function(e){return{text:e,value:e}})),onFilter:function(e,t){return e===t.scheme},render:function(e,t){return(0,C.jsx)("span",{children:t.scheme})}},{title:"原始数据",dataIndex:"memo",key:"memo",render:function(e,t){return(0,C.jsx)("span",{children:t.memo})}},{title:"交易id",dataIndex:"txid",key:"txid",render:function(e,t){return(0,C.jsx)("a",{onClick:function(){return s("/query/transaction?search=".concat(t.txid,"&tab=summary"))},children:t.txid.slice(0,8)})}}]}),[ee]);return(0,l.useEffect)((function(){m&&u&&!o.current&&(o.current=!0,G(!0),ie(m,u))}),[ie,u,m]),(0,C.jsxs)("div",{className:"result1",children:[(0,C.jsx)(K.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"投票结果"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(W.Z,{size:"large",spinning:V,tip:re,children:(0,C.jsx)(U,E()(E()({},ue),{},{loading:V}))})}),(0,C.jsx)(K.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"有效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(J.Z,{scroll:{x:!0},size:"small",columns:le,dataSource:T,defaultData:[],loading:{spinning:V,tip:re},search:!1,options:!1,pagination:!1})}),(0,C.jsx)(K.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"无效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(J.Z,{scroll:{x:!0},size:"small",columns:le,dataSource:_,defaultData:[],loading:{spinning:V,tip:re},search:!1,options:!1,pagination:!1})}),(0,C.jsx)(K.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"获奖用户"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(J.Z,{scroll:{x:!0},size:"small",columns:le,dataSource:D,defaultData:[],loading:{spinning:V,tip:re},search:!1,options:!1,pagination:!1})}),r]})},Y=(0,l.memo)(H);c().extend(u());var $=function(e){var t=S.ZP.useMessage(),a=x()(t,2),n=a[0],r=a[1],s=(0,j.useNavigate)(),o=(0,l.useRef)(!1),i=(0,j.useDispatch)(),u=(0,j.useSelector)((function(e){return e.global.contractKit})),m=(0,j.useSelector)((function(e){return e.global.session})),p=(0,j.useSelector)((function(e){return e.jiu.liqsCache})),h=(0,j.useSelector)((function(e){return e.jiu.assetsCache})),y=(0,j.useSelector)((function(e){return e.account.markets})),g=(0,l.useState)([]),v=x()(g,2),q=v[0],w=v[1],N=(0,l.useState)([]),B=x()(N,2),T=B[0],O=B[1],M=(0,l.useState)([]),A=x()(M,2),_=A[0],z=A[1],L=(0,l.useState)([]),R=x()(L,2),D=R[0],H=R[1],Y=(0,l.useState)(!1),$=x()(Y,2),V=$[0],G=$[1],Q=(0,l.useState)([]),X=x()(Q,2),ee=X[0],te=X[1],ae=(0,l.useState)(""),ne=x()(ae,2),re=ne[0],se=ne[1],oe=(0,j.useIntl)().formatMessage({id:"jiu.intlMissingData"}),ce=(0,l.useCallback)(function(){var e=f()(d()().mark((function e(t){var a,r,s,o,i,u,l,m,p,f,h,b,y,g,v,j,q,S,C,w,N,B,T,O,M,E,F,A,_;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="jiutothemoon",r="000d9cae502dd1cc895745e204f83cc892bc4c450f92a03ecd4fe057709853cc",s=(0,P.js)("md5"),o=r+a,s.update(o),i=s.digest("hex").substring(0,8),u={key:i,chainId:r,account:a,skip:0,lastUpdate:"2020-01-01T01:01:01.000Z",error:!1,data:[]},e.next=9,Z.db.txList.where({key:i}).toArray();case 9:if((l=e.sent).length&&(u=l[0]),!(t&&c().utc(u.lastUpdate).valueOf()>c().utc(t).valueOf())){e.next=13;break}return e.abrupt("return",u.data);case 13:m=[],p=500,f=u.lastUpdate,h=u.skip;case 17:return e.next=20,(0,k.zI)(I().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&sort=asc&simple=true&noBinary=true&account=".concat(a,"&after=").concat(f,"&limit=").concat(p)));case 20:if(b=e.sent,y=x()(b,2),g=y[0],v=y[1],g||200!==v.status){e.next=73;break}if(j=v.data.simple_actions,q=j.length,S=v.data.total.value,C=1,0!==S){e.next=32;break}return Z.db.txList.put(u),e.abrupt("return",u.data);case 32:for(w=0;w<j.length;w++)h<=w&&m.push(j[w]);if(m.length){e.next=36;break}return u.error&&n.error(oe),e.abrupt("return",u.data);case 36:N=m.length-1;case 37:if(!(N>0)){e.next=46;break}if(m[N].transaction_id!==m[N-1].transaction_id){e.next=42;break}C+=1,e.next=43;break;case 42:return e.abrupt("break",46);case 43:N--,e.next=37;break;case 46:if(h=C,q!==p){e.next=58;break}if(B=m[m.length-1].timestamp,f=B,!(t&&c().utc(B).valueOf()>c().utc(t).valueOf())){e.next=56;break}return m.forEach((function(e){u.data.push(e)})),u.lastUpdate=B,u.skip=h,Z.db.txList.put(u),e.abrupt("return",u.data);case 56:e.next=71;break;case 58:return m.forEach((function(e){u.data.push(e)})),T=m[m.length-1].timestamp,u.lastUpdate=T,u.skip=h,e.next=64,(0,k.zI)(I().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&simple=true&noBinary=true&account=".concat(a,"&skip=0&limit=1")));case 64:return O=e.sent,M=x()(O,2),E=M[0],F=M[1],E||200!==F.status?n.error(E):(A=F.data.total.value,u.data.length!==A?(u.error=!0,n.error(oe)):u.error=!1),Z.db.txList.put(u),e.abrupt("return",u.data);case 71:e.next=77;break;case 73:return m.length&&(m.forEach((function(e){u.data.push(e)})),_=m[m.length-1].timestamp,u.lastUpdate=_,u.skip=h,u.error=!0),Z.db.txList.put(u),n.error(g),e.abrupt("return",u.data);case 77:e.next=17;break;case 79:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n]),ie=(0,l.useCallback)(function(){var t=f()(d()().mark((function t(a,r){var s,o,u,l,m,f,x,g,v,j,q,S,C,N,B,T,Z,I,P,M,A,_,L,R,D,U,K,J,W,Y,$,V,Q,X,ee,ae,ne,re,oe,ie,ue,le,me;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s=e.params.startTime,o=e.params.endTime,u=e.params.receiveAccount,l=e.params.transferTokenContract,m=e.params.transferTokenMinAmount,f=e.params.transferTokenSym,x=e.params.liqMid,g=e.params.liqTokenKey,v=e.params.liqSym,j=e.params.liqTokenMinAmount,q=e.params.type,S="",0,C="",N=0,2===q&&(S=e.params.holdTokenContract,e.params.holdTokenMinAmount,C=e.params.holdTokenSym,N=e.params.allTokenMinAmount),B=e.params.schemesRegexp,T=[],Z={},I=[],P=[],M=[],A=[],_=[],L=[],t.next=28,ce(o);case 28:R=t.sent,D=0;case 30:if(!(D<R.length)){t.next=40;break}if(U=c().utc(s).valueOf(),K=c().utc(o).valueOf(),J=c().utc(R[D].timestamp).valueOf(),U<=J&&J<=K&&R[D].contract===l&&"transfer"===R[D].action&&R[D].data.symbol===f&&R[D].data.to===u&&"dfsminingout"!==R[D].data.from&&"swapswapswap"!==R[D].data.from&&""!==R[D].data.memo.trim()&&T.push(R[D]),!(J>K)){t.next=37;break}return t.abrupt("break",40);case 37:D++,t.next=30;break;case 40:if(T.forEach((function(e){var t=e.data.from,a=e.data.memo.trim(),n=e.data.amount;Z.hasOwnProperty(t)?n>=m&&B[0].test(a)&&(Z[t]=e):Z[t]=e})),W=[],!y||!y.length){t.next=46;break}W=y,t.next=54;break;case 46:return t.next=48,r.load("swapswapswap");case 48:return Y=t.sent,$=Y.table("markets"),t.next=52,$.all();case 52:W=t.sent,i(b.N.setMarkets(W));case 54:return t.next=56,r.load("loglogloglog");case 56:V=t.sent,Q=V.table("liqs"),X=Object.keys(Z),ee={},ae={},ne=d()().mark((function e(){var t,n,r,s,o,c,i,u,l,m,f,b;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(se("".concat(re+1," / ").concat(X.length)),t=0,n=v,r=[],!p.hasOwnProperty(X[re])){e.next=8;break}r=p[X[re]],e.next=12;break;case 8:return e.next=10,Q.all({scope:X[re]});case 10:r=e.sent,ee[X[re]]=r;case 12:if((s=r.find((function(e){return e.mid.toNumber()===x})))&&(o=W.find((function(e){return e.mid.equals(s.mid)})),c=s.token.toNumber()/o.liquidity_token.toNumber(),i=c*o.reserve0.value,u=c*o.reserve1.value,l=o.reserve0.symbol.name,m=o.reserve1.symbol.name,0===g?(t=i,n=l):(t=u,n=m)),Z[X[re]].liqBalance=t,Z[X[re]].liqSym=n,f=0,b=[],2!==q){e.next=29;break}if(!h.hasOwnProperty(X[re])){e.next=23;break}b=h[X[re]],e.next=27;break;case 23:return e.next=25,a.client.v1.chain.get_currency_balance(S,X[re],C);case 25:b=e.sent,ae[X[re]]=b;case 27:b.length&&(f=b[0].value),Z[X[re]].holdBalance=f;case 29:case"end":return e.stop()}}),e)})),re=0;case 63:if(!(re<X.length)){t.next=68;break}return t.delegateYield(ne(),"t0",65);case 65:re++,t.next=63;break;case 68:for(Object.keys(ee).length&&i(F.N.setLiqsCache(E()(E()({},p),ee))),Object.keys(ae).length&&i(F.N.setAssetsCache(E()(E()({},h),ae))),1===q?X.forEach((function(e){var t=Z[e].liqBalance;Z[e].data.amount>=m&&t>=j?I.push(Z[e]):P.push(Z[e])})):2===q&&X.forEach((function(e){var t=Z[e].liqBalance+Z[e].holdBalance;Z[e].data.amount>=m&&t>=N?I.push(Z[e]):P.push(Z[e])})),oe={},ie=[],ue=1;ue<B.length;ue++)oe["scheme".concat(ue)]={vote:0,name:"方案".concat(ue)},ie.push("方案".concat(ue));I.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,o=c().utc(e.timestamp).local().format(),i=e.data.quantity,u=e.transaction_id,l=e.holdBalance,m=r+l,d=1;d<B.length;d++)if(B[d].test(a)){oe["scheme".concat(d)].vote+=1,A.push({key:t,account:n,liqBalance:r,liqSym:s,time:o,quantity:i,scheme:oe["scheme".concat(d)].name,memo:a,txid:u,holdBalance:l,holdTokenSym:C,allBalance:m});break}})),Object.keys(oe).forEach((function(e){M.push({scheme:oe[e].name,vote:oe[e].vote})})),w(M),O(A.sort((function(e,t){return e.time.localeCompare(t.time)}))),te(ie),P.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,o=c().utc(e.timestamp).local().format(),i=e.data.quantity,u=e.transaction_id,l=e.holdBalance,m=r+l,d=1;d<B.length;d++)if(B[d].test(a)){oe["scheme".concat(d)].vote+=1,_.push({key:t,account:n,liqBalance:r,liqSym:s,time:o,quantity:i,scheme:oe["scheme".concat(d)].name,memo:a,txid:u,holdBalance:l,holdTokenSym:C,allBalance:m});break}})),z(_.sort((function(e,t){return e.time.localeCompare(t.time)}))),le=0,M.forEach((function(e){e.vote>le&&(le=e.vote,me=e)})),A.forEach((function(e){e.scheme===me.scheme&&L.push(e)})),H(L.sort((function(e,t){return e.time.localeCompare(t.time)}))),G(!1),t.next=92;break;case 88:t.prev=88,t.t1=t.catch(0),G(!1),(0,k.Tv)(t.t1,n);case 92:case"end":return t.stop()}}),t,null,[[0,88]])})));return function(e,a){return t.apply(this,arguments)}}(),[ce,n,h,p,y,e.params]),ue={data:q,xField:"scheme",yField:"vote",meta:{vote:{alias:"票数"}},label:{},color:function(){return"#5B8FF9"},minColumnWidth:30,maxColumnWidth:30},le=(0,l.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,a){return(0,C.jsx)("span",{children:a+1})}},{title:"账号",dataIndex:"account",key:"account",sorter:function(e,t){return e.account.localeCompare(t.account)},render:function(e,t){return(0,C.jsx)("a",{onClick:function(){return s("/query/account?search=".concat(t.account,"&tab=info"))},children:t.account})}},{title:"JIU/DFS矿池做市",dataIndex:"liqBalance",key:"liqBalance",sorter:function(e,t){return t.liqBalance-e.liqBalance},render:function(e,t){return(0,C.jsx)("span",{children:t.liqBalance.toFixed(0)+" "+t.liqSym})}},{title:"JIU账号余额",dataIndex:"holdBalance",key:"holdBalance",sorter:function(e,t){return t.holdBalance-e.holdBalance},render:function(e,t){return(0,C.jsx)("span",{children:t.holdBalance.toFixed(0)+" "+t.holdTokenSym})}},{title:"做市+持有",dataIndex:"allBalance",key:"allBalance",sorter:function(e,t){return t.allBalance-e.allBalance},render:function(e,t){return(0,C.jsx)("span",{children:(0,k.CE)(t.allBalance)+" "+t.holdTokenSym})}},{title:"转账数量",dataIndex:"quantity",key:"quantity",sorter:function(e,t){return Number(t.quantity.split(" ")[0])-Number(e.quantity.split(" ")[0])},render:function(e,t){return(0,C.jsx)("span",{children:t.quantity})}},{title:"转账时间",dataIndex:"time",key:"time",sorter:function(e,t){return t.time.localeCompare(e.time)},render:function(e,t){return(0,C.jsx)("span",{children:t.time})}},{title:"投票方案",dataIndex:"scheme",key:"scheme",sorter:function(e,t){return e.scheme.localeCompare(t.scheme)},filters:ee.map((function(e){return{text:e,value:e}})),onFilter:function(e,t){return e===t.scheme},render:function(e,t){return(0,C.jsx)("span",{children:t.scheme})}},{title:"原始数据",dataIndex:"memo",key:"memo",render:function(e,t){return(0,C.jsx)("span",{children:t.memo})}},{title:"交易id",dataIndex:"txid",key:"txid",render:function(e,t){return(0,C.jsx)("a",{onClick:function(){return s("/query/transaction?search=".concat(t.txid,"&tab=summary"))},children:t.txid.slice(0,8)})}}]}),[ee]);return(0,l.useEffect)((function(){m&&u&&!o.current&&(o.current=!0,G(!0),ie(m,u))}),[ie,u,m]),(0,C.jsxs)("div",{className:"result2",children:[(0,C.jsx)(K.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"投票结果"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(W.Z,{size:"large",spinning:V,tip:re,children:(0,C.jsx)(U,E()(E()({},ue),{},{loading:V}))})}),(0,C.jsx)(K.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"有效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(J.Z,{scroll:{x:!0},size:"small",columns:le,dataSource:T,defaultData:[],loading:{spinning:V,tip:re},search:!1,options:!1,pagination:!1})}),(0,C.jsx)(K.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"无效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(J.Z,{scroll:{x:!0},size:"small",columns:le,dataSource:_,defaultData:[],loading:{spinning:V,tip:re},search:!1,options:!1,pagination:!1})}),(0,C.jsx)(K.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"获奖用户"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(J.Z,{scroll:{x:!0},size:"small",columns:le,dataSource:D,defaultData:[],loading:{spinning:V,tip:re},search:!1,options:!1,pagination:!1})}),r]})},V=(0,l.memo)($);c().extend(u())}}]);