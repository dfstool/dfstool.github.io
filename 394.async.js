"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[394],{64317:function(e,t,a){var n=a(1413),r=a(91),s=a(22270),c=a(62435),o=a(66758),i=a(56499),u=a(86074),l=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],m=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],d=function(e,t){var a=e.fieldProps,m=e.children,d=e.params,p=e.proFieldProps,f=e.mode,h=e.valueEnum,x=e.request,b=e.showSearch,k=e.options,y=(0,r.Z)(e,l),g=(0,c.useContext)(o.Z);return(0,u.jsx)(i.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,s.h)(h),request:x,params:d,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({options:k,mode:f,showSearch:b,getPopupContainer:g.getPopupContainer},a),ref:t,proFieldProps:p},y),{},{children:m}))},p=c.forwardRef((function(e,t){var a=e.fieldProps,l=e.children,d=e.params,p=e.proFieldProps,f=e.mode,h=e.valueEnum,x=e.request,b=e.options,k=(0,r.Z)(e,m),y=(0,n.Z)({options:b,mode:f||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},a),g=(0,c.useContext)(o.Z);return(0,u.jsx)(i.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,s.h)(h),request:x,params:d,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({getPopupContainer:g.getPopupContainer},y),ref:t,proFieldProps:p},k),{},{children:l}))})),f=c.forwardRef(d);f.SearchSelect=p,f.displayName="ProFormComponent",t.Z=f},16529:function(e,t,a){a.d(t,{s:function(){return d},S:function(){return h}});var n=a(5574),r=a.n(n),s=a(59530),c=a(85265),o=a(42075),i=a(15867),u=a(62435),l=a(86074),m=u.forwardRef((function(e,t){var a=(0,s.useIntl)(),n=a.formatMessage({id:"iframe.Close"}),m=a.formatMessage({id:"iframe.Jump"}),d=e.src,p=e.title,f=(0,u.useState)(!1),h=r()(f,2),x=h[0],b=h[1];(0,u.useImperativeHandle)(t,(function(){return{setIsDrawerOpen:b}}));var k=(0,u.useCallback)((function(){b(!1)}),[]),y=(0,u.useCallback)((function(){window.open(d),b(!1)}),[d]);return(0,l.jsx)(c.Z,{title:p,placement:"bottom",closable:!1,open:x,onClose:k,styles:{body:{padding:"0px"},header:{padding:"10px"}},height:"90%",destroyOnClose:!0,extra:(0,l.jsxs)(o.Z,{children:[(0,l.jsx)(i.ZP,{type:"primary",onClick:y,children:m}),(0,l.jsx)(i.ZP,{type:"primary",onClick:k,children:n})]}),children:(0,l.jsx)("iframe",{title:"",style:{borderWidth:"0px"},width:"100%",height:"100%",src:d})})})),d=(0,u.memo)(m),p=a(99021),f=u.forwardRef((function(e,t){var a=(0,u.useState)([]),n=r()(a,2),s=n[0],o=n[1],i=(0,u.useState)(!1),m=r()(i,2),d=m[0],f=m[1],h=(0,u.useCallback)((function(e){f(!0),o(e.split("|"))}),[]);return(0,u.useImperativeHandle)(t,(function(){return{handleOpen:h}})),(0,l.jsx)(c.Z,{placement:"bottom",closable:!0,open:d,onClose:function(){return f(!1)},styles:{body:{padding:"0px",textAlign:"center"},header:{padding:"10px"}},height:"91%",destroyOnClose:!0,children:s.map((function(e,t){return(0,l.jsx)(p.Z,{src:e,preview:!1},t)}))})})),h=(0,u.memo)(f)},12394:function(e,t,a){a.d(t,{cS:function(){return T},K4:function(){return Y},xt:function(){return $}});var n=a(16529),r=a(35132),s=a(15867),c=a(27484),o=a.n(c),i=a(70178),u=a.n(i),l=a(62435),m=a(15009),d=a.n(m),p=a(99289),f=a.n(p),h=a(5574),x=a.n(h),b=a(3990),k=a(64119),y=a(37476),g=a(64317),v=a(5966),j=a(59530),q=a(80507),S=a(45360),C=a(86074),w=l.forwardRef((function(e,t){var a=(0,j.useDispatch)(),n=S.ZP.useMessage(),r=x()(n,2),s=r[0],c=r[1],o=(0,j.useSelector)((function(e){return e.jiu.activeKey})),i=(0,j.useSelector)((function(e){return e.global.session})),u=(0,j.useSelector)((function(e){return e.global.account})),m=(0,j.useSelector)((function(e){return e.global.contractKit})),p=(0,j.useSelector)((function(e){return e.account.markets})),h=(0,l.useRef)(),w=(0,l.useState)(!1),B=x()(w,2),N=B[0],T=B[1],Z=(0,j.useIntl)(),O=Z.formatMessage({id:"common.intlInputException"}),I=Z.formatMessage({id:"common.intlPleaseConnectWallet"}),M=Z.formatMessage({id:"common.intlPleaseConnectNetwork"}),P=Z.formatMessage({id:"common.intlTxSuccess"}),E=Z.formatMessage({id:"common.intlTxFail"}),F=Z.formatMessage({id:"jiu.intlQuantityMustGreater"},{num:e.params.transferTokenMinAmount,sym:e.params.transferTokenSym}),A=Z.formatMessage({id:"jiu.intlFinished"}),_=(0,l.useCallback)((function(){T(!0)}),[]);(0,l.useImperativeHandle)(t,(function(){return{handleOpen:_}}));var R=(0,l.useCallback)(function(){var t=f()(d()().mark((function t(n){var r,c,o,l,f,h,y,g,v,j,S,C,w,B,N,T,Z,O,_,R,z,D,U,L,K,J,W,H,Y,V,$,G,Q,X,ee,te,ae,ne,re;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.params.finish,c=e.params.liqMid,o=e.params.liqTokenKey,l=e.params.liqSym,f=e.params.liqTokenMinAmount,h=e.params.transferTokenSym,y=e.params.transferTokenMinAmount,g=e.params.transferTokenContract,v=e.params.transferTokenPrecision,j=e.params.receiveAccount,S=e.params.type,C="",0,w="",B=0,2===S&&(C=e.params.holdTokenContract,e.params.holdTokenMinAmount,w=e.params.holdTokenSym,B=e.params.allTokenMinAmount),!r){t.next=19;break}return s.info("".concat(A)),t.abrupt("return",!0);case 19:if(t.prev=19,i&&i.broadcast){t.next=25;break}return s.error("".concat(I)),t.abrupt("return",!1);case 25:if(u){t.next=28;break}return s.error("".concat(M)),t.abrupt("return",!1);case 28:if(!(Number(n.quantity)<1)){t.next=31;break}return s.error("".concat(F)),t.abrupt("return",!1);case 31:if(N=[],!p||!p.length){t.next=36;break}N=p,t.next=44;break;case 36:return t.next=38,m.load("swapswapswap");case 38:return T=t.sent,Z=T.table("markets"),t.next=42,Z.all();case 42:N=t.sent,a(b.N.setMarkets(N));case 44:return t.next=46,m.load("loglogloglog");case 46:return O=t.sent,_=O.table("liqs"),t.next=50,_.all({scope:u.accountName.toString()});case 50:if(R=t.sent,z=0,D=l,(U=R.find((function(e){return e.mid.toNumber()===c})))&&(L=N.find((function(e){return e.mid.equals(U.mid)})),K=U.token.toNumber()/L.liquidity_token.toNumber(),J=K*L.reserve0.value,W=K*L.reserve1.value,H=L.reserve0.symbol.name,Y=L.reserve1.symbol.name,0===o?(z=J,D=H):(z=W,D=Y)),V=0,$=[],2!==S){t.next=62;break}return t.next=60,i.client.v1.chain.get_currency_balance(C,u.accountName.toString(),w);case 60:($=t.sent).length&&(V=$[0].value);case 62:if(1!==S){t.next=73;break}if(G=z,!(Number(n.quantity)<y)){t.next=68;break}return s.error("转账数量至少".concat(y).concat(h)),t.abrupt("return",!1);case 68:if(!(G<f)){t.next=71;break}return s.error("JIU/DFS矿池做市至少".concat(f).concat(D)),t.abrupt("return",!1);case 71:t.next=82;break;case 73:if(2!==S){t.next=82;break}if(Q=z+V,!(Number(n.quantity)<y)){t.next=79;break}return s.error("转账数量至少".concat(y).concat(h)),t.abrupt("return",!1);case 79:if(!(Q<B)){t.next=82;break}return s.error("JIU/DFS做市+".concat(w,"余额至少").concat(B).concat(w)),t.abrupt("return",!1);case 82:return X=q.xR.from(Number(n.quantity),q.xR.Symbol.fromParts(h,v)),ee={action:{account:g,name:"transfer",authorization:[i.permissionLevel],data:{from:i.actor,to:j,quantity:X.toString(),memo:n.scheme.slice(6)}}},t.next=86,(0,k.zI)(i.transact(ee));case 86:return te=t.sent,ae=x()(te,2),ne=ae[0],re=ae[1],ne?s.error(ne):re&&re.response?s.success("".concat(P)):s.error("".concat(E)),t.abrupt("return",!0);case 94:t.prev=94,t.t0=t.catch(19),console.log(t.t0.message),s.error(t.t0.message);case 98:case"end":return t.stop()}}),t,null,[[19,94]])})));return function(e){return t.apply(this,arguments)}}(),[i,u,m,e.params,p]);return(0,C.jsxs)(y.Y,{formRef:h,title:"活动"+o,open:N,onFinish:R,onOpenChange:function(e){T(e)},layout:"vertical",width:"400px",children:[(0,C.jsx)(g.Z,{name:"scheme",label:(0,C.jsx)("span",{className:" font-semibold",children:"选择方案"}),placeholder:"",fieldProps:{autoFocus:!1,size:"large"},rules:[{required:!0,whitespace:!0,message:"".concat(O),pattern:/^.+$/}],valueEnum:e.params.schemes}),(0,C.jsx)(v.Z,{name:"quantity",label:(0,C.jsx)("span",{className:" font-semibold",children:"发送".concat(e.params.transferTokenSym,"数量(至少 ").concat(e.params.transferTokenMinAmount," ").concat(e.params.transferTokenSym,")")}),placeholder:"ex: ".concat(e.params.transferTokenMinAmount),fieldProps:{autoFocus:!1,size:"large"},rules:[{required:!0,whitespace:!0,message:"".concat(O),pattern:/^\d+(\.\d+)?$/}]}),c]})})),B=(0,l.memo)(w);o().extend(u());var N=function(e){var t=(0,l.useRef)(),a=e.params.src,c=e.params.title,o=(0,l.useRef)();return(0,C.jsxs)("div",{className:"",children:[(0,C.jsx)(r.Z.Title,{level:4,className:"text-center",children:c}),(0,C.jsx)("div",{className:"text-center mt-8",children:(0,C.jsx)("a",{className:" font-bold text-lg",onClick:function(){return t.current.setIsDrawerOpen(!0)},children:"活动详情"})}),(0,C.jsx)("div",{className:"mt-14",children:(0,C.jsx)(s.ZP,{type:"primary",size:"large",block:!0,onClick:function(){return o.current.handleOpen()},children:"立即参与"})}),(0,C.jsx)(B,{ref:o,params:e.params}),(0,C.jsx)(n.s,{ref:t,src:a,title:c})]})},T=(0,l.memo)(N),Z=a(97857),O=a.n(Z),I=a(81876),M=a(31120),P=a(20701),E=a(11924),F=a(79360),A=a(24770),_=a(79642),R=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a},z=(0,l.forwardRef)((function(e,t){var a=e.chartRef,n=e.style,r=void 0===n?{height:"inherit"}:n,s=e.className,c=e.loading,o=e.loadingTemplate,i=e.errorTemplate,u=R(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),m=(0,E.Z)(P.sg,u),d=m.chart,p=m.container;return(0,l.useEffect)((function(){(0,F.J)(a,d.current)}),[d.current]),(0,l.useImperativeHandle)(t,(function(){return{getChart:function(){return d.current}}})),l.createElement(A.Z,{errorTemplate:i},c&&l.createElement(_.Z,{loadingTemplate:o,theme:e.theme}),l.createElement("div",{className:s,style:r,ref:p}))})),D=a(38345),U=a(92340),L=a(57953),K=a(9669),J=a.n(K),W=a(55835);o().extend(u());var H=function(e){var t=S.ZP.useMessage(),a=x()(t,2),n=a[0],r=a[1],s=(0,j.useNavigate)(),c=(0,l.useRef)(!1),i=(0,j.useDispatch)(),u=(0,j.useSelector)((function(e){return e.global.contractKit})),m=(0,j.useSelector)((function(e){return e.global.session})),p=(0,j.useSelector)((function(e){return e.jiu.liqsCache})),h=(0,j.useSelector)((function(e){return e.jiu.assetsCache})),y=(0,j.useSelector)((function(e){return e.account.markets})),g=(0,l.useState)([]),v=x()(g,2),q=v[0],w=v[1],B=(0,l.useState)([]),N=x()(B,2),T=N[0],Z=N[1],P=(0,l.useState)([]),E=x()(P,2),F=E[0],A=E[1],_=(0,l.useState)([]),R=x()(_,2),K=R[0],H=R[1],Y=(0,l.useState)(!1),V=x()(Y,2),$=V[0],G=V[1],Q=(0,l.useState)([]),X=x()(Q,2),ee=X[0],te=X[1],ae=(0,l.useState)(""),ne=x()(ae,2),re=ne[0],se=ne[1],ce=(0,j.useIntl)().formatMessage({id:"jiu.intlMissingData"}),oe=(0,l.useCallback)(function(){var e=f()(d()().mark((function e(t){var a,r,s,c,i,u,l,m,p,f,h,b,y,g,v,j,q,S,C,w,B,N,T,Z,O,I,P,E,F;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="jiutothemoon",r="000d9cae502dd1cc895745e204f83cc892bc4c450f92a03ecd4fe057709853cc",s=(0,W.js)("md5"),c=r+a,s.update(c),i=s.digest("hex").substring(0,8),u={key:i,chainId:r,account:a,skip:0,lastUpdate:"2020-01-01T01:01:01.000Z",error:!1,data:[]},e.next=9,M.db.txList.where({key:i}).toArray();case 9:if((l=e.sent).length&&(u=l[0]),!(t&&o().utc(u.lastUpdate).valueOf()>o().utc(t).valueOf())){e.next=13;break}return e.abrupt("return",u.data);case 13:m=[],p=500,f=u.lastUpdate,h=u.skip;case 17:return e.next=20,(0,k.zI)(J().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&sort=asc&simple=true&noBinary=true&account=".concat(a,"&after=").concat(f,"&limit=").concat(p)));case 20:if(b=e.sent,y=x()(b,2),g=y[0],v=y[1],g||200!==v.status){e.next=73;break}if(j=v.data.simple_actions,q=j.length,S=v.data.total.value,C=1,0!==S){e.next=32;break}return M.db.txList.put(u),e.abrupt("return",u.data);case 32:for(w=0;w<j.length;w++)h<=w&&m.push(j[w]);if(m.length){e.next=36;break}return u.error&&n.error(ce),e.abrupt("return",u.data);case 36:B=m.length-1;case 37:if(!(B>0)){e.next=46;break}if(m[B].transaction_id!==m[B-1].transaction_id){e.next=42;break}C+=1,e.next=43;break;case 42:return e.abrupt("break",46);case 43:B--,e.next=37;break;case 46:if(h=C,q!==p){e.next=58;break}if(N=m[m.length-1].timestamp,f=N,!(t&&o().utc(N).valueOf()>o().utc(t).valueOf())){e.next=56;break}return m.forEach((function(e){u.data.push(e)})),u.lastUpdate=N,u.skip=h,M.db.txList.put(u),e.abrupt("return",u.data);case 56:e.next=71;break;case 58:return m.forEach((function(e){u.data.push(e)})),T=m[m.length-1].timestamp,u.lastUpdate=T,u.skip=h,e.next=64,(0,k.zI)(J().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&simple=true&noBinary=true&account=".concat(a,"&skip=0&limit=1")));case 64:return Z=e.sent,O=x()(Z,2),I=O[0],P=O[1],I||200!==P.status?n.error(I):(E=P.data.total.value,u.data.length!==E?(u.error=!0,n.error(ce)):u.error=!1),M.db.txList.put(u),e.abrupt("return",u.data);case 71:e.next=77;break;case 73:return m.length&&(m.forEach((function(e){u.data.push(e)})),F=m[m.length-1].timestamp,u.lastUpdate=F,u.skip=h,u.error=!0),M.db.txList.put(u),n.error(g),e.abrupt("return",u.data);case 77:e.next=17;break;case 79:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n]),ie=(0,l.useCallback)(function(){var t=f()(d()().mark((function t(a,r){var s,c,u,l,m,f,x,g,v,j,q,S,C,B,N,T,M,P,E,F,_,R,z,D,U,L,K,J,W,Y,V,$,Q,X,ee,ae,ne,re,ce,ie,ue,le,me;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s=e.params.startTime,c=e.params.endTime,u=e.params.receiveAccount,l=e.params.transferTokenContract,m=e.params.transferTokenMinAmount,f=e.params.transferTokenSym,x=e.params.liqMid,g=e.params.liqTokenKey,v=e.params.liqSym,j=e.params.liqTokenMinAmount,q=e.params.type,S="",0,C="",B=0,2===q&&(S=e.params.holdTokenContract,e.params.holdTokenMinAmount,C=e.params.holdTokenSym,B=e.params.allTokenMinAmount),N=e.params.schemesRegexp,T=[],M={},P=[],E=[],F=[],_=[],R=[],z=[],t.next=28,oe(c);case 28:D=t.sent,U=0;case 30:if(!(U<D.length)){t.next=40;break}if(L=o().utc(s).valueOf(),K=o().utc(c).valueOf(),J=o().utc(D[U].timestamp).valueOf(),L<=J&&J<=K&&D[U].contract===l&&"transfer"===D[U].action&&D[U].data.symbol===f&&D[U].data.to===u&&"dfsminingout"!==D[U].data.from&&"swapswapswap"!==D[U].data.from&&""!==D[U].data.memo.trim()&&T.push(D[U]),!(J>K)){t.next=37;break}return t.abrupt("break",40);case 37:U++,t.next=30;break;case 40:if(T.forEach((function(e){var t=e.data.from,a=e.data.memo.trim();M.hasOwnProperty(t)?e.data.amount>=m&&N[0].test(a)&&(M[t]=e):M[t]=e})),W=[],!y||!y.length){t.next=46;break}W=y,t.next=54;break;case 46:return t.next=48,r.load("swapswapswap");case 48:return Y=t.sent,V=Y.table("markets"),t.next=52,V.all();case 52:W=t.sent,i(b.N.setMarkets(W));case 54:return t.next=56,r.load("loglogloglog");case 56:$=t.sent,Q=$.table("liqs"),X=Object.keys(M),ee={},ae={},ne=d()().mark((function e(){var t,n,r,s,c,o,i,u,l,m,f,b;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(se("".concat(re+1," / ").concat(X.length)),t=0,n=v,r=[],!p.hasOwnProperty(X[re])){e.next=8;break}r=p[X[re]],e.next=12;break;case 8:return e.next=10,Q.all({scope:X[re]});case 10:r=e.sent,ee[X[re]]=r;case 12:if((s=r.find((function(e){return e.mid.toNumber()===x})))&&(c=W.find((function(e){return e.mid.equals(s.mid)})),o=s.token.toNumber()/c.liquidity_token.toNumber(),i=o*c.reserve0.value,u=o*c.reserve1.value,l=c.reserve0.symbol.name,m=c.reserve1.symbol.name,0===g?(t=i,n=l):(t=u,n=m)),M[X[re]].liqBalance=t,M[X[re]].liqSym=n,f=0,b=[],2!==q){e.next=29;break}if(!h.hasOwnProperty(X[re])){e.next=23;break}b=h[X[re]],e.next=27;break;case 23:return e.next=25,a.client.v1.chain.get_currency_balance(S,X[re],C);case 25:b=e.sent,ae[X[re]]=b;case 27:b.length&&(f=b[0].value),M[X[re]].holdBalance=f;case 29:case"end":return e.stop()}}),e)})),re=0;case 63:if(!(re<X.length)){t.next=68;break}return t.delegateYield(ne(),"t0",65);case 65:re++,t.next=63;break;case 68:for(Object.keys(ee).length&&i(I.N.setLiqsCache(O()(O()({},p),ee))),Object.keys(ae).length&&i(I.N.setAssetsCache(O()(O()({},h),ae))),1===q?X.forEach((function(e){var t=M[e].liqBalance;M[e].data.amount>=m&&t>=j?P.push(M[e]):E.push(M[e])})):2===q&&X.forEach((function(e){var t=M[e].liqBalance+M[e].holdBalance;M[e].data.amount>=m&&t>=B?P.push(M[e]):E.push(M[e])})),ce={},ie=[],ue=1;ue<N.length;ue++)ce["scheme".concat(ue)]={vote:0,name:"方案".concat(ue)},ie.push("方案".concat(ue));P.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,c=o().utc(e.timestamp).local().format(),i=e.data.quantity,u=e.transaction_id,l=1;l<N.length;l++)if(N[l].test(a)){ce["scheme".concat(l)].vote+=1,_.push({key:t,account:n,liqBalance:r,liqSym:s,time:c,quantity:i,scheme:ce["scheme".concat(l)].name,memo:a,txid:u});break}})),Object.keys(ce).forEach((function(e){F.push({scheme:ce[e].name,vote:ce[e].vote})})),w(F),Z(_.sort((function(e,t){return e.time.localeCompare(t.time)}))),te(ie),E.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,c=o().utc(e.timestamp).local().format(),i=e.data.quantity,u=e.transaction_id,l=1;l<N.length;l++)if(N[l].test(a)){ce["scheme".concat(l)].vote+=1,R.push({key:t,account:n,liqBalance:r,liqSym:s,time:c,quantity:i,scheme:ce["scheme".concat(l)].name,memo:a,txid:u});break}})),A(R.sort((function(e,t){return e.time.localeCompare(t.time)}))),le=0,F.forEach((function(e){e.vote>le&&(le=e.vote,me=e)})),_.forEach((function(e){e.scheme===me.scheme&&z.push(e)})),H(z.sort((function(e,t){return e.time.localeCompare(t.time)}))),G(!1),t.next=92;break;case 88:t.prev=88,t.t1=t.catch(0),G(!1),(0,k.Tv)(t.t1,n);case 92:case"end":return t.stop()}}),t,null,[[0,88]])})));return function(e,a){return t.apply(this,arguments)}}(),[oe,n,h,p,y,u,y,e.params]),ue={data:q,xField:"scheme",yField:"vote",meta:{vote:{alias:"票数"}},label:{},color:function(){return"#5B8FF9"},minColumnWidth:30,maxColumnWidth:30},le=(0,l.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,a){return(0,C.jsx)("span",{children:a+1})}},{title:"投票人",dataIndex:"account",key:"account",sorter:function(e,t){return e.account.localeCompare(t.account)},render:function(e,t){return(0,C.jsx)("a",{onClick:function(){return s("/query/account?search=".concat(t.account,"&tab=info"))},children:t.account})}},{title:"JIU/DFS矿池做市",dataIndex:"liqBalance",key:"liqBalance",sorter:function(e,t){return t.liqBalance-e.liqBalance},render:function(e,t){return(0,C.jsx)("span",{children:t.liqBalance.toFixed(0)+" "+t.liqSym})}},{title:"转账数量",dataIndex:"quantity",key:"quantity",sorter:function(e,t){return Number(t.quantity.split(" ")[0])-Number(e.quantity.split(" ")[0])},render:function(e,t){return(0,C.jsx)("span",{children:t.quantity})}},{title:"转账时间",dataIndex:"time",key:"time",sorter:function(e,t){return t.time.localeCompare(e.time)},render:function(e,t){return(0,C.jsx)("span",{children:t.time})}},{title:"投票方案",dataIndex:"scheme",key:"scheme",sorter:function(e,t){return e.scheme.localeCompare(t.scheme)},filters:ee.map((function(e){return{text:e,value:e}})),onFilter:function(e,t){return e===t.scheme},render:function(e,t){return(0,C.jsx)("span",{children:t.scheme})}},{title:"原始数据",dataIndex:"memo",key:"memo",render:function(e,t){return(0,C.jsx)("span",{children:t.memo})}},{title:"交易id",dataIndex:"txid",key:"txid",render:function(e,t){return(0,C.jsx)("a",{onClick:function(){return s("/query/transaction?search=".concat(t.txid,"&tab=summary"))},children:t.txid.slice(0,8)})}}]}),[ee]);return(0,l.useEffect)((function(){m&&u&&!c.current&&(c.current=!0,G(!0),ie(m,u))}),[ie,u,m]),(0,C.jsxs)("div",{className:"result1",children:[(0,C.jsx)(D.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"投票结果"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(L.Z,{size:"large",spinning:$,tip:re,children:(0,C.jsx)(z,O()(O()({},ue),{},{loading:$}))})}),(0,C.jsx)(D.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"有效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(U.Z,{scroll:{x:!0},size:"small",columns:le,dataSource:T,defaultData:[],loading:$,search:!1,options:!1,pagination:!1})}),(0,C.jsx)(D.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"无效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(U.Z,{scroll:{x:!0},size:"small",columns:le,dataSource:F,defaultData:[],loading:$,search:!1,options:!1,pagination:!1})}),(0,C.jsx)(D.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"获奖用户"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(U.Z,{scroll:{x:!0},size:"small",columns:le,dataSource:K,defaultData:[],loading:$,search:!1,options:!1,pagination:!1})}),r]})},Y=(0,l.memo)(H);o().extend(u());var V=function(e){var t=S.ZP.useMessage(),a=x()(t,2),n=a[0],r=a[1],s=(0,j.useNavigate)(),c=(0,l.useRef)(!1),i=(0,j.useDispatch)(),u=(0,j.useSelector)((function(e){return e.global.contractKit})),m=(0,j.useSelector)((function(e){return e.global.session})),p=(0,j.useSelector)((function(e){return e.jiu.liqsCache})),h=(0,j.useSelector)((function(e){return e.jiu.assetsCache})),y=(0,j.useSelector)((function(e){return e.account.markets})),g=(0,l.useState)([]),v=x()(g,2),q=v[0],w=v[1],B=(0,l.useState)([]),N=x()(B,2),T=N[0],Z=N[1],P=(0,l.useState)([]),E=x()(P,2),F=E[0],A=E[1],_=(0,l.useState)([]),R=x()(_,2),K=R[0],H=R[1],Y=(0,l.useState)(!1),V=x()(Y,2),$=V[0],G=V[1],Q=(0,l.useState)([]),X=x()(Q,2),ee=X[0],te=X[1],ae=(0,l.useState)(""),ne=x()(ae,2),re=ne[0],se=ne[1],ce=(0,j.useIntl)().formatMessage({id:"jiu.intlMissingData"}),oe=(0,l.useCallback)(function(){var e=f()(d()().mark((function e(t){var a,r,s,c,i,u,l,m,p,f,h,b,y,g,v,j,q,S,C,w,B,N,T,Z,O,I,P,E,F;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="jiutothemoon",r="000d9cae502dd1cc895745e204f83cc892bc4c450f92a03ecd4fe057709853cc",s=(0,W.js)("md5"),c=r+a,s.update(c),i=s.digest("hex").substring(0,8),u={key:i,chainId:r,account:a,skip:0,lastUpdate:"2020-01-01T01:01:01.000Z",error:!1,data:[]},e.next=9,M.db.txList.where({key:i}).toArray();case 9:if((l=e.sent).length&&(u=l[0]),!(t&&o().utc(u.lastUpdate).valueOf()>o().utc(t).valueOf())){e.next=13;break}return e.abrupt("return",u.data);case 13:m=[],p=500,f=u.lastUpdate,h=u.skip;case 17:return e.next=20,(0,k.zI)(J().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&sort=asc&simple=true&noBinary=true&account=".concat(a,"&after=").concat(f,"&limit=").concat(p)));case 20:if(b=e.sent,y=x()(b,2),g=y[0],v=y[1],g||200!==v.status){e.next=73;break}if(j=v.data.simple_actions,q=j.length,S=v.data.total.value,C=1,0!==S){e.next=32;break}return M.db.txList.put(u),e.abrupt("return",u.data);case 32:for(w=0;w<j.length;w++)h<=w&&m.push(j[w]);if(m.length){e.next=36;break}return u.error&&n.error(ce),e.abrupt("return",u.data);case 36:B=m.length-1;case 37:if(!(B>0)){e.next=46;break}if(m[B].transaction_id!==m[B-1].transaction_id){e.next=42;break}C+=1,e.next=43;break;case 42:return e.abrupt("break",46);case 43:B--,e.next=37;break;case 46:if(h=C,q!==p){e.next=58;break}if(N=m[m.length-1].timestamp,f=N,!(t&&o().utc(N).valueOf()>o().utc(t).valueOf())){e.next=56;break}return m.forEach((function(e){u.data.push(e)})),u.lastUpdate=N,u.skip=h,M.db.txList.put(u),e.abrupt("return",u.data);case 56:e.next=71;break;case 58:return m.forEach((function(e){u.data.push(e)})),T=m[m.length-1].timestamp,u.lastUpdate=T,u.skip=h,e.next=64,(0,k.zI)(J().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&simple=true&noBinary=true&account=".concat(a,"&skip=0&limit=1")));case 64:return Z=e.sent,O=x()(Z,2),I=O[0],P=O[1],I||200!==P.status?n.error(I):(E=P.data.total.value,u.data.length!==E?(u.error=!0,n.error(ce)):u.error=!1),M.db.txList.put(u),e.abrupt("return",u.data);case 71:e.next=77;break;case 73:return m.length&&(m.forEach((function(e){u.data.push(e)})),F=m[m.length-1].timestamp,u.lastUpdate=F,u.skip=h,u.error=!0),M.db.txList.put(u),n.error(g),e.abrupt("return",u.data);case 77:e.next=17;break;case 79:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n]),ie=(0,l.useCallback)(function(){var t=f()(d()().mark((function t(a,r){var s,c,u,l,m,f,x,g,v,j,q,S,C,B,N,T,M,P,E,F,_,R,z,D,U,L,K,J,W,Y,V,$,Q,X,ee,ae,ne,re,ce,ie,ue,le,me;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s=e.params.startTime,c=e.params.endTime,u=e.params.receiveAccount,l=e.params.transferTokenContract,m=e.params.transferTokenMinAmount,f=e.params.transferTokenSym,x=e.params.liqMid,g=e.params.liqTokenKey,v=e.params.liqSym,j=e.params.liqTokenMinAmount,q=e.params.type,S="",0,C="",B=0,2===q&&(S=e.params.holdTokenContract,e.params.holdTokenMinAmount,C=e.params.holdTokenSym,B=e.params.allTokenMinAmount),N=e.params.schemesRegexp,T=[],M={},P=[],E=[],F=[],_=[],R=[],z=[],t.next=28,oe(c);case 28:D=t.sent,U=0;case 30:if(!(U<D.length)){t.next=40;break}if(L=o().utc(s).valueOf(),K=o().utc(c).valueOf(),J=o().utc(D[U].timestamp).valueOf(),L<=J&&J<=K&&D[U].contract===l&&"transfer"===D[U].action&&D[U].data.symbol===f&&D[U].data.to===u&&"dfsminingout"!==D[U].data.from&&"swapswapswap"!==D[U].data.from&&""!==D[U].data.memo.trim()&&T.push(D[U]),!(J>K)){t.next=37;break}return t.abrupt("break",40);case 37:U++,t.next=30;break;case 40:if(T.forEach((function(e){var t=e.data.from,a=e.data.memo.trim();M.hasOwnProperty(t)?e.data.amount>=m&&N[0].test(a)&&(M[t]=e):M[t]=e})),W=[],!y||!y.length){t.next=46;break}W=y,t.next=54;break;case 46:return t.next=48,r.load("swapswapswap");case 48:return Y=t.sent,V=Y.table("markets"),t.next=52,V.all();case 52:W=t.sent,i(b.N.setMarkets(W));case 54:return t.next=56,r.load("loglogloglog");case 56:$=t.sent,Q=$.table("liqs"),X=Object.keys(M),ee={},ae={},ne=d()().mark((function e(){var t,n,r,s,c,o,i,u,l,m,f,b;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(se("".concat(re+1," / ").concat(X.length)),t=0,n=v,r=[],!p.hasOwnProperty(X[re])){e.next=8;break}r=p[X[re]],e.next=12;break;case 8:return e.next=10,Q.all({scope:X[re]});case 10:r=e.sent,ee[X[re]]=r;case 12:if((s=r.find((function(e){return e.mid.toNumber()===x})))&&(c=W.find((function(e){return e.mid.equals(s.mid)})),o=s.token.toNumber()/c.liquidity_token.toNumber(),i=o*c.reserve0.value,u=o*c.reserve1.value,l=c.reserve0.symbol.name,m=c.reserve1.symbol.name,0===g?(t=i,n=l):(t=u,n=m)),M[X[re]].liqBalance=t,M[X[re]].liqSym=n,f=0,b=[],2!==q){e.next=29;break}if(!h.hasOwnProperty(X[re])){e.next=23;break}b=h[X[re]],e.next=27;break;case 23:return e.next=25,a.client.v1.chain.get_currency_balance(S,X[re],C);case 25:b=e.sent,ae[X[re]]=b;case 27:b.length&&(f=b[0].value),M[X[re]].holdBalance=f;case 29:case"end":return e.stop()}}),e)})),re=0;case 63:if(!(re<X.length)){t.next=68;break}return t.delegateYield(ne(),"t0",65);case 65:re++,t.next=63;break;case 68:for(Object.keys(ee).length&&i(I.N.setLiqsCache(O()(O()({},p),ee))),Object.keys(ae).length&&i(I.N.setAssetsCache(O()(O()({},h),ae))),1===q?X.forEach((function(e){var t=M[e].liqBalance;M[e].data.amount>=m&&t>=j?P.push(M[e]):E.push(M[e])})):2===q&&X.forEach((function(e){var t=M[e].liqBalance+M[e].holdBalance;M[e].data.amount>=m&&t>=B?P.push(M[e]):E.push(M[e])})),ce={},ie=[],ue=1;ue<N.length;ue++)ce["scheme".concat(ue)]={vote:0,name:"方案".concat(ue)},ie.push("方案".concat(ue));P.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,c=o().utc(e.timestamp).local().format(),i=e.data.quantity,u=e.transaction_id,l=e.holdBalance,m=r+l,d=1;d<N.length;d++)if(N[d].test(a)){ce["scheme".concat(d)].vote+=1,_.push({key:t,account:n,liqBalance:r,liqSym:s,time:c,quantity:i,scheme:ce["scheme".concat(d)].name,memo:a,txid:u,holdBalance:l,holdTokenSym:C,allBalance:m});break}})),Object.keys(ce).forEach((function(e){F.push({scheme:ce[e].name,vote:ce[e].vote})})),w(F),Z(_.sort((function(e,t){return e.time.localeCompare(t.time)}))),te(ie),E.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,c=o().utc(e.timestamp).local().format(),i=e.data.quantity,u=e.transaction_id,l=e.holdBalance,m=r+l,d=1;d<N.length;d++)if(N[d].test(a)){ce["scheme".concat(d)].vote+=1,R.push({key:t,account:n,liqBalance:r,liqSym:s,time:c,quantity:i,scheme:ce["scheme".concat(d)].name,memo:a,txid:u,holdBalance:l,holdTokenSym:C,allBalance:m});break}})),A(R.sort((function(e,t){return e.time.localeCompare(t.time)}))),le=0,F.forEach((function(e){e.vote>le&&(le=e.vote,me=e)})),_.forEach((function(e){e.scheme===me.scheme&&z.push(e)})),H(z.sort((function(e,t){return e.time.localeCompare(t.time)}))),G(!1),t.next=92;break;case 88:t.prev=88,t.t1=t.catch(0),G(!1),(0,k.Tv)(t.t1,n);case 92:case"end":return t.stop()}}),t,null,[[0,88]])})));return function(e,a){return t.apply(this,arguments)}}(),[oe,n,h,p,y,u,y,e.params]),ue={data:q,xField:"scheme",yField:"vote",meta:{vote:{alias:"票数"}},label:{},color:function(){return"#5B8FF9"},minColumnWidth:30,maxColumnWidth:30},le=(0,l.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,a){return(0,C.jsx)("span",{children:a+1})}},{title:"投票人",dataIndex:"account",key:"account",sorter:function(e,t){return e.account.localeCompare(t.account)},render:function(e,t){return(0,C.jsx)("a",{onClick:function(){return s("/query/account?search=".concat(t.account,"&tab=info"))},children:t.account})}},{title:"JIU/DFS矿池做市",dataIndex:"liqBalance",key:"liqBalance",sorter:function(e,t){return t.liqBalance-e.liqBalance},render:function(e,t){return(0,C.jsx)("span",{children:t.liqBalance.toFixed(0)+" "+t.liqSym})}},{title:"JIU账号余额",dataIndex:"holdBalance",key:"holdBalance",sorter:function(e,t){return t.holdBalance-e.holdBalance},render:function(e,t){return(0,C.jsx)("span",{children:t.holdBalance.toFixed(0)+" "+t.holdTokenSym})}},{title:"做市+持有",dataIndex:"allBalance",key:"allBalance",sorter:function(e,t){return t.allBalance-e.allBalance},render:function(e,t){return(0,C.jsx)("span",{children:(0,k.CE)(t.allBalance)+" "+t.holdTokenSym})}},{title:"转账数量",dataIndex:"quantity",key:"quantity",sorter:function(e,t){return Number(t.quantity.split(" ")[0])-Number(e.quantity.split(" ")[0])},render:function(e,t){return(0,C.jsx)("span",{children:t.quantity})}},{title:"转账时间",dataIndex:"time",key:"time",sorter:function(e,t){return t.time.localeCompare(e.time)},render:function(e,t){return(0,C.jsx)("span",{children:t.time})}},{title:"投票方案",dataIndex:"scheme",key:"scheme",sorter:function(e,t){return e.scheme.localeCompare(t.scheme)},filters:ee.map((function(e){return{text:e,value:e}})),onFilter:function(e,t){return e===t.scheme},render:function(e,t){return(0,C.jsx)("span",{children:t.scheme})}},{title:"原始数据",dataIndex:"memo",key:"memo",render:function(e,t){return(0,C.jsx)("span",{children:t.memo})}},{title:"交易id",dataIndex:"txid",key:"txid",render:function(e,t){return(0,C.jsx)("a",{onClick:function(){return s("/query/transaction?search=".concat(t.txid,"&tab=summary"))},children:t.txid.slice(0,8)})}}]}),[ee]);return(0,l.useEffect)((function(){m&&u&&!c.current&&(c.current=!0,G(!0),ie(m,u))}),[ie,u,m]),(0,C.jsxs)("div",{className:"result2",children:[(0,C.jsx)(D.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"投票结果"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(L.Z,{size:"large",spinning:$,tip:re,children:(0,C.jsx)(z,O()(O()({},ue),{},{loading:$}))})}),(0,C.jsx)(D.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"有效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(U.Z,{scroll:{x:!0},size:"small",columns:le,dataSource:T,defaultData:[],loading:$,search:!1,options:!1,pagination:!1})}),(0,C.jsx)(D.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"无效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(U.Z,{scroll:{x:!0},size:"small",columns:le,dataSource:F,defaultData:[],loading:$,search:!1,options:!1,pagination:!1})}),(0,C.jsx)(D.Z,{className:"mb-4",title:(0,C.jsx)("span",{className:" text-lg font-semibold",children:"获奖用户"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,C.jsx)(U.Z,{scroll:{x:!0},size:"small",columns:le,dataSource:K,defaultData:[],loading:$,search:!1,options:!1,pagination:!1})}),r]})},$=(0,l.memo)(V)}}]);