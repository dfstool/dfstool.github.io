"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7024],{7024:function(e,t,n){n.r(t);var r=n(15009),s=n.n(r),a=n(99289),o=n.n(a),c=n(5574),l=n.n(c),i=n(10832),u=n(3990),p=n(64119),f=n(11774),d=n(38345),h=n(59530),g=n(80507),m=n(45360),b=n(69677),k=n(57953),x=n(92398),v=n(9669),y=n.n(v),N=n(27484),S=n.n(N),w=n(96486),j=n(62435),P=(n(31145),n(86074));t.default=function(){var e=m.ZP.useMessage(),t=l()(e,2),n=t[0],r=t[1],a=(0,h.useDispatch)(),c=(0,h.useSelector)((function(e){return e.global.session})),v=(0,h.useSelector)((function(e){return e.global.contractKit})),N=(0,h.useSelector)((function(e){return e.global.accountKit})),V=(0,h.useSelector)((function(e){return e.account.activeKey})),M=(0,h.useSelector)((function(e){return e.account.accountInfo})),T=(0,h.useSelector)((function(e){return e.account.loading})),C=(0,h.useSelector)((function(e){return e.account.approvals2})),L=(0,h.useSelector)((function(e){return e.account.proposals})),O=(0,j.useRef)(),_=(0,j.useState)(""),I=l()(_,2),z=I[0],q=I[1],A=(0,h.useSearchParams)(),D=l()(A,2),E=D[0],K=D[1],Z=E.get("tab")?E.get("tab"):void 0,R=(0,h.useIntl)(),B=R.formatMessage({id:"account.intlAccount"}),F=R.formatMessage({id:"account.intlSearch"}),$=R.formatMessage({id:"contract.intlAccountFormatError"}),U=R.formatMessage({id:"account.intlSearchAccount"}),G=R.formatMessage({id:"account.intlProfile"}),H=R.formatMessage({id:"account.intlAuth"}),J=R.formatMessage({id:"account.intlToken"}),Q=R.formatMessage({id:"account.intlLiq"}),W=R.formatMessage({id:"account.intlTx"}),X=R.formatMessage({id:"account.intlProposal"}),Y=R.formatMessage({id:"account.intlInvite"}),ee=(0,j.useMemo)((function(){return M?M.accountName.toString():""}),[M]),te=(0,j.useCallback)(function(){var e=o()(s()().mark((function e(t,r){var o,i,f,d;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(/^[a-z1-5.]{1,12}$/.test(t)){e.next=8;break}if(t||r.hasOwnProperty("type")){e.next=4;break}return e.abrupt("return",!1);case 4:return n.error("".concat($)),e.abrupt("return",!1);case 8:return e.next=10,(0,p.zI)(c.client.v1.chain.get_abi(t));case 10:if(o=e.sent,i=l()(o,2),f=i[0],d=i[1],!f){e.next=17;break}return n.error(f),e.abrupt("return",!1);case 17:return!f&&d.hasOwnProperty("abi")?a(u.N.setIsContract(!0)):a(u.N.setIsContract(!1)),e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[c,n]),ne=(0,j.useCallback)(function(){var e=o()(s()().mark((function e(t,r,o,c,i){var f,d,h,m,b,k,x,v,N,w,j,P,V,M,T,C,L,O,_,I,z,q,A,D;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,f=[],h={},m=[],b=[],k=0,x={balValue:0,reserveValue:0,diffValue:0},"usdtusdtusdt-USDT-8",v="eosio.token-DFS-8",N=[],(d={})["usdtusdtusdt-USDT-8"]=1,d[v]=(0,p.ri)(o[0].reserve0)/(0,p.ri)(o[0].reserve1),o.forEach((function(e){var t=e.contract0.toString()+"-"+e.sym0.toString().split(",")[1]+"-"+e.sym0.toString().split(",")[0],n=e.contract1.toString()+"-"+e.sym1.toString().split(",")[1]+"-"+e.sym1.toString().split(",")[0];f.includes(t)||(f.push(t),h[t]=f.length),f.includes(n)||(f.push(n),h[n]=f.length);var r=(0,p.ri)(e.reserve0),s=(0,p.ri)(e.reserve1);"eosio.token"===e.contract0.toString()?d.hasOwnProperty(n)||(d[n]=r/s*d[v]):"eosio.token"===e.contract1.toString()?d.hasOwnProperty(t)||(d[t]=s/r*d[v]):"usdtusdtusdt"===e.contract0.toString()?d.hasOwnProperty(n)||(d[n]=r/s):"usdtusdtusdt"===e.contract1.toString()?d.hasOwnProperty(t)||(d[t]=s/r):N.push({key0:t,key1:n,value0:r,value1:s})})),N.forEach((function(e){d.hasOwnProperty(e.key0)&&!d.hasOwnProperty(e.key1)?d[e.key1]=e.value0/e.value1*d[e.key0]:!d.hasOwnProperty(e.key0)&&d.hasOwnProperty(e.key1)?d[e.key0]=e.value1/e.value0*d[e.key1]:d.hasOwnProperty(e.key0)||d.hasOwnProperty(e.key1)||(d[e.key0]=0,d[e.key1]=0)})),e.next=17,(0,p.zI)(y().get("https://api2.dfsmoon.com/v2/state/get_tokens?limit=1000&account=".concat(i),{timeout:2e3}));case 17:if(w=e.sent,j=l()(w,2),P=j[0],V=j[1],P||200!==V.status){e.next=26;break}V.data.tokens.forEach((function(e){var t=e.contract+"-"+e.symbol,n=d[t+"-"+e.precision],r=e.amount*n;k+=r;var s="dfsppptokens"===e.contract?c[e.symbol]:"https://dfs.land/assets/tokens/".concat(t,".png");m.push({key:t,contract:e.contract,sym:e.symbol,precision:String(e.precision),price:n,asset:g.xR.from(e.amount.toFixed(e.precision)+" "+e.symbol),value:r,logo:s})})),m.sort((function(e,t){return h[e.key+"-"+e.precision]-h[t.key+"-"+t.precision]})),e.next=45;break;case 26:M=0;case 27:if(!(M<f.length)){e.next=45;break}return T=f[M].split("-")[0],C=f[M].split("-")[1],L=T+"-"+C,O=f[M].split("-")[2],_=d[f[M]],e.next=35,t.client.v1.chain.get_currency_balance(T,i,C);case 35:if(I=e.sent,z="dfsppptokens"===T?c[C]:"https://dfs.land/assets/tokens/".concat(L,".png"),I.length){e.next=39;break}return e.abrupt("continue",42);case 39:q=(0,p.ri)(I[0])*_,k+=q,m.push({key:L,contract:T,sym:C,precision:O,price:_,asset:I[0],value:q,logo:z});case 42:M++,e.next=27;break;case 45:return e.next=47,r.load("loglogloglog");case 47:return A=e.sent,D=A.table("liqs"),e.next=51,D.all({scope:(0,p.fD)(i)});case 51:e.sent.forEach((function(e){var t=o.find((function(t){return t.mid.equals(e.mid)})),n=t.contract0.toString(),r=t.contract1.toString(),s=t.sym0.name,a=t.sym1.name,l=t.sym0.precision,i=t.sym1.precision,u=n+"-"+s,f=r+"-"+a,h=d[u+"-"+l],g=d[f+"-"+i],m=(0,p.ri)(e.bal0),k=(0,p.ri)(e.bal1),v=m*h,y=k*g,N=e.token.toNumber()/t.liquidity_token.toNumber(),w=N*(0,p.ri)(t.reserve0),j=N*(0,p.ri)(t.reserve1),P=w*h,V=j*g,M=P+V-v-y,T=S()().diff(S().utc(e.start.toString()),"days"),C="dfsppptokens"===n?c[s]:"https://dfs.land/assets/tokens/".concat(u,".png"),L="dfsppptokens"===r?c[a]:"https://dfs.land/assets/tokens/".concat(f,".png");x.reserveValue+=P+V,x.balValue+=v+y,b.push({ratio:N,contract0:n,sym0:s,precision0:l,bal0:m,key0:u,bal0Value:v,reserve0Value:P,contract1:r,sym1:a,precision1:i,bal1:k,key1:f,reserve0:w,reserve1:j,price0:h,price1:g,bal1Value:y,reserve1Value:V,diffValue:M,days:T,logo0:C,logo1:L})})),x.diffValue=x.reserveValue-x.balValue,a(u.N.setTokensLoading(!1)),a(u.N.setTokens(m)),a(u.N.setLiqTokens(b)),a(u.N.setTokensValue(k)),a(u.N.setLiqsValue(x)),e.next=65;break;case 61:e.prev=61,e.t0=e.catch(0),a(u.N.setTokensLoading(!1)),(0,p.Tv)(e.t0,n);case 65:case"end":return e.stop()}}),e,null,[[0,61]])})));return function(t,n,r,s,a){return e.apply(this,arguments)}}(),[n]),re=(0,j.useCallback)(function(){var e=o()(s()().mark((function e(t,r){var o,i,f,d,h,m,b,k,x,S,w,j,P,V,M,T,C,L,_,I,z,A,D,E,K,Z,R,B,F;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(N&&v&&c)){e.next=94;break}return a(u.N.setLoading(!0)),a(u.N.setTokensLoading(!0)),e.next=5,te(t,r);case 5:if(e.sent){e.next=9;break}return a(u.N.setLoading(!1)),a(u.N.setTokensLoading(!1)),e.abrupt("return");case 9:return e.prev=9,o="",e.next=13,N.load(t);case 13:return i=e.sent,e.next=16,v.load("swapswapswap");case 16:return f=e.sent,e.next=19,v.load("dfsweb3desoc");case 19:return d=e.sent,e.next=22,v.load("dfsbpsvoters");case 22:return h=e.sent,e.next=25,v.load("eosio.msig");case 25:return m=e.sent,e.next=28,v.load("dfsrefdfsref");case 28:return b=e.sent,e.next=31,v.load("dfs3protocol");case 31:return k=e.sent,x=f.table("markets"),S=d.table("profiles"),w=h.table("voters"),j=m.table("approvals2"),P=m.table("proposal"),V=b.table("referrers"),M=b.table("relations"),T=k.table("projects"),e.next=42,x.all();case 42:return C=e.sent,e.next=45,w.all({scope:"dfsbpsvoters",from:t,to:t});case 45:return L=e.sent,e.next=48,S.all({scope:"dfsweb3desoc",from:t,to:t});case 48:return(_=e.sent).length||_.push({avatar:"",cover:"",desc:"",join:"",nick:"",owner:g.VG.from(t),sex:g.zM.from(2),update:""}),e.next=52,j.all({scope:(0,p.fD)(t)});case 52:return I=e.sent,e.next=55,P.all({scope:(0,p.fD)(t)});case 55:return z=e.sent,e.next=58,V.all({scope:"dfsrefdfsref",from:t,to:t});case 58:return A=e.sent,e.next=61,M.all({scope:"dfsrefdfsref",from:t,to:t});case 61:return D=e.sent,e.next=64,T.all();case 64:return E=e.sent,K={},E.forEach((function(e){var t=e.max_token_supply.symbol.name;K[t]=e.token_url})),e.next=69,(0,p.zI)(y().get("https://api2.dfsmoon.com/v2/history/get_creator?account=".concat(i.accountName.toString())));case 69:Z=e.sent,R=l()(Z,2),B=R[0],F=R[1],B||200!==F.status||(o=F.data.creator),ne(c,v,C,K,t),a(u.N.setMarkets(C)),a(u.N.setAccountInfo(i)),a(u.N.setCreator(o)),a(u.N.setProfile(_[0])),a(u.N.setVoter(L[0])),a(u.N.setProposals(z)),a(u.N.setApprovals2(I)),a(u.N.setReferrer(A[0])),a(u.N.setRelation(D[0])),q(""),a(u.N.setLoading(!1)),O.current&&O.current.handleSearch(),e.next=94;break;case 89:e.prev=89,e.t0=e.catch(9),a(u.N.setLoading(!1)),a(u.N.setTokensLoading(!1)),(0,p.Tv)(e.t0,n);case 94:case"end":return e.stop()}}),e,null,[[9,89]])})));return function(t,n){return e.apply(this,arguments)}}(),[N,v,c,te,n,ne]),se=(0,j.useCallback)((0,w.debounce)(function(){var e=o()(s()().mark((function e(t){var n,r,a,o;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target.value,/^[a-z1-5.]{1,12}$/.test(n)){e.next=6;break}0===n.trim().length?q(""):q("error"),e.next=12;break;case 6:return e.next=8,(0,p.zI)(c.client.v1.chain.get_account(n));case 8:r=e.sent,a=l()(r,2),o=a[1],q(o?"":"error");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),1e3),[c]),ae=[{key:"info",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:G}),children:!!M&&(0,P.jsx)(i.i3,{handleSearch:re})},{key:"auth",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:H}),children:!!M&&(0,P.jsx)(i.Bf,{})},{key:"token",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:J}),children:!!M&&(0,P.jsx)(i.DL,{})},{key:"liq",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:Q}),children:!!M&&(0,P.jsx)(i.uq,{})},{key:"tx",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:W}),children:!!M&&(0,P.jsx)(i.ps,{ref:O})},{key:"proposal",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:X}),children:!!M&&(0,P.jsx)(i.f9,{proposer:M.accountName.toString(),approvals2:C,proposals:L,loading:T,handleSearch:re})},{key:"invite",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:Y}),children:!!M&&(0,P.jsx)(i.$7,{handleSearch:re})},{key:"tip",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:ee}),disabled:!0}],oe=(0,j.useCallback)((function(e,t){var n={};e&&(n.search=e),n.tab=t||V,K(n)}),[V]);return(0,j.useEffect)((function(){var e=E.get("search"),t=E.get("tab");t&&a(u.N.setActiveKey(t)),e&&re(e,""),oe(e,t)}),[re]),(0,j.useEffect)((function(){var e=M?M.accountName.toString():"";oe(e,V)}),[M,V,oe]),(0,P.jsxs)(f._z,{className:"account",ghost:!0,children:[(0,P.jsxs)(d.Z,{title:(0,P.jsx)("div",{className:"hardline font-semibold text-lg mb-3",children:U}),children:[(0,P.jsx)(b.Z.Search,{className:" ",loading:T,addonBefore:(0,P.jsx)(k.Z,{spinning:T,children:B}),placeholder:"Search...",allowClear:!0,enterButton:F,size:"large",status:z,onSearch:re,onChange:se}),(0,P.jsx)(x.Z,{className:"mt-2",items:ae,activeKey:Z,onChange:function(e){a(u.N.setActiveKey(e))}})]}),r]})}},31145:function(){}}]);