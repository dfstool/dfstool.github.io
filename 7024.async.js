"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7024],{7024:function(e,t,r){r.r(t);var n=r(15009),a=r.n(n),s=r(99289),o=r.n(s),c=r(5574),l=r.n(c),u=r(23569),i=r(3990),f=r(64119),p=r(11774),d=r(38345),v=r(59530),h=r(80507),m=r(45360),b=r(69677),g=r(57953),k=r(92398),x=r(9669),y=r.n(x),N=r(27484),S=r.n(N),w=r(96486),j=r(62435),P=(r(31145),r(86074));t.default=function(){var e=m.ZP.useMessage(),t=l()(e,2),r=t[0],n=t[1],s=(0,v.useDispatch)(),c=(0,v.useSelector)((function(e){return e.global.session})),x=(0,v.useSelector)((function(e){return e.global.contractKit})),N=(0,v.useSelector)((function(e){return e.global.accountKit})),V=(0,v.useSelector)((function(e){return e.account.activeKey})),M=(0,v.useSelector)((function(e){return e.account.accountInfo})),T=(0,v.useSelector)((function(e){return e.account.loading})),C=(0,v.useSelector)((function(e){return e.account.approvals2})),L=(0,v.useSelector)((function(e){return e.account.proposals})),O=(0,j.useRef)(),I=(0,j.useState)(""),z=l()(I,2),q=z[0],A=z[1],_=(0,v.useSearchParams)(),E=l()(_,2),K=E[0],D=E[1],Z=K.get("tab")?K.get("tab"):void 0,R=(0,v.useIntl)(),B=R.formatMessage({id:"account.intlAccount"}),F=R.formatMessage({id:"account.intlSearch"}),$=R.formatMessage({id:"contract.intlAccountFormatError"}),U=R.formatMessage({id:"account.intlSearchAccount"}),G=R.formatMessage({id:"account.intlProfile"}),H=R.formatMessage({id:"account.intlAuth"}),J=R.formatMessage({id:"account.intlToken"}),Q=R.formatMessage({id:"account.intlLiq"}),W=R.formatMessage({id:"account.intlTx"}),X=R.formatMessage({id:"account.intlProposal"}),Y=R.formatMessage({id:"account.intlInvite"}),ee=(0,j.useMemo)((function(){return M?M.accountName.toString():""}),[M]),te=(0,j.useCallback)(function(){var e=o()(a()().mark((function e(t,n){var o,u,p,d;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(/^[a-z1-5.]{1,12}$/.test(t)){e.next=8;break}if(t||n.hasOwnProperty("type")){e.next=4;break}return e.abrupt("return",!1);case 4:return r.error("".concat($)),e.abrupt("return",!1);case 8:return e.next=10,(0,f.zI)(c.client.v1.chain.get_abi(t));case 10:if(o=e.sent,u=l()(o,2),p=u[0],d=u[1],!p){e.next=17;break}return r.error(p),e.abrupt("return",!1);case 17:return!p&&d.hasOwnProperty("abi")?s(i.N.setIsContract(!0)):s(i.N.setIsContract(!1)),e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),[c,r]),re=(0,j.useCallback)(function(){var e=o()(a()().mark((function e(t,n,o,c){var u,p,d,v,m,b,g,k,x,N,w,j,P,V,M,T,C,L,O,I,z,q;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u=[],d={},v=[],m=[],b=0,g={balValue:0,reserveValue:0,diffValue:0},"usdtusdtusdt-USDT-8",k="eosio.token-DFS-8",x=[],(p={})["usdtusdtusdt-USDT-8"]=1,p[k]=o[0].reserve0.value/o[0].reserve1.value,o.forEach((function(e){var t=e.contract0.toString()+"-"+e.sym0.toString().split(",")[1]+"-"+e.sym0.toString().split(",")[0],r=e.contract1.toString()+"-"+e.sym1.toString().split(",")[1]+"-"+e.sym1.toString().split(",")[0];u.includes(t)||(u.push(t),d[t]=u.length),u.includes(r)||(u.push(r),d[r]=u.length),"eosio.token"===e.contract0.toString()?p.hasOwnProperty(r)||(p[r]=e.reserve0.value/e.reserve1.value*p[k]):"eosio.token"===e.contract1.toString()?p.hasOwnProperty(t)||(p[t]=e.reserve1.value/e.reserve0.value*p[k]):"usdtusdtusdt"===e.contract0.toString()?p.hasOwnProperty(r)||(p[r]=e.reserve0.value/e.reserve1.value):"usdtusdtusdt"===e.contract1.toString()?p.hasOwnProperty(t)||(p[t]=e.reserve1.value/e.reserve0.value):x.push({key0:t,key1:r,value0:e.reserve0.value,value1:e.reserve1.value})})),x.forEach((function(e){p.hasOwnProperty(e.key0)&&!p.hasOwnProperty(e.key1)?p[e.key1]=e.value0/e.value1*p[e.key0]:!p.hasOwnProperty(e.key0)&&p.hasOwnProperty(e.key1)?p[e.key0]=e.value1/e.value0*p[e.key1]:p.hasOwnProperty(e.key0)||p.hasOwnProperty(e.key1)||(p[e.key0]=0,p[e.key1]=0)})),e.next=17,(0,f.zI)(y().get("https://api2.dfsmoon.com/v2/state/get_tokens?limit=1000&account=".concat(c),{timeout:2e3}));case 17:if(N=e.sent,w=l()(N,2),j=w[0],P=w[1],j||200!==P.status){e.next=26;break}P.data.tokens.forEach((function(e){var t=e.contract+"-"+e.symbol,r=p[t+"-"+e.precision],n=e.amount*r;b+=n,v.push({key:t,contract:e.contract,sym:e.symbol,precision:String(e.precision),price:r,asset:h.xR.from(e.amount.toFixed(e.precision)+" "+e.symbol),value:n})})),v.sort((function(e,t){return d[e.key+"-"+e.precision]-d[t.key+"-"+t.precision]})),e.next=43;break;case 26:V=0;case 27:if(!(V<u.length)){e.next=43;break}return M=u[V].split("-")[0],T=u[V].split("-")[1],C=u[V].split("-")[2],L=p[u[V]],e.next=34,t.client.v1.chain.get_currency_balance(M,c,T);case 34:if((O=e.sent).length){e.next=37;break}return e.abrupt("continue",40);case 37:I=O[0].value*L,b+=I,v.push({key:M+"-"+T,contract:M,sym:T,precision:C,price:L,asset:O[0],value:I});case 40:V++,e.next=27;break;case 43:return e.next=45,n.load("loglogloglog");case 45:return z=e.sent,q=z.table("liqs"),e.next=49,q.all({scope:c});case 49:e.sent.forEach((function(e){var t=o.find((function(t){return t.mid.equals(e.mid)})),r=t.contract0.toString(),n=t.contract1.toString(),a=t.sym0.name,s=t.sym1.name,c=t.sym0.precision,l=t.sym1.precision,u=r+"-"+a,i=n+"-"+s,f=p[u+"-"+c],d=p[i+"-"+l],v=e.bal0.value,h=e.bal1.value,b=v*f,k=h*d,x=e.token.toNumber()/t.liquidity_token.toNumber(),y=x*t.reserve0.value,N=x*t.reserve1.value,w=y*f,j=N*d,P=w+j-b-k,V=S()().diff(S().utc(e.start.toString()),"days");g.reserveValue+=w+j,g.balValue+=b+k,m.push({ratio:x,contract0:r,sym0:a,precision0:c,bal0:v,key0:u,bal0Value:b,reserve0Value:w,contract1:n,sym1:s,precision1:l,bal1:h,key1:i,reserve0:y,reserve1:N,price0:f,price1:d,bal1Value:k,reserve1Value:j,diffValue:P,days:V})})),g.diffValue=g.reserveValue-g.balValue,s(i.N.setTokensLoading(!1)),s(i.N.setTokens(v)),s(i.N.setLiqTokens(m)),s(i.N.setTokensValue(b)),s(i.N.setLiqsValue(g)),e.next=63;break;case 59:e.prev=59,e.t0=e.catch(0),s(i.N.setTokensLoading(!1)),(0,f.Tv)(e.t0,r);case 63:case"end":return e.stop()}}),e,null,[[0,59]])})));return function(t,r,n,a){return e.apply(this,arguments)}}(),[r]),ne=(0,j.useCallback)(function(){var e=o()(a()().mark((function e(t,n){var o,u,p,d,v,m,b,g,k,S,w,j,P,V,M,T,C,L,I,z,q,_,E,K,D;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(N&&x&&c)){e.next=85;break}return s(i.N.setLoading(!0)),s(i.N.setTokensLoading(!0)),e.next=5,te(t,n);case 5:if(e.sent){e.next=9;break}return s(i.N.setLoading(!1)),s(i.N.setTokensLoading(!1)),e.abrupt("return");case 9:return e.prev=9,o="",e.next=13,N.load(t);case 13:return u=e.sent,e.next=16,x.load("swapswapswap");case 16:return p=e.sent,e.next=19,x.load("dfsweb3desoc");case 19:return d=e.sent,e.next=22,x.load("dfsbpsvoters");case 22:return v=e.sent,e.next=25,x.load("eosio.msig");case 25:return m=e.sent,e.next=28,x.load("dfsrefdfsref");case 28:return b=e.sent,g=p.table("markets"),k=d.table("profiles"),S=v.table("voters"),w=m.table("approvals2"),j=m.table("proposal"),P=b.table("referrers"),V=b.table("relations"),e.next=38,g.all();case 38:return M=e.sent,e.next=41,S.all({scope:"dfsbpsvoters",from:t,to:t});case 41:return T=e.sent,e.next=44,k.all({scope:"dfsweb3desoc",from:t,to:t});case 44:return(C=e.sent).length||C.push({avatar:"",cover:"",desc:"",join:"",nick:"",owner:h.VG.from(t),sex:h.zM.from(2),update:""}),e.next=48,w.all({scope:t});case 48:return L=e.sent,e.next=51,j.all({scope:t});case 51:return I=e.sent,e.next=54,P.all({scope:"dfsrefdfsref",from:t,to:t});case 54:return z=e.sent,e.next=57,V.all({scope:"dfsrefdfsref",from:t,to:t});case 57:return q=e.sent,e.next=60,(0,f.zI)(y().get("https://api2.dfsmoon.com/v2/history/get_creator?account=".concat(u.accountName.toString())));case 60:_=e.sent,E=l()(_,2),K=E[0],D=E[1],K||200!==D.status||(o=D.data.creator),re(c,x,M,t),s(i.N.setMarkets(M)),s(i.N.setAccountInfo(u)),s(i.N.setCreator(o)),s(i.N.setProfile(C[0])),s(i.N.setVoter(T[0])),s(i.N.setProposals(I)),s(i.N.setApprovals2(L)),s(i.N.setReferrer(z[0])),s(i.N.setRelation(q[0])),A(""),s(i.N.setLoading(!1)),O.current&&O.current.handleSearch(),e.next=85;break;case 80:e.prev=80,e.t0=e.catch(9),s(i.N.setLoading(!1)),s(i.N.setTokensLoading(!1)),(0,f.Tv)(e.t0,r);case 85:case"end":return e.stop()}}),e,null,[[9,80]])})));return function(t,r){return e.apply(this,arguments)}}(),[N,x,c,te,r,re]),ae=(0,j.useCallback)((0,w.debounce)(function(){var e=o()(a()().mark((function e(t){var r,n,s,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.target.value,/^[a-z1-5.]{1,12}$/.test(r)){e.next=6;break}0===r.trim().length?A(""):A("error"),e.next=12;break;case 6:return e.next=8,(0,f.zI)(c.client.v1.chain.get_account(r));case 8:n=e.sent,s=l()(n,2),o=s[1],A(o?"":"error");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),1e3),[c]),se=[{key:"info",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:G}),children:!!M&&(0,P.jsx)(u.i3,{handleSearch:ne})},{key:"auth",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:H}),children:!!M&&(0,P.jsx)(u.Bf,{})},{key:"token",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:J}),children:!!M&&(0,P.jsx)(u.DL,{})},{key:"liq",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:Q}),children:!!M&&(0,P.jsx)(u.uq,{})},{key:"tx",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:W}),children:!!M&&(0,P.jsx)(u.ps,{ref:O})},{key:"proposal",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:X}),children:!!M&&(0,P.jsx)(u.f9,{proposer:M.accountName.toString(),approvals2:C,proposals:L,loading:T,handleSearch:ne})},{key:"invite",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:Y}),children:!!M&&(0,P.jsx)(u.$7,{handleSearch:ne})},{key:"tip",label:(0,P.jsx)("span",{className:"text-lg font-semibold",children:ee}),disabled:!0}],oe=(0,j.useCallback)((function(e,t){var r={};e&&(r.search=e),r.tab=t||V,D(r)}),[V]);return(0,j.useEffect)((function(){var e=K.get("search"),t=K.get("tab");t&&s(i.N.setActiveKey(t)),e&&ne(e,""),oe(e,t)}),[ne]),(0,j.useEffect)((function(){var e=M?M.accountName.toString():"";oe(e,V)}),[M,V,oe]),(0,P.jsxs)(p._z,{className:"account",ghost:!0,children:[(0,P.jsxs)(d.Z,{title:(0,P.jsx)("div",{className:"hardline font-semibold text-lg mb-3",children:U}),children:[(0,P.jsx)(b.Z.Search,{className:" ",loading:T,addonBefore:(0,P.jsx)(g.Z,{spinning:T,children:B}),placeholder:"Search...",allowClear:!0,enterButton:F,size:"large",status:q,onSearch:ne,onChange:ae}),(0,P.jsx)(k.Z,{className:"mt-2",items:se,activeKey:Z,onChange:function(e){s(i.N.setActiveKey(e))}})]}),n]})}},31145:function(){}}]);