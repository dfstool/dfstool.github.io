"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7024],{7024:function(e,t,n){n.r(t);var r=n(97857),s=n.n(r),a=n(15009),o=n.n(a),c=n(99289),i=n.n(c),l=n(5574),u=n.n(l),f=n(93498),p=n(3990),d=n(64119),m=n(11774),h=n(38345),g=n(59530),b=n(80507),k=n(45360),y=n(69677),v=n(57953),x=n(92398),N=n(9669),S=n.n(N),w=n(27484),j=n.n(w),_=n(96486),P=n(62435),L=(n(31145),n(86074));t.default=function(){var e=k.ZP.useMessage(),t=u()(e,2),n=t[0],r=t[1],a=(0,g.useDispatch)(),c=(0,g.useSelector)((function(e){return e.global.session})),l=(0,g.useSelector)((function(e){return e.global.contractKit})),N=(0,g.useSelector)((function(e){return e.global.accountKit})),w=(0,g.useSelector)((function(e){return e.account.activeKey})),V=(0,g.useSelector)((function(e){return e.account.accountInfo})),O=(0,g.useSelector)((function(e){return e.account.loading})),M=(0,g.useSelector)((function(e){return e.account.approvals2})),T=(0,g.useSelector)((function(e){return e.account.proposals})),D=(0,P.useRef)(),C=(0,P.useState)(""),E=u()(C,2),I=E[0],z=E[1],q=(0,g.useSearchParams)(),A=u()(q,2),F=A[0],K=A[1],R=F.get("tab")?F.get("tab"):void 0,Z=(0,g.useIntl)(),U=Z.formatMessage({id:"account.intlAccount"}),B=Z.formatMessage({id:"account.intlSearch"}),$=Z.formatMessage({id:"contract.intlAccountFormatError"}),G=Z.formatMessage({id:"account.intlSearchAccount"}),H=Z.formatMessage({id:"account.intlProfile"}),J=Z.formatMessage({id:"account.intlAuth"}),Q=Z.formatMessage({id:"account.intlToken"}),W=Z.formatMessage({id:"account.intlNft"}),X=Z.formatMessage({id:"account.intlLiq"}),Y=Z.formatMessage({id:"account.intlTx"}),ee=Z.formatMessage({id:"account.intlProposal"}),te=Z.formatMessage({id:"account.intlInvite"}),ne=(0,P.useMemo)((function(){return V?V.accountName.toString():""}),[V]),re=(0,P.useCallback)(function(){var e=i()(o()().mark((function e(t,r){var s,i,l,f;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(/^[a-z1-5.]{1,12}$/.test(t)){e.next=8;break}if(t||r.hasOwnProperty("type")){e.next=4;break}return e.abrupt("return",!1);case 4:return n.error("".concat($)),e.abrupt("return",!1);case 8:return e.next=10,(0,d.zI)(c.client.v1.chain.get_abi(t));case 10:if(s=e.sent,i=u()(s,2),l=i[0],f=i[1],!l){e.next=17;break}return n.error(l),e.abrupt("return",!1);case 17:return!l&&f.hasOwnProperty("abi")?a(p.N.setIsContract(!0)):a(p.N.setIsContract(!1)),e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[c,n]),se=(0,P.useCallback)(function(){var e=i()(o()().mark((function e(t,n,r){var c,i,l,u;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=[],i={},l={},n.forEach((function(e){var n=e.max_token_supply.symbol.name,r=e.init_nft_price.symbol.name,s=e.id,a=e.nft_img,o=e.project_name,c="";"DFS"===r?c="eosio.token-DFS-8":"USDT"===r?c="usdtusdtusdt-USDT-8":"ORDI"===r&&(c="ordiordiordi-ORDI-8");var i=t[c];l[s]={logo:a,sym:n,price:i,name:o}})),r.forEach((function(e){var t=e.pid.toString(),n=e.current_price.value,r=l[t].price*n,s=l[t].name;i.hasOwnProperty(t)?(i[t].count+=1,i[t].value+=r):i[t]={count:1,value:r,logo:l[t].logo,sym:l[t].sym,name:s}})),u=0,Object.keys(i).forEach((function(e){u+=i[e].value,c.push(s()({pid:e},i[e]))})),c.sort((function(e,t){return t.value-e.value})),a(p.N.setNfts(c)),a(p.N.setNftsValue(u)),a(p.N.setNftsLoading(!1));case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),[]),ae=(0,P.useCallback)(function(){var e=i()(o()().mark((function e(t,r,s,c,i,l){var f,m,h,g,k,y,v,x,N,w,_,P,L,V,O,M,T,D,C,E,I,z,q,A,F;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,f=[],h={},g=[],k=[],y=0,v={balValue:0,reserveValue:0,diffValue:0},"usdtusdtusdt-USDT-8",x="eosio.token-DFS-8",N=[],(m={})["usdtusdtusdt-USDT-8"]=1,m[x]=(0,d.ri)(s[0].reserve0)/(0,d.ri)(s[0].reserve1),s.forEach((function(e){var t=e.contract0.toString()+"-"+e.sym0.toString().split(",")[1]+"-"+e.sym0.toString().split(",")[0],n=e.contract1.toString()+"-"+e.sym1.toString().split(",")[1]+"-"+e.sym1.toString().split(",")[0];f.includes(t)||(f.push(t),h[t]=f.length),f.includes(n)||(f.push(n),h[n]=f.length);var r=(0,d.ri)(e.reserve0),s=(0,d.ri)(e.reserve1);"eosio.token"===e.contract0.toString()?m.hasOwnProperty(n)||(m[n]=r/s*m[x]):"eosio.token"===e.contract1.toString()?m.hasOwnProperty(t)||(m[t]=s/r*m[x]):"usdtusdtusdt"===e.contract0.toString()?m.hasOwnProperty(n)||(m[n]=r/s):"usdtusdtusdt"===e.contract1.toString()?m.hasOwnProperty(t)||(m[t]=s/r):N.push({key0:t,key1:n,value0:r,value1:s})})),N.forEach((function(e){m.hasOwnProperty(e.key0)&&!m.hasOwnProperty(e.key1)?m[e.key1]=e.value0/e.value1*m[e.key0]:!m.hasOwnProperty(e.key0)&&m.hasOwnProperty(e.key1)?m[e.key0]=e.value1/e.value0*m[e.key1]:m.hasOwnProperty(e.key0)||m.hasOwnProperty(e.key1)||(m[e.key0]=0,m[e.key1]=0),Number.isNaN(m[e.key0])&&(m[e.key0]=0)})),Object.keys(m).forEach((function(e){Number.isNaN(m[e])&&(m[e]=0)})),m["dfs3protocol-DFS-8"]=0,w={},c.forEach((function(e){var t=e.max_token_supply.symbol.name;w[t]=e.token_url})),se(m,c,i),e.next=22,(0,d.zI)(S().get("https://api2.dfsmoon.com/v2/state/get_tokens?limit=1000&account=".concat(l),{timeout:2e3}));case 22:if(_=e.sent,P=u()(_,2),L=P[0],V=P[1],L||200!==V.status){e.next=31;break}V.data.tokens.forEach((function(e){if("dfs3protocol"!==e.contract){var t=e.contract+"-"+e.symbol,n=m[t+"-"+e.precision],r=e.amount*n;y+=r;var s="dfsppptokens"===e.contract?w[e.symbol]:"https://dfs.land/assets/tokens/".concat(t,".png");g.push({key:t,contract:e.contract,sym:e.symbol,precision:String(e.precision),price:n,asset:b.xR.from(e.amount.toFixed(e.precision)+" "+e.symbol),value:r,logo:s})}})),g.sort((function(e,t){return h[e.key+"-"+e.precision]-h[t.key+"-"+t.precision]})),e.next=52;break;case 31:O=0;case 32:if(!(O<f.length)){e.next=52;break}if("dfs3protocol"!==(M=f[O].split("-")[0])){e.next=36;break}return e.abrupt("continue",49);case 36:return T=f[O].split("-")[1],D=M+"-"+T,C=f[O].split("-")[2],E=m[f[O]],e.next=42,t.client.v1.chain.get_currency_balance(M,l,T);case 42:if(I=e.sent,z="dfsppptokens"===M?w[T]:"https://dfs.land/assets/tokens/".concat(D,".png"),I.length){e.next=46;break}return e.abrupt("continue",49);case 46:q=(0,d.ri)(I[0])*E,y+=q,g.push({key:D,contract:M,sym:T,precision:C,price:E,asset:I[0],value:q,logo:z});case 49:O++,e.next=32;break;case 52:return e.next=54,r.load("loglogloglog");case 54:return A=e.sent,F=A.table("liqs"),e.next=58,F.all({scope:(0,d.fD)(l)});case 58:e.sent.forEach((function(e){var t=s.find((function(t){return t.mid.equals(e.mid)})),n=t.contract0.toString(),r=t.contract1.toString(),a=t.sym0.name,o=t.sym1.name,c=t.sym0.precision,i=t.sym1.precision,l=n+"-"+a,u=r+"-"+o,f=m[l+"-"+c],p=m[u+"-"+i],h=(0,d.ri)(e.bal0),g=(0,d.ri)(e.bal1),b=h*f,y=g*p,x=e.token.toNumber()/t.liquidity_token.toNumber(),N=x*(0,d.ri)(t.reserve0),S=x*(0,d.ri)(t.reserve1),_=N*f,P=S*p,L=_+P-b-y,V=j()().diff(j().utc(e.start.toString()),"days"),O="dfsppptokens"===n?w[a]:"https://dfs.land/assets/tokens/".concat(l,".png"),M="dfsppptokens"===r?w[o]:"https://dfs.land/assets/tokens/".concat(u,".png");v.reserveValue+=_+P,v.balValue+=b+y,k.push({ratio:x,contract0:n,sym0:a,precision0:c,bal0:h,key0:l,bal0Value:b,reserve0Value:_,contract1:r,sym1:o,precision1:i,bal1:g,key1:u,reserve0:N,reserve1:S,price0:f,price1:p,bal1Value:y,reserve1Value:P,diffValue:L,days:V,logo0:O,logo1:M})})),v.diffValue=v.reserveValue-v.balValue,a(p.N.setTokensLoading(!1)),a(p.N.setTokens(g)),a(p.N.setLiqTokens(k)),a(p.N.setTokensValue(y)),a(p.N.setLiqsValue(v)),e.next=73;break;case 68:e.prev=68,e.t0=e.catch(0),a(p.N.setTokensLoading(!1)),a(p.N.setNftsLoading(!1)),(0,d.Tv)(e.t0,n);case 73:case"end":return e.stop()}}),e,null,[[0,68]])})));return function(t,n,r,s,a,o){return e.apply(this,arguments)}}(),[n,se]),oe=(0,P.useCallback)(function(){var e=i()(o()().mark((function e(t,r){var s,i,f,m,h,g,k,y,v,x,w,j,_,P,L,V,O,M,T,C,E,I,q,A,F,K,R,Z,U,B;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(N&&l&&c)){e.next=99;break}return a(p.N.setLoading(!0)),a(p.N.setTokensLoading(!0)),a(p.N.setNftsLoading(!0)),e.next=6,re(t,r);case 6:if(e.sent){e.next=11;break}return a(p.N.setLoading(!1)),a(p.N.setTokensLoading(!1)),a(p.N.setNftsLoading(!1)),e.abrupt("return");case 11:return e.prev=11,s="",e.next=15,N.load(t);case 15:return i=e.sent,e.next=18,l.load("swapswapswap");case 18:return f=e.sent,e.next=21,l.load("dfsweb3desoc");case 21:return m=e.sent,e.next=24,l.load("dfsbpsvoters");case 24:return h=e.sent,e.next=27,l.load("eosio.msig");case 27:return g=e.sent,e.next=30,l.load("dfsrefdfsref");case 30:return k=e.sent,e.next=33,l.load("dfs3protocol");case 33:return y=e.sent,v=f.table("markets"),x=m.table("profiles"),w=h.table("voters"),j=g.table("approvals2"),_=g.table("proposal"),P=k.table("referrers"),L=k.table("relations"),V=y.table("projects"),O=y.table("registry"),e.next=45,O.all({scope:"dfs3protocol",from:t,to:t,index_position:"tertiary",key_type:"name"});case 45:return M=e.sent,e.next=48,v.all();case 48:return T=e.sent,e.next=51,w.all({scope:"dfsbpsvoters",from:t,to:t});case 51:return C=e.sent,e.next=54,x.all({scope:"dfsweb3desoc",from:t,to:t});case 54:return(E=e.sent).length||E.push({avatar:"",cover:"",desc:"",join:"",nick:"",owner:b.VG.from(t),sex:b.zM.from(2),update:""}),e.next=58,j.all({scope:(0,d.fD)(t)});case 58:return I=e.sent,e.next=61,_.all({scope:(0,d.fD)(t)});case 61:return q=e.sent,e.next=64,P.all({scope:"dfsrefdfsref",from:t,to:t});case 64:return A=e.sent,e.next=67,L.all({scope:"dfsrefdfsref",from:t,to:t});case 67:return F=e.sent,e.next=70,V.all();case 70:return K=e.sent,e.next=73,(0,d.zI)(S().get("https://api2.dfsmoon.com/v2/history/get_creator?account=".concat(i.accountName.toString())));case 73:R=e.sent,Z=u()(R,2),U=Z[0],B=Z[1],U||200!==B.status||(s=B.data.creator),ae(c,l,T,K,M,t),a(p.N.setMarkets(T)),a(p.N.setAccountInfo(i)),a(p.N.setCreator(s)),a(p.N.setProfile(E[0])),a(p.N.setVoter(C[0])),a(p.N.setProposals(q)),a(p.N.setApprovals2(I)),a(p.N.setReferrer(A[0])),a(p.N.setRelation(F[0])),z(""),a(p.N.setLoading(!1)),D.current&&D.current.handleSearch(),e.next=99;break;case 93:e.prev=93,e.t0=e.catch(11),a(p.N.setLoading(!1)),a(p.N.setTokensLoading(!1)),a(p.N.setNftsLoading(!1)),(0,d.Tv)(e.t0,n);case 99:case"end":return e.stop()}}),e,null,[[11,93]])})));return function(t,n){return e.apply(this,arguments)}}(),[N,l,c,re,n,ae]),ce=(0,P.useCallback)((0,_.debounce)(function(){var e=i()(o()().mark((function e(t){var n,r,s,a;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target.value,/^[a-z1-5.]{1,12}$/.test(n)){e.next=6;break}0===n.trim().length?z(""):z("error"),e.next=12;break;case 6:return e.next=8,(0,d.zI)(c.client.v1.chain.get_account(n));case 8:r=e.sent,s=u()(r,2),a=s[1],z(a?"":"error");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),1e3),[c]),ie=[{key:"info",label:(0,L.jsx)("span",{className:"text-lg font-semibold",children:H}),children:!!V&&(0,L.jsx)(f.i3,{handleSearch:oe})},{key:"auth",label:(0,L.jsx)("span",{className:"text-lg font-semibold",children:J}),children:!!V&&(0,L.jsx)(f.Bf,{})},{key:"token",label:(0,L.jsx)("span",{className:"text-lg font-semibold",children:Q}),children:!!V&&(0,L.jsx)(f.DL,{})},{key:"nft",label:(0,L.jsx)("span",{className:"text-lg font-semibold",children:W}),children:!!V&&(0,L.jsx)(f.tw,{})},{key:"liq",label:(0,L.jsx)("span",{className:"text-lg font-semibold",children:X}),children:!!V&&(0,L.jsx)(f.uq,{})},{key:"tx",label:(0,L.jsx)("span",{className:"text-lg font-semibold",children:Y}),children:!!V&&(0,L.jsx)(f.ps,{ref:D})},{key:"proposal",label:(0,L.jsx)("span",{className:"text-lg font-semibold",children:ee}),children:!!V&&(0,L.jsx)(f.f9,{proposer:V.accountName.toString(),approvals2:M,proposals:T,loading:O,handleSearch:oe})},{key:"invite",label:(0,L.jsx)("span",{className:"text-lg font-semibold",children:te}),children:!!V&&(0,L.jsx)(f.$7,{handleSearch:oe})},{key:"tip",label:(0,L.jsx)("span",{className:"text-lg font-semibold",children:ne}),disabled:!0}],le=(0,P.useCallback)((function(e,t){var n={};e&&(n.search=e),n.tab=t||w,K(n)}),[w]);return(0,P.useEffect)((function(){var e=F.get("search"),t=F.get("tab");t&&a(p.N.setActiveKey(t)),e&&oe(e,""),le(e,t)}),[oe]),(0,P.useEffect)((function(){var e=V?V.accountName.toString():"";le(e,w)}),[V,w,le]),(0,L.jsxs)(m._z,{className:"account",ghost:!0,children:[(0,L.jsxs)(h.Z,{title:(0,L.jsx)("div",{className:"hardline font-semibold text-lg mb-3",children:G}),children:[(0,L.jsx)(y.Z.Search,{className:" ",loading:O,addonBefore:(0,L.jsx)(v.Z,{spinning:O,children:U}),placeholder:"Search...",allowClear:!0,enterButton:B,size:"large",status:I,onSearch:oe,onChange:ce}),(0,L.jsx)(x.Z,{className:"mt-2",items:ie,activeKey:R,onChange:function(e){a(p.N.setActiveKey(e))}})]}),r]})}},31145:function(){}}]);