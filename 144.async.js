"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[144],{64317:function(e,t,a){var n=a(1413),r=a(91),s=a(22270),i=a(62435),o=a(66758),l=a(56499),c=a(86074),u=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],m=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],d=function(e,t){var a=e.fieldProps,m=e.children,d=e.params,p=e.proFieldProps,f=e.mode,h=e.valueEnum,x=e.request,y=e.showSearch,b=e.options,k=(0,r.Z)(e,u),j=(0,i.useContext)(o.Z);return(0,c.jsx)(l.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,s.h)(h),request:x,params:d,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({options:b,mode:f,showSearch:y,getPopupContainer:j.getPopupContainer},a),ref:t,proFieldProps:p},k),{},{children:m}))},p=i.forwardRef((function(e,t){var a=e.fieldProps,u=e.children,d=e.params,p=e.proFieldProps,f=e.mode,h=e.valueEnum,x=e.request,y=e.options,b=(0,r.Z)(e,m),k=(0,n.Z)({options:y,mode:f||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},a),j=(0,i.useContext)(o.Z);return(0,c.jsx)(l.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,s.h)(h),request:x,params:d,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({getPopupContainer:j.getPopupContainer},k),ref:t,proFieldProps:p},b),{},{children:u}))})),f=i.forwardRef(d);f.SearchSelect=p,f.displayName="ProFormComponent",t.Z=f},16529:function(e,t,a){a.d(t,{s:function(){return d},S:function(){return h}});var n=a(5574),r=a.n(n),s=a(59530),i=a(85265),o=a(42075),l=a(15867),c=a(62435),u=a(86074),m=c.forwardRef((function(e,t){var a=(0,s.useIntl)(),n=a.formatMessage({id:"iframe.Close"}),m=a.formatMessage({id:"iframe.Jump"}),d=e.src,p=e.title,f=(0,c.useState)(!1),h=r()(f,2),x=h[0],y=h[1];(0,c.useImperativeHandle)(t,(function(){return{setIsDrawerOpen:y}}));var b=(0,c.useCallback)((function(){y(!1)}),[]),k=(0,c.useCallback)((function(){window.open(d),y(!1)}),[d]);return(0,u.jsx)(i.Z,{title:p,placement:"bottom",closable:!1,open:x,onClose:b,styles:{body:{padding:"0px"},header:{padding:"10px"}},height:"90%",destroyOnClose:!0,extra:(0,u.jsxs)(o.Z,{children:[(0,u.jsx)(l.ZP,{type:"primary",onClick:k,children:m}),(0,u.jsx)(l.ZP,{type:"primary",onClick:b,children:n})]}),children:(0,u.jsx)("iframe",{title:"",style:{borderWidth:"0px"},width:"100%",height:"100%",src:d})})})),d=(0,c.memo)(m),p=a(99021),f=c.forwardRef((function(e,t){var a=(0,c.useState)([]),n=r()(a,2),s=n[0],o=n[1],l=(0,c.useState)(!1),m=r()(l,2),d=m[0],f=m[1],h=(0,c.useCallback)((function(e){f(!0),o(e.split("|"))}),[]);return(0,c.useImperativeHandle)(t,(function(){return{handleOpen:h}})),(0,u.jsx)(i.Z,{placement:"bottom",closable:!0,open:d,onClose:function(){return f(!1)},styles:{body:{padding:"0px",textAlign:"center"},header:{padding:"10px"}},height:"91%",destroyOnClose:!0,children:s.map((function(e,t){return(0,u.jsx)(p.Z,{src:e,preview:!1},t)}))})})),h=(0,c.memo)(f)},23144:function(e,t,a){a.d(t,{cS:function(){return V},K4:function(){return be},xt:function(){return je},OA:function(){return ge}});var n=a(16529),r=a(35132),s=a(15867),i=a(27484),o=a.n(i),l=a(70178),c=a.n(l),u=a(62435),m=a(15009),d=a.n(m),p=a(99289),f=a.n(p),h=a(5574),x=a.n(h),y=a(3990),b=a(64119),k=a(64317),j=a(1413),S=a(91),g=a(66758),C=a(56499),v=a(86074),q=["proFieldProps","fieldProps"],Z="date",N=u.forwardRef((function(e,t){var a=e.proFieldProps,n=e.fieldProps,r=(0,S.Z)(e,q),s=(0,u.useContext)(g.Z);return(0,v.jsx)(C.Z,(0,j.Z)({ref:t,valueType:Z,fieldProps:(0,j.Z)({getPopupContainer:s.getPopupContainer},n),proFieldProps:a,filedConfig:{valueType:Z,customLightMode:!0}},r))})),B=["proFieldProps","fieldProps"],F="dateMonth",T=u.forwardRef((function(e,t){var a=e.proFieldProps,n=e.fieldProps,r=(0,S.Z)(e,B),s=(0,u.useContext)(g.Z);return(0,v.jsx)(C.Z,(0,j.Z)({ref:t,valueType:F,fieldProps:(0,j.Z)({getPopupContainer:s.getPopupContainer},n),proFieldProps:a,filedConfig:{valueType:F,customLightMode:!0}},r))})),E=["fieldProps"],w="dateQuarter",P=u.forwardRef((function(e,t){var a=e.fieldProps,n=(0,S.Z)(e,E),r=(0,u.useContext)(g.Z);return(0,v.jsx)(C.Z,(0,j.Z)({ref:t,valueType:w,fieldProps:(0,j.Z)({getPopupContainer:r.getPopupContainer},a),filedConfig:{valueType:w,customLightMode:!0}},n))})),I=["proFieldProps","fieldProps"],M="dateWeek",O=u.forwardRef((function(e,t){var a=e.proFieldProps,n=e.fieldProps,r=(0,S.Z)(e,I),s=(0,u.useContext)(g.Z);return(0,v.jsx)(C.Z,(0,j.Z)({ref:t,valueType:M,fieldProps:(0,j.Z)({getPopupContainer:s.getPopupContainer},n),proFieldProps:a,filedConfig:{valueType:M,customLightMode:!0}},r))})),D=["proFieldProps","fieldProps"],R="dateYear",_=u.forwardRef((function(e,t){var a=e.proFieldProps,n=e.fieldProps,r=(0,S.Z)(e,D),s=(0,u.useContext)(g.Z);return(0,v.jsx)(C.Z,(0,j.Z)({ref:t,valueType:R,fieldProps:(0,j.Z)({getPopupContainer:s.getPopupContainer},n),proFieldProps:a,filedConfig:{valueType:R,customLightMode:!0}},r))})),A=N;A.Week=O,A.Month=T,A.Quarter=P,A.Year=_,A.displayName="ProFormComponent";var U=A,L=a(37476),z=a(5966),H=a(59530),J=a(80507),K=a(45360),W=u.forwardRef((function(e,t){var a=(0,H.useDispatch)(),n=K.ZP.useMessage(),r=x()(n,2),s=r[0],i=r[1],o=(0,H.useSelector)((function(e){return e.jiu.activeKey})),l=(0,H.useSelector)((function(e){return e.global.session})),c=(0,H.useSelector)((function(e){return e.global.account})),m=(0,H.useSelector)((function(e){return e.global.contractKit})),p=(0,H.useSelector)((function(e){return e.account.markets})),h=(0,u.useRef)(),j=(0,u.useState)(!1),S=x()(j,2),g=S[0],C=S[1],q=(0,H.useIntl)(),Z=q.formatMessage({id:"common.intlInputException"}),N=q.formatMessage({id:"common.intlPleaseConnectWallet"}),B=q.formatMessage({id:"common.intlPleaseConnectNetwork"}),F=q.formatMessage({id:"common.intlTxSuccess"}),T=q.formatMessage({id:"common.intlTxFail"}),E=q.formatMessage({id:"jiu.intlQuantityMustGreater"},{num:e.params.transferTokenMinAmount,sym:e.params.transferTokenSym}),w=q.formatMessage({id:"jiu.intlFinished"}),P=(0,u.useCallback)((function(){C(!0)}),[]);(0,u.useImperativeHandle)(t,(function(){return{handleOpen:P}}));var I=(0,u.useCallback)((function(t){var a=e.params,n=a.inputPrefix;switch(a.inputType){case 1:return n+t.input.trim().slice(6);case 2:return n+t.input.trim().split("-")[0].slice(2,4)+t.input.trim().split("-")[1]+t.input.trim().split("-")[2]}}),[e.params]),M=(0,u.useCallback)(function(){var t=f()(d()().mark((function t(n){var r,i,o,u,f,h,k,j,S,g,C,v,q,Z,P,M,O,D,R,_,A,U,L,z,H,K,W,Y,Q,V,$,G,X,ee,te,ae,ne,re,se,ie;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.params.finish,i=e.params.liqMid,o=e.params.liqTokenKey,u=e.params.liqSym,f=e.params.liqTokenMinAmount,h=e.params.transferTokenSym,k=e.params.transferTokenMinAmount,j=e.params.transferTokenContract,S=e.params.transferTokenPrecision,g=e.params.receiveAccount,C=e.params.ruleType,v="",0,q="",Z=0,2===C&&(v=e.params.holdTokenContract,e.params.holdTokenMinAmount,q=e.params.holdTokenSym,Z=e.params.allTokenMinAmount),!r){t.next=19;break}return s.info("".concat(w)),t.abrupt("return",!0);case 19:if(t.prev=19,l&&l.broadcast){t.next=25;break}return s.error("".concat(N)),t.abrupt("return",!1);case 25:if(c){t.next=28;break}return s.error("".concat(B)),t.abrupt("return",!1);case 28:if(!(Number(n.quantity)<1)){t.next=31;break}return s.error("".concat(E)),t.abrupt("return",!1);case 31:if(P=[],!p||!p.length){t.next=36;break}P=p,t.next=44;break;case 36:return t.next=38,m.load("swapswapswap");case 38:return M=t.sent,O=M.table("markets"),t.next=42,O.all();case 42:P=t.sent,a(y.N.setMarkets(P));case 44:return t.next=46,m.load("loglogloglog");case 46:return D=t.sent,R=D.table("liqs"),t.next=50,R.all({scope:c.accountName.toString()});case 50:if(_=t.sent,A=0,U=u,(L=_.find((function(e){return e.mid.toNumber()===i})))&&(z=P.find((function(e){return e.mid.equals(L.mid)})),H=L.token.toNumber()/z.liquidity_token.toNumber(),K=H*z.reserve0.value,W=H*z.reserve1.value,Y=z.reserve0.symbol.name,Q=z.reserve1.symbol.name,0===o?(A=K,U=Y):(A=W,U=Q)),V=0,$=[],2!==C){t.next=72;break}return t.next=60,l.client.v1.chain.get_currency_balance(v,c.accountName.toString(),q);case 60:if(($=t.sent).length&&(V=$[0].value),G=A+V,!(Number(n.quantity)<k)){t.next=67;break}return s.error("转账数量至少".concat(k).concat(h)),t.abrupt("return",!1);case 67:if(!(G<Z)){t.next=70;break}return s.error("JIU/DFS做市+".concat(q,"余额至少").concat(Z).concat(q)),t.abrupt("return",!1);case 70:t.next=80;break;case 72:if(X=A,!(Number(n.quantity)<k)){t.next=77;break}return s.error("转账数量至少".concat(k).concat(h)),t.abrupt("return",!1);case 77:if(!(X<f)){t.next=80;break}return s.error("JIU/DFS矿池做市至少".concat(f).concat(U)),t.abrupt("return",!1);case 80:return ee=I(n),te=J.xR.from(Number(n.quantity),J.xR.Symbol.fromParts(h,S)),ae={action:{account:j,name:"transfer",authorization:[l.permissionLevel],data:{from:l.actor,to:g,quantity:te.toString(),memo:ee}}},t.next=85,(0,b.zI)(l.transact(ae));case 85:return ne=t.sent,re=x()(ne,2),se=re[0],ie=re[1],se?s.error(se):ie&&ie.response?s.success("".concat(F)):s.error("".concat(T)),t.abrupt("return",!0);case 93:t.prev=93,t.t0=t.catch(19),console.log(t.t0.message),s.error(t.t0.message);case 97:case"end":return t.stop()}}),t,null,[[19,93]])})));return function(e){return t.apply(this,arguments)}}(),[l,c,m,e.params,p,I]),O=(0,u.useCallback)((function(){var t=e.params,a=t.inputLabel,n=t.inputPlaceholder,r=t.schemes;switch(t.inputType){case 1:return(0,v.jsx)(k.Z,{name:"input",label:(0,v.jsx)("span",{className:" font-semibold",children:a}),placeholder:n,fieldProps:{autoFocus:!1,size:"large"},rules:[{required:!0,whitespace:!0,message:"".concat(Z),pattern:/^.+$/}],valueEnum:r});case 2:return(0,v.jsx)(U,{width:"100%",name:"input",label:(0,v.jsx)("span",{className:" font-semibold",children:a}),placeholder:n,fieldProps:{autoFocus:!1,size:"large",width:"100%"},rules:[{required:!0,message:"".concat(Z)}]})}}),[e.params]);return(0,v.jsxs)(L.Y,{formRef:h,title:"活动"+o,open:g,onFinish:M,onOpenChange:function(e){C(e)},layout:"vertical",width:"400px",style:{overflowWrap:"anywhere"},children:[(0,v.jsx)("div",{children:e.params.inputTip}),O(),(0,v.jsx)(z.Z,{name:"quantity",label:(0,v.jsx)("span",{className:" font-semibold",children:"发送".concat(e.params.transferTokenSym,"数量(至少 ").concat(e.params.transferTokenMinAmount," ").concat(e.params.transferTokenSym,")")}),placeholder:"ex: ".concat(e.params.transferTokenMinAmount),fieldProps:{autoFocus:!1,size:"large"},rules:[{required:!0,whitespace:!0,message:"".concat(Z),pattern:/^\d+(\.\d+)?$/}]}),i]})})),Y=(0,u.memo)(W);o().extend(c());var Q=function(e){var t=(0,u.useRef)(),a=e.params.src,i=e.params.title,o=(0,u.useRef)();return(0,v.jsxs)("div",{className:"",children:[(0,v.jsx)(r.Z.Title,{level:4,className:"text-center",children:i}),(0,v.jsx)("div",{className:"text-center mt-8",children:(0,v.jsxs)("a",{className:" font-bold text-lg",onClick:function(){return t.current.setIsDrawerOpen(!0)},children:["活动详情"," ",e.params.finish?(0,v.jsx)("span",{className:" text-red-600",children:"(已结束)"}):(0,v.jsx)("span",{className:" text-green-600",children:"(进行中)"})]})}),(0,v.jsx)("div",{className:"mt-14",children:(0,v.jsx)(s.ZP,{type:"primary",size:"large",block:!0,onClick:function(){return o.current.handleOpen()},children:"立即参与"})}),(0,v.jsx)(Y,{ref:o,params:e.params}),(0,v.jsx)(n.s,{ref:t,src:a,title:i})]})},V=(0,u.memo)(Q),$=a(97857),G=a.n($),X=a(81876),ee=a(31120),te=a(20701),ae=a(11924),ne=a(79360),re=a(24770),se=a(79642),ie=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a},oe=(0,u.forwardRef)((function(e,t){var a=e.chartRef,n=e.style,r=void 0===n?{height:"inherit"}:n,s=e.className,i=e.loading,o=e.loadingTemplate,l=e.errorTemplate,c=ie(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),m=(0,ae.Z)(te.sg,c),d=m.chart,p=m.container;return(0,u.useEffect)((function(){(0,ne.J)(a,d.current)}),[d.current]),(0,u.useImperativeHandle)(t,(function(){return{getChart:function(){return d.current}}})),u.createElement(re.Z,{errorTemplate:l},i&&u.createElement(se.Z,{loadingTemplate:o,theme:e.theme}),u.createElement("div",{className:s,style:r,ref:p}))})),le=a(38345),ce=a(92340),ue=a(57953),me=a(62120),de=a(9669),pe=a.n(de),fe=a(55835),he=a(53667),xe=a.n(he);o().extend(c());var ye=function(e){var t=K.ZP.useMessage(),a=x()(t,2),n=a[0],r=a[1],i=(0,H.useNavigate)(),l=(0,u.useRef)(!1),c=(0,H.useDispatch)(),m=(0,H.useSelector)((function(e){return e.global.contractKit})),p=(0,H.useSelector)((function(e){return e.global.session})),h=(0,H.useSelector)((function(e){return e.jiu.liqsCache})),k=(0,H.useSelector)((function(e){return e.jiu.assetsCache})),j=(0,H.useSelector)((function(e){return e.account.markets})),S=(0,H.useSelector)((function(e){return e.jiu.activeKey})),g=(0,u.useState)([]),C=x()(g,2),q=C[0],Z=C[1],N=(0,u.useState)([]),B=x()(N,2),F=B[0],T=B[1],E=(0,u.useState)([]),w=x()(E,2),P=w[0],I=w[1],M=(0,u.useState)([]),O=x()(M,2),D=O[0],R=O[1],_=(0,u.useState)([]),A=x()(_,2),U=A[0],L=A[1],z=(0,u.useState)(!1),J=x()(z,2),W=J[0],Y=J[1],Q=(0,u.useState)([]),V=x()(Q,2),$=V[0],te=V[1],ae=(0,u.useState)(""),ne=x()(ae,2),re=ne[0],se=ne[1],ie=(0,H.useIntl)().formatMessage({id:"jiu.intlMissingData"}),de=(0,u.useCallback)(function(){var e=f()(d()().mark((function e(t){var a,r,s,i,l,c,u,m,p,f,h,y,k,j,S,g,C,v,q,Z,N,B,F,T,E,w,P,I,M;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="jiutothemoon",r="000d9cae502dd1cc895745e204f83cc892bc4c450f92a03ecd4fe057709853cc",s=(0,fe.js)("md5"),i=r+a,s.update(i),l=s.digest("hex").substring(0,8),c={key:l,chainId:r,account:a,skip:0,lastUpdate:"2020-01-01T01:01:01.000Z",error:!1,data:[]},e.next=9,ee.db.txList.where({key:l}).toArray();case 9:if((u=e.sent).length&&(c=u[0]),!(t&&o().utc(c.lastUpdate).valueOf()>o().utc(t).valueOf())){e.next=13;break}return e.abrupt("return",c.data);case 13:m=[],p=500,f=c.lastUpdate,h=c.skip;case 17:return e.next=20,(0,b.zI)(pe().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&sort=asc&simple=true&noBinary=true&account=".concat(a,"&after=").concat(f,"&limit=").concat(p)));case 20:if(y=e.sent,k=x()(y,2),j=k[0],S=k[1],j||200!==S.status){e.next=73;break}if(g=S.data.simple_actions,C=g.length,v=S.data.total.value,q=1,0!==v){e.next=32;break}return ee.db.txList.put(c),e.abrupt("return",c.data);case 32:for(Z=0;Z<g.length;Z++)h<=Z&&m.push(g[Z]);if(m.length){e.next=36;break}return c.error&&n.error(ie),e.abrupt("return",c.data);case 36:N=m.length-1;case 37:if(!(N>0)){e.next=46;break}if(m[N].transaction_id!==m[N-1].transaction_id){e.next=42;break}q+=1,e.next=43;break;case 42:return e.abrupt("break",46);case 43:N--,e.next=37;break;case 46:if(h=q,C!==p){e.next=58;break}if(B=m[m.length-1].timestamp,f=B,!(t&&o().utc(B).valueOf()>o().utc(t).valueOf())){e.next=56;break}return m.forEach((function(e){c.data.push(e)})),c.lastUpdate=B,c.skip=h,ee.db.txList.put(c),e.abrupt("return",c.data);case 56:e.next=71;break;case 58:return m.forEach((function(e){c.data.push(e)})),F=m[m.length-1].timestamp,c.lastUpdate=F,c.skip=h,e.next=64,(0,b.zI)(pe().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&simple=true&noBinary=true&account=".concat(a,"&skip=0&limit=1")));case 64:return T=e.sent,E=x()(T,2),w=E[0],P=E[1],w||200!==P.status?n.error(w):(I=P.data.total.value,c.data.length!==I?(c.error=!0,n.error(ie)):c.error=!1),ee.db.txList.put(c),e.abrupt("return",c.data);case 71:e.next=77;break;case 73:return m.length&&(m.forEach((function(e){c.data.push(e)})),M=m[m.length-1].timestamp,c.lastUpdate=M,c.skip=h,c.error=!0),ee.db.txList.put(c),n.error(j),e.abrupt("return",c.data);case 77:e.next=17;break;case 79:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n]),he=(0,u.useCallback)(function(){var t=f()(d()().mark((function t(a,r){var s,i,l,u,m,p,f,x,S,g,C,v,q,N,B,F,E,w,P,M,O,D,_,A,U,z,H,J,K,W,Q,V,$,ee,ae,ne,re,ie,oe,le,ce,ue,me,pe;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s=e.params.startTime,i=e.params.endTime,l=e.params.receiveAccount,u=e.params.transferTokenContract,m=e.params.transferTokenMinAmount,p=e.params.transferTokenSym,f=e.params.liqMid,x=e.params.liqTokenKey,S=e.params.liqSym,g=e.params.liqTokenMinAmount,C=e.params.ruleType,v="",0,q="",N=0,2===C&&(v=e.params.holdTokenContract,e.params.holdTokenMinAmount,q=e.params.holdTokenSym,N=e.params.allTokenMinAmount),B=e.params.schemesRegexp,F=[],E={},w=[],P=[],M=[],O=[],D=[],_=[],A=[],t.next=29,de(i);case 29:U=t.sent,z=0;case 31:if(!(z<U.length)){t.next=41;break}if(H=o().utc(s).valueOf(),J=o().utc(i).valueOf(),K=o().utc(U[z].timestamp).valueOf(),H<=K&&K<=J&&U[z].contract===u&&"transfer"===U[z].action&&U[z].data.symbol===p&&U[z].data.to===l&&"dfsminingout"!==U[z].data.from&&"swapswapswap"!==U[z].data.from&&""!==U[z].data.memo.trim()&&F.push(U[z]),!(K>J)){t.next=38;break}return t.abrupt("break",41);case 38:z++,t.next=31;break;case 41:if(F.forEach((function(e){var t=e.data.from,a=e.data.memo.trim(),n=e.data.amount;E.hasOwnProperty(t)?n>=m&&B[0].test(a)&&(E[t]=e):B[0].test(a)&&(E[t]=e)})),W=[],!j||!j.length){t.next=47;break}W=j,t.next=55;break;case 47:return t.next=49,r.load("swapswapswap");case 49:return Q=t.sent,V=Q.table("markets"),t.next=53,V.all();case 53:W=t.sent,c(y.N.setMarkets(W));case 55:return t.next=57,r.load("loglogloglog");case 57:$=t.sent,ee=$.table("liqs"),ae=Object.keys(E),ne={},re={},ie=d()().mark((function e(){var t,n,r,s,i,o,l,c,u,m,p,y;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(se("".concat(oe+1," / ").concat(ae.length)),t=0,n=S,r=[],!h.hasOwnProperty(ae[oe])){e.next=8;break}r=h[ae[oe]],e.next=12;break;case 8:return e.next=10,ee.all({scope:ae[oe]});case 10:r=e.sent,ne[ae[oe]]=r;case 12:if((s=r.find((function(e){return e.mid.toNumber()===f})))&&(i=W.find((function(e){return e.mid.equals(s.mid)})),o=s.token.toNumber()/i.liquidity_token.toNumber(),l=o*i.reserve0.value,c=o*i.reserve1.value,u=i.reserve0.symbol.name,m=i.reserve1.symbol.name,0===x?(t=l,n=u):(t=c,n=m)),E[ae[oe]].liqBalance=t,E[ae[oe]].liqSym=n,p=0,y=[],2!==C){e.next=29;break}if(!k.hasOwnProperty(ae[oe])){e.next=23;break}y=k[ae[oe]],e.next=27;break;case 23:return e.next=25,a.client.v1.chain.get_currency_balance(v,ae[oe],q);case 25:y=e.sent,re[ae[oe]]=y;case 27:y.length&&(p=y[0].value),E[ae[oe]].holdBalance=p;case 29:case"end":return e.stop()}}),e)})),oe=0;case 64:if(!(oe<ae.length)){t.next=69;break}return t.delegateYield(ie(),"t0",66);case 66:oe++,t.next=64;break;case 69:for(Object.keys(ne).length&&c(X.N.setLiqsCache(G()(G()({},h),ne))),Object.keys(re).length&&c(X.N.setAssetsCache(G()(G()({},k),re))),1===C?ae.forEach((function(e){var t=E[e].liqBalance;E[e].data.amount>=m&&t>=g?w.push(E[e]):P.push(E[e])})):2===C&&ae.forEach((function(e){var t=E[e].liqBalance+E[e].holdBalance;E[e].data.amount>=m&&t>=N?w.push(E[e]):P.push(E[e])})),le={},ce=[],ue=1;ue<B.length;ue++)le["scheme".concat(ue)]={vote:0,name:"方案".concat(ue)},ce.push("方案".concat(ue));w.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,i=o().utc(e.timestamp).local().format(),l=e.data.quantity,c=e.transaction_id,u=1;u<B.length;u++)if(B[u].test(a)){le["scheme".concat(u)].vote+=1,O.push({key:t,account:n,liqBalance:r,liqSym:s,time:i,quantity:l,scheme:le["scheme".concat(u)].name,memo:a,txid:c});break}})),Object.keys(le).forEach((function(e,t){M.push({key:t,scheme:le[e].name,vote:le[e].vote,ratio:le[e].vote/w.length})})),Z(M),T(O.sort((function(e,t){return e.time.localeCompare(t.time)}))),te(ce),P.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,i=o().utc(e.timestamp).local().format(),l=e.data.quantity,c=e.transaction_id,u=1;u<B.length;u++)if(B[u].test(a)){le["scheme".concat(u)].vote+=1,D.push({key:t,account:n,liqBalance:r,liqSym:s,time:i,quantity:l,scheme:le["scheme".concat(u)].name,memo:a,txid:c});break}})),I(D.sort((function(e,t){return e.time.localeCompare(t.time)}))),me=0,M.forEach((function(e){e.vote>me&&(me=e.vote,pe=e)})),O.forEach((function(e){e.scheme===pe.scheme?_.push(e):A.push(e)})),R(_.sort((function(e,t){return e.time.localeCompare(t.time)}))),L(A.sort((function(e,t){return e.time.localeCompare(t.time)}))),Y(!1),t.next=94;break;case 90:t.prev=90,t.t1=t.catch(0),Y(!1),(0,b.Tv)(t.t1,n);case 94:case"end":return t.stop()}}),t,null,[[0,90]])})));return function(e,a){return t.apply(this,arguments)}}(),[de,n,k,h,j,e.params]),ye={data:q,xField:"scheme",yField:"vote",meta:{vote:{alias:"票数"}},label:{},color:function(){return"#5B8FF9"},minColumnWidth:30,maxColumnWidth:30},be=(0,u.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,a){return(0,v.jsx)("span",{children:a+1})}},{title:"账号",dataIndex:"account",key:"account",sorter:function(e,t){return e.account.localeCompare(t.account)},render:function(e,t){return(0,v.jsx)("a",{onClick:function(){return i("/query/account?search=".concat(t.account,"&tab=info"))},children:t.account})}},{title:"JIU/DFS矿池做市",dataIndex:"liqBalance",key:"liqBalance",sorter:function(e,t){return t.liqBalance-e.liqBalance},render:function(e,t){return(0,v.jsx)("span",{children:(0,b.CE)(t.liqBalance.toFixed(0))+" "+t.liqSym})}},{title:"转账数量",dataIndex:"quantity",key:"quantity",sorter:function(e,t){return Number(t.quantity.split(" ")[0])-Number(e.quantity.split(" ")[0])},render:function(e,t){var a=Number(t.quantity.split(" ")[0]),n=t.quantity.split(" ")[1];return(0,v.jsx)("span",{children:(0,b.CE)(a.toFixed(0))+" "+n})}},{title:"转账时间",dataIndex:"time",key:"time",sorter:function(e,t){return t.time.localeCompare(e.time)},render:function(e,t){return(0,v.jsx)("span",{children:t.time})}},{title:"投票方案",dataIndex:"scheme",key:"scheme",sorter:function(e,t){return e.scheme.localeCompare(t.scheme)},filters:$.map((function(e){return{text:e,value:e}})),onFilter:function(e,t){return e===t.scheme},render:function(e,t){return(0,v.jsx)("span",{children:t.scheme})}},{title:"原始数据",dataIndex:"memo",key:"memo",render:function(e,t){return(0,v.jsx)("span",{children:t.memo})}},{title:"交易id",dataIndex:"txid",key:"txid",render:function(e,t){return(0,v.jsx)("a",{onClick:function(){return i("/query/transaction?search=".concat(t.txid,"&tab=summary"))},children:t.txid.slice(0,8)})}}]}),[$]),ke=(0,u.useMemo)((function(){return[{title:"方案",dataIndex:"scheme",key:"scheme",width:"auto",render:function(e,t){return(0,v.jsx)("span",{children:t.scheme})}},{title:"票数",dataIndex:"vote",key:"vote",width:"auto",render:function(e,t){return(0,v.jsx)("span",{children:t.vote})}},{title:"得票率",dataIndex:"ratio",width:"auto",key:"ratio",render:function(e,t){return(0,v.jsxs)("span",{children:[(100*t.ratio).toFixed(2),"%"]})}}]}),[]),je=(0,u.useCallback)((function(){var t=function(t){var a=0,n=0,r=t.map((function(e,t){var r=Number(e.quantity.split(" ")[0]),s=e.quantity.split(" ")[1];return a+=e.liqBalance,n+=r,{"#":t+1,"账号":e.account,"JIU/DFS矿池做市":(0,b.CE)(e.liqBalance.toFixed(0))+" "+e.liqSym,"转账数量":(0,b.CE)(r.toFixed(0))+" "+s,"转账时间":e.time,"投票方案":e.scheme,"原始数据":e.memo,"交易id":e.txid}}));return r.push({"#":0,"账号":"汇总","JIU/DFS矿池做市":(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym,"转账数量":(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym,"转账时间":"","投票方案":"","原始数据":"","交易id":""}),r},a=function(e){return e.map((function(e){return e.title}))},n=0,r=q.map((function(e){return n+=e.vote,{"方案":e.scheme,"票数":e.vote,"得票率":(100*e.ratio).toFixed(2)+"%"}}));r.push({"方案":"汇总","票数":n,"得票率":"100%"});var s={};s.fileName="活动".concat(S,"数据汇总"),s.datas=[{sheetData:r,sheetName:"投票结果",sheetFilter:["方案","票数","得票率"],sheetHeader:["方案","票数","得票率"]},{sheetData:t(F),sheetName:"有效投票详情",sheetFilter:a(be),sheetHeader:a(be)},{sheetData:t(P),sheetName:"无效投票详情",sheetFilter:a(be),sheetHeader:a(be)},{sheetData:t(D),sheetName:"获奖用户",sheetFilter:a(be),sheetHeader:a(be)},{sheetData:t(U),sheetName:"非获奖用户",sheetFilter:a(be),sheetHeader:a(be)}],new(xe())(s).saveExcel()}),[e.params,S,be,F,P,D,U,q]);return(0,u.useEffect)((function(){p&&m&&!l.current&&(l.current=!0,Y(!0),he(p,m))}),[he,m,p]),(0,v.jsxs)("div",{className:"result1",children:[(0,v.jsx)(s.ZP,{type:"primary",className:"mt-3 ml-3",onClick:je,children:"导出数据"}),(0,v.jsxs)(le.Z,{className:"mb-4",title:(0,v.jsx)("span",{className:" text-lg font-semibold",children:"投票结果"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:[(0,v.jsx)(ue.Z,{size:"large",spinning:W,tip:re,children:(0,v.jsx)(oe,G()(G()({},ye),{},{loading:W}))}),(0,v.jsx)(ce.Z,{className:"mt-4 summary",scroll:{x:!0},size:"small",columns:ke,dataSource:q,defaultData:[],loading:{spinning:W,tip:re},search:!1,options:!1,pagination:!1,summary:function(e){var t=0;return e.forEach((function(e){t+=e.vote})),(0,v.jsxs)(me.Z.Summary.Row,{children:[(0,v.jsx)(me.Z.Summary.Cell,{index:0,children:(0,v.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,v.jsx)(me.Z.Summary.Cell,{index:1,children:(0,v.jsx)("span",{className:"font-bold",children:t})}),(0,v.jsx)(me.Z.Summary.Cell,{index:2,children:(0,v.jsx)("span",{className:"font-bold",children:"100%"})})]})}})]}),(0,v.jsx)(le.Z,{className:"mb-4",title:(0,v.jsx)("span",{className:" text-lg font-semibold",children:"有效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"0"},children:(0,v.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:F,defaultData:[],loading:{spinning:W,tip:re},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0])})),(0,v.jsxs)(me.Z.Summary.Row,{children:[(0,v.jsx)(me.Z.Summary.Cell,{index:0}),(0,v.jsx)(me.Z.Summary.Cell,{index:1,children:(0,v.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,v.jsx)(me.Z.Summary.Cell,{index:2,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:3,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:4}),(0,v.jsx)(me.Z.Summary.Cell,{index:5}),(0,v.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),(0,v.jsx)(le.Z,{className:"mb-4",title:(0,v.jsx)("span",{className:" text-lg font-semibold",children:"无效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,v.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:P,defaultData:[],loading:{spinning:W,tip:re},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0])})),(0,v.jsxs)(me.Z.Summary.Row,{children:[(0,v.jsx)(me.Z.Summary.Cell,{index:0}),(0,v.jsx)(me.Z.Summary.Cell,{index:1,children:(0,v.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,v.jsx)(me.Z.Summary.Cell,{index:2,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:3,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:4}),(0,v.jsx)(me.Z.Summary.Cell,{index:5}),(0,v.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),(0,v.jsx)(le.Z,{className:"mb-4",title:(0,v.jsx)("span",{className:" text-lg font-semibold",children:"获奖用户"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,v.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:D,defaultData:[],loading:{spinning:W,tip:re},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0])})),(0,v.jsxs)(me.Z.Summary.Row,{children:[(0,v.jsx)(me.Z.Summary.Cell,{index:0}),(0,v.jsx)(me.Z.Summary.Cell,{index:1,children:(0,v.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,v.jsx)(me.Z.Summary.Cell,{index:2,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:3,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:4}),(0,v.jsx)(me.Z.Summary.Cell,{index:5}),(0,v.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),(0,v.jsx)(le.Z,{className:"mb-4",title:(0,v.jsx)("span",{className:" text-lg font-semibold",children:"非获奖用户"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,v.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:U,defaultData:[],loading:{spinning:W,tip:re},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0])})),(0,v.jsxs)(me.Z.Summary.Row,{children:[(0,v.jsx)(me.Z.Summary.Cell,{index:0}),(0,v.jsx)(me.Z.Summary.Cell,{index:1,children:(0,v.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,v.jsx)(me.Z.Summary.Cell,{index:2,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:3,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:4}),(0,v.jsx)(me.Z.Summary.Cell,{index:5}),(0,v.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),r]})},be=(0,u.memo)(ye);o().extend(c());var ke=function(e){var t=K.ZP.useMessage(),a=x()(t,2),n=a[0],r=a[1],i=(0,H.useNavigate)(),l=(0,u.useRef)(!1),c=(0,H.useDispatch)(),m=(0,H.useSelector)((function(e){return e.global.contractKit})),p=(0,H.useSelector)((function(e){return e.global.session})),h=(0,H.useSelector)((function(e){return e.jiu.liqsCache})),k=(0,H.useSelector)((function(e){return e.jiu.assetsCache})),j=(0,H.useSelector)((function(e){return e.jiu.activeKey})),S=(0,H.useSelector)((function(e){return e.account.markets})),g=(0,u.useState)([]),C=x()(g,2),q=C[0],Z=C[1],N=(0,u.useState)([]),B=x()(N,2),F=B[0],T=B[1],E=(0,u.useState)([]),w=x()(E,2),P=w[0],I=w[1],M=(0,u.useState)([]),O=x()(M,2),D=O[0],R=O[1],_=(0,u.useState)([]),A=x()(_,2),U=A[0],L=A[1],z=(0,u.useState)(!1),J=x()(z,2),W=J[0],Y=J[1],Q=(0,u.useState)([]),V=x()(Q,2),$=V[0],te=V[1],ae=(0,u.useState)(""),ne=x()(ae,2),re=ne[0],se=ne[1],ie=(0,H.useIntl)().formatMessage({id:"jiu.intlMissingData"}),de=(0,u.useCallback)(function(){var e=f()(d()().mark((function e(t){var a,r,s,i,l,c,u,m,p,f,h,y,k,j,S,g,C,v,q,Z,N,B,F,T,E,w,P,I,M;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="jiutothemoon",r="000d9cae502dd1cc895745e204f83cc892bc4c450f92a03ecd4fe057709853cc",s=(0,fe.js)("md5"),i=r+a,s.update(i),l=s.digest("hex").substring(0,8),c={key:l,chainId:r,account:a,skip:0,lastUpdate:"2020-01-01T01:01:01.000Z",error:!1,data:[]},e.next=9,ee.db.txList.where({key:l}).toArray();case 9:if((u=e.sent).length&&(c=u[0]),!(t&&o().utc(c.lastUpdate).valueOf()>o().utc(t).valueOf())){e.next=13;break}return e.abrupt("return",c.data);case 13:m=[],p=500,f=c.lastUpdate,h=c.skip;case 17:return e.next=20,(0,b.zI)(pe().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&sort=asc&simple=true&noBinary=true&account=".concat(a,"&after=").concat(f,"&limit=").concat(p)));case 20:if(y=e.sent,k=x()(y,2),j=k[0],S=k[1],j||200!==S.status){e.next=73;break}if(g=S.data.simple_actions,C=g.length,v=S.data.total.value,q=1,0!==v){e.next=32;break}return ee.db.txList.put(c),e.abrupt("return",c.data);case 32:for(Z=0;Z<g.length;Z++)h<=Z&&m.push(g[Z]);if(m.length){e.next=36;break}return c.error&&n.error(ie),e.abrupt("return",c.data);case 36:N=m.length-1;case 37:if(!(N>0)){e.next=46;break}if(m[N].transaction_id!==m[N-1].transaction_id){e.next=42;break}q+=1,e.next=43;break;case 42:return e.abrupt("break",46);case 43:N--,e.next=37;break;case 46:if(h=q,C!==p){e.next=58;break}if(B=m[m.length-1].timestamp,f=B,!(t&&o().utc(B).valueOf()>o().utc(t).valueOf())){e.next=56;break}return m.forEach((function(e){c.data.push(e)})),c.lastUpdate=B,c.skip=h,ee.db.txList.put(c),e.abrupt("return",c.data);case 56:e.next=71;break;case 58:return m.forEach((function(e){c.data.push(e)})),F=m[m.length-1].timestamp,c.lastUpdate=F,c.skip=h,e.next=64,(0,b.zI)(pe().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&simple=true&noBinary=true&account=".concat(a,"&skip=0&limit=1")));case 64:return T=e.sent,E=x()(T,2),w=E[0],P=E[1],w||200!==P.status?n.error(w):(I=P.data.total.value,c.data.length!==I?(c.error=!0,n.error(ie)):c.error=!1),ee.db.txList.put(c),e.abrupt("return",c.data);case 71:e.next=77;break;case 73:return m.length&&(m.forEach((function(e){c.data.push(e)})),M=m[m.length-1].timestamp,c.lastUpdate=M,c.skip=h,c.error=!0),ee.db.txList.put(c),n.error(j),e.abrupt("return",c.data);case 77:e.next=17;break;case 79:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n]),he=(0,u.useCallback)(function(){var t=f()(d()().mark((function t(a,r){var s,i,l,u,m,p,f,x,j,g,C,v,q,N,B,F,E,w,P,M,O,D,_,A,U,z,H,J,K,W,Q,V,$,ee,ae,ne,re,ie,oe,le,ce,ue,me,pe;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s=e.params.startTime,i=e.params.endTime,l=e.params.receiveAccount,u=e.params.transferTokenContract,m=e.params.transferTokenMinAmount,p=e.params.transferTokenSym,f=e.params.liqMid,x=e.params.liqTokenKey,j=e.params.liqSym,g=e.params.liqTokenMinAmount,C=e.params.ruleType,v="",0,q="",N=0,2===C&&(v=e.params.holdTokenContract,e.params.holdTokenMinAmount,q=e.params.holdTokenSym,N=e.params.allTokenMinAmount),B=e.params.schemesRegexp,F=[],E={},w=[],P=[],M=[],O=[],D=[],_=[],A=[],t.next=29,de(i);case 29:U=t.sent,z=0;case 31:if(!(z<U.length)){t.next=41;break}if(H=o().utc(s).valueOf(),J=o().utc(i).valueOf(),K=o().utc(U[z].timestamp).valueOf(),H<=K&&K<=J&&U[z].contract===u&&"transfer"===U[z].action&&U[z].data.symbol===p&&U[z].data.to===l&&"dfsminingout"!==U[z].data.from&&"swapswapswap"!==U[z].data.from&&""!==U[z].data.memo.trim()&&F.push(U[z]),!(K>J)){t.next=38;break}return t.abrupt("break",41);case 38:z++,t.next=31;break;case 41:if(F.forEach((function(e){var t=e.data.from,a=e.data.memo.trim(),n=e.data.amount;E.hasOwnProperty(t)?n>=m&&B[0].test(a)&&(E[t]=e):B[0].test(a)&&(E[t]=e)})),W=[],!S||!S.length){t.next=47;break}W=S,t.next=55;break;case 47:return t.next=49,r.load("swapswapswap");case 49:return Q=t.sent,V=Q.table("markets"),t.next=53,V.all();case 53:W=t.sent,c(y.N.setMarkets(W));case 55:return t.next=57,r.load("loglogloglog");case 57:$=t.sent,ee=$.table("liqs"),ae=Object.keys(E),ne={},re={},ie=d()().mark((function e(){var t,n,r,s,i,o,l,c,u,m,p,y;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(se("".concat(oe+1," / ").concat(ae.length)),t=0,n=j,r=[],!h.hasOwnProperty(ae[oe])){e.next=8;break}r=h[ae[oe]],e.next=12;break;case 8:return e.next=10,ee.all({scope:ae[oe]});case 10:r=e.sent,ne[ae[oe]]=r;case 12:if((s=r.find((function(e){return e.mid.toNumber()===f})))&&(i=W.find((function(e){return e.mid.equals(s.mid)})),o=s.token.toNumber()/i.liquidity_token.toNumber(),l=o*i.reserve0.value,c=o*i.reserve1.value,u=i.reserve0.symbol.name,m=i.reserve1.symbol.name,0===x?(t=l,n=u):(t=c,n=m)),E[ae[oe]].liqBalance=t,E[ae[oe]].liqSym=n,p=0,y=[],2!==C){e.next=29;break}if(!k.hasOwnProperty(ae[oe])){e.next=23;break}y=k[ae[oe]],e.next=27;break;case 23:return e.next=25,a.client.v1.chain.get_currency_balance(v,ae[oe],q);case 25:y=e.sent,re[ae[oe]]=y;case 27:y.length&&(p=y[0].value),E[ae[oe]].holdBalance=p;case 29:case"end":return e.stop()}}),e)})),oe=0;case 64:if(!(oe<ae.length)){t.next=69;break}return t.delegateYield(ie(),"t0",66);case 66:oe++,t.next=64;break;case 69:for(Object.keys(ne).length&&c(X.N.setLiqsCache(G()(G()({},h),ne))),Object.keys(re).length&&c(X.N.setAssetsCache(G()(G()({},k),re))),1===C?ae.forEach((function(e){var t=E[e].liqBalance;E[e].data.amount>=m&&t>=g?w.push(E[e]):P.push(E[e])})):2===C&&ae.forEach((function(e){var t=E[e].liqBalance+E[e].holdBalance;E[e].data.amount>=m&&t>=N?w.push(E[e]):P.push(E[e])})),le={},ce=[],ue=1;ue<B.length;ue++)le["scheme".concat(ue)]={vote:0,name:"方案".concat(ue)},ce.push("方案".concat(ue));w.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,i=o().utc(e.timestamp).local().format(),l=e.data.quantity,c=e.transaction_id,u=e.holdBalance,m=r+u,d=1;d<B.length;d++)if(B[d].test(a)){le["scheme".concat(d)].vote+=1,O.push({key:t,account:n,liqBalance:r,liqSym:s,time:i,quantity:l,scheme:le["scheme".concat(d)].name,memo:a,txid:c,holdBalance:u,holdTokenSym:q,allBalance:m});break}})),Object.keys(le).forEach((function(e,t){M.push({key:t,scheme:le[e].name,vote:le[e].vote,ratio:le[e].vote/w.length})})),Z(M),T(O.sort((function(e,t){return e.time.localeCompare(t.time)}))),te(ce),P.forEach((function(e,t){for(var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,i=o().utc(e.timestamp).local().format(),l=e.data.quantity,c=e.transaction_id,u=e.holdBalance,m=r+u,d=1;d<B.length;d++)if(B[d].test(a)){le["scheme".concat(d)].vote+=1,D.push({key:t,account:n,liqBalance:r,liqSym:s,time:i,quantity:l,scheme:le["scheme".concat(d)].name,memo:a,txid:c,holdBalance:u,holdTokenSym:q,allBalance:m});break}})),I(D.sort((function(e,t){return e.time.localeCompare(t.time)}))),me=0,M.forEach((function(e){e.vote>me&&(me=e.vote,pe=e)})),O.forEach((function(e){e.scheme===pe.scheme?_.push(e):A.push(e)})),R(_.sort((function(e,t){return e.time.localeCompare(t.time)}))),L(A.sort((function(e,t){return e.time.localeCompare(t.time)}))),Y(!1),t.next=94;break;case 90:t.prev=90,t.t1=t.catch(0),Y(!1),(0,b.Tv)(t.t1,n);case 94:case"end":return t.stop()}}),t,null,[[0,90]])})));return function(e,a){return t.apply(this,arguments)}}(),[de,n,k,h,S,e.params]),ye={data:q,xField:"scheme",yField:"vote",meta:{vote:{alias:"票数"}},label:{},color:function(){return"#5B8FF9"},minColumnWidth:30,maxColumnWidth:30},be=(0,u.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,a){return(0,v.jsx)("span",{children:a+1})}},{title:"账号",dataIndex:"account",key:"account",sorter:function(e,t){return e.account.localeCompare(t.account)},render:function(e,t){return(0,v.jsx)("a",{onClick:function(){return i("/query/account?search=".concat(t.account,"&tab=info"))},children:t.account})}},{title:"JIU/DFS矿池做市",dataIndex:"liqBalance",key:"liqBalance",sorter:function(e,t){return t.liqBalance-e.liqBalance},render:function(e,t){return(0,v.jsx)("span",{children:(0,b.CE)(t.liqBalance.toFixed(0))+" "+t.liqSym})}},{title:"".concat(e.params.holdTokenSym,"账号余额"),dataIndex:"holdBalance",key:"holdBalance",sorter:function(e,t){return t.holdBalance-e.holdBalance},render:function(e,t){return(0,v.jsx)("span",{children:(0,b.CE)(t.holdBalance.toFixed(0))+" "+t.holdTokenSym})}},{title:"做市+持有",dataIndex:"allBalance",key:"allBalance",sorter:function(e,t){return t.allBalance-e.allBalance},render:function(e,t){return(0,v.jsx)("span",{children:(0,b.CE)(t.allBalance.toFixed(0))+" "+t.holdTokenSym})}},{title:"转账数量",dataIndex:"quantity",key:"quantity",sorter:function(e,t){return Number(t.quantity.split(" ")[0])-Number(e.quantity.split(" ")[0])},render:function(e,t){var a=Number(t.quantity.split(" ")[0]),n=t.quantity.split(" ")[1];return(0,v.jsx)("span",{children:(0,b.CE)(a.toFixed(0))+" "+n})}},{title:"转账时间",dataIndex:"time",key:"time",sorter:function(e,t){return t.time.localeCompare(e.time)},render:function(e,t){return(0,v.jsx)("span",{children:t.time})}},{title:"投票方案",dataIndex:"scheme",key:"scheme",sorter:function(e,t){return e.scheme.localeCompare(t.scheme)},filters:$.map((function(e){return{text:e,value:e}})),onFilter:function(e,t){return e===t.scheme},render:function(e,t){return(0,v.jsx)("span",{children:t.scheme})}},{title:"原始数据",dataIndex:"memo",key:"memo",render:function(e,t){return(0,v.jsx)("span",{children:t.memo})}},{title:"交易id",dataIndex:"txid",key:"txid",render:function(e,t){return(0,v.jsx)("a",{onClick:function(){return i("/query/transaction?search=".concat(t.txid,"&tab=summary"))},children:t.txid.slice(0,8)})}}]}),[$,e.params]),ke=(0,u.useMemo)((function(){return[{title:"方案",dataIndex:"scheme",key:"scheme",width:"auto",render:function(e,t){return(0,v.jsx)("span",{children:t.scheme})}},{title:"票数",dataIndex:"vote",key:"vote",width:"auto",render:function(e,t){return(0,v.jsx)("span",{children:t.vote})}},{title:"得票率",dataIndex:"ratio",width:"auto",key:"ratio",render:function(e,t){return(0,v.jsxs)("span",{children:[(100*t.ratio).toFixed(2),"%"]})}}]}),[]),je=(0,u.useCallback)((function(){var t=function(t){var a=0,n=0,r=0,s=0,i=t.map((function(e,t){var s=Number(e.quantity.split(" ")[0]),i=e.quantity.split(" ")[1];return a+=e.liqBalance,n+=s,r+=e.holdBalance,{"#":t+1,"账号":e.account,"JIU/DFS矿池做市":(0,b.CE)(e.liqBalance.toFixed(0))+" "+e.liqSym,"JIU账号余额":(0,b.CE)(e.holdBalance.toFixed(0))+" "+e.holdTokenSym,"做市+持有":(0,b.CE)(e.allBalance.toFixed(0))+" "+e.holdTokenSym,"转账数量":(0,b.CE)(s.toFixed(0))+" "+i,"转账时间":e.time,"投票方案":e.scheme,"原始数据":e.memo,"交易id":e.txid}}));return s=a+r,i.push({"#":0,"账号":"汇总","JIU/DFS矿池做市":(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym,"JIU账号余额":(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym,"做市+持有":(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym,"转账数量":(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym,"转账时间":"","投票方案":"","原始数据":"","交易id":""}),i},a=function(e){return e.map((function(e){return e.title}))},n=0,r=q.map((function(e){return n+=e.vote,{"方案":e.scheme,"票数":e.vote,"得票率":(100*e.ratio).toFixed(2)+"%"}}));r.push({"方案":"汇总","票数":n,"得票率":"100%"});var s={};s.fileName="活动".concat(j,"数据汇总"),s.datas=[{sheetData:r,sheetName:"投票结果",sheetFilter:["方案","票数","得票率"],sheetHeader:["方案","票数","得票率"]},{sheetData:t(F),sheetName:"有效投票详情",sheetFilter:a(be),sheetHeader:a(be)},{sheetData:t(P),sheetName:"无效投票详情",sheetFilter:a(be),sheetHeader:a(be)},{sheetData:t(D),sheetName:"获奖用户",sheetFilter:a(be),sheetHeader:a(be)},{sheetData:t(U),sheetName:"非获奖用户",sheetFilter:a(be),sheetHeader:a(be)}],new(xe())(s).saveExcel()}),[e.params,j,be,F,P,D,U,q]);return(0,u.useEffect)((function(){p&&m&&!l.current&&(l.current=!0,Y(!0),he(p,m))}),[he,m,p]),(0,v.jsxs)("div",{className:"result2",children:[(0,v.jsx)(s.ZP,{type:"primary",className:"mt-3 ml-3",onClick:je,children:"导出数据"}),(0,v.jsxs)(le.Z,{className:"mb-4",title:(0,v.jsx)("span",{className:" text-lg font-semibold",children:"投票结果"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:[(0,v.jsx)(ue.Z,{size:"large",spinning:W,tip:re,children:(0,v.jsx)(oe,G()(G()({},ye),{},{loading:W}))}),(0,v.jsx)(ce.Z,{className:"mt-4 summary",scroll:{x:!0},size:"small",columns:ke,dataSource:q,defaultData:[],loading:{spinning:W,tip:re},search:!1,options:!1,pagination:!1,summary:function(e){var t=0;return e.forEach((function(e){t+=e.vote})),(0,v.jsxs)(me.Z.Summary.Row,{children:[(0,v.jsx)(me.Z.Summary.Cell,{index:0,children:(0,v.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,v.jsx)(me.Z.Summary.Cell,{index:1,children:(0,v.jsx)("span",{className:"font-bold",children:t})}),(0,v.jsx)(me.Z.Summary.Cell,{index:2,children:(0,v.jsx)("span",{className:"font-bold",children:"100%"})})]})}})]}),(0,v.jsx)(le.Z,{className:"mb-4",title:(0,v.jsx)("span",{className:" text-lg font-semibold",children:"有效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,v.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:F,defaultData:[],loading:{spinning:W,tip:re},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0,r=0,s=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0]),r+=e.holdBalance,s+=e.allBalance})),(0,v.jsxs)(me.Z.Summary.Row,{children:[(0,v.jsx)(me.Z.Summary.Cell,{index:0}),(0,v.jsx)(me.Z.Summary.Cell,{index:1,children:(0,v.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,v.jsx)(me.Z.Summary.Cell,{index:2,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:3,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:4,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:5,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),(0,v.jsx)(le.Z,{className:"mb-4",title:(0,v.jsx)("span",{className:" text-lg font-semibold",children:"无效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,v.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:P,defaultData:[],loading:{spinning:W,tip:re},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0,r=0,s=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0]),r+=e.holdBalance,s+=e.allBalance})),(0,v.jsxs)(me.Z.Summary.Row,{children:[(0,v.jsx)(me.Z.Summary.Cell,{index:0}),(0,v.jsx)(me.Z.Summary.Cell,{index:1,children:(0,v.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,v.jsx)(me.Z.Summary.Cell,{index:2,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:3,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:4,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:5,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),(0,v.jsx)(le.Z,{className:"mb-4",title:(0,v.jsx)("span",{className:" text-lg font-semibold",children:"获奖用户"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,v.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:D,defaultData:[],loading:{spinning:W,tip:re},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0,r=0,s=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0]),r+=e.holdBalance,s+=e.allBalance})),(0,v.jsxs)(me.Z.Summary.Row,{children:[(0,v.jsx)(me.Z.Summary.Cell,{index:0}),(0,v.jsx)(me.Z.Summary.Cell,{index:1,children:(0,v.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,v.jsx)(me.Z.Summary.Cell,{index:2,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:3,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:4,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:5,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),(0,v.jsx)(le.Z,{className:"mb-4",title:(0,v.jsx)("span",{className:" text-lg font-semibold",children:"非获奖用户"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,v.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:be,dataSource:U,defaultData:[],loading:{spinning:W,tip:re},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0,r=0,s=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0]),r+=e.holdBalance,s+=e.allBalance})),(0,v.jsxs)(me.Z.Summary.Row,{children:[(0,v.jsx)(me.Z.Summary.Cell,{index:0}),(0,v.jsx)(me.Z.Summary.Cell,{index:1,children:(0,v.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,v.jsx)(me.Z.Summary.Cell,{index:2,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:3,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:4,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:5,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),r]})},je=(0,u.memo)(ke);o().extend(c());var Se=function(e){var t=K.ZP.useMessage(),a=x()(t,2),n=a[0],r=a[1],i=(0,H.useNavigate)(),l=(0,u.useRef)(!1),c=(0,H.useDispatch)(),m=(0,H.useSelector)((function(e){return e.global.contractKit})),p=(0,H.useSelector)((function(e){return e.global.session})),h=(0,H.useSelector)((function(e){return e.jiu.liqsCache})),k=(0,H.useSelector)((function(e){return e.jiu.assetsCache})),j=(0,H.useSelector)((function(e){return e.jiu.activeKey})),S=(0,H.useSelector)((function(e){return e.account.markets})),g=(0,u.useState)([]),C=x()(g,2),q=C[0],Z=C[1],N=(0,u.useState)([]),B=x()(N,2),F=B[0],T=B[1],E=(0,u.useState)(!1),w=x()(E,2),P=w[0],I=w[1],M=(0,u.useState)(""),O=x()(M,2),D=O[0],R=O[1],_=(0,H.useIntl)().formatMessage({id:"jiu.intlMissingData"}),A=(0,u.useCallback)(function(){var e=f()(d()().mark((function e(t){var a,r,s,i,l,c,u,m,p,f,h,y,k,j,S,g,C,v,q,Z,N,B,F,T,E,w,P,I,M;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="jiutothemoon",r="000d9cae502dd1cc895745e204f83cc892bc4c450f92a03ecd4fe057709853cc",s=(0,fe.js)("md5"),i=r+a,s.update(i),l=s.digest("hex").substring(0,8),c={key:l,chainId:r,account:a,skip:0,lastUpdate:"2020-01-01T01:01:01.000Z",error:!1,data:[]},e.next=9,ee.db.txList.where({key:l}).toArray();case 9:if((u=e.sent).length&&(c=u[0]),!(t&&o().utc(c.lastUpdate).valueOf()>o().utc(t).valueOf())){e.next=13;break}return e.abrupt("return",c.data);case 13:m=[],p=500,f=c.lastUpdate,h=c.skip;case 17:return e.next=20,(0,b.zI)(pe().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&sort=asc&simple=true&noBinary=true&account=".concat(a,"&after=").concat(f,"&limit=").concat(p)));case 20:if(y=e.sent,k=x()(y,2),j=k[0],S=k[1],j||200!==S.status){e.next=73;break}if(g=S.data.simple_actions,C=g.length,v=S.data.total.value,q=1,0!==v){e.next=32;break}return ee.db.txList.put(c),e.abrupt("return",c.data);case 32:for(Z=0;Z<g.length;Z++)h<=Z&&m.push(g[Z]);if(m.length){e.next=36;break}return c.error&&n.error(_),e.abrupt("return",c.data);case 36:N=m.length-1;case 37:if(!(N>0)){e.next=46;break}if(m[N].transaction_id!==m[N-1].transaction_id){e.next=42;break}q+=1,e.next=43;break;case 42:return e.abrupt("break",46);case 43:N--,e.next=37;break;case 46:if(h=q,C!==p){e.next=58;break}if(B=m[m.length-1].timestamp,f=B,!(t&&o().utc(B).valueOf()>o().utc(t).valueOf())){e.next=56;break}return m.forEach((function(e){c.data.push(e)})),c.lastUpdate=B,c.skip=h,ee.db.txList.put(c),e.abrupt("return",c.data);case 56:e.next=71;break;case 58:return m.forEach((function(e){c.data.push(e)})),F=m[m.length-1].timestamp,c.lastUpdate=F,c.skip=h,e.next=64,(0,b.zI)(pe().get("https://api2.dfsmoon.com/v2/history/get_actions?track=true&simple=true&noBinary=true&account=".concat(a,"&skip=0&limit=1")));case 64:return T=e.sent,E=x()(T,2),w=E[0],P=E[1],w||200!==P.status?n.error(w):(I=P.data.total.value,c.data.length!==I?(c.error=!0,n.error(_)):c.error=!1),ee.db.txList.put(c),e.abrupt("return",c.data);case 71:e.next=77;break;case 73:return m.length&&(m.forEach((function(e){c.data.push(e)})),M=m[m.length-1].timestamp,c.lastUpdate=M,c.skip=h,c.error=!0),ee.db.txList.put(c),n.error(j),e.abrupt("return",c.data);case 77:e.next=17;break;case 79:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n]),U=(0,u.useCallback)(function(){var t=f()(d()().mark((function t(a,r){var s,i,l,u,m,p,f,x,j,g,C,v,q,N,B,F,E,w,P,M,O,D,_,U,L,z,H,J,K,W,Y,Q,V,$,ee,te;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s=e.params.startTime,i=e.params.endTime,l=e.params.receiveAccount,u=e.params.transferTokenContract,m=e.params.transferTokenMinAmount,p=e.params.transferTokenSym,f=e.params.liqMid,x=e.params.liqTokenKey,j=e.params.liqSym,g=e.params.liqTokenMinAmount,C=e.params.ruleType,v="",0,q="",N=0,2===C&&(v=e.params.holdTokenContract,e.params.holdTokenMinAmount,q=e.params.holdTokenSym,N=e.params.allTokenMinAmount),B=e.params.pattern,F=[],E={},w=[],P=[],M=[],O=[],t.next=26,A(i);case 26:D=t.sent,_=0;case 28:if(!(_<D.length)){t.next=38;break}if(U=o().utc(s).valueOf(),L=o().utc(i).valueOf(),z=o().utc(D[_].timestamp).valueOf(),U<=z&&z<=L&&D[_].contract===u&&"transfer"===D[_].action&&D[_].data.symbol===p&&D[_].data.to===l&&"dfsminingout"!==D[_].data.from&&"swapswapswap"!==D[_].data.from&&""!==D[_].data.memo.trim()&&F.push(D[_]),!(z>L)){t.next=35;break}return t.abrupt("break",38);case 35:_++,t.next=28;break;case 38:if(F.forEach((function(e){var t=e.data.from,a=e.data.memo.trim(),n=e.data.amount;E.hasOwnProperty(t)?n>=m&&B.test(a)&&(E[t]=e):B.test(a)&&(E[t]=e)})),H=[],!S||!S.length){t.next=44;break}H=S,t.next=52;break;case 44:return t.next=46,r.load("swapswapswap");case 46:return J=t.sent,K=J.table("markets"),t.next=50,K.all();case 50:H=t.sent,c(y.N.setMarkets(H));case 52:return t.next=54,r.load("loglogloglog");case 54:W=t.sent,Y=W.table("liqs"),Q=Object.keys(E),V={},$={},ee=d()().mark((function e(){var t,n,r,s,i,o,l,c,u,m,p,y;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(R("".concat(te+1," / ").concat(Q.length)),t=0,n=j,r=[],!h.hasOwnProperty(Q[te])){e.next=8;break}r=h[Q[te]],e.next=12;break;case 8:return e.next=10,Y.all({scope:Q[te]});case 10:r=e.sent,V[Q[te]]=r;case 12:if((s=r.find((function(e){return e.mid.toNumber()===f})))&&(i=H.find((function(e){return e.mid.equals(s.mid)})),o=s.token.toNumber()/i.liquidity_token.toNumber(),l=o*i.reserve0.value,c=o*i.reserve1.value,u=i.reserve0.symbol.name,m=i.reserve1.symbol.name,0===x?(t=l,n=u):(t=c,n=m)),E[Q[te]].liqBalance=t,E[Q[te]].liqSym=n,p=0,y=[],2!==C){e.next=29;break}if(!k.hasOwnProperty(Q[te])){e.next=23;break}y=k[Q[te]],e.next=27;break;case 23:return e.next=25,a.client.v1.chain.get_currency_balance(v,Q[te],q);case 25:y=e.sent,$[Q[te]]=y;case 27:y.length&&(p=y[0].value),E[Q[te]].holdBalance=p;case 29:case"end":return e.stop()}}),e)})),te=0;case 61:if(!(te<Q.length)){t.next=66;break}return t.delegateYield(ee(),"t0",63);case 63:te++,t.next=61;break;case 66:Object.keys(V).length&&c(X.N.setLiqsCache(G()(G()({},h),V))),Object.keys($).length&&c(X.N.setAssetsCache(G()(G()({},k),$))),1===C?Q.forEach((function(e){var t=E[e].liqBalance;E[e].data.amount>=m&&t>=g?w.push(E[e]):P.push(E[e])})):2===C&&Q.forEach((function(e){var t=E[e].liqBalance+E[e].holdBalance;E[e].data.amount>=m&&t>=N?w.push(E[e]):P.push(E[e])})),w.forEach((function(e,t){var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,i=o().utc(e.timestamp).local().format(),l=e.data.quantity,c=e.transaction_id,u=e.holdBalance,m=r+u,d=B.exec(a),p="";p=d?d[1]:a,M.push({key:t,account:n,liqBalance:r,liqSym:s,time:i,quantity:l,scheme:p,memo:a,txid:c,holdBalance:u,holdTokenSym:q,allBalance:m})})),Z(M.sort((function(e,t){return e.time.localeCompare(t.time)}))),P.forEach((function(e,t){var a=e.data.memo.trim(),n=e.data.from,r=e.liqBalance,s=e.liqSym,i=o().utc(e.timestamp).local().format(),l=e.data.quantity,c=e.transaction_id,u=e.holdBalance,m=r+u,d=B.exec(a),p="";p=d?d[1]:a,O.push({key:t,account:n,liqBalance:r,liqSym:s,time:i,quantity:l,scheme:p,memo:a,txid:c,holdBalance:u,holdTokenSym:q,allBalance:m})})),T(O.sort((function(e,t){return e.time.localeCompare(t.time)}))),I(!1),t.next=80;break;case 76:t.prev=76,t.t1=t.catch(0),I(!1),(0,b.Tv)(t.t1,n);case 80:case"end":return t.stop()}}),t,null,[[0,76]])})));return function(e,a){return t.apply(this,arguments)}}(),[A,n,k,h,S,e.params]),L=(0,u.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,a){return(0,v.jsx)("span",{children:a+1})}},{title:"账号",dataIndex:"account",key:"account",sorter:function(e,t){return e.account.localeCompare(t.account)},render:function(e,t){return(0,v.jsx)("a",{onClick:function(){return i("/query/account?search=".concat(t.account,"&tab=info"))},children:t.account})}},{title:"JIU/DFS矿池做市",dataIndex:"liqBalance",key:"liqBalance",sorter:function(e,t){return t.liqBalance-e.liqBalance},render:function(e,t){return(0,v.jsx)("span",{children:(0,b.CE)(t.liqBalance.toFixed(0))+" "+t.liqSym})}},{title:"".concat(e.params.holdTokenSym,"账号余额"),dataIndex:"holdBalance",key:"holdBalance",sorter:function(e,t){return t.holdBalance-e.holdBalance},render:function(e,t){return(0,v.jsx)("span",{children:(0,b.CE)(t.holdBalance.toFixed(0))+" "+t.holdTokenSym})}},{title:"做市+持有",dataIndex:"allBalance",key:"allBalance",sorter:function(e,t){return t.allBalance-e.allBalance},render:function(e,t){return(0,v.jsx)("span",{children:(0,b.CE)(t.allBalance.toFixed(0))+" "+t.holdTokenSym})}},{title:"转账数量",dataIndex:"quantity",key:"quantity",sorter:function(e,t){return Number(t.quantity.split(" ")[0])-Number(e.quantity.split(" ")[0])},render:function(e,t){var a=Number(t.quantity.split(" ")[0]),n=t.quantity.split(" ")[1];return(0,v.jsx)("span",{children:(0,b.CE)(a.toFixed(0))+" "+n})}},{title:"转账时间",dataIndex:"time",key:"time",sorter:function(e,t){return t.time.localeCompare(e.time)},render:function(e,t){return(0,v.jsx)("span",{children:t.time})}},{title:"预测时间",dataIndex:"scheme",key:"scheme",sorter:function(e,t){return Number(e.scheme)-Number(t.scheme)},render:function(e,t){return(0,v.jsx)("span",{children:t.scheme})}},{title:"原始数据",dataIndex:"memo",key:"memo",render:function(e,t){return(0,v.jsx)("span",{children:t.memo})}},{title:"交易id",dataIndex:"txid",key:"txid",render:function(e,t){return(0,v.jsx)("a",{onClick:function(){return i("/query/transaction?search=".concat(t.txid,"&tab=summary"))},children:t.txid.slice(0,8)})}}]}),[e.params]),z=(0,u.useCallback)((function(){var t=function(t){var a=0,n=0,r=0,s=0,i=t.map((function(e,t){var s=Number(e.quantity.split(" ")[0]),i=e.quantity.split(" ")[1];return a+=e.liqBalance,n+=s,r+=e.holdBalance,{"#":t+1,"账号":e.account,"JIU/DFS矿池做市":(0,b.CE)(e.liqBalance.toFixed(0))+" "+e.liqSym,"DFS账号余额":(0,b.CE)(e.holdBalance.toFixed(0))+" "+e.holdTokenSym,"做市+持有":(0,b.CE)(e.allBalance.toFixed(0))+" "+e.holdTokenSym,"转账数量":(0,b.CE)(s.toFixed(0))+" "+i,"转账时间":e.time,"预测时间":e.scheme,"原始数据":e.memo,"交易id":e.txid}}));return s=a+r,i.push({"#":0,"账号":"汇总","JIU/DFS矿池做市":(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym,"DFS账号余额":(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym,"做市+持有":(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym,"转账数量":(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym,"转账时间":"","预测时间":"","原始数据":"","交易id":""}),i},a=function(e){return e.map((function(e){return e.title}))},n={};n.fileName="活动".concat(j,"数据汇总"),n.datas=[{sheetData:t(q),sheetName:"有效预测详情",sheetFilter:a(L),sheetHeader:a(L)},{sheetData:t(F),sheetName:"无效预测详情",sheetFilter:a(L),sheetHeader:a(L)}],new(xe())(n).saveExcel()}),[e.params,j,L,q,F]);return(0,u.useEffect)((function(){p&&m&&!l.current&&(l.current=!0,I(!0),U(p,m))}),[U,m,p]),(0,v.jsxs)("div",{className:"result2",children:[(0,v.jsx)(s.ZP,{type:"primary",className:"mt-3 ml-3",onClick:z,children:"导出数据"}),(0,v.jsx)(le.Z,{className:"mb-4",title:(0,v.jsx)("span",{className:" text-lg font-semibold",children:"有效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,v.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:L,dataSource:q,defaultData:[],loading:{spinning:P,tip:D},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0,r=0,s=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0]),r+=e.holdBalance,s+=e.allBalance})),(0,v.jsxs)(me.Z.Summary.Row,{children:[(0,v.jsx)(me.Z.Summary.Cell,{index:0}),(0,v.jsx)(me.Z.Summary.Cell,{index:1,children:(0,v.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,v.jsx)(me.Z.Summary.Cell,{index:2,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:3,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:4,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:5,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),(0,v.jsx)(le.Z,{className:"mb-4",title:(0,v.jsx)("span",{className:" text-lg font-semibold",children:"无效投票详情"}),headStyle:{justifyContent:"center",marginBottom:"15px"},children:(0,v.jsx)(ce.Z,{scroll:{x:!0},size:"small",columns:L,dataSource:F,defaultData:[],loading:{spinning:P,tip:D},search:!1,options:!1,pagination:!1,summary:function(t){var a=0,n=0,r=0,s=0;return t.forEach((function(e){a+=e.liqBalance,n+=Number(e.quantity.split(" ")[0]),r+=e.holdBalance,s+=e.allBalance})),(0,v.jsxs)(me.Z.Summary.Row,{children:[(0,v.jsx)(me.Z.Summary.Cell,{index:0}),(0,v.jsx)(me.Z.Summary.Cell,{index:1,children:(0,v.jsx)("span",{className:"font-bold",children:"汇总"})}),(0,v.jsx)(me.Z.Summary.Cell,{index:2,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(a.toFixed(0))+" "+e.params.liqSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:3,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(r.toFixed(0))+" "+e.params.holdTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:4,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(s.toFixed(0))+" "+e.params.holdTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:5,children:(0,v.jsx)("span",{className:"font-bold",children:(0,b.CE)(n.toFixed(0))+" "+e.params.transferTokenSym})}),(0,v.jsx)(me.Z.Summary.Cell,{index:6})]})}})}),r]})},ge=(0,u.memo)(Se)}}]);