"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[909,98],{53238:function(e,t,n){n.d(t,{Z:function(){return i}});var r=n(11774),s=n(59530),o=n(22181),a=n(62435),c=n(86074),u=function(){var e=(0,s.useSelector)((function(e){return e.global.session})),t=e?e.chain.name:"DFS",n=(0,s.useIntl)().formatMessage({id:"app.intlNotSupportChain"},{chainName:t});return(0,c.jsx)(r._z,{ghost:!0,children:(0,c.jsx)(o.ZP,{title:n})})},i=(0,a.memo)(u)},22979:function(e,t,n){n.r(t);var r=n(53238),s=n(59530),o=n(62435),a=n(42932),c=n(86074);t.default=function(){var e=(0,s.useSelector)((function(e){return e.global.session})),t=e?e.chain.name:"DFS";return(0,o.useCallback)((function(){return"DFS"===t?(0,c.jsx)(a.default,{}):(0,c.jsx)(r.Z,{})}),[t])()}},42932:function(e,t,n){n.r(t),n.d(t,{default:function(){return w}});var r=n(15009),s=n.n(r),o=n(52677),a=n.n(o),c=n(99289),u=n.n(c),i=n(5574),l=n.n(i),d=n(95260),p=n(9004),f=n(19601),h=n(64119),g=n(11774),v=n(92340),x=n(59530),b=n(45360),m=n(71230),_=n(15746),S=n(62435),k=n(86074),N=0,j=0,w=function(){var e=b.ZP.useMessage(),t=l()(e,2),n=t[0],r=t[1],o=(0,S.useState)(!1),c=l()(o,2),i=c[0],w=c[1],y=(0,x.useDispatch)(),D=(0,x.useSelector)((function(e){return e.global.session})),C=(0,x.useSelector)((function(e){return e.global.contractKit})),I=(0,x.useSelector)((function(e){return e.vote.producerDataSource1})),P=(0,x.useSelector)((function(e){return e.vote.producerDataSource2})),R=(0,S.useState)(""),Z=l()(R,2),E=Z[0],O=Z[1],A=(0,S.useRef)(),F=(0,S.useCallback)(function(){var e=u()(s()().mark((function e(t,r){var o,c,u,i,l,d,h,g,v,x,b,m,_,S,k,N,j;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.load("eosio");case 3:return o=e.sent,e.next=6,r.load("dfsbpsvoters");case 6:return c=e.sent,u=c.table("bpstatus"),i=o.table("producers"),l=c.table("bpinfos"),e.next=12,u.all();case 12:return d=e.sent,e.next=15,i.all();case 15:return h=e.sent,e.next=18,l.all();case 18:return g=e.sent,e.next=21,t.client.v1.chain.get_currency_stats("eosio.token","DFS");case 21:return v=e.sent,e.next=24,t.client.v1.chain.get_currency_balance("eosio.token","dfsbpsvoters","DFS");case 24:return x=e.sent,e.next=27,t.client.v1.chain.get_producer_schedule();case 27:b=e.sent,m=b.active.producers,_=d.reduce((function(e,t){return e+t.current_status.toNumber()}),0),S={totalNodes:d.length,totalProducers:m.length,totalNodesOnline:_,rewardMinVotes:v.DFS.supply.value/1e4,bpRewardPoolBal:x[0].value},y(p.N.setNodeInfo(S)),(k=h.sort((function(e,t){return t.total_votes.value-e.total_votes.value}))).forEach((function(e,t){k[t].rank=t+1})),m.forEach((function(e,t){var n=k.find((function(t){return t.owner.toString()===e.producer_name.toString()}));m[t].is_active=n.is_active,m[t].last_claim_time=n.last_claim_time,m[t].producer_authority=n.producer_authority,m[t].producer_key=n.producer_key,m[t].total_votes=n.total_votes,m[t].url=n.url,m[t].rank=n.rank;var r=g.find((function(t){return t.bp.toString()===e.producer_name.toString()}));r?(m[t].intro=r.intro,m[t].location=r.location,m[t].logo=r.logo,m[t].nick=r.nick,m[t].p2purl=r.p2purl,m[t].rpcurl=r.rpcurl):(m[t].intro="",m[t].location="",m[t].logo="https://dfs.land/assets/icons/48x48.png",m[t].nick="",m[t].p2purl="NA",m[t].rpcurl="NA");var s=d.find((function(t){return t.bp.toString()===e.producer_name.toString()}));m[t].bp=s.bp,m[t].current_status=s.current_status,m[t].p2pstatus=s.p2pstatus,m[t].rpcstatus=s.rpcstatus,m[t].total_reward=s.total_reward})),0,m.forEach((function(e,t){m[t].key=t,"1"===m[t].current_status.toString()&&e.total_votes.value/1e8>=S.rewardMinVotes?(1,m[t].is_reward="1"):m[t].is_reward="0"})),N=[],j=[],m.forEach((function(e,t){t<15?N.push(e):j.push(e)})),y(f.N.setProducerDataSource1(N)),y(f.N.setProducerDataSource2(j)),w(!1),e.next=49;break;case 45:e.prev=45,e.t0=e.catch(0),w(!1),e.t0 instanceof Error?(console.log(e.t0.message),n.error(e.t0.message)):e.t0.response?(console.log(e.t0.response),n.error(JSON.stringify(e.t0.response.data))):e.t0.request?(console.log("no response"),n.error("No response")):(console.log(e.t0),"object"===a()(e.t0)?n.error(JSON.stringify(e.t0)):n.error(e.t0));case 49:case"end":return e.stop()}}),e,null,[[0,45]])})));return function(t,n){return e.apply(this,arguments)}}(),[]),z=(0,S.useCallback)(function(){var e=u()(s()().mark((function e(t){var n,r,o,a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=8;break}return e.next=3,(0,h.zI)(t.client.v1.chain.get_info());case 3:n=e.sent,r=l()(n,2),o=r[0],(a=r[1])?O(a.head_block_producer.toString()):(O(""),console.log(o));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);(0,S.useEffect)((function(){D&&C?(I.length&&P.length?w(!1):w(!0),F(D,C),z(D)):w(!0)}),[D,C,F,z]),(0,S.useEffect)((function(){return D&&(N=setInterval((function(){z(D)}),6e3)),function(){clearInterval(N)}}),[D,z]),(0,S.useEffect)((function(){return D&&C&&(j=setInterval((function(){F(D,C)}),12e4)),function(){clearInterval(j)}}),[D,C,F]);var M=(0,S.useMemo)((function(){return[{title:"Pruducer",dataIndex:"bp",key:"bp",fixed:!0,render:function(e,t){return E===t.bp.toString()?(0,k.jsx)("span",{className:"text-blue-500 hover:cursor-pointer",children:t.key+1+". "+t.bp.toString()}):(0,k.jsx)("span",{className:"hover:cursor-pointer",children:t.key+1+". "+t.bp.toString()})}},{title:"RPC",dataIndex:"rpcstatus",key:"rpcstatus",align:"center",render:function(e,t){return(0,k.jsx)("div",{children:"online"===t.rpcstatus?(0,k.jsx)("div",{children:1}):(0,k.jsx)("div",{className:"text-red-600 font-semibold",children:0})})}},{title:"P2P",dataIndex:"rpcstatus",key:"rpcstatus",align:"center",render:function(e,t){return(0,k.jsx)("div",{children:"online"===t.p2pstatus?(0,k.jsx)("div",{children:1}):(0,k.jsx)("div",{className:"text-red-600 font-semibold",children:0})})}},{title:"Reward",dataIndex:"current_status",key:"current_status",align:"center",render:function(e,t){return(0,k.jsx)("div",{children:"1"===t.current_status.toString()?(0,k.jsx)("div",{children:1}):(0,k.jsx)("div",{className:"text-red-600 font-semibold",children:0})})}}]}),[E]);return(0,k.jsxs)(g._z,{className:"producer",ghost:!0,children:[(0,k.jsxs)(m.Z,{gutter:10,className:"w-full",children:[(0,k.jsx)(_.Z,{lg:{span:"12"},md:{span:"12"},sm:{span:"24"},xs:{span:"24"},children:(0,k.jsx)(v.Z,{className:"mb-3",scroll:{x:!0},size:"small",columns:M,dataSource:I,defaultData:[],search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,loading:i,rowClassName:function(e){return e.bp.toString()===E?"bg-blue-200":""},onRow:function(e){return{onClick:function(){A.current.handleOpen(e)}}}})}),(0,k.jsx)(_.Z,{lg:{span:"12"},md:{span:"12"},sm:{span:"24"},xs:{span:"24"},children:(0,k.jsx)(v.Z,{className:"mb-3",scroll:{x:!0},size:"small",columns:M,dataSource:P,defaultData:[],search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,loading:i,rowClassName:function(e){return e.bp.toString()===E?"bg-blue-200":""},onRow:function(e){return{onClick:function(){A.current.handleOpen(e)}}}})})]}),(0,k.jsx)(d.Z,{ref:A}),r]})}}}]);