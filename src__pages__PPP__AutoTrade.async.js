"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5457],{67939:function(e,t,r){r.r(t);var n=r(19632),o=r.n(n),a=r(97857),s=r.n(a),c=r(15009),u=r.n(c),i=r(99289),l=r.n(i),d=r(5574),f=r.n(d),p=(r(355),r(64119)),m=r(11774),b=r(59530),v=r(80507),g=r(45360),h=r(27484),k=r.n(h),x=r(70178),y=r.n(x),S=r(62435),_=r(51409),w=r(86074);k().extend(y());var C=[];t.default=function(){(0,b.useDispatch)();var e=g.ZP.useMessage(),t=f()(e,2),r=t[0],n=(t[1],(0,b.useSelector)((function(e){return e.global.contractKit}))),a=(0,b.useSelector)((function(e){return e.global.account})),c=(0,b.useSelector)((function(e){return e.global.session})),i=(0,b.useSelector)((function(e){return e.global.privateKey})),d=((0,b.useSelector)((function(e){return e.ppp.stats})),(0,b.useSelector)((function(e){return e.ppp.vipAccounts}))),h=(0,b.useSelector)((function(e){return e.ppp.accessAccounts})),x=(0,S.useState)(0),y=f()(x,2),D=(y[0],y[1]),M=(0,S.useState)(0),A=f()(M,2),F=(A[0],A[1]),Y=(0,S.useState)(0),O=f()(Y,2),T=(O[0],O[1]),N=(0,S.useState)(0),P=f()(N,2),E=(P[0],P[1]),z=(0,S.useState)(0),H=f()(z,2),j=(H[0],H[1]),R=(0,S.useState)([]),V=f()(R,2),U=V[0],L=V[1],q=(0,S.useState)(""),I=f()(q,2),K=(I[0],I[1]),J=(0,S.useState)(0),W=f()(J,2)[1],Q=(0,S.useState)(0),Z=f()(Q,2),B=(Z[0],Z[1]),G=(0,S.useState)(!1),X=f()(G,2),$=X[0],ee=X[1],te=(0,S.useState)({}),re=f()(te,2),ne=re[0],oe=re[1],ae=(0,S.useState)({}),se=f()(ae,2),ce=(se[0],se[1]),ue=(0,S.useState)(!1),ie=f()(ue,2),le=(ie[0],ie[1]),de=(0,S.useState)(!1),fe=f()(de,2),pe=(fe[0],fe[1]),me=(0,S.useState)(!1),be=f()(me,2),ve=be[0],ge=be[1],he=(0,S.useState)(!1),ke=f()(he,2),xe=(ke[0],ke[1]),ye=(0,S.useState)(0),Se=f()(ye,2),_e=(Se[0],Se[1],(0,S.useState)([])),we=f()(_e,2),Ce=we[0],De=we[1],Me=(0,S.useState)({}),Ae=f()(Me,2),Fe=Ae[0],Ye=Ae[1],Oe=(0,S.useState)({buy:"买入",sell:"卖出"}),Te=f()(Oe,2),Ne=(Te[0],Te[1]),Pe=(0,b.useIntl)(),Ee=(Pe.formatMessage({id:"coffee.inputException"}),Pe.formatMessage({id:"msig.intlTransactionEmpty"})),ze=Pe.formatMessage({id:"common.intlPleaseConnectWallet"}),He=Pe.formatMessage({id:"common.intlPleaseConnectNetwork"}),je=(0,S.useRef)([]),Re=(0,S.useRef)(!1),Ve=(0,S.useRef)({}),Ue=(0,S.useRef)(),Le=(0,S.useRef)(0),qe=(0,S.useRef)(!0),Ie=(0,S.useCallback)((function(){var e=0,t=0,r=0,n=0;for(var o in Ve.current)"success"===Ve.current[o].status?t+=1:"error"===Ve.current[o].status?r+=1:"processing"===Ve.current[o].status?n+=1:"default"===Ve.current[o].status&&(e+=1);D(t),F(r),T(n),E(e)}),[]),Ke=(0,S.useCallback)((function(e,t){var r=k()(e).add(t,"seconds").valueOf();B(r)}),[]),Je=(0,S.useCallback)(function(){var e=l()(u()().mark((function e(t){var r,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n=k()().format("YYYY-MM-DDTHH:mm:ss.SSS"),C.push({time:n}),t.forEach((function(e){if("success"!==Ve.current[e.cid].status&&"processing"!==Ve.current[e.cid].status&&("error"!==Ve.current[e.cid].status||!Ve.current[e.cid].message.includes("invalid price"))){var t=new Promise((function(t){Ve.current[e.cid].status="processing",Ie(),c.client.v1.chain.push_transaction(e.signedTransaction).then((function(r){r&&r.processed&&"executed"===r.processed.receipt.status?(Ve.current[e.cid].status="success",Ie(),t(!0)):("success"!==Ve.current[e.cid].status&&(Ve.current[e.cid].status="error",C.push({cid:e.cid,error:JSON.stringify(r),pos:"then"}),console.log(r),Ie()),t(!1))})).catch((function(r){if("success"!==Ve.current[e.cid].status){if(Ve.current[e.cid].status="error",Ie(),C.push({cid:e.cid,error:JSON.stringify(r),pos:"catch"}),r instanceof Error)if(r.message.includes("eosio_assert_message assertion failure"))r.details[0].message.includes("invalid price")&&(Ve.current[e.cid].message="invalid price");console.log(r)}t(!1)}))}));r.push(t)}}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[c,Ie]),We=((0,S.useCallback)(function(){var e=l()(u()().mark((function e(t){var o,s,i,l,f,m,b,g,h,x,y,S,_,w,C,D,M,A,F,Y,O,T,N,P,E,z;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,c&&c.broadcast){e.next=6;break}return r.error("".concat(ze)),e.abrupt("return");case 6:if(a){e.next=9;break}return r.error("".concat(He)),e.abrupt("return");case 9:if("owner"===(s=c.permissionLevel.permission.toString())||"active"===s){e.next=13;break}return r.error("permission权限必须是owner或者active"),e.abrupt("return");case 13:return pe(!0),i=t.pidAuto,l=t.countAuto,f=t.disorderAuto,m=t.startAuto,b=t.endAuto,g=Number(i.split("-")[1]),h=c.actor.toString(),e.next=19,n.load("dfs3protocol");case 19:return x=e.sent,e.next=22,c.client.v1.chain.get_table_rows({code:"dfs3protocol",table:"registry",scope:"dfs3protocol",key_type:"i64",index_position:"secondary",lower_bound:v.zM.from(g),upper_bound:v.zM.from(g),limit:1e3});case 22:return y=e.sent,S=y.rows,_=x.table("projects"),e.next=27,_.all({scope:"dfs3protocol",from:g,to:g});case 27:if(w=e.sent,C=w[0].init_nft_price.value,D=w[0].init_nft_price.symbol.name,M=w[0].sec_per_round.toNumber(),A=w[0].last_round.toString(),A=k().utc(A).local().format("YYYY-MM-DDTHH:mm:ss"),F=k()(A).add(M,"seconds").format("YYYY-MM-DDTHH:mm:ss"),"DFS"===D||"USDT"===D||"ORDI"===D){e.next=38;break}return r.error("不支持当前项目"),pe(!1),e.abrupt("return");case 38:if(!(m>S.length)){e.next=42;break}return r.error("开始序号超过当前项目最大值".concat(S.length)),pe(!1),e.abrupt("return");case 42:if(!b){e.next=51;break}if(!(m>b)){e.next=47;break}return r.error("开始序号超过结束序号"),pe(!1),e.abrupt("return");case 47:Y=S.length>b?b:S.length,S=S.slice(m-1,Y),e.next=52;break;case 51:S=S.slice(m-1);case 52:O=0,T=0,f&&S.sort((function(){return Math.random()-.5})),N=0;case 56:if(!(N<S.length)){e.next=73;break}if(P=S[N].owner,E=Number(S[N].current_price.split(" ")[0]),P!==h){e.next=61;break}return e.abrupt("continue",70);case 61:if(!(E>=2*C)){e.next=63;break}return e.abrupt("continue",70);case 63:if(!(O>=l)){e.next=65;break}return e.abrupt("break",73);case 65:if(!(O>=3e3)){e.next=67;break}return e.abrupt("break",73);case 67:O+=1,T+=E;case 70:++N,e.next=56;break;case 73:return z=d.includes(h)?T.toFixed(8)+" "+D:(1.005*T).toFixed(8)+" "+D,null===(o=Ue.current)||void 0===o||o.setFieldValue("amountAuto",z),K(F),Ke(A,M),Re.current=!1,xe(!0),pe(!1),e.abrupt("return",!0);case 83:e.prev=83,e.t0=e.catch(0),pe(!1),(0,p.Tv)(e.t0,r);case 87:case"end":return e.stop()}}),e,null,[[0,83]])})));return function(t){return e.apply(this,arguments)}}(),[Ke,a,n,c,d]),(0,S.useCallback)((function(){var e,t=je.current;if(0===t.length)return r.error(Ee),console.log(Ee),!1;var n=null===(e=Ue.current)||void 0===e?void 0:e.getFieldsValue(),o=n.disorderAuto,a=n.repeatAuto,s=n.intervalAuto,c=n.loop;try{o?t.sort((function(){return Math.random()-.5})):t.sort((function(e,t){return e.cid-t.cid})),console.log("handleCountDownFinishAuto",k()().format()),C.push({position:"handleCountDownFinishAuto",time:k()().format()}),Je(t);for(var u=1;u<a;u++)(0,_.iK)(Je,s*u,t);return c&&(qe.current=!0,(0,_.gr)(Le.current),Le.current=(0,_.iK)((function(){var e;return null===(e=Ue.current)||void 0===e?void 0:e.submit()}),6e5)),!0}catch(e){(0,p.Tv)(e,r)}}),[U,Je]),(0,S.useCallback)((function(){var e;null===(e=Ue.current)||void 0===e||e.resetFields(),F(0),D(0),T(0),E(0),L([]),K(""),B(0),W(0),Ve.current={},ce({}),oe({}),j(0),Ie(),Re.current=!1,qe.current=!0}),[Ie]),(0,S.useCallback)(function(){var e=l()(u()().mark((function e(t){var n,o,a,s,c,i,l,d,f,m,b,v,g,h;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.load("swapswapswap");case 3:return a=e.sent,e.next=6,t.load("dfs3protocol");case 6:return s=e.sent,c=a.table("markets"),i=s.table("projects"),e.next=11,c.all();case 11:return l=e.sent,e.next=14,i.all();case 14:d=e.sent,f={},d.forEach((function(e){var t=e.max_token_supply.symbol.name;f[t]=e.token_url})),m=[],"usdtusdtusdt-USDT-8",v="eosio.token-DFS-8",g=[],(b={})["usdtusdtusdt-USDT-8"]=1,b[v]=(0,p.ri)(l[0].reserve0)/(0,p.ri)(l[0].reserve1),l.forEach((function(e){var t=e.contract0.toString(),r=e.contract1.toString(),n=t+"-"+e.sym0.name+"-"+e.sym0.precision,o=r+"-"+e.sym1.name+"-"+e.sym1.precision;m.includes(n)||m.push(n),m.includes(o)||m.push(o);var a=(0,p.ri)(e.reserve0),s=(0,p.ri)(e.reserve1);"eosio.token"===t?b.hasOwnProperty(o)||(b[o]=a/s*b[v]):"eosio.token"===r?b.hasOwnProperty(n)||(b[n]=s/a*b[v]):"usdtusdtusdt"===t?b.hasOwnProperty(o)||(b[o]=a/s):"usdtusdtusdt"===r?b.hasOwnProperty(n)||(b[n]=s/a):g.push({key0:n,key1:o,value0:a,value1:s})})),g.forEach((function(e){var t=e.key0,r=e.key1,n=e.value0,o=e.value1;b.hasOwnProperty(t)&&!b.hasOwnProperty(r)?b[r]=n/o*b[t]:!b.hasOwnProperty(t)&&b.hasOwnProperty(r)?b[t]=o/n*b[r]:b.hasOwnProperty(t)||b.hasOwnProperty(r)||(b[t]=0,b[r]=0)})),Object.keys(b).forEach((function(e){Number.isNaN(b[e])&&(b[e]=0)})),l.sort((function(e,t){var r=e.contract0.toString(),n=e.contract1.toString(),o=t.contract0.toString(),a=t.contract1.toString(),s=e.sym0.name,c=e.sym1.name,u=t.sym0.name,i=t.sym1.name,l=r+"-"+s+"-"+e.sym0.precision,d=n+"-"+c+"-"+e.sym1.precision,f=o+"-"+u+"-"+t.sym0.precision,m=a+"-"+i+"-"+t.sym1.precision,v=(0,p.ri)(e.reserve0),g=(0,p.ri)(e.reserve1),h=(0,p.ri)(t.reserve0),k=(0,p.ri)(t.reserve1),x=v*b[l]+g*b[d];return h*b[f]+k*b[m]-x})),h={},l.forEach((function(e){var t=e.mid.toNumber(),r=e.contract0.toString(),n=e.contract1.toString(),o=e.sym0.name,a=e.sym1.name,s=e.sym0.precision,c=e.sym1.precision,u=e.reserve0.toString(),i=e.reserve1.toString(),l="".concat(n,"-").concat(a),d="dfsppptokens"===n?f[a]:"https://dfs.land/assets/tokens/".concat(l,".png");h[t]="".concat(t,"_").concat(r,"_").concat(o,"_").concat(s,"_").concat(u,"_").concat(n,"_").concat(a,"_").concat(c,"_").concat(i,"_").concat(d)})),null===(n=Ue.current)||void 0===n||n.setFieldValue("mid",""),null===(o=Ue.current)||void 0===o||o.setFieldValue("liquidity",""),Ye(h),De(l),ge(!1),e.next=41;break;case 37:e.prev=37,e.t0=e.catch(0),ge(!1),(0,p.Tv)(e.t0,r);case 41:case"end":return e.stop()}}),e,null,[[0,37]])})));return function(t){return e.apply(this,arguments)}}(),[])),Qe=((0,S.useCallback)((function(){return c&&c.broadcast?a?(ge(!0),void We(n)):(r.error("".concat(He)),!1):(r.error("".concat(ze)),!1)}),[c,a,We,n]),(0,S.useCallback)(l()(u()().mark((function e(){var t,n,o,a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(U.length){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,le(!0),t={},e.next=7,c.client.v1.chain.get_table_rows({code:"dfs3protocol",table:"registry",scope:"dfs3protocol",key_type:"i64",index_position:"secondary",lower_bound:v.zM.from(ne.pid),upper_bound:v.zM.from(ne.pid),limit:1e3});case 7:n=e.sent,o=n.rows,a=0,U.forEach((function(e){var r=e.from,n=e.cid;o.filter((function(t){return t.cid===e.cid}))[0].owner===r?(t[n]="success",a+=1):t[n]="default"})),j(a),ce(t),le(!1),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(2),le(!1),(0,p.Tv)(e.t0,r);case 20:case"end":return e.stop()}}),e,null,[[2,16]])}))),[n,r,ne,U,c]),(0,S.useCallback)((function(e){if(e.hasOwnProperty("mid")){var t,r,n=null===(t=Ue.current)||void 0===t?void 0:t.getFieldValue("mid"),o=Ce.filter((function(e){return e.mid.toString()===n}))[0],a=o.reserve0.toString(),s=o.reserve1.toString(),c=o.reserve1.symbol.name;null===(r=Ue.current)||void 0===r||r.setFieldValue("liquidity",s+" / "+a),Ne({buy:"买入 "+c,sell:"卖出 "+c})}}),[Ce]),(0,S.useCallback)(l()(u()().mark((function e(){var t,l,m,b,g,h,x,y,S,_,w,C,M,A,Y,O,N,P,z,H,R,V,U,q,I,K,J,W,Q,Z,B,G,X,$,ee,te,re,ne,ae,se,ue,ie,le,de,fe,me,be,ve,ge,he,ke,xe,ye,Se,_e,we,Ce;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,c&&c.broadcast){e.next=7;break}return r.error("".concat(ze)),console.log(ze),e.abrupt("return");case 7:if(a){e.next=11;break}return r.error("".concat(He)),console.log(He),e.abrupt("return");case 11:if("owner"===(m=c.permissionLevel.permission.toString())||"active"===m){e.next=16;break}return r.error("permission权限必须是owner或者active"),console.log("permission权限必须是owner或者active"),e.abrupt("return");case 16:return pe(!0),b=null===(t=Ue.current)||void 0===t?void 0:t.getFieldsValue(),g=b.pidAuto,h=b.countAuto,x=b.disorderAuto,y=b.startAuto,S=b.endAuto,_=Number(g.split("-")[1]),w=c.actor.toString(),e.next=22,n.load("dfs3protocol");case 22:return C=e.sent,e.next=25,c.client.v1.chain.get_table_rows({code:"dfs3protocol",table:"registry",scope:"dfs3protocol",key_type:"i64",index_position:"secondary",lower_bound:v.zM.from(_),upper_bound:v.zM.from(_),limit:1e3});case 25:return M=e.sent,A=M.rows,Y=C.table("projects"),e.next=30,Y.all({scope:"dfs3protocol",from:_,to:_});case 30:if(O=e.sent,N=O[0].creator.toString(),P=O[0].nft_name.toString(),z=O[0].project_name,H=O[0].init_nft_price.value,R=O[0].init_nft_price.symbol.name,V="","DFS"!==R){e.next=41;break}V="eosio.token",e.next=53;break;case 41:if("USDT"!==R){e.next=45;break}V="usdtusdtusdt",e.next=53;break;case 45:if("ORDI"!==R){e.next=49;break}V="ordiordiordi",e.next=53;break;case 49:return r.error("不支持当前项目"),pe(!1),console.log("不支持当前项目"),e.abrupt("return");case 53:if(!(y>A.length)){e.next=58;break}return r.error("开始序号超过当前项目最大值".concat(A.length)),pe(!1),console.log("开始序号超过当前项目最大值".concat(A.length)),e.abrupt("return");case 58:if(!S){e.next=67;break}if(!(y>S)){e.next=63;break}return r.error("开始序号超过结束序号"),pe(!1),e.abrupt("return");case 63:U=A.length>S?S:A.length,A=A.slice(y-1,U),e.next=68;break;case 67:A=A.slice(y-1);case 68:return q={account:"dfsfreecpu11",name:"freecpu",authorization:[{actor:"dfs.service",permission:"cpu"},c.permissionLevel],data:p._9.from({user:w})},I=v.aU.from(q),e.next=72,c.client.v1.chain.get_info();case 72:K=e.sent,J=K.getTransactionHeader(),W=k()(),Q=[],Z={},B=0,G="",X=0,x&&A.sort((function(){return Math.random()-.5})),$=0;case 82:if(!($<A.length)){e.next=130;break}if(ee=A[$].owner,te=Number(A[$].current_price.split(" ")[0]),ee!==w){e.next=87;break}return e.abrupt("continue",127);case 87:if(!(te>=2*H)){e.next=89;break}return e.abrupt("continue",127);case 89:if(!(B>=h)){e.next=91;break}return e.abrupt("break",130);case 91:if(!(B>=3e3)){e.next=93;break}return e.abrupt("break",130);case 93:return G=k()(W).add(3600-B++,"seconds").utc().format("YYYY-MM-DDTHH:mm:ss"),re=A[$].current_price,ne=v.xR.from(re),ae=ne.value,se=ne.symbol,ue=v.xR.from(.003*ae,se),ie="buy:"+A[$].id.toString(),X+=ae,le={account:V,name:"transfer",authorization:[c.permissionLevel],data:p.FE.from({from:w,to:"dfs3protocol",quantity:re,memo:ie})},de=v.aU.from(le),fe={account:V,name:"transfer",authorization:[c.permissionLevel],data:p.FE.from({from:w,to:"davidaccount",quantity:ue,memo:"fee"})},me=v.aU.from(fe),be=void 0,ve=void 0,ge=[],he=d.includes(w)?[I,de]:[I,de,me],be=v.YW.from(s()(s()({},J),{},{expiration:G,actions:he})),ge[0]=i.signDigest(be.signingDigest(c.chain.id.toString())),e.next=113,(0,p.zI)(c.transact({transaction:be},{broadcast:!1,transactPlugins:[]}));case 113:if(ke=e.sent,xe=f()(ke,2),ye=xe[0],Se=xe[1],!ye){e.next=122;break}return r.error(ye),pe(!1),console.log(ye),e.abrupt("return");case 122:ve=v.uQ.from(s()(s()({},be),{},{signatures:[].concat(ge,o()(Se.signatures))})),_e=A[$].cid,we=A[$].id,Z[_e]={status:"default",message:""},Q.push({signedTransaction:ve,cid:_e,nftid:we,amount:ae,from:w});case 127:++$,e.next=82;break;case 130:Ce=d.includes(w)?X.toFixed(8)+" "+R:(1.005*X).toFixed(8)+" "+R,null===(l=Ue.current)||void 0===l||l.setFieldValue("amountAuto",Ce),Ve.current=Z,ce({}),F(0),D(0),T(0),E(Q.length),L(Q),je.current=Q,j(0),oe({pid:_,creator:N,nft_name:P,project_name:z}),j(0),r.success("创建完成"),pe(!1),console.log("创建完成"),e.next=153;break;case 148:e.prev=148,e.t0=e.catch(0),pe(!1),(0,p.Tv)(e.t0,r),console.log(e.t0);case 153:case"end":return e.stop()}}),e,null,[[0,148]])}))),[n,c,a,d])),Ze=((0,S.useCallback)((function(e){var t;e<18e5&&!Re.current&&(Re.current=!0,Qe());var r=null===(t=Ue.current)||void 0===t?void 0:t.getFieldValue("leadTimeAuto");r&&e<r&&qe.current&&(qe.current=!1,Je(je.current),console.log(k()().format(),"handleCountdownChangeAuto",e),C.push({position:"handleCountdownChangeAuto",time:k()().format(),value:e}))}),[Qe,Je]),(0,S.useCallback)((function(){xe(!1),B(0),(0,_.gr)(Le.current),qe.current=!0}),[]),(0,S.useCallback)((function(){if($){if(a){var e=a.accountName.toString();return!!h.includes(e)||(ee(!1),!1)}return!0}if(a){var t=a.accountName.toString();return!!h.includes(t)&&(ee(!0),!0)}return!1}),[a,$,h]));(0,S.useCallback)((function(){var e=k()().format("YYYY-MM-DDTHH:mm:ss"),t=JSON.stringify(C,null,2),r="data:,".concat(t),n=document.createElement("a");n.href=r,n.download="log_".concat(e,".json"),n.click()}),[]),(0,S.useCallback)((function(){var e;F(0),D(0),T(0),E(0),L([]),K(""),B(0),W(0),Ve.current={},ce({}),oe({}),j(0),Ie(),Re.current=!1,qe.current=!0,null===(e=Ue.current)||void 0===e||e.setFieldValue("amountAuto","")}),[Ie]);return(0,S.useEffect)((function(){!n||Object.keys(Fe).length||ve||(ge(!0),We(n))}),[We,Fe,n,ve]),(0,w.jsx)(m._z,{className:"",ghost:!0,children:(Ze(),(0,w.jsx)("div",{}))})}}}]);